2025å¹´07æœˆ21æ—¥ 22:00  
åŸºäºæ¨¡æ¿æ–¹æ³•çš„å¤šé…ç½®ä¸­å¿ƒæŠ½è±¡å±‚è®¾è®¡ï¼Œå…ƒæ•°æ®ä¿¡æ¯ï¼š

*  
ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± oneThreadï¼š<https://t.zsxq.com/5GfrN>  
*  
ä»£ç ä»“åº“ï¼š<https://gitcode.net/nageoffer/onethread> ------ ç”³è¯·é¡¹ç›®æƒé™å‚è€ƒä¸Šè¿°çº¿ç¨‹æ± é¡¹ç›®é“¾æ¥  
*  
ç« èŠ‚éš¾åº¦ï¼šâ˜…â˜…â˜…â˜†â˜† - è¾ƒéš¾  
*  
  è§†é¢‘åœ°å€ï¼šæ–‡æ¡£å…ˆè¡Œè§†é¢‘æ¬¡ä¹‹



*** ** * ** ***

å†…å®¹æ‘˜è¦ï¼šæœ¬æ–‡é€šè¿‡å¯¹ Nacosã€Apollo ä¸¤ç§é…ç½®ä¸­å¿ƒåˆ·æ–°å®ç°çš„å¯¹æ¯”å‰–æï¼Œå¼•å‡ºå…¶åœ¨å¤šé…ç½®ä¸­å¿ƒæ‰©å±•ä¸­çš„è®¾è®¡çŸ­æ¿ï¼Œç»§è€Œå¼•å…¥**æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼**å¯¹åˆ·æ–°é€»è¾‘è¿›è¡ŒæŠ½è±¡é‡æ„ã€‚

è¯¾ç¨‹ç›®å½•å¦‚ä¸‹æ‰€ç¤ºï¼š

*  
å‰è¨€  
*  
å¤šé…ç½®ä¸­å¿ƒè®¾è®¡çŸ­æ¿  
*  
ä»€ä¹ˆæ˜¯æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼ï¼Ÿ  
*  
ä½¿ç”¨æ¨¡æ¿æ–¹æ³•é‡æ„åˆ·æ–°äº‹ä»¶  
*  
  æ–‡æœ«æ€»ç»“

å‰è¨€
---

åœ¨å‰é¢çš„ç« èŠ‚ä¸­ï¼Œä¸ºäº†å¸®åŠ©å¤§å®¶å¿«é€Ÿç†è§£åŠ¨æ€çº¿ç¨‹æ± çš„**é…ç½®åˆ·æ–°æœºåˆ¶** ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€äº›"ä¸´æ—¶ä»£ç "ä½œä¸ºæ¼”ç¤ºã€‚è¿™äº›ä»£ç è™½ç„¶ç®€æ´ç›´è§‚ï¼Œä½†å¹¶ä¸æ˜¯æˆ‘ä»¬çœŸæ­£è½åœ°æ—¶é‡‡ç”¨çš„æ–¹å¼ã€‚

åœ¨ oneThread çš„çœŸå®å®ç°ä¸­ï¼Œæˆ‘ä»¬ä¸ºäº†æ”¯æŒå¤šç§é…ç½®ä¸­å¿ƒå¹¶ä¿æŒè‰¯å¥½çš„å¯ç»´æŠ¤æ€§ï¼Œé‡‡ç”¨äº†**æ¨¡æ¿æ–¹æ³•æ¨¡å¼** æ¥å°è£…å…¬å…±æµç¨‹ã€æŠ½è±¡å·®å¼‚è¡Œä¸ºï¼Œä»è€Œå®ç°å¯æ‰©å±•ã€é«˜å†…èšçš„åŠ¨æ€é…ç½®åˆ·æ–°èƒ½åŠ›ã€‚

æœ¬æ–‡å°†å¸¦ä½ å®Œæ•´æ¢³ç†çº¿ç¨‹æ± é…ç½®åŠ¨æ€åŒ–çš„è®¾è®¡æ¼”è¿›ï¼Œé‡ç‚¹èšç„¦åœ¨**å¤šé…ç½®ä¸­å¿ƒæ”¯æŒçš„è®¾è®¡çŸ­æ¿** ä¸**ä¸ºä½•éœ€è¦å¼•å…¥æ¨¡æ¿æ–¹æ³•æ¨¡å¼** ã€‚

å¤šé…ç½®ä¸­å¿ƒè®¾è®¡çŸ­æ¿
---------

ç›®å‰æˆ‘ä»¬å·²ç»æ”¯æŒ Nacos å’Œ Apollo ä¸¤ç§ä¸»æµé…ç½®ä¸­å¿ƒï¼Œä¸‹é¢æ˜¯å®ƒä»¬å„è‡ªçš„ç›‘å¬å®ç°æ–¹å¼ã€‚

### 1. Nacos é…ç½®åˆ·æ–°äº‹ä»¶å®ç° {#1-nacos}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    @Slf4j
    @RequiredArgsConstructor
    public class NacosCloudRefresherHandlerV1 implements ApplicationRunner {
    â€‹
        private final ConfigService configService;
        private final BootstrapConfigProperties properties;
    â€‹
        @Override
        public void run(ApplicationArguments args) throws Exception {
            BootstrapConfigProperties.NacosConfig nacosConfig = properties.getNacos();
            configService.addListener(
                    nacosConfig.getDataId(),
                    nacosConfig.getGroup(),
                    new Listener() {
    â€‹
                        @Override
                        public Executor getExecutor() {
                            return xxx;
                        }
    â€‹
                        @Override
                        public void receiveConfigInfo(String configInfo) {
                            refreshThreadPoolProperties(content); // åˆ·æ–°åŠ¨æ€çº¿ç¨‹æ± é…ç½®
                        }
                    });
    â€‹
            log.info("Dynamic thread pool refresher, add nacos cloud listener success. data-id: {}, group: {}", nacosConfig.getDataId(), nacosConfig.getGroup());
        }
    â€‹
        public void refreshThreadPoolProperties(String configInfo) throws IOException {
            Map<Object, Object> configInfoMap = ConfigParserHandler.getInstance().parseConfig(configInfo, properties.getConfigFileType());
            ConfigurationPropertySource sources = new MapConfigurationPropertySource(configInfoMap);
            Binder binder = new Binder(sources);
    â€‹
            BootstrapConfigProperties refresherProperties = binder.bind(BootstrapConfigProperties.PREFIX, Bindable.ofInstance(properties)).get();
            log.info("Latest updated configuration: \n{}", configInfo);
            log.info("Java configuration object binding: \n{}", JSON.toJSONString(refresherProperties));
    â€‹
            // ...... æ£€æµ‹çº¿ç¨‹æ± å‚æ•°æ˜¯å¦å˜æ›´ï¼Œå¦‚æœå·²å˜æ›´åˆ™è¿›è¡Œæ›´æ–°
        }
    }
              
### 2. Apollo é…ç½®åˆ·æ–°äº‹ä»¶å®ç° {#2-apollo}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    @Slf4j
    @RequiredArgsConstructor
    public class ApolloRefresherHandlerV1 implements ApplicationRunner {
    â€‹
        private final BootstrapConfigProperties properties;
    â€‹
        @Override
        public void run(ApplicationArguments args) throws Exception {
            BootstrapConfigProperties.ApolloConfig apolloConfig = properties.getApollo();
            String[] apolloNamespaces = apolloConfig.getNamespace().split(",");
    â€‹
            String namespace = apolloNamespaces[0];
            String configFileType = properties.getConfigFileType().getValue();
            Config config = ConfigService.getConfig(String.format("%s.%s", namespace, properties.getConfigFileType().getValue()));
    â€‹
            ConfigChangeListener configChangeListener = createConfigChangeListener(namespace, configFileType);
            config.addChangeListener(configChangeListener);
    â€‹
            log.info("Dynamic thread pool refresher, add apollo listener success. namespace: {}", namespace);
        }
    â€‹
        private ConfigChangeListener createConfigChangeListener(String namespace, String configFileType) {
            return configChangeEvent -> {
                // å¦‚æœ Apollo é…ç½®æ–‡ä»¶å˜æ›´ï¼Œä¼šè§¦å‘è¯¥æ–¹æ³•è¿›è¡Œå›è°ƒ
                String namespaceItem = namespace.replace("." + configFileType, "");
                ConfigFileFormat configFileFormat = ConfigFileFormat.fromString(configFileType);
                ConfigFile configFile = ConfigService.getConfigFile(namespaceItem, configFileFormat);
                String content = configFile.getContent(); // å˜æ›´åçš„æœ€æ–°å†…å®¹
                refreshThreadPoolProperties(content); // åˆ·æ–°åŠ¨æ€çº¿ç¨‹æ± é…ç½®
            };
        }
    â€‹
        public void refreshThreadPoolProperties(String configInfo) throws IOException {
            Map<Object, Object> configInfoMap = ConfigParserHandler.getInstance().parseConfig(configInfo, properties.getConfigFileType());
            ConfigurationPropertySource sources = new MapConfigurationPropertySource(configInfoMap);
            Binder binder = new Binder(sources);
    â€‹
            BootstrapConfigProperties refresherProperties = binder.bind(BootstrapConfigProperties.PREFIX, Bindable.ofInstance(properties)).get();
            log.info("Latest updated configuration: \n{}", configInfo);
            log.info("Java configuration object binding: \n{}", JSON.toJSONString(refresherProperties));
    â€‹
            // ...... æ£€æµ‹çº¿ç¨‹æ± å‚æ•°æ˜¯å¦å˜æ›´ï¼Œå¦‚æœå·²å˜æ›´åˆ™è¿›è¡Œæ›´æ–°
        }
    }
              
### 3. å­˜åœ¨çš„ä¸»è¦é—®é¢˜ {#3}

éšç€å¯¹é…ç½®ä¸­å¿ƒçš„æ”¯æŒå¢åŠ ï¼Œä¸Šè¿°å®ç°ä¼šæš´éœ²å‡ºä»¥ä¸‹è®¾è®¡çŸ­æ¿ï¼š

#### 3.1 ä»£ç é‡å¤ {#3-1}

*  
`refreshThreadPoolProperties()` çš„é€»è¾‘åœ¨æ¯ä¸ªç±»ä¸­**é‡å¤å‡ºç°** ï¼›  
*  
`ApplicationRunner` æ¥å£éœ€è¦åœ¨æ¯ä¸ªç±»ä¸­**é‡å¤å®ç°** ï¼›  
*  
  æ¯å¢åŠ ä¸€ç§é…ç½®ä¸­å¿ƒï¼Œéƒ½éœ€**å¤åˆ¶ç²˜è´´ä¸€ä»½é€»è¾‘** ï¼Œä¸åˆ©äºç»´æŠ¤ä¸æ‰©å±•ã€‚

#### 3.2 è¡Œä¸ºæ— æ³•çº¦æŸ {#3-2}

*  
æ¯ä¸ªé…ç½®ä¸­å¿ƒçš„ç›‘å¬å®ç°ç±»è§¦å‘æ—¶æœºéƒ½æ˜¯è‡ªç”±å‘æŒ¥ï¼Œ**ç¼ºä¹ç»Ÿä¸€çº¦æŸè§„èŒƒ** ï¼›  
*  
å®¹æ˜“å‡ºç°è°ƒç”¨æ—¶æœºä¸ä¸€è‡´ã€ç›‘å¬å¤±è´¥æ— å…œåº•ã€çº¿ç¨‹æ± å˜æ›´æœªè§¦å‘ç­‰é—®é¢˜ï¼›  
*  
  éš¾ä»¥ç»Ÿä¸€å‡çº§æˆ–å¢å¼ºå…¬å…±èƒ½åŠ›ï¼ˆä¾‹å¦‚ç»Ÿä¸€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ± é‡è½½é€»è¾‘ç­‰ï¼‰ã€‚

æ¥ä¸‹æ¥çš„ç« èŠ‚å°†ä»‹ç»æˆ‘ä»¬æ˜¯å¦‚ä½•å€ŸåŠ©**æ¨¡æ¿æ–¹æ³•æ¨¡å¼** è®¾è®¡ä¸€ä¸ªç»Ÿä¸€çš„åˆ·æ–°æŠ½è±¡ç±»ï¼Œå¹¶æ”¯æŒä»¥æœ€å°æˆæœ¬æ‰©å±•æ›´å¤šé…ç½®ä¸­å¿ƒçš„ã€‚

ä»€ä¹ˆæ˜¯æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼ï¼Ÿ
------------

### 1. æ¨¡æ¿æ–¹æ³•å®šä¹‰ {#1}

**æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼** æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œå®ƒåœ¨ä¸€ä¸ªæ–¹æ³•ä¸­å®šä¹‰äº†ä¸€ä¸ªæ“ä½œçš„æ¡†æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤çš„å®ç°å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ¨¡æ¿æ–¹æ³•å…è®¸å­ç±»åœ¨ä¸æ”¹å˜ç®—æ³•ç»“æ„çš„æƒ…å†µä¸‹é‡æ–°å®šä¹‰ç®—æ³•ä¸­çš„æŸäº›æ­¥éª¤ã€‚

é€šä¿—æ¥è®² : å®šä¹‰ä¸€ä¸ªæŠ½è±¡ç±» `AbstractTemplate`ï¼Œå¹¶å®šä¹‰ä¸€ä¸ªæˆ–è‹¥å¹²æŠ½è±¡æ–¹æ³• `abstractMethod`ã€‚

ç”±å­ç±»å»ç»§æ‰¿æŠ½è±¡ç±»çš„åŒæ—¶å®ç°æŠ½è±¡æ–¹æ³•ï¼Œ åœ¨æŠ½è±¡ç±»çš„å…¬å…±æ–¹æ³•ä¸­è°ƒç”¨æŠ½è±¡æ–¹æ³•ï¼Œæœ€ç»ˆè°ƒç”¨çš„å°±æ˜¯ä¸åŒå­ç±»å®ç°çš„æ–¹æ³•é€»è¾‘ã€‚

### 2. ç”¨æˆ·ç™»å½•ä¸¾ä¾‹ {#2}

**èƒŒæ™¯ï¼š** å‡è®¾æˆ‘ä»¬æœ‰ä¸€å¥—ç”¨æˆ·ç™»å½•é€»è¾‘ï¼Œå…¶æ€»ä½“æµç¨‹å¦‚ä¸‹ï¼š

* 1.  
è·å–ç”¨æˆ·è¾“å…¥ï¼›  
* 2.  
æ ¡éªŒèº«ä»½ï¼ˆç”¨æˆ·åå¯†ç ã€éªŒè¯ç ã€OAuth token ç­‰ï¼‰ï¼›  
* 3.  
  ç™»å½•æˆåŠŸåå†™å…¥æ—¥å¿—æˆ–å‘é€šçŸ¥ã€‚

è¿™ä¸ªæµç¨‹å¯¹äºä¸åŒç™»å½•æ–¹å¼ï¼ˆè´¦å·å¯†ç ç™»å½•ã€å¾®ä¿¡æ‰«ç ç™»å½•ã€é’‰é’‰å…ç™»ç™»å½•ç­‰ï¼‰æ˜¯ä¸€è‡´çš„ï¼Œåªæœ‰"æ ¡éªŒæ–¹å¼"ä¸åŒï¼Œå…¸å‹é€‚åˆä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼æŠ½è±¡å‡ºå…¬å…±æµç¨‹ã€‚

#### 2.1 æŠ½è±¡æ¨¡æ¿ç±» {#2-1}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    public abstract class LoginTemplate {
    â€‹
        /**
         * æ¨¡æ¿æ–¹æ³•ï¼šå®šä¹‰å›ºå®šç™»å½•æµç¨‹
         */
        public final void login(String loginId) {
            // 1. è·å–ç”¨æˆ·è¾“å…¥
            String input = getLoginInput(loginId);
            // 2. æ‰§è¡Œè®¤è¯é€»è¾‘ï¼ˆç”±å­ç±»å†³å®šæ€ä¹ˆè®¤è¯ï¼‰
            boolean success = authenticate(input);
            if (success) {
                // 3. ç™»å½•æˆåŠŸåçš„å¤„ç†
                postLogin(loginId);
            } else {
                System.out.println("[LoginTemplate] ç™»å½•å¤±è´¥");
            }
        }
    â€‹
        /**
         * è·å–ç™»å½•è¾“å…¥ï¼ˆå¯é€‰æ­¥éª¤ï¼Œé»˜è®¤å®ç°ï¼‰
         */
        protected String getLoginInput(String loginId) {
            return loginId; // é»˜è®¤ç›´æ¥è¿”å›ç”¨æˆ·åç­‰
        }
    â€‹
        /**
         * è®¤è¯é€»è¾‘ï¼ˆæŠ½è±¡æ–¹æ³•ï¼‰
         */
        protected abstract boolean authenticate(String input);
    â€‹
        /**
         * ç™»å½•æˆåŠŸåçš„æ“ä½œï¼ˆé’©å­æ–¹æ³•ï¼‰
         */
        protected void postLogin(String loginId) {
            System.out.println("[LoginTemplate] ç™»å½•æˆåŠŸï¼Œç”¨æˆ·ï¼š" + loginId);
        }
    }
              
#### 2.2 å­ç±»ä¸€ï¼šè´¦å·å¯†ç ç™»å½• {#2-2}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    public class UsernamePasswordLogin extends LoginTemplate {
    â€‹
        @Override
        protected boolean authenticate(String input) {
            System.out.println("[UsernamePasswordLogin] æ­£åœ¨æ ¡éªŒç”¨æˆ·åå’Œå¯†ç ...");
            return "admin".equals(input); // æ¨¡æ‹Ÿåˆ¤æ–­ç”¨æˆ·åç­‰äº admin æ‰èƒ½ç™»å½•
        }
    â€‹
        @Override
        protected void postLogin(String loginId) {
            System.out.println("[UsernamePasswordLogin] ç™»å½•æˆåŠŸï¼Œè®°å½•ç™»å½•æ—¥å¿—ï¼š" + loginId);
        }
    }
              
#### 2.3 å­ç±»äºŒï¼šå¾®ä¿¡æ‰«ç ç™»å½• {#2-3}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    public class WeChatScanLogin extends LoginTemplate {
    â€‹
        @Override
        protected boolean authenticate(String input) {
            System.out.println("[WeChatScanLogin] æ­£åœ¨æ ¡éªŒå¾®ä¿¡äºŒç»´ç ...");
            return input.startsWith("wx_"); // æ¨¡æ‹Ÿå¾®ä¿¡äºŒç»´ç å‰ç¼€
        }
    â€‹
        @Override
        protected void postLogin(String loginId) {
            System.out.println("[WeChatScanLogin] ç™»å½•æˆåŠŸï¼Œæ¨é€æ¬¢è¿æ¶ˆæ¯ï¼š" + loginId);
        }
    }
              
#### 2.4 æµ‹è¯•è¿è¡Œ {#2-4}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    public class LoginTest {
        public static void main(String[] args) {
            LoginTemplate login1 = new UsernamePasswordLogin();
            login1.login("admin");
    â€‹
            System.out.println("-----");
    â€‹
            LoginTemplate login2 = new WeChatScanLogin();
            login2.login("wx_123456");
        }
    }
    â€‹
    [UsernamePasswordLogin] æ­£åœ¨æ ¡éªŒç”¨æˆ·åå’Œå¯†ç ...
    [UsernamePasswordLogin] ç™»å½•æˆåŠŸï¼Œè®°å½•ç™»å½•æ—¥å¿—ï¼šadmin
    -----
    [WeChatScanLogin] æ­£åœ¨æ ¡éªŒå¾®ä¿¡äºŒç»´ç ...
    [WeChatScanLogin] ç™»å½•æˆåŠŸï¼Œæ¨é€æ¬¢è¿æ¶ˆæ¯ï¼šwx_123456
              
è¿™é‡Œæ‹¿ç”¨æˆ·åå¯†ç ç™»å½•æ–¹å¼ä¸¾ä¾‹ï¼Œæ—¶åºå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š

![image-20250721153424954.png](https://article-images.zsxq.com/Fs-AyauQ5uGzlgVbKRhBt6C9oOra "image-20250721153424954.png")

### 3. æ¨¡å¼ä¼˜ç‚¹ {#3}

*  
ç™»å½•æµç¨‹å®Œå…¨ç”±æ¨¡æ¿ç±»æ§åˆ¶ï¼Œæµç¨‹ç»Ÿä¸€ï¼›  
*  
å­ç±»åªå…³å¿ƒ **è®¤è¯æ–¹å¼** å’Œ **åå¤„ç†åŠ¨ä½œ** ï¼›  
*  
  æ–¹ä¾¿æ‰©å±•é’‰é’‰ç™»å½•ã€éªŒè¯ç ç™»å½•ç­‰ï¼Œ**æ— éœ€æ”¹åŠ¨å·²æœ‰é€»è¾‘** ã€‚

ä½¿ç”¨æ¨¡æ¿æ–¹æ³•é‡æ„åˆ·æ–°äº‹ä»¶
------------

åŠ¨æ€çº¿ç¨‹æ± åœ¨å¤šé…ç½®ä¸­å¿ƒæ”¯æŒçš„åœºæ™¯ä¸‹ï¼Œç›‘å¬å™¨æ³¨å†Œä¸é…ç½®åˆ·æ–°å­˜åœ¨é«˜åº¦ç›¸ä¼¼çš„å¤„ç†æµç¨‹ã€‚ä¸ºäº†ç»Ÿä¸€é€»è¾‘ã€å¢å¼ºå¯æ‰©å±•æ€§ï¼Œæˆ‘ä»¬å¼•å…¥**æ¨¡æ¿æ–¹æ³•æ¨¡å¼** è¿›è¡Œé‡æ„ï¼Œå½¢æˆä¸€å¥—ç»“æ„æ¸…æ™°ã€èŒè´£åˆ†æ˜çš„åˆ·æ–°æœºåˆ¶ã€‚

### 1. ç±»å›¾ {#1}

![iShot_2025-07-19_13.07.27.png](https://article-images.zsxq.com/Fu25DFGZpgo_2HwgjWOOQmSxThyD "iShot_2025-07-19_13.07.27.png")

åŠ¨æ€åˆ·æ–°åœºæ™¯é€»è¾‘å¦‚ä¸‹ï¼š

*  
æŠ½è±¡ç±» `AbstractDynamicThreadPoolRefresher` å®šä¹‰äº†ç»Ÿä¸€çš„åˆ·æ–°æµç¨‹ï¼›  
*  
å­ç±»å¦‚ `NacosCloudRefresherHandler`ã€`ApolloRefresherHandler` ä»…éœ€å®ç°é…ç½®ç›‘å¬é€»è¾‘ï¼›  
*  
  é¿å…é‡å¤ä»£ç ï¼Œä¾¿äºåç»­æ‰©å±•å…¶ä»–é…ç½®ä¸­å¿ƒï¼ˆå¦‚ Zookeeperã€ETCDã€Consulï¼‰ã€‚

### 2. æ—¶åºå›¾ {#2}

ä»¥ Nacos ä¸ºä¾‹ï¼Œä»¥ä¸‹å±•ç¤ºä¸€æ¬¡é…ç½®å˜æ›´åçº¿ç¨‹æ± åˆ·æ–°çš„å®Œæ•´æµç¨‹ï¼š

![image-20250721163429499.png](https://article-images.zsxq.com/Fp2bPOJHLPxQbMWJvFARGoN6eAQa "image-20250721163429499.png")

### 3. å®šä¹‰æŠ½è±¡ç±» {#3}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * åŸºäºæ¨¡æ¿æ–¹æ³•æ¨¡å¼æŠ½è±¡åŠ¨æ€çº¿ç¨‹æ± åˆ·æ–°é€»è¾‘
     * <p>
     * ä½œè€…ï¼šé©¬ä¸
     * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
     * å¼€å‘æ—¶é—´ï¼š2025-04-28
     */
    @Slf4j
    @RequiredArgsConstructor
    public abstract class AbstractDynamicThreadPoolRefresher implements ApplicationRunner {
    â€‹
        protected final BootstrapConfigProperties properties;
    â€‹
        /**
         * æ³¨å†Œé…ç½®å˜æ›´ç›‘å¬å™¨ï¼Œç”±å­ç±»å®ç°å…·ä½“é€»è¾‘
         *
         * @throws Exception
         */
        protected abstract void registerListener() throws Exception;
    â€‹
        /**
         * é»˜è®¤ç©ºå®ç°ï¼Œå­ç±»å¯ä»¥æŒ‰éœ€è¦†ç›–
         */
        protected void beforeRegister() {
        }
    â€‹
        /**
         * é»˜è®¤ç©ºå®ç°ï¼Œå­ç±»å¯ä»¥æŒ‰éœ€è¦†ç›–
         */
        protected void afterRegister() {
        }
    â€‹
        @Override
        public void run(ApplicationArguments args) throws Exception {
            beforeRegister();
            registerListener();
            afterRegister();
        }
    â€‹
        @SneakyThrows
        public void refreshThreadPoolProperties(String configInfo) {
            Map<Object, Object> configInfoMap = ConfigParserHandler.getInstance().parseConfig(configInfo, properties.getConfigFileType());
            ConfigurationPropertySource sources = new MapConfigurationPropertySource(configInfoMap);
            Binder binder = new Binder(sources);
            BootstrapConfigProperties refresherProperties = binder.bind(BootstrapConfigProperties.PREFIX, Bindable.ofInstance(properties)).get();
    â€‹
            // å‘å¸ƒçº¿ç¨‹æ± é…ç½®å˜æ›´äº‹ä»¶ï¼Œè§¦å‘æ‰€æœ‰ç›‘å¬å™¨æ‰§è¡Œçº¿ç¨‹æ± å‚æ•°å¯¹æ¯”ä¸åˆ·æ–°æ“ä½œ
            // å½“å‰æ”¯æŒçš„ç›‘å¬å™¨åŒ…æ‹¬ï¼š
            // - {@link com.nageoffer.onethread.config.common.starter.refresher.DynamicThreadPoolRefreshListener}
            // - {@link com.nageoffer.onethread.web.starter.core.WebThreadPoolRefreshListener}
            ApplicationContextHolder.publishEvent(new ThreadPoolConfigUpdateEvent(this, refresherProperties));
        }
    }
              
å¸¸è§é—®é¢˜è¯´æ˜ï¼š

Qï¼šä¸ºä»€ä¹ˆè¦ä¿ç•™ `beforeRegister` å’Œ `afterRegister`ï¼Ÿ

è¿™æ˜¯å…¸å‹çš„é’©å­æ–¹æ³•è®¾è®¡ï¼Œç±»ä¼¼ JDK ä¸­çº¿ç¨‹æ± çš„ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    public class ThreadPoolExecutor extends AbstractExecutorService {
    â€‹
        protected void beforeExecute(Thread t, Runnable r) { }
    â€‹
        protected void afterExecute(Runnable r, Throwable t) { }
    }
              
åœ¨æ³¨å†Œç›‘å¬å™¨å‰åç•™æœ‰æ‰©å±•ç‚¹ï¼Œå¯ç”¨äºè®¾ç½®ä¸Šä¸‹æ–‡ã€æ³¨å…¥ä¾èµ–æˆ–è¡¥å……é€»è¾‘ï¼Œæå‡çµæ´»æ€§ã€‚

Qï¼š`ApplicationContextHolder.publishEvent` æ˜¯ä»€ä¹ˆï¼Ÿ

è¯¥æ–¹æ³•åŸºäº Spring çš„**äº‹ä»¶å‘å¸ƒæœºåˆ¶ï¼ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼‰** ï¼Œç”¨äºå¹¿æ’­çº¿ç¨‹æ± å‚æ•°çš„åˆ·æ–°äº‹ä»¶ã€‚è¿™æ˜¯æ”¯æŒ Web å®¹å™¨çº¿ç¨‹æ± åˆ·æ–°æ‰€å¿…é¡»çš„æœºåˆ¶ï¼Œåç»­ç« èŠ‚ä¼šè¯¦ç»†å±•å¼€ã€‚

### 4. å­ç±» Nacos å®ç° {#4-nacos}

æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¸‹ï¼ŒNacos çš„åˆ·æ–°é€»è¾‘å˜å¾—å¼‚å¸¸æ¸…æ™°ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * Nacos Cloud ç‰ˆæœ¬åˆ·æ–°å¤„ç†å™¨
     * <p>
     * ä½œè€…ï¼šé©¬ä¸
     * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
     * å¼€å‘æ—¶é—´ï¼š2025-04-24
     */
    @Slf4j(topic = "OneThreadConfigRefresher")
    public class NacosCloudRefresherHandler extends AbstractDynamicThreadPoolRefresher {

        private ConfigService configService;

        public NacosCloudRefresherHandler(ConfigService configService, BootstrapConfigProperties properties) {
            super(properties);
            this.configService = configService;
        }

        public void registerListener() throws NacosException {
            BootstrapConfigProperties.NacosConfig nacosConfig = properties.getNacos();
            configService.addListener(
                    nacosConfig.getDataId(),
                    nacosConfig.getGroup(),
                    new Listener() {

                        @Override
                        public Executor getExecutor() {
                            return ThreadPoolExecutorBuilder.builder()
                                    .corePoolSize(1)
                                    .maximumPoolSize(1)
                                    .keepAliveTime(9999L)
                                    .workQueueType(BlockingQueueTypeEnum.SYNCHRONOUS_QUEUE)
                                    .threadFactory("clod-nacos-refresher-thread_")
                                    .rejectedHandler(new ThreadPoolExecutor.CallerRunsPolicy())
                                    .build();
                        }

                        @Override
                        public void receiveConfigInfo(String configInfo) {
                            refreshThreadPoolProperties(configInfo);
                        }
                    });

            log.info("Dynamic thread pool refresher, add nacos cloud listener success. data-id: {}, group: {}", nacosConfig.getDataId(), nacosConfig.getGroup());
        }
    }
              
å„é…ç½®ä¸­å¿ƒçš„å®ç°ç±»ä¸­ï¼Œå¦‚æœæ— ç‰¹æ®Šé€»è¾‘ï¼Œåªéœ€å…³æ³¨ `registerListener`ï¼Œå…¶ä½™æµç¨‹ç”±æŠ½è±¡ç±»ç»Ÿä¸€è°ƒåº¦ã€‚

### 5. é‡æ„åçš„ä¼˜åŠ¿ {#5}

*  
**å¤ç”¨æ€§å¼º** ï¼šå°†å…¬å…±æµç¨‹ï¼ˆå¦‚ `ApplicationRunner` æ‰§è¡Œå…¥å£ã€é…ç½®è§£æä¸ç»‘å®šã€äº‹ä»¶å‘å¸ƒï¼‰æŠ½è±¡å°è£…åœ¨çˆ¶ç±»ä¸­ï¼Œé¿å…å­ç±»é‡å¤å®ç°ï¼Œæå‡ä»£ç å¤ç”¨ç‡ã€‚  
*  
**æ‰©å±•æ€§å¥½** ï¼šå°†é…ç½®ä¸­å¿ƒçš„å·®å¼‚åŒ–é€»è¾‘ä¸‹æ²‰åˆ°å­ç±»ä¸­å®ç°ï¼Œæ–°å¢æ”¯æŒåªéœ€ç»§æ‰¿æŠ½è±¡ç±»å¹¶å®ç° `registerListener()` æ–¹æ³•ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ï¼Œæ–¹ä¾¿æ‰©å±•å’Œç»´æŠ¤ã€‚  
*  
  **ç»“æ„æ›´æ¸…æ™°** ï¼šç™»å½•æµç¨‹é›†ä¸­ç”±æ¨¡æ¿æ–¹æ³•ç»Ÿä¸€æ§åˆ¶ï¼Œé…ç½®ç›‘å¬ä¸åˆ·æ–°èŒè´£åˆ†ç¦»ï¼Œç±»èŒè´£å•ä¸€ï¼Œæ•´ä½“æµç¨‹**å¯è¯»æ€§ä¸å¯ç»´æŠ¤æ€§å¤§å¹…æå‡** ã€‚

æ–‡æœ«æ€»ç»“
----

åœ¨åŠ¨æ€çº¿ç¨‹æ± æ”¯æŒå¤šé…ç½®ä¸­å¿ƒçš„åœºæ™¯ä¸‹ï¼Œå¦‚ä½•å®ç°**é«˜å¤ç”¨ã€å¼ºæ‰©å±•ã€ä½ä¾µå…¥** çš„é…ç½®åˆ·æ–°æœºåˆ¶ï¼Œæ˜¯æ¶æ„è®¾è®¡ä¸­çš„å…³é”®è€ƒé‡ã€‚

æœ¬æ–‡ä»¥åŠ¨æ€çº¿ç¨‹æ± åœ¨å¤šé…ç½®ä¸­å¿ƒä¸‹çš„åˆ·æ–°ç›‘å¬é€»è¾‘ä¸ºå‡ºå‘ç‚¹ï¼Œä»å®é™…å®ç°å…¥æ‰‹ï¼Œåˆ†æäº†åŸå§‹ä»£ç åœ¨å¤ç”¨æ€§ä¸å¯æ‰©å±•æ€§æ–¹é¢çš„ä¸è¶³ã€‚é€šè¿‡å¼•å…¥æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œå°†æ³¨å†Œç›‘å¬æµç¨‹ä¸é…ç½®åˆ·æ–°é€»è¾‘è¿›è¡Œåˆç†åˆ†å±‚ä¸æŠ½è±¡ã€‚

é€šè¿‡ç»Ÿä¸€çš„æŠ½è±¡ç±»å°è£…æ³¨å†Œæµç¨‹ä¸åˆ·æ–°é€»è¾‘ï¼Œé…åˆé’©å­å‡½æ•°ä¸äº‹ä»¶å‘å¸ƒæœºåˆ¶ï¼Œå®ç°äº†ç»“æ„æ¸…æ™°ã€è¡Œä¸ºå—æ§ã€å¯æŒç»­æ¼”è¿›çš„åŠ¨æ€é…ç½®åˆ·æ–°æ¶æ„ã€‚æ–‡ç« å¹¶ç»“åˆç±»å›¾ã€æ—¶åºå›¾ã€ä»£ç ç¤ºä¾‹ï¼Œå¸®åŠ©å¤§å®¶å®Œæ•´ç†è§£è¯¥é‡æ„æ–¹æ¡ˆçš„æ ¸å¿ƒä»·å€¼ä¸åº”ç”¨è½åœ°ã€‚

å®Œç»“ï¼Œæ’’èŠ± ğŸ‰  
åŸºäºæ¨¡æ¿æ–¹æ³•çš„å¤šé…ç½®ä¸­å¿ƒæŠ½è±¡å±‚è®¾è®¡ï¼Œå…ƒæ•°æ®ä¿¡æ¯ï¼š

*  
ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± oneThreadï¼š<https://t.zsxq.com/5GfrN>  
*  
ä»£ç ä»“åº“ï¼š<https://gitcode.net/nageoffer/onethread> ------ ç”³è¯·é¡¹ç›®æƒé™å‚è€ƒä¸Šè¿°çº¿ç¨‹æ± é¡¹ç›®é“¾æ¥  
*  
ç« èŠ‚éš¾åº¦ï¼šâ˜…â˜…â˜…â˜†â˜† - è¾ƒéš¾  
*  
  è§†é¢‘åœ°å€ï¼šæ–‡æ¡£å…ˆè¡Œè§†é¢‘æ¬¡ä¹‹



*** ** * ** ***

å†…å®¹æ‘˜è¦ï¼šæœ¬æ–‡é€šè¿‡å¯¹ Nacosã€Apollo ä¸¤ç§é…ç½®ä¸­å¿ƒåˆ·æ–°å®ç°çš„å¯¹æ¯”å‰–æï¼Œå¼•å‡ºå…¶åœ¨å¤šé…ç½®ä¸­å¿ƒæ‰©å±•ä¸­çš„è®¾è®¡çŸ­æ¿ï¼Œç»§è€Œå¼•å…¥**æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼**å¯¹åˆ·æ–°é€»è¾‘è¿›è¡ŒæŠ½è±¡é‡æ„ã€‚

è¯¾ç¨‹ç›®å½•å¦‚ä¸‹æ‰€ç¤ºï¼š

*  
å‰è¨€  
*  
å¤šé…ç½®ä¸­å¿ƒè®¾è®¡çŸ­æ¿  
*  
ä»€ä¹ˆæ˜¯æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼ï¼Ÿ  
*  
ä½¿ç”¨æ¨¡æ¿æ–¹æ³•é‡æ„åˆ·æ–°äº‹ä»¶  
*  
  æ–‡æœ«æ€»ç»“

å‰è¨€
---

åœ¨å‰é¢çš„ç« èŠ‚ä¸­ï¼Œä¸ºäº†å¸®åŠ©å¤§å®¶å¿«é€Ÿç†è§£åŠ¨æ€çº¿ç¨‹æ± çš„**é…ç½®åˆ·æ–°æœºåˆ¶** ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€äº›"ä¸´æ—¶ä»£ç "ä½œä¸ºæ¼”ç¤ºã€‚è¿™äº›ä»£ç è™½ç„¶ç®€æ´ç›´è§‚ï¼Œä½†å¹¶ä¸æ˜¯æˆ‘ä»¬çœŸæ­£è½åœ°æ—¶é‡‡ç”¨çš„æ–¹å¼ã€‚

åœ¨ oneThread çš„çœŸå®å®ç°ä¸­ï¼Œæˆ‘ä»¬ä¸ºäº†æ”¯æŒå¤šç§é…ç½®ä¸­å¿ƒå¹¶ä¿æŒè‰¯å¥½çš„å¯ç»´æŠ¤æ€§ï¼Œé‡‡ç”¨äº†**æ¨¡æ¿æ–¹æ³•æ¨¡å¼** æ¥å°è£…å…¬å…±æµç¨‹ã€æŠ½è±¡å·®å¼‚è¡Œä¸ºï¼Œä»è€Œå®ç°å¯æ‰©å±•ã€é«˜å†…èšçš„åŠ¨æ€é…ç½®åˆ·æ–°èƒ½åŠ›ã€‚

æœ¬æ–‡å°†å¸¦ä½ å®Œæ•´æ¢³ç†çº¿ç¨‹æ± é…ç½®åŠ¨æ€åŒ–çš„è®¾è®¡æ¼”è¿›ï¼Œé‡ç‚¹èšç„¦åœ¨**å¤šé…ç½®ä¸­å¿ƒæ”¯æŒçš„è®¾è®¡çŸ­æ¿** ä¸**ä¸ºä½•éœ€è¦å¼•å…¥æ¨¡æ¿æ–¹æ³•æ¨¡å¼** ã€‚

å¤šé…ç½®ä¸­å¿ƒè®¾è®¡çŸ­æ¿
---------

ç›®å‰æˆ‘ä»¬å·²ç»æ”¯æŒ Nacos å’Œ Apollo ä¸¤ç§ä¸»æµé…ç½®ä¸­å¿ƒï¼Œä¸‹é¢æ˜¯å®ƒä»¬å„è‡ªçš„ç›‘å¬å®ç°æ–¹å¼ã€‚

### 1. Nacos é…ç½®åˆ·æ–°äº‹ä»¶å®ç° {#1-nacos}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    @Slf4j
    @RequiredArgsConstructor
    public class NacosCloudRefresherHandlerV1 implements ApplicationRunner {
    â€‹
        private final ConfigService configService;
        private final BootstrapConfigProperties properties;
    â€‹
        @Override
        public void run(ApplicationArguments args) throws Exception {
            BootstrapConfigProperties.NacosConfig nacosConfig = properties.getNacos();
            configService.addListener(
                    nacosConfig.getDataId(),
                    nacosConfig.getGroup(),
                    new Listener() {
    â€‹
                        @Override
                        public Executor getExecutor() {
                            return xxx;
                        }
    â€‹
                        @Override
                        public void receiveConfigInfo(String configInfo) {
                            refreshThreadPoolProperties(content); // åˆ·æ–°åŠ¨æ€çº¿ç¨‹æ± é…ç½®
                        }
                    });
    â€‹
            log.info("Dynamic thread pool refresher, add nacos cloud listener success. data-id: {}, group: {}", nacosConfig.getDataId(), nacosConfig.getGroup());
        }
    â€‹
        public void refreshThreadPoolProperties(String configInfo) throws IOException {
            Map<Object, Object> configInfoMap = ConfigParserHandler.getInstance().parseConfig(configInfo, properties.getConfigFileType());
            ConfigurationPropertySource sources = new MapConfigurationPropertySource(configInfoMap);
            Binder binder = new Binder(sources);
    â€‹
            BootstrapConfigProperties refresherProperties = binder.bind(BootstrapConfigProperties.PREFIX, Bindable.ofInstance(properties)).get();
            log.info("Latest updated configuration: \n{}", configInfo);
            log.info("Java configuration object binding: \n{}", JSON.toJSONString(refresherProperties));
    â€‹
            // ...... æ£€æµ‹çº¿ç¨‹æ± å‚æ•°æ˜¯å¦å˜æ›´ï¼Œå¦‚æœå·²å˜æ›´åˆ™è¿›è¡Œæ›´æ–°
        }
    }
              
### 2. Apollo é…ç½®åˆ·æ–°äº‹ä»¶å®ç° {#2-apollo}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    @Slf4j
    @RequiredArgsConstructor
    public class ApolloRefresherHandlerV1 implements ApplicationRunner {
    â€‹
        private final BootstrapConfigProperties properties;
    â€‹
        @Override
        public void run(ApplicationArguments args) throws Exception {
            BootstrapConfigProperties.ApolloConfig apolloConfig = properties.getApollo();
            String[] apolloNamespaces = apolloConfig.getNamespace().split(",");
    â€‹
            String namespace = apolloNamespaces[0];
            String configFileType = properties.getConfigFileType().getValue();
            Config config = ConfigService.getConfig(String.format("%s.%s", namespace, properties.getConfigFileType().getValue()));
    â€‹
            ConfigChangeListener configChangeListener = createConfigChangeListener(namespace, configFileType);
            config.addChangeListener(configChangeListener);
    â€‹
            log.info("Dynamic thread pool refresher, add apollo listener success. namespace: {}", namespace);
        }
    â€‹
        private ConfigChangeListener createConfigChangeListener(String namespace, String configFileType) {
            return configChangeEvent -> {
                // å¦‚æœ Apollo é…ç½®æ–‡ä»¶å˜æ›´ï¼Œä¼šè§¦å‘è¯¥æ–¹æ³•è¿›è¡Œå›è°ƒ
                String namespaceItem = namespace.replace("." + configFileType, "");
                ConfigFileFormat configFileFormat = ConfigFileFormat.fromString(configFileType);
                ConfigFile configFile = ConfigService.getConfigFile(namespaceItem, configFileFormat);
                String content = configFile.getContent(); // å˜æ›´åçš„æœ€æ–°å†…å®¹
                refreshThreadPoolProperties(content); // åˆ·æ–°åŠ¨æ€çº¿ç¨‹æ± é…ç½®
            };
        }
    â€‹
        public void refreshThreadPoolProperties(String configInfo) throws IOException {
            Map<Object, Object> configInfoMap = ConfigParserHandler.getInstance().parseConfig(configInfo, properties.getConfigFileType());
            ConfigurationPropertySource sources = new MapConfigurationPropertySource(configInfoMap);
            Binder binder = new Binder(sources);
    â€‹
            BootstrapConfigProperties refresherProperties = binder.bind(BootstrapConfigProperties.PREFIX, Bindable.ofInstance(properties)).get();
            log.info("Latest updated configuration: \n{}", configInfo);
            log.info("Java configuration object binding: \n{}", JSON.toJSONString(refresherProperties));
    â€‹
            // ...... æ£€æµ‹çº¿ç¨‹æ± å‚æ•°æ˜¯å¦å˜æ›´ï¼Œå¦‚æœå·²å˜æ›´åˆ™è¿›è¡Œæ›´æ–°
        }
    }
              
### 3. å­˜åœ¨çš„ä¸»è¦é—®é¢˜ {#3}

éšç€å¯¹é…ç½®ä¸­å¿ƒçš„æ”¯æŒå¢åŠ ï¼Œä¸Šè¿°å®ç°ä¼šæš´éœ²å‡ºä»¥ä¸‹è®¾è®¡çŸ­æ¿ï¼š

#### 3.1 ä»£ç é‡å¤ {#3-1}

*  
`refreshThreadPoolProperties()` çš„é€»è¾‘åœ¨æ¯ä¸ªç±»ä¸­**é‡å¤å‡ºç°** ï¼›  
*  
`ApplicationRunner` æ¥å£éœ€è¦åœ¨æ¯ä¸ªç±»ä¸­**é‡å¤å®ç°** ï¼›  
*  
  æ¯å¢åŠ ä¸€ç§é…ç½®ä¸­å¿ƒï¼Œéƒ½éœ€**å¤åˆ¶ç²˜è´´ä¸€ä»½é€»è¾‘** ï¼Œä¸åˆ©äºç»´æŠ¤ä¸æ‰©å±•ã€‚

#### 3.2 è¡Œä¸ºæ— æ³•çº¦æŸ {#3-2}

*  
æ¯ä¸ªé…ç½®ä¸­å¿ƒçš„ç›‘å¬å®ç°ç±»è§¦å‘æ—¶æœºéƒ½æ˜¯è‡ªç”±å‘æŒ¥ï¼Œ**ç¼ºä¹ç»Ÿä¸€çº¦æŸè§„èŒƒ** ï¼›  
*  
å®¹æ˜“å‡ºç°è°ƒç”¨æ—¶æœºä¸ä¸€è‡´ã€ç›‘å¬å¤±è´¥æ— å…œåº•ã€çº¿ç¨‹æ± å˜æ›´æœªè§¦å‘ç­‰é—®é¢˜ï¼›  
*  
  éš¾ä»¥ç»Ÿä¸€å‡çº§æˆ–å¢å¼ºå…¬å…±èƒ½åŠ›ï¼ˆä¾‹å¦‚ç»Ÿä¸€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ± é‡è½½é€»è¾‘ç­‰ï¼‰ã€‚

æ¥ä¸‹æ¥çš„ç« èŠ‚å°†ä»‹ç»æˆ‘ä»¬æ˜¯å¦‚ä½•å€ŸåŠ©**æ¨¡æ¿æ–¹æ³•æ¨¡å¼** è®¾è®¡ä¸€ä¸ªç»Ÿä¸€çš„åˆ·æ–°æŠ½è±¡ç±»ï¼Œå¹¶æ”¯æŒä»¥æœ€å°æˆæœ¬æ‰©å±•æ›´å¤šé…ç½®ä¸­å¿ƒçš„ã€‚

ä»€ä¹ˆæ˜¯æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼ï¼Ÿ
------------

### 1. æ¨¡æ¿æ–¹æ³•å®šä¹‰ {#1}

**æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼** æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œå®ƒåœ¨ä¸€ä¸ªæ–¹æ³•ä¸­å®šä¹‰äº†ä¸€ä¸ªæ“ä½œçš„æ¡†æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤çš„å®ç°å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ¨¡æ¿æ–¹æ³•å…è®¸å­ç±»åœ¨ä¸æ”¹å˜ç®—æ³•ç»“æ„çš„æƒ…å†µä¸‹é‡æ–°å®šä¹‰ç®—æ³•ä¸­çš„æŸäº›æ­¥éª¤ã€‚

é€šä¿—æ¥è®² : å®šä¹‰ä¸€ä¸ªæŠ½è±¡ç±» `AbstractTemplate`ï¼Œå¹¶å®šä¹‰ä¸€ä¸ªæˆ–è‹¥å¹²æŠ½è±¡æ–¹æ³• `abstractMethod`ã€‚

ç”±å­ç±»å»ç»§æ‰¿æŠ½è±¡ç±»çš„åŒæ—¶å®ç°æŠ½è±¡æ–¹æ³•ï¼Œ åœ¨æŠ½è±¡ç±»çš„å…¬å…±æ–¹æ³•ä¸­è°ƒç”¨æŠ½è±¡æ–¹æ³•ï¼Œæœ€ç»ˆè°ƒç”¨çš„å°±æ˜¯ä¸åŒå­ç±»å®ç°çš„æ–¹æ³•é€»è¾‘ã€‚

### 2. ç”¨æˆ·ç™»å½•ä¸¾ä¾‹ {#2}

**èƒŒæ™¯ï¼š** å‡è®¾æˆ‘ä»¬æœ‰ä¸€å¥—ç”¨æˆ·ç™»å½•é€»è¾‘ï¼Œå…¶æ€»ä½“æµç¨‹å¦‚ä¸‹ï¼š

* 1.  
è·å–ç”¨æˆ·è¾“å…¥ï¼›  
* 2.  
æ ¡éªŒèº«ä»½ï¼ˆç”¨æˆ·åå¯†ç ã€éªŒè¯ç ã€OAuth token ç­‰ï¼‰ï¼›  
* 3.  
  ç™»å½•æˆåŠŸåå†™å…¥æ—¥å¿—æˆ–å‘é€šçŸ¥ã€‚

è¿™ä¸ªæµç¨‹å¯¹äºä¸åŒç™»å½•æ–¹å¼ï¼ˆè´¦å·å¯†ç ç™»å½•ã€å¾®ä¿¡æ‰«ç ç™»å½•ã€é’‰é’‰å…ç™»ç™»å½•ç­‰ï¼‰æ˜¯ä¸€è‡´çš„ï¼Œåªæœ‰"æ ¡éªŒæ–¹å¼"ä¸åŒï¼Œå…¸å‹é€‚åˆä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼æŠ½è±¡å‡ºå…¬å…±æµç¨‹ã€‚

#### 2.1 æŠ½è±¡æ¨¡æ¿ç±» {#2-1}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    public abstract class LoginTemplate {
    â€‹
        /**
         * æ¨¡æ¿æ–¹æ³•ï¼šå®šä¹‰å›ºå®šç™»å½•æµç¨‹
         */
        public final void login(String loginId) {
            // 1. è·å–ç”¨æˆ·è¾“å…¥
            String input = getLoginInput(loginId);
            // 2. æ‰§è¡Œè®¤è¯é€»è¾‘ï¼ˆç”±å­ç±»å†³å®šæ€ä¹ˆè®¤è¯ï¼‰
            boolean success = authenticate(input);
            if (success) {
                // 3. ç™»å½•æˆåŠŸåçš„å¤„ç†
                postLogin(loginId);
            } else {
                System.out.println("[LoginTemplate] ç™»å½•å¤±è´¥");
            }
        }
    â€‹
        /**
         * è·å–ç™»å½•è¾“å…¥ï¼ˆå¯é€‰æ­¥éª¤ï¼Œé»˜è®¤å®ç°ï¼‰
         */
        protected String getLoginInput(String loginId) {
            return loginId; // é»˜è®¤ç›´æ¥è¿”å›ç”¨æˆ·åç­‰
        }
    â€‹
        /**
         * è®¤è¯é€»è¾‘ï¼ˆæŠ½è±¡æ–¹æ³•ï¼‰
         */
        protected abstract boolean authenticate(String input);
    â€‹
        /**
         * ç™»å½•æˆåŠŸåçš„æ“ä½œï¼ˆé’©å­æ–¹æ³•ï¼‰
         */
        protected void postLogin(String loginId) {
            System.out.println("[LoginTemplate] ç™»å½•æˆåŠŸï¼Œç”¨æˆ·ï¼š" + loginId);
        }
    }
              
#### 2.2 å­ç±»ä¸€ï¼šè´¦å·å¯†ç ç™»å½• {#2-2}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    public class UsernamePasswordLogin extends LoginTemplate {
    â€‹
        @Override
        protected boolean authenticate(String input) {
            System.out.println("[UsernamePasswordLogin] æ­£åœ¨æ ¡éªŒç”¨æˆ·åå’Œå¯†ç ...");
            return "admin".equals(input); // æ¨¡æ‹Ÿåˆ¤æ–­ç”¨æˆ·åç­‰äº admin æ‰èƒ½ç™»å½•
        }
    â€‹
        @Override
        protected void postLogin(String loginId) {
            System.out.println("[UsernamePasswordLogin] ç™»å½•æˆåŠŸï¼Œè®°å½•ç™»å½•æ—¥å¿—ï¼š" + loginId);
        }
    }
              
#### 2.3 å­ç±»äºŒï¼šå¾®ä¿¡æ‰«ç ç™»å½• {#2-3}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    public class WeChatScanLogin extends LoginTemplate {
    â€‹
        @Override
        protected boolean authenticate(String input) {
            System.out.println("[WeChatScanLogin] æ­£åœ¨æ ¡éªŒå¾®ä¿¡äºŒç»´ç ...");
            return input.startsWith("wx_"); // æ¨¡æ‹Ÿå¾®ä¿¡äºŒç»´ç å‰ç¼€
        }
    â€‹
        @Override
        protected void postLogin(String loginId) {
            System.out.println("[WeChatScanLogin] ç™»å½•æˆåŠŸï¼Œæ¨é€æ¬¢è¿æ¶ˆæ¯ï¼š" + loginId);
        }
    }
              
#### 2.4 æµ‹è¯•è¿è¡Œ {#2-4}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    public class LoginTest {
        public static void main(String[] args) {
            LoginTemplate login1 = new UsernamePasswordLogin();
            login1.login("admin");
    â€‹
            System.out.println("-----");
    â€‹
            LoginTemplate login2 = new WeChatScanLogin();
            login2.login("wx_123456");
        }
    }
    â€‹
    [UsernamePasswordLogin] æ­£åœ¨æ ¡éªŒç”¨æˆ·åå’Œå¯†ç ...
    [UsernamePasswordLogin] ç™»å½•æˆåŠŸï¼Œè®°å½•ç™»å½•æ—¥å¿—ï¼šadmin
    -----
    [WeChatScanLogin] æ­£åœ¨æ ¡éªŒå¾®ä¿¡äºŒç»´ç ...
    [WeChatScanLogin] ç™»å½•æˆåŠŸï¼Œæ¨é€æ¬¢è¿æ¶ˆæ¯ï¼šwx_123456
              
è¿™é‡Œæ‹¿ç”¨æˆ·åå¯†ç ç™»å½•æ–¹å¼ä¸¾ä¾‹ï¼Œæ—¶åºå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š

![image-20250721153424954.png](https://article-images.zsxq.com/Fs-AyauQ5uGzlgVbKRhBt6C9oOra "image-20250721153424954.png")

### 3. æ¨¡å¼ä¼˜ç‚¹ {#3}

*  
ç™»å½•æµç¨‹å®Œå…¨ç”±æ¨¡æ¿ç±»æ§åˆ¶ï¼Œæµç¨‹ç»Ÿä¸€ï¼›  
*  
å­ç±»åªå…³å¿ƒ **è®¤è¯æ–¹å¼** å’Œ **åå¤„ç†åŠ¨ä½œ** ï¼›  
*  
  æ–¹ä¾¿æ‰©å±•é’‰é’‰ç™»å½•ã€éªŒè¯ç ç™»å½•ç­‰ï¼Œ**æ— éœ€æ”¹åŠ¨å·²æœ‰é€»è¾‘** ã€‚

ä½¿ç”¨æ¨¡æ¿æ–¹æ³•é‡æ„åˆ·æ–°äº‹ä»¶
------------

åŠ¨æ€çº¿ç¨‹æ± åœ¨å¤šé…ç½®ä¸­å¿ƒæ”¯æŒçš„åœºæ™¯ä¸‹ï¼Œç›‘å¬å™¨æ³¨å†Œä¸é…ç½®åˆ·æ–°å­˜åœ¨é«˜åº¦ç›¸ä¼¼çš„å¤„ç†æµç¨‹ã€‚ä¸ºäº†ç»Ÿä¸€é€»è¾‘ã€å¢å¼ºå¯æ‰©å±•æ€§ï¼Œæˆ‘ä»¬å¼•å…¥**æ¨¡æ¿æ–¹æ³•æ¨¡å¼** è¿›è¡Œé‡æ„ï¼Œå½¢æˆä¸€å¥—ç»“æ„æ¸…æ™°ã€èŒè´£åˆ†æ˜çš„åˆ·æ–°æœºåˆ¶ã€‚

### 1. ç±»å›¾ {#1}

![iShot_2025-07-19_13.07.27.png](https://article-images.zsxq.com/Fu25DFGZpgo_2HwgjWOOQmSxThyD "iShot_2025-07-19_13.07.27.png")

åŠ¨æ€åˆ·æ–°åœºæ™¯é€»è¾‘å¦‚ä¸‹ï¼š

*  
æŠ½è±¡ç±» `AbstractDynamicThreadPoolRefresher` å®šä¹‰äº†ç»Ÿä¸€çš„åˆ·æ–°æµç¨‹ï¼›  
*  
å­ç±»å¦‚ `NacosCloudRefresherHandler`ã€`ApolloRefresherHandler` ä»…éœ€å®ç°é…ç½®ç›‘å¬é€»è¾‘ï¼›  
*  
  é¿å…é‡å¤ä»£ç ï¼Œä¾¿äºåç»­æ‰©å±•å…¶ä»–é…ç½®ä¸­å¿ƒï¼ˆå¦‚ Zookeeperã€ETCDã€Consulï¼‰ã€‚

### 2. æ—¶åºå›¾ {#2}

ä»¥ Nacos ä¸ºä¾‹ï¼Œä»¥ä¸‹å±•ç¤ºä¸€æ¬¡é…ç½®å˜æ›´åçº¿ç¨‹æ± åˆ·æ–°çš„å®Œæ•´æµç¨‹ï¼š

![image-20250721163429499.png](https://article-images.zsxq.com/Fp2bPOJHLPxQbMWJvFARGoN6eAQa "image-20250721163429499.png")

### 3. å®šä¹‰æŠ½è±¡ç±» {#3}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * åŸºäºæ¨¡æ¿æ–¹æ³•æ¨¡å¼æŠ½è±¡åŠ¨æ€çº¿ç¨‹æ± åˆ·æ–°é€»è¾‘
     * <p>
     * ä½œè€…ï¼šé©¬ä¸
     * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
     * å¼€å‘æ—¶é—´ï¼š2025-04-28
     */
    @Slf4j
    @RequiredArgsConstructor
    public abstract class AbstractDynamicThreadPoolRefresher implements ApplicationRunner {
    â€‹
        protected final BootstrapConfigProperties properties;
    â€‹
        /**
         * æ³¨å†Œé…ç½®å˜æ›´ç›‘å¬å™¨ï¼Œç”±å­ç±»å®ç°å…·ä½“é€»è¾‘
         *
         * @throws Exception
         */
        protected abstract void registerListener() throws Exception;
    â€‹
        /**
         * é»˜è®¤ç©ºå®ç°ï¼Œå­ç±»å¯ä»¥æŒ‰éœ€è¦†ç›–
         */
        protected void beforeRegister() {
        }
    â€‹
        /**
         * é»˜è®¤ç©ºå®ç°ï¼Œå­ç±»å¯ä»¥æŒ‰éœ€è¦†ç›–
         */
        protected void afterRegister() {
        }
    â€‹
        @Override
        public void run(ApplicationArguments args) throws Exception {
            beforeRegister();
            registerListener();
            afterRegister();
        }
    â€‹
        @SneakyThrows
        public void refreshThreadPoolProperties(String configInfo) {
            Map<Object, Object> configInfoMap = ConfigParserHandler.getInstance().parseConfig(configInfo, properties.getConfigFileType());
            ConfigurationPropertySource sources = new MapConfigurationPropertySource(configInfoMap);
            Binder binder = new Binder(sources);
            BootstrapConfigProperties refresherProperties = binder.bind(BootstrapConfigProperties.PREFIX, Bindable.ofInstance(properties)).get();
    â€‹
            // å‘å¸ƒçº¿ç¨‹æ± é…ç½®å˜æ›´äº‹ä»¶ï¼Œè§¦å‘æ‰€æœ‰ç›‘å¬å™¨æ‰§è¡Œçº¿ç¨‹æ± å‚æ•°å¯¹æ¯”ä¸åˆ·æ–°æ“ä½œ
            // å½“å‰æ”¯æŒçš„ç›‘å¬å™¨åŒ…æ‹¬ï¼š
            // - {@link com.nageoffer.onethread.config.common.starter.refresher.DynamicThreadPoolRefreshListener}
            // - {@link com.nageoffer.onethread.web.starter.core.WebThreadPoolRefreshListener}
            ApplicationContextHolder.publishEvent(new ThreadPoolConfigUpdateEvent(this, refresherProperties));
        }
    }
              
å¸¸è§é—®é¢˜è¯´æ˜ï¼š

Qï¼šä¸ºä»€ä¹ˆè¦ä¿ç•™ `beforeRegister` å’Œ `afterRegister`ï¼Ÿ

è¿™æ˜¯å…¸å‹çš„é’©å­æ–¹æ³•è®¾è®¡ï¼Œç±»ä¼¼ JDK ä¸­çº¿ç¨‹æ± çš„ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    public class ThreadPoolExecutor extends AbstractExecutorService {
    â€‹
        protected void beforeExecute(Thread t, Runnable r) { }
    â€‹
        protected void afterExecute(Runnable r, Throwable t) { }
    }
              
åœ¨æ³¨å†Œç›‘å¬å™¨å‰åç•™æœ‰æ‰©å±•ç‚¹ï¼Œå¯ç”¨äºè®¾ç½®ä¸Šä¸‹æ–‡ã€æ³¨å…¥ä¾èµ–æˆ–è¡¥å……é€»è¾‘ï¼Œæå‡çµæ´»æ€§ã€‚

Qï¼š`ApplicationContextHolder.publishEvent` æ˜¯ä»€ä¹ˆï¼Ÿ

è¯¥æ–¹æ³•åŸºäº Spring çš„**äº‹ä»¶å‘å¸ƒæœºåˆ¶ï¼ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼‰** ï¼Œç”¨äºå¹¿æ’­çº¿ç¨‹æ± å‚æ•°çš„åˆ·æ–°äº‹ä»¶ã€‚è¿™æ˜¯æ”¯æŒ Web å®¹å™¨çº¿ç¨‹æ± åˆ·æ–°æ‰€å¿…é¡»çš„æœºåˆ¶ï¼Œåç»­ç« èŠ‚ä¼šè¯¦ç»†å±•å¼€ã€‚

### 4. å­ç±» Nacos å®ç° {#4-nacos}

æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¸‹ï¼ŒNacos çš„åˆ·æ–°é€»è¾‘å˜å¾—å¼‚å¸¸æ¸…æ™°ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * Nacos Cloud ç‰ˆæœ¬åˆ·æ–°å¤„ç†å™¨
     * <p>
     * ä½œè€…ï¼šé©¬ä¸
     * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
     * å¼€å‘æ—¶é—´ï¼š2025-04-24
     */
    @Slf4j(topic = "OneThreadConfigRefresher")
    public class NacosCloudRefresherHandler extends AbstractDynamicThreadPoolRefresher {

        private ConfigService configService;

        public NacosCloudRefresherHandler(ConfigService configService, BootstrapConfigProperties properties) {
            super(properties);
            this.configService = configService;
        }

        public void registerListener() throws NacosException {
            BootstrapConfigProperties.NacosConfig nacosConfig = properties.getNacos();
            configService.addListener(
                    nacosConfig.getDataId(),
                    nacosConfig.getGroup(),
                    new Listener() {

                        @Override
                        public Executor getExecutor() {
                            return ThreadPoolExecutorBuilder.builder()
                                    .corePoolSize(1)
                                    .maximumPoolSize(1)
                                    .keepAliveTime(9999L)
                                    .workQueueType(BlockingQueueTypeEnum.SYNCHRONOUS_QUEUE)
                                    .threadFactory("clod-nacos-refresher-thread_")
                                    .rejectedHandler(new ThreadPoolExecutor.CallerRunsPolicy())
                                    .build();
                        }

                        @Override
                        public void receiveConfigInfo(String configInfo) {
                            refreshThreadPoolProperties(configInfo);
                        }
                    });

            log.info("Dynamic thread pool refresher, add nacos cloud listener success. data-id: {}, group: {}", nacosConfig.getDataId(), nacosConfig.getGroup());
        }
    }
              
å„é…ç½®ä¸­å¿ƒçš„å®ç°ç±»ä¸­ï¼Œå¦‚æœæ— ç‰¹æ®Šé€»è¾‘ï¼Œåªéœ€å…³æ³¨ `registerListener`ï¼Œå…¶ä½™æµç¨‹ç”±æŠ½è±¡ç±»ç»Ÿä¸€è°ƒåº¦ã€‚

### 5. é‡æ„åçš„ä¼˜åŠ¿ {#5}

*  
**å¤ç”¨æ€§å¼º** ï¼šå°†å…¬å…±æµç¨‹ï¼ˆå¦‚ `ApplicationRunner` æ‰§è¡Œå…¥å£ã€é…ç½®è§£æä¸ç»‘å®šã€äº‹ä»¶å‘å¸ƒï¼‰æŠ½è±¡å°è£…åœ¨çˆ¶ç±»ä¸­ï¼Œé¿å…å­ç±»é‡å¤å®ç°ï¼Œæå‡ä»£ç å¤ç”¨ç‡ã€‚  
*  
**æ‰©å±•æ€§å¥½** ï¼šå°†é…ç½®ä¸­å¿ƒçš„å·®å¼‚åŒ–é€»è¾‘ä¸‹æ²‰åˆ°å­ç±»ä¸­å®ç°ï¼Œæ–°å¢æ”¯æŒåªéœ€ç»§æ‰¿æŠ½è±¡ç±»å¹¶å®ç° `registerListener()` æ–¹æ³•ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ï¼Œæ–¹ä¾¿æ‰©å±•å’Œç»´æŠ¤ã€‚  
*  
  **ç»“æ„æ›´æ¸…æ™°** ï¼šç™»å½•æµç¨‹é›†ä¸­ç”±æ¨¡æ¿æ–¹æ³•ç»Ÿä¸€æ§åˆ¶ï¼Œé…ç½®ç›‘å¬ä¸åˆ·æ–°èŒè´£åˆ†ç¦»ï¼Œç±»èŒè´£å•ä¸€ï¼Œæ•´ä½“æµç¨‹**å¯è¯»æ€§ä¸å¯ç»´æŠ¤æ€§å¤§å¹…æå‡** ã€‚

æ–‡æœ«æ€»ç»“
----

åœ¨åŠ¨æ€çº¿ç¨‹æ± æ”¯æŒå¤šé…ç½®ä¸­å¿ƒçš„åœºæ™¯ä¸‹ï¼Œå¦‚ä½•å®ç°**é«˜å¤ç”¨ã€å¼ºæ‰©å±•ã€ä½ä¾µå…¥** çš„é…ç½®åˆ·æ–°æœºåˆ¶ï¼Œæ˜¯æ¶æ„è®¾è®¡ä¸­çš„å…³é”®è€ƒé‡ã€‚

æœ¬æ–‡ä»¥åŠ¨æ€çº¿ç¨‹æ± åœ¨å¤šé…ç½®ä¸­å¿ƒä¸‹çš„åˆ·æ–°ç›‘å¬é€»è¾‘ä¸ºå‡ºå‘ç‚¹ï¼Œä»å®é™…å®ç°å…¥æ‰‹ï¼Œåˆ†æäº†åŸå§‹ä»£ç åœ¨å¤ç”¨æ€§ä¸å¯æ‰©å±•æ€§æ–¹é¢çš„ä¸è¶³ã€‚é€šè¿‡å¼•å…¥æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œå°†æ³¨å†Œç›‘å¬æµç¨‹ä¸é…ç½®åˆ·æ–°é€»è¾‘è¿›è¡Œåˆç†åˆ†å±‚ä¸æŠ½è±¡ã€‚

é€šè¿‡ç»Ÿä¸€çš„æŠ½è±¡ç±»å°è£…æ³¨å†Œæµç¨‹ä¸åˆ·æ–°é€»è¾‘ï¼Œé…åˆé’©å­å‡½æ•°ä¸äº‹ä»¶å‘å¸ƒæœºåˆ¶ï¼Œå®ç°äº†ç»“æ„æ¸…æ™°ã€è¡Œä¸ºå—æ§ã€å¯æŒç»­æ¼”è¿›çš„åŠ¨æ€é…ç½®åˆ·æ–°æ¶æ„ã€‚æ–‡ç« å¹¶ç»“åˆç±»å›¾ã€æ—¶åºå›¾ã€ä»£ç ç¤ºä¾‹ï¼Œå¸®åŠ©å¤§å®¶å®Œæ•´ç†è§£è¯¥é‡æ„æ–¹æ¡ˆçš„æ ¸å¿ƒä»·å€¼ä¸åº”ç”¨è½åœ°ã€‚

å®Œç»“ï¼Œæ’’èŠ± ğŸ‰

