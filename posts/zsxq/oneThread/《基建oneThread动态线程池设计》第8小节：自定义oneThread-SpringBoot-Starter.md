2025å¹´07æœˆ14æ—¥ 22:53  
è‡ªå®šä¹‰oneThread-SpringBoot-StarteråŸºç¡€ç»„ä»¶ï¼Œå…ƒæ•°æ®ä¿¡æ¯ï¼š

*  
ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± oneThreadï¼š<https://t.zsxq.com/5GfrN>  
*  
ä»£ç ä»“åº“ï¼š<https://gitcode.net/nageoffer/onethread> ------ ç”³è¯·é¡¹ç›®æƒé™å‚è€ƒä¸Šè¿°çº¿ç¨‹æ± é¡¹ç›®é“¾æ¥  
*  
ç« èŠ‚éš¾åº¦ï¼šâ˜…â˜…â˜…â˜†â˜† - è¾ƒéš¾  
*  
  è§†é¢‘åœ°å€ï¼šæ–‡æ¡£å…ˆè¡Œè§†é¢‘æ¬¡ä¹‹



***å†…å®¹æ‘˜è¦ï¼šæœ¬ç« èŠ‚æ·±å…¥æ¢è®¨äº†å¦‚ä½•é€šè¿‡SpringBootStarterç»Ÿä¸€ç®¡ç†åŠ¨æ€çº¿ç¨‹æ± ï¼ŒåŒ…æ‹¬** åŠ¨æ€çº¿ç¨‹æ± æ ‡è®°* \*ã€\*\* è¿œç¨‹é…ç½®è¦†ç›–\*\*ã€\*\* Starter å¼€å‘**ä»¥åŠ** å¯æ’æ‹”è®¾è®¡\*\*ç­‰åŠŸèƒ½ã€‚

è¯¾ç¨‹ç›®å½•å¦‚ä¸‹æ‰€ç¤ºï¼š

*  
å¦‚ä½•å‘ç°åŠ¨æ€çº¿ç¨‹æ± ï¼Ÿ  
*  
Spring åç½®å¤„ç†å™¨  
*  
å¼€å‘ SpringBoot Starter  
*  
å…³äºå¯ç”¨åŠ¨æ€çº¿ç¨‹æ± æ ‡è¯†  
*  
  æ–‡æœ«æ€»ç»“

æœ¬ç« èŠ‚å°†æ¶‰åŠåˆ° `core`ã€`spring-base`ã€`starter/common-spring-boot-starter`ã€`nacos-cloud-example` å››ä¸ªæ¨¡å—ã€‚

![iShot_2025-06-26_20.53.59.png](https://article-images.zsxq.com/FnGsvdmA6cTDjXJhsUxryzhs5XPB "iShot_2025-06-26_20.53.59.png")

> è¿™ç¯‡æ–‡ç« æ¶‰åŠå¤šä¸ªæ¨¡å—ä¹‹é—´çš„åä½œï¼Œ**ä¸åƒå•ç‚¹åŠŸèƒ½é‚£æ ·èšç„¦æ˜ç¡®**ï¼Œå¯¹äºæ²¡æ¥è§¦è¿‡å¤æ‚å¤šæ¨¡å—ç³»ç»Ÿçš„åŒå­¦ï¼Œå¯èƒ½é˜…è¯»èµ·æ¥ä¼šæœ‰ä¸€ç‚¹"æ™•"ã€‚
>
> ä¸è¿‡æ²¡å…³ç³»ï¼Œæ–‡ä¸­æˆ‘å·²ç»å°½å¯èƒ½**æ¢³ç†äº†å…³é”®æµç¨‹å’Œç»†èŠ‚** ï¼Œå¸®åŠ©å¤§å®¶ç†è§£æ¨¡å—ä¹‹é—´çš„å…³ç³»ã€‚å¦‚æœåœ¨é˜…è¯»æˆ–å®è·µè¿‡ç¨‹ä¸­è¿˜æœ‰ä¸æ¸…æ¥šçš„åœ°æ–¹ï¼Œ**ä¹Ÿæ¬¢è¿éšæ—¶ç•™è¨€æé—®ï¼Œæˆ‘ä»¬ä¸€èµ·è®¨è®ºï½**

å¦‚ä½•å‘ç°åŠ¨æ€çº¿ç¨‹æ± ï¼Ÿ
----------

ä¸Šä¸€ç« èŠ‚æˆ‘ä»¬å·²ç»äº†è§£äº† SpringBoot Starter çš„åŸºæœ¬æ¦‚å¿µï¼Œæœ¬ç« èŠ‚å°†å…·ä½“ä»‹ç»å¦‚ä½•å€ŸåŠ© SpringBoot Starter å°†çº¿ç¨‹æ± æ³¨å†Œåˆ°ç»Ÿä¸€çš„çº¿ç¨‹æ± å®¹å™¨ `OneThreadRegistry` ä¸­ã€‚

åœ¨å¼€å§‹ä¹‹å‰ï¼Œå…ˆæå‡ºä¸€ä¸ªé—®é¢˜ï¼šå¦‚ä½•ç»Ÿä¸€ç®¡ç†åŠ¨æ€çº¿ç¨‹æ± ï¼Ÿæˆ‘æƒ³åˆ°çš„ä¸€ä¸ªç®€å•æ˜“è¡Œçš„æ–¹æ³•æ˜¯ï¼Œå°†æ¯ä¸ªçº¿ç¨‹æ± å®šä¹‰ä¸ºä¸€ä¸ª Spring çš„ Beanï¼Œå¹¶é€šè¿‡è‡ªå®šä¹‰çš„æ³¨è§£æ ‡è®°ä¸ºåŠ¨æ€çº¿ç¨‹æ± ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * åŠ¨æ€çº¿ç¨‹æ± æ³¨è§£
     * <p>
     * ä½œè€…ï¼šé©¬ä¸
     * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
     * å¼€å‘æ—¶é—´ï¼š2025-04-23
     */
    @Target({ElementType.METHOD, ElementType.TYPE})
    @Retention(RetentionPolicy.RUNTIME)
    @Documented
    public @interface DynamicThreadPool {
    }
              
å‚è€ƒåŠ¨æ€çº¿ç¨‹æ± åˆ›å»ºçš„ç¤ºä¾‹ä»£ç ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    @Bean
    @DynamicThreadPool
    public ThreadPoolExecutor onethreadProducer() {
        return ThreadPoolExecutorBuilder.builder()
                .threadPoolId("onethread-producer")
                .corePoolSize(2)
                .maximumPoolSize(4)
                .keepAliveTime(9999L)
                .awaitTerminationMillis(5000L)
                .workQueueType(BlockingQueueTypeEnum.SYNCHRONOUS_QUEUE)
                .threadFactory("onethread-producer_")
                .rejectedHandler(new ThreadPoolExecutor.CallerRunsPolicy())
                .dynamicPool()
                .build();
    }
              
åˆ°è¿™é‡Œï¼Œå¯èƒ½æœ‰åŒå­¦ä¼šç–‘æƒ‘ï¼Œä»…ä»…æ ‡è®° `@Bean` å’Œ `@DynamicThreadPool` å°±å¯ä»¥æŠŠåŠ¨æ€çº¿ç¨‹æ± æ³¨å†Œåˆ°ç»Ÿä¸€çš„å®¹å™¨é‡Œå—ï¼Ÿç­”æ¡ˆæ˜¾ç„¶æ˜¯å¦å®šçš„ã€‚

ä¸Šè¿°ä»£ç åªæ˜¯å¯¹åŠ¨æ€çº¿ç¨‹æ± çš„æ ‡è®°ï¼Œè¦æƒ³çœŸæ­£å°†å®ƒä»¬åŠ å…¥ç»Ÿä¸€ç®¡ç†çš„å®¹å™¨ï¼Œè¿˜éœ€è¦å€ŸåŠ© Spring æä¾›çš„åç½®å¤„ç†å™¨ `BeanPostProcessor`ã€‚

Spring åç½®å¤„ç†å™¨ {#spring}
----------------------

### 1. é€»è¾‘æ¦‚è¿° {#1}

åç½®å¤„ç†å™¨é™¤äº†å°†åŠ¨æ€çº¿ç¨‹æ± æ³¨å†Œåˆ°ç»Ÿä¸€å®¹å™¨ `OneThreadRegistry` å¤–ï¼Œè¿˜æ‰¿æ‹…å¦ä¸€ä¸ªé‡è¦åŠŸèƒ½ï¼šä»é…ç½®ä¸­å¿ƒè¯»å–è¿œç¨‹çº¿ç¨‹æ± é…ç½®å¹¶è¦†ç›–æœ¬åœ°é…ç½®ã€‚

é€šä¿—åœ°è®²ï¼Œå°±æ˜¯å°½ç®¡ä½ æœ¬åœ°å®šä¹‰äº†çº¿ç¨‹æ± çš„é…ç½®å‚æ•°ï¼Œä½†è¿™äº›å‚æ•°å¯èƒ½å¹¶ä¸ä¼šè¢«ä½¿ç”¨ï¼Œè€Œæ˜¯åœ¨é¡¹ç›®å¯åŠ¨æ—¶ï¼Œè‡ªåŠ¨ä»è¿œç¨‹é…ç½®ä¸­å¿ƒï¼ˆå¦‚ Nacosï¼‰æ‹‰å–æœ€æ–°çš„çº¿ç¨‹æ± å‚æ•°å¹¶ç”Ÿæ•ˆã€‚

é…ç½®ç¤ºä¾‹å¦‚ä¸‹ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    onethread:
      nacos:
        data-id: onethread-nacos-cloud-example-ding-ma.yaml
        group: DEFAULT_GROUP
      config-file-type: YAML
      web:
        core-pool-size: 17
        maximum-pool-size: 26
        keep-alive-time: 60
        notify:
          receives: xxx
      notify-platforms:
        platform: DING
        url: https://oapi.dingtalk.com/robot/send?access_token=xxx
      executors:
      - thread-pool-id: onethread-producer
        core-pool-size: 14
        maximum-pool-size: 22
        queue-capacity: 1999
        work-queue: ResizableCapacityLinkedBlockingQueue
        rejected-handler: DiscardOldestPolicy
        keep-alive-time: 160
        allow-core-thread-time-out: false
        notify:
          receives: xxx
          interval: 10
        alarm:
          enable: false
          queue-threshold: 90
          active-threshold: 90
      - thread-pool-id: onethread-consumer
        core-pool-size: 10
        maximum-pool-size: 20
        queue-capacity: 1024
        work-queue: LinkedBlockingQueue
        rejected-handler: AbortPolicy
        keep-alive-time: 9999
        allow-core-thread-time-out: true
        notify:
          receives: xxx
          interval: 5
        alarm:
          enable: false
          queue-threshold: 80
          active-threshold: 80
              
è¿œç«¯é…ç½®åªè¦†ç›–é…ç½®ä¸­å¿ƒä¸­å®šä¹‰çš„å‚æ•°ï¼Œå…¶ä»–å¦‚çº¿ç¨‹å·¥å‚çš„å®šä¹‰åˆ™ä¸ä¼šè¢«è¦†ç›–ã€‚

### 2. è¿œç«¯é…ç½®è¯»å– {#2}

è¿œç¨‹é…ç½®è¯»å–é€»è¾‘å¦‚ä¸‹ï¼Œä»¥ Nacos ç¤ºä¾‹ç¨‹åºä¸ºä¾‹ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    server:
      port: 18080  # åº”ç”¨æœåŠ¡ç«¯å£ï¼Œå¯åŠ¨åè®¿é—®åœ°å€ä¸º http://localhost:18080
    â€‹
    spring:
      application:
        name: nacos-cloud-example${unique-name:}  # Spring åº”ç”¨åç§°ï¼Œæ”¯æŒé€šè¿‡ unique-name å‚æ•°è‡ªå®šä¹‰æœåŠ¡åï¼Œæ–¹ä¾¿å¤šå®ä¾‹åŒºåˆ†
      config:
        import: nacos:onethread-nacos-cloud-example${unique-name:}.yaml  # ä» Nacos å¯¼å…¥æŒ‡å®šé…ç½®æ–‡ä»¶
      profiles:
        active: dev  # æ¿€æ´»çš„é…ç½®ç¯å¢ƒï¼ˆå¼€å‘ç¯å¢ƒï¼‰
    â€‹
      cloud:
        nacos:
          config:
            username: nacos  # è¿æ¥ Nacos çš„ç”¨æˆ·å
            password: nacos  # è¿æ¥ Nacos çš„å¯†ç 
            file-extension: yaml  # æŒ‡å®šé…ç½®æ–‡ä»¶çš„åç¼€ç±»å‹ä¸º YAML
            extension-configs:
              - data-id: onethread-nacos-cloud-example${unique-name:}.yaml  # æŒ‡å®šæ‰©å±•é…ç½®æ–‡ä»¶çš„ dataId
                group: DEFAULT_GROUP  # é…ç½®æ–‡ä»¶æ‰€åœ¨çš„ Nacos åˆ†ç»„
                refresh: true  # æ˜¯å¦å¼€å¯è‡ªåŠ¨åˆ·æ–°ï¼Œå½“ Nacos é…ç½®å˜æ›´æ—¶è‡ªåŠ¨æ›´æ–°æœ¬åœ°é…ç½®
          server-addr: 127.0.0.1:8848  # Nacos æœåŠ¡å™¨åœ°å€ï¼Œé»˜è®¤ç«¯å£ä¸º 8848
    â€‹
              
åœ¨è¿™æ®µé…ç½®ä¸­ï¼Œæœ‰ä¸¤ä¸ªå…³é”®ç‚¹éœ€è¦ç‰¹åˆ«å…³æ³¨ï¼š

*  
**`-data-id`** ï¼šè¿™æ˜¯æˆ‘ä»¬åœ¨ Nacos ä¸­åˆ›å»ºçš„é…ç½®æ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†ï¼Œåº”ç”¨ä¼šæ ¹æ®å®ƒæ¥è¯»å–å¯¹åº”çš„è¿œç¨‹é…ç½®å†…å®¹ã€‚ä¸€ä¸ªé¡¹ç›®å¯ä»¥é…ç½®å¤šä¸ª `data-id`ï¼Œå®ç°çµæ´»çš„æ¨¡å—åŒ–é…ç½®ã€‚  
*  
  **`spring.config.import`** ï¼šè¿™é‡Œå°¤å…¶å€¼å¾—æ³¨æ„ã€‚åœ¨ SpringBoot2 ä¸­ï¼Œè¿œç¨‹é…ç½®é»˜è®¤ä¼šè‡ªåŠ¨åˆå¹¶åˆ°æœ¬åœ°é…ç½®ä¸­ï¼›ä½†ä» Spring Boot 3 å¼€å§‹ï¼Œ**å¦‚æœä¸é€šè¿‡`spring.config.import`æ˜ç¡®æŒ‡å®šè¿œç¨‹é…ç½®æ–‡ä»¶çš„æ¥æºï¼ŒSpringBootå°†ä¸ä¼šåŠ è½½è¿™äº›é…ç½®** ã€‚å› æ­¤ï¼Œå¦‚æœçœç•¥äº†è¯¥é¡¹ï¼Œä¸‹é¢æåˆ°çš„"è¿œç¨‹é…ç½®è¦†ç›–æœ¬åœ°é…ç½®"çš„åŠŸèƒ½å°†æ— æ³•ç”Ÿæ•ˆã€‚

æ­¤å¤–ï¼Œé…ç½®ä¸­å¿ƒä¸­å­˜å‚¨çš„å‚æ•°æœ¬è´¨ä¸Šæ˜¯**å­—ç¬¦ä¸²å½¢å¼** çš„é”®å€¼å¯¹ï¼Œç›´æ¥ä½¿ç”¨æ—¶ä¸å¤Ÿç›´è§‚ä¹Ÿä¸ä¾¿äºç®¡ç†ã€‚åœ¨ Java åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå°†å…¶**ç»‘å®šä¸ºé…ç½®ç±»çš„å±æ€§å¯¹è±¡** ï¼Œè¿™æ ·æ›´ä¾¿äºç±»å‹è½¬æ¢ã€ä»£ç æç¤ºå’Œåç»­ç»´æŠ¤ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * oneThread é…ç½®ä¸­å¿ƒå‚æ•°
     * <p>
     * ä½œè€…ï¼šé©¬ä¸
     * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
     * å¼€å‘æ—¶é—´ï¼š2025-04-23
     */
    @Data
    public class BootstrapConfigProperties {
    â€‹
        public static final String PREFIX = "onethread";
    â€‹
        /**
         * æ˜¯å¦å¼€å¯åŠ¨æ€çº¿ç¨‹æ± å¼€å…³
         */
        private Boolean enable = Boolean.TRUE;
    â€‹
        /**
         * Nacos é…ç½®æ–‡ä»¶
         */
        private NacosConfig nacos;
    â€‹
        /**
         * Apollo é…ç½®æ–‡ä»¶
         */
        private ApolloConfig apollo;
    â€‹
        /**
         * Web çº¿ç¨‹æ± é…ç½®
         */
        private WebThreadPoolExecutorConfig web;
    â€‹
        /**
         * Nacos è¿œç¨‹é…ç½®æ–‡ä»¶æ ¼å¼ç±»å‹
         */
        private ConfigFileTypeEnum configFileType;
    â€‹
        /**
         * é€šçŸ¥é…ç½®
         */
        private NotifyPlatformsConfig notifyPlatforms;
    â€‹
        /**
         * ç›‘æ§é…ç½®
         */
        private MonitorConfig monitorConfig = new MonitorConfig();
    â€‹
        /**
         * çº¿ç¨‹æ± é…ç½®é›†åˆ
         */
        private List<ThreadPoolExecutorProperties> executors;
    â€‹
        @Data
        public static class NotifyPlatformsConfig {
    â€‹
            /**
             * é€šçŸ¥ç±»å‹ï¼Œæ¯”å¦‚ï¼šDING
             */
            private String platform;
    â€‹
            /**
             * å®Œæ•´ WebHook åœ°å€
             */
            private String url;
        }
    â€‹
        @Data
        public static class MonitorConfig {
    â€‹
            /**
             * é»˜è®¤å¼€å¯ç›‘æ§é…ç½®
             */
            private Boolean enable = Boolean.TRUE;
    â€‹
            /**
             * ç›‘æ§ç±»å‹
             */
            private String collectType = "micrometer";
    â€‹
            /**
             * é‡‡é›†é—´éš”ï¼Œé»˜è®¤ 10 ç§’
             */
            private Long collectInterval = 10L;
        }
    â€‹
        @Data
        public static class NacosConfig {
    â€‹
            private String dataId;
    â€‹
            private String group;
        }
    â€‹
        @Data
        public static class ApolloConfig {
    â€‹
            private String namespace;
        }
    â€‹
        @Data
        public static class WebThreadPoolExecutorConfig {
    â€‹
            /**
             * æ ¸å¿ƒçº¿ç¨‹æ•°
             */
            private Integer corePoolSize;
    â€‹
            /**
             * æœ€å¤§çº¿ç¨‹æ•°
             */
            private Integer maximumPoolSize;
    â€‹
            /**
             * çº¿ç¨‹ç©ºé—²å­˜æ´»æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰
             */
            private Long keepAliveTime;
    â€‹
            /**
             * é€šçŸ¥é…ç½®
             */
            private NotifyConfig notify;
        }
    â€‹
        @Data
        @NoArgsConstructor
        @AllArgsConstructor
        public static class NotifyConfig {
    â€‹
            /**
             * æ¥æ”¶äººé›†åˆ
             */
            private String receives;
        }
    â€‹
        private static BootstrapConfigProperties INSTANCE = new BootstrapConfigProperties();
    â€‹
        public static BootstrapConfigProperties getInstance() {
            return INSTANCE;
        }
    â€‹
        public static void setInstance(BootstrapConfigProperties properties) {
            INSTANCE = properties;
        }
    }
              
è¿™é‡Œè¿˜æ¶‰åŠä¸€å±‚è®¾è®¡ä¸Šçš„é€»è¾‘ï¼š**`core`åŒ…æœ¬èº«æ— æ³•ç›´æ¥è·å–Springå®¹å™¨ä¸­çš„Bean** ï¼Œä½†æˆ‘ä»¬åˆå¸Œæœ›åœ¨ `core` åŒ…ä¸­çš„ç»„ä»¶ï¼ˆå¦‚çº¿ç¨‹æ± ç›‘æ§ã€å‘Šè­¦æ¨¡å—ï¼‰èƒ½å¤Ÿä½¿ç”¨è¿œç¨‹é…ç½®ä¸­å¿ƒä¸‹å‘çš„çº¿ç¨‹æ± å‚æ•°ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªçŸ›ç›¾ï¼Œåœ¨è£…é… `BootstrapConfigProperties` Bean æ—¶ï¼Œæˆ‘ä»¬åšäº†ä¸€äº›å¤„ç†ï¼Œä½¿ç”¨äº†ä¸€ä¸ª **"å°æŠ€å·§"** ï¼šåœ¨ Bean åˆ›å»ºå®Œæˆåï¼Œ**å°†å…¶å®ä¾‹æ‰‹åŠ¨èµ‹å€¼ç»™ç±»ä¸­çš„é™æ€å•ä¾‹å˜é‡** ï¼Œä»è€Œå®ç°å…¨å±€å…±äº«ã€‚

è¿™æ ·ï¼Œå³ä½¿åœ¨é Spring ç¯å¢ƒä¸‹çš„æ¨¡å—ä¸­ï¼ˆæ¯”å¦‚ `core` åŒ…ï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ `BootstrapConfigProperties.getInstance()` çš„æ–¹å¼è·å–åˆ°çº¿ç¨‹æ± çš„é…ç½®å‚æ•°ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    public class CommonAutoConfiguration {
    â€‹
        @Bean
        public BootstrapConfigProperties bootstrapConfigProperties(Environment environment) {
            BootstrapConfigProperties bootstrapConfigProperties = Binder.get(environment)
                    .bind(BootstrapConfigProperties.PREFIX, Bindable.of(BootstrapConfigProperties.class))
                    .get();
            BootstrapConfigProperties.setInstance(bootstrapConfigProperties);
            return bootstrapConfigProperties;
        }
    }
              
é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€åœ¨ `BootstrapConfigProperties` ç±»ä¸Šæ·»åŠ  `@ConfigurationProperties(prefix = "onethread")` æ³¨è§£ï¼ŒSpring Boot å°±ä¼šè‡ªåŠ¨å®Œæˆå±æ€§çš„ç»‘å®šï¼Œæ— éœ€å¦‚æ­¤å¤æ‚çš„å¤„ç†é€»è¾‘ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    @ConfigurationProperties(prefix = "onethread")
    public class BootstrapConfigProperties {
      
        // ......
    }
    â€‹
    public class CommonAutoConfiguration {
    â€‹
        @Bean
        public BootstrapConfigProperties bootstrapConfigProperties() {
            return new BootstrapConfigProperties();
        }
    }
              
å¦‚æœæ˜¯ä¸€ä¸ª**å¸¸è§„çš„SpringBootStarteré¡¹ç›®** ï¼Œä¸”ä¸è€ƒè™‘å…¼å®¹é Spring æˆ–æ—©æœŸ Spring é¡¹ç›®ï¼Œä½¿ç”¨ Spring Boot æä¾›çš„è‡ªåŠ¨å±æ€§ç»‘å®šæœºåˆ¶ï¼ˆå¦‚ `@ConfigurationProperties`ï¼‰å°±è¶³å¤Ÿäº†ï¼Œæ— éœ€é¢å¤–å¤„ç†ã€‚

ä½†è€ƒè™‘åˆ°æˆ‘ä»¬å¸Œæœ›æ¡†æ¶å…·æœ‰æ›´å¼ºçš„é€šç”¨æ€§å’Œæ‰©å±•æ€§ï¼Œå› æ­¤é‡‡ç”¨äº†ä¸¤ä¸ª"å°æŠ€å·§"ï¼š

* 1.  
**æ‰‹åŠ¨ç»‘å®šé…ç½®å±æ€§** ï¼šä¸ä½¿ç”¨ SpringBoot é»˜è®¤çš„è‡ªåŠ¨ç»‘å®šæ–¹å¼ï¼Œè€Œæ˜¯é€šè¿‡ `Binder.bind(...)` æ‰‹åŠ¨åŠ è½½é…ç½®ï¼Œæ˜¾å¼æ§åˆ¶ç»‘å®šè¿‡ç¨‹ï¼Œå¹¶ç¡®ä¿ `BootstrapConfigProperties` å®ä¾‹åœ¨ç»‘å®šå®Œæˆåå³ä¸ºå®Œæ•´å¯¹è±¡ï¼›  
* 2.  
  **ç»´æŠ¤å†…éƒ¨å•ä¾‹** ï¼šåœ¨ `BootstrapConfigProperties` å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªé™æ€å•ä¾‹å¼•ç”¨ï¼ŒBean åˆ›å»ºå¹¶èµ‹å€¼åï¼Œå³å¯é€šè¿‡é™æ€æ–¹æ³•å…¨å±€è®¿é—®è¯¥é…ç½®ã€‚

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå³ä½¿åœ¨ä¸ä¾èµ– Spring å®¹å™¨çš„ `core` åŒ…ä¸­ï¼Œä¹Ÿèƒ½è¯»å–è¿œç¨‹é…ç½®ä¸­å¿ƒï¼ˆå¦‚ Nacosï¼‰ä¸‹å‘çš„çº¿ç¨‹æ± å‚æ•°ï¼Œå®ç°é…ç½®çš„å…¨å±€å¯ç”¨æ€§ä¸æ¨¡å—è§£è€¦ã€‚
> è¿™é‡Œéœ€è¦è¡¥å……ä¸€ç‚¹è¯´æ˜ï¼šä»æ¶æ„è®¾è®¡è§’åº¦æ¥çœ‹ï¼Œè¿™ç§åšæ³•å…¶å®å­˜åœ¨ä¸€å®šçš„**èŒè´£ä¸æ¸…æ™°** é—®é¢˜ã€‚æŒ‰ç…§ç†æƒ³çš„æ¨¡å—è¾¹ç•Œåˆ’åˆ†ï¼Œ`core` åŒ…åº”å½“ä¿æŒçº¯å‡€ï¼Œä¸“æ³¨äºé Spring ä¾èµ–çš„é€šç”¨é€»è¾‘ï¼Œä¸åº”è¯¥ç›´æ¥æ„ŸçŸ¥æˆ–ä¾èµ– Spring ç¯å¢ƒã€‚ä¸è¿‡ï¼Œä¸ºäº†é™ä½ç†è§£æˆæœ¬ã€æå‡ä½¿ç”¨ä¾¿åˆ©æ€§ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œåšäº†ä¸€å®šç¨‹åº¦çš„**è€¦åˆå¤„ç†** ï¼Œé€šè¿‡å†…éƒ¨å•ä¾‹è®© `core` ä¹Ÿèƒ½è®¿é—®åˆ°é…ç½®ä¸­å¿ƒä¸‹å‘çš„å‚æ•°ã€‚
>
> å½“ç„¶ï¼Œè¿™ç§è€¦åˆæ˜¯å¯ä»¥é¿å…çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæŸäº›æ ¸å¿ƒæ¨¡å—ï¼ˆå¦‚çº¿ç¨‹æ± å‘Šè­¦ï¼‰éœ€è¦ä¾èµ–é…ç½®é¡¹ï¼ˆå¦‚é€šçŸ¥æ¥æ”¶äººã€WebHook åœ°å€ï¼‰ï¼Œå®Œå…¨å¯ä»¥é€šè¿‡ **å‚æ•°ä¼ é€’** çš„æ–¹å¼å°†å…¶æ³¨å…¥è¿›æ¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”± Starter ä½œä¸ºå…¥å£ï¼Œå°†ç›¸å…³é…ç½®ä½œä¸ºæ–¹æ³•å‚æ•°ä¼ é€’ç»™ `core` å±‚ï¼Œæ—¢å®ç°äº†åŠŸèƒ½ï¼Œåˆä¿æŒäº†æ¨¡å—çš„ç‹¬ç«‹æ€§ä¸è§£è€¦ã€‚

### 3. è¿œç¨‹å‚æ•°æ›¿æ¢ {#3}

è¿™é‡Œæˆ‘ä»¬å…ˆé€šè¿‡ä¸€å¼ æ—¶åºå›¾ï¼Œå¸®åŠ©å¤§å®¶å¿«é€Ÿå»ºç«‹æ•´ä½“æµç¨‹çš„è®¤çŸ¥ã€‚æœ‰äº†å…¨å±€è§†è§’ä¹‹åï¼Œå†å»è°ƒè¯•å…·ä½“çš„ä»£ç é€»è¾‘ï¼Œä¼šæ›´åŠ æ¸…æ™°ã€äº‹åŠåŠŸå€ã€‚

![iShot_2025-06-26_20.53.58.png](https://article-images.zsxq.com/FqPkMHh5S7O2G5wHepimLRHX0h2C "iShot_2025-06-26_20.53.58.png")

ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * åŠ¨æ€çº¿ç¨‹æ± åç½®å¤„ç†å™¨ï¼Œæ‰«æ Bean æ˜¯å¦ä¸ºåŠ¨æ€çº¿ç¨‹æ± ï¼Œå¦‚æœæ˜¯çš„è¯è¿›è¡Œå±æ€§å¡«å……å’Œæ³¨å†Œ
     * <p>
     * ä½œè€…ï¼šé©¬ä¸
     * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
     * å¼€å‘æ—¶é—´ï¼š2025-04-23
     */
    @Slf4j
    @RequiredArgsConstructor
    public class OneThreadBeanPostProcessor implements BeanPostProcessor {
    â€‹
        private final BootstrapConfigProperties properties;
    â€‹
        @Override
        public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
            if (bean instanceof OneThreadExecutor) {
                DynamicThreadPool dynamicThreadPool;
                try {
                    // é€šè¿‡ IOC å®¹å™¨æ‰«æ Bean æ˜¯å¦å­˜åœ¨åŠ¨æ€çº¿ç¨‹æ± æ³¨è§£
                    dynamicThreadPool = ApplicationContextHolder.findAnnotationOnBean(beanName, DynamicThreadPool.class);
                    if (Objects.isNull(dynamicThreadPool)) {
                        return bean;
                    }
                } catch (Exception ex) {
                    log.error("Failed to create dynamic thread pool in annotation mode.", ex);
                    return bean;
                }
    â€‹
                OneThreadExecutor oneThreadExecutor = (OneThreadExecutor) bean;
                // ä»é…ç½®ä¸­å¿ƒè¯»å–åŠ¨æ€çº¿ç¨‹æ± é…ç½®å¹¶å¯¹çº¿ç¨‹æ± è¿›è¡Œèµ‹å€¼
                ThreadPoolExecutorProperties executorProperties = properties.getExecutors()
                        .stream()
                        .filter(each -> Objects.equals(oneThreadExecutor.getThreadPoolId(), each.getThreadPoolId()))
                        .findFirst()
                        .orElseThrow(() -> new RuntimeException("The thread pool id does not exist in the configuration."));
    â€‹
                overrideLocalThreadPoolConfig(executorProperties, oneThreadExecutor);
    â€‹
                // æ³¨å†Œåˆ°åŠ¨æ€çº¿ç¨‹æ± æ³¨å†Œå™¨ï¼Œåç»­ç›‘æ§å’ŒæŠ¥è­¦ä»æ³¨å†Œå™¨è·å–çº¿ç¨‹æ± å®ä¾‹ã€‚åŒæ—¶ï¼Œå‚æ•°åŠ¨æ€å˜æ›´éœ€è¦ä¾èµ– ThreadPoolExecutorProperties æ¯”å¯¹æ˜¯å¦æœ‰è¾¹è·Ÿ
                OneThreadRegistry.putHolder(oneThreadExecutor.getThreadPoolId(), oneThreadExecutor, executorProperties);
            }
    â€‹
            return bean;
        }
    â€‹
        private void overrideLocalThreadPoolConfig(ThreadPoolExecutorProperties executorProperties, OneThreadExecutor oneThreadExecutor) {
            Integer remoteCorePoolSize = executorProperties.getCorePoolSize();
            Integer remoteMaximumPoolSize = executorProperties.getMaximumPoolSize();
            Assert.isTrue(remoteCorePoolSize <= remoteMaximumPoolSize, "remoteCorePoolSize must be smaller than remoteMaximumPoolSize.");
    â€‹
            // å¦‚æœä¸æ¸…æ¥šä¸ºä»€ä¹ˆæœ‰è¿™æ®µé€»è¾‘ï¼Œå¯ä»¥å‚è€ƒ Hippo4j Issue https://github.com/opengoofy/hippo4j/issues/1063
            int originalMaximumPoolSize = oneThreadExecutor.getMaximumPoolSize();
            if (remoteCorePoolSize > originalMaximumPoolSize) {
                oneThreadExecutor.setMaximumPoolSize(remoteMaximumPoolSize);
                oneThreadExecutor.setCorePoolSize(remoteCorePoolSize);
            } else {
                oneThreadExecutor.setCorePoolSize(remoteCorePoolSize);
                oneThreadExecutor.setMaximumPoolSize(remoteMaximumPoolSize);
            }
    â€‹
            // é˜»å¡é˜Ÿåˆ—æ²¡æœ‰å¸¸è§„ set æ–¹æ³•ï¼Œæ‰€ä»¥ä½¿ç”¨åå°„èµ‹å€¼
            BlockingQueue workQueue = BlockingQueueTypeEnum.createBlockingQueue(executorProperties.getWorkQueue(), executorProperties.getQueueCapacity());
            // Java 9+ çš„æ¨¡å—ç³»ç»Ÿï¼ˆJPMSï¼‰é»˜è®¤ç¦æ­¢é€šè¿‡åå°„è®¿é—® JDK å†…éƒ¨ API çš„ç§æœ‰å­—æ®µï¼Œæ‰€ä»¥éœ€è¦é…ç½®å¼€æ”¾åå°„æƒé™
            // åœ¨å¯åŠ¨å‘½ä»¤ä¸­å¢åŠ ä»¥ä¸‹å‚æ•°ï¼Œæ˜¾å¼å¼€æ”¾ java.util.concurrent åŒ…
            // IDE ä¸­é€šè¿‡åœ¨ VM options ä¸­æ·»åŠ å‚æ•°ï¼š--add-opens=java.base/java.util.concurrent=ALL-UNNAMED
            // éƒ¨ç½²çš„æ—¶å€™ï¼Œåœ¨å¯åŠ¨è„šæœ¬ï¼ˆå¦‚ java -jar å‘½ä»¤ï¼‰ä¸­åŠ å…¥è¯¥å‚æ•°ï¼šjava -jar --add-opens=java.base/java.util.concurrent=ALL-UNNAMED your-app.jar
            ReflectUtil.setFieldValue(oneThreadExecutor, "workQueue", workQueue);
    â€‹
            // èµ‹å€¼åŠ¨æ€çº¿ç¨‹æ± å…¶ä»–æ ¸å¿ƒå‚æ•°
            oneThreadExecutor.setKeepAliveTime(executorProperties.getKeepAliveTime(), TimeUnit.SECONDS);
            oneThreadExecutor.allowCoreThreadTimeOut(executorProperties.getAllowCoreThreadTimeOut());
            oneThreadExecutor.setRejectedExecutionHandler(RejectedPolicyTypeEnum.createPolicy(executorProperties.getRejectedHandler()));
        }
    }
              
è¿™é‡Œå¯èƒ½æœ‰åŒå­¦ä¼šæ‹…å¿ƒï¼š**é€šè¿‡åå°„æ›¿æ¢`workQueue`æ˜¯å¦å­˜åœ¨é£é™©ï¼Ÿæ¯”å¦‚é˜Ÿåˆ—ä¸­æ˜¯å¦å¯èƒ½å·²ç»æœ‰æœªå®Œæˆçš„ä»»åŠ¡ï¼Ÿ**

å®é™…ä¸Šè¿™ç§æƒ…å†µæ˜¯ä¸å­˜åœ¨çš„ã€‚å› ä¸ºæ­¤æ—¶çº¿ç¨‹æ± ä»å¤„äº **Beanåˆ›å»ºé˜¶æ®µ** ï¼Œå°šæœªå¯¹å¤–æä¾›æœåŠ¡ï¼Œä¹Ÿå°±ä¸ä¼šæœ‰ä»»ä½•ä»»åŠ¡æäº¤è¿›æ¥ã€‚å› æ­¤ï¼Œæ›¿æ¢ `workQueue` æ˜¯å®‰å…¨ä¸”å¯æ§çš„ã€‚

å¼€å‘ SpringBoot Starter {#spring-boot-starter}
--------------------------------------------

å‰é¢æˆ‘ä»¬å·²ç»è®²è§£äº†åŠ¨æ€çº¿ç¨‹æ± çš„**æ ‡è¯†æ–¹å¼** ã€**è¿œç¨‹é…ç½®çš„è¯»å–é€»è¾‘** ä»¥åŠ**æ ¸å¿ƒå‚æ•°çš„è¦†ç›–æœºåˆ¶** ï¼Œä¹Ÿå°±æ˜¯è¯´å®ç°å±‚çš„ä»£ç åŸºæœ¬å·²ç»å®Œæˆã€‚

ä½†æœ‰ä¸€ä¸ªå…³é”®é—®é¢˜å¤§å®¶éœ€è¦æ€è€ƒï¼š**ä»£ç å†™å¥½äº†ï¼Œå¦‚ä½•æ‰èƒ½è®©å®ƒåœ¨é¡¹ç›®å¯åŠ¨æ—¶è‡ªåŠ¨ç”Ÿæ•ˆï¼Ÿ**

è¿™å°±è¦å›åˆ°æˆ‘ä»¬åœ¨ä¸Šä¸€ç« èŠ‚æåˆ°çš„ **SpringBootStarter** æœºåˆ¶ï¼Œé€šè¿‡è‡ªåŠ¨è£…é…çš„æ–¹å¼ï¼Œè®©ç›¸å…³é€»è¾‘åœ¨å¯åŠ¨æ—¶è¢«æ­£ç¡®åŠ è½½å’Œæ‰§è¡Œã€‚

æˆ‘ä»¬å¯ä»¥æŠŠå¼€å‘ Starter æ¯”ä½œ"æŠŠå¤§è±¡è£…è¿›å†°ç®±"ï¼Œåªéœ€è¦ä¸‰æ­¥ï¼š

* 1.  
ç¼–å†™æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä»£ç ï¼ˆæ¯”å¦‚è¿œç¨‹é…ç½®è¯»å–ã€åç½®å¤„ç†å™¨ç­‰ï¼‰ï¼›  
* 2.  
ç¼–å†™é…ç½®ç±»ï¼Œå°†è¿™äº›é€»è¾‘æ³¨å†Œä¸º Spring Beanï¼›  
* 3.  
  é€šè¿‡è‡ªåŠ¨è£…é…æœºåˆ¶ï¼Œå°†é…ç½®ç±»é›†æˆè¿›åº”ç”¨å¯åŠ¨æµç¨‹ä¸­ã€‚

å‰ä¸¤æ­¥æˆ‘ä»¬å·²ç»ä»‹ç»å¾—å·®ä¸å¤šäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é‡ç‚¹æ¼”ç¤º**åä¸¤æ­¥** ï¼šå¦‚ä½•è¿›è¡Œé…ç½®ç±»æ³¨å†Œä¸è‡ªåŠ¨è£…é…ã€‚

### 1. Spring è£…é…ç±» {#1-spring}

ä¹‹æ‰€ä»¥å°† `OneThreadBaseConfiguration` æ”¾åœ¨ `spring-base` æ¨¡å—ï¼Œè€Œå°† `CommonAutoConfiguration` æ”¾åœ¨ `common-spring-boot-starter` æ¨¡å—ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬åœ¨æœ€åˆè®¾è®¡æ—¶å°±è€ƒè™‘åˆ°äº†è¦å…¼å®¹ **æ™®é€šSpringé¡¹ç›®** ï¼ˆé Spring Bootï¼‰ã€‚å› æ­¤ï¼ŒåŸºç¡€é…ç½®ç±»ä¸è‡ªåŠ¨è£…é…ç±»è¿›è¡Œäº†åˆç†æ‹†åˆ†ï¼Œåˆ†åˆ«æ”¾ç½®äºä¸åŒæ¨¡å—ä¸­ï¼Œä¾¿äºæŒ‰éœ€å¼•å…¥ä¸å¤ç”¨ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * åŠ¨æ€çº¿ç¨‹æ± åŸºç¡€ Spring é…ç½®ç±»
     * <p>
     * ä½œè€…ï¼šé©¬ä¸
     * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
     * å¼€å‘æ—¶é—´ï¼š2025-04-23
     */
    @Configuration
    public class OneThreadBaseConfiguration {
    â€‹
        @Bean
        public ApplicationContextHolder applicationContextHolder() {
            return new ApplicationContextHolder();
        }
    â€‹
        @Bean
        @DependsOn("applicationContextHolder")
        public OneThreadBeanPostProcessor oneThreadBeanPostProcessor(BootstrapConfigProperties properties) {
            return new OneThreadBeanPostProcessor(properties);
        }
      
        // ......
    }
    â€‹
    /**
     * åŸºäºé…ç½®ä¸­å¿ƒçš„å…¬å…±è‡ªåŠ¨è£…é…é…ç½®
     * <p>
     * ä½œè€…ï¼šé©¬ä¸
     * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
     * å¼€å‘æ—¶é—´ï¼š2025-04-28
     */
    @Import(OneThreadBaseConfiguration.class)
    @AutoConfigureAfter(OneThreadBaseConfiguration.class)
    public class CommonAutoConfiguration {
    â€‹
        @Bean
        public BootstrapConfigProperties bootstrapConfigProperties(Environment environment) {
            BootstrapConfigProperties bootstrapConfigProperties = Binder.get(environment)
                    .bind(BootstrapConfigProperties.PREFIX, Bindable.of(BootstrapConfigProperties.class))
                    .get();
            BootstrapConfigProperties.setInstance(bootstrapConfigProperties);
            return bootstrapConfigProperties;
        }
        // ......
    }
              
ä¸Šè¿°ä»£ç ä¸­åŒ…å«ä¸‰ä¸ªå…³é”®ç»†èŠ‚ï¼Œå€¼å¾—ç‰¹åˆ«å…³æ³¨ï¼š

*  
**`@DependsOn`** ï¼šç”±äº `OneThreadBeanPostProcessor` ä¾èµ–å…¶ä»– Beanï¼ˆå¦‚ `ApplicationContextHolder`ï¼‰ï¼Œè€Œ Spring åœ¨åˆå§‹åŒ– Bean æ—¶é»˜è®¤ä¸ä¿è¯é¡ºåºï¼Œå› æ­¤é€šè¿‡ `@DependsOn` æ˜¾å¼å£°æ˜ä¾èµ–å…³ç³»ï¼Œä»¥ç¡®ä¿æ‰€éœ€ Bean å·²å°±ç»ªï¼Œé¿å…åˆå§‹åŒ–å¼‚å¸¸ã€‚  
*  
**`@Import`** ï¼šç”¨äºåœ¨ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»ä¸­å¼•å…¥å¦ä¸€ä¸ªé…ç½®ç±»ï¼Œä»è€Œè®©å…¶ä¸€å¹¶ç”Ÿæ•ˆã€‚è¿™æ˜¯æ¨¡å—åŒ– Starter ä¸­å¸¸ç”¨çš„è£…é…æ‰‹æ®µã€‚  
*  
  **`@AutoConfigureAfter`** ï¼šæŒ‡å®šå½“å‰è‡ªåŠ¨é…ç½®ç±»åº”åœ¨æŸä¸ªé…ç½®ç±»ä¹‹ååŠ è½½ã€‚ç”±äº `OneThreadBaseConfiguration` å±äºåŸºç¡€é…ç½®ï¼Œå› æ­¤éœ€è¦ç¡®ä¿å®ƒä¼˜å…ˆäºå…¶ä»–è‡ªåŠ¨é…ç½®ç±»è¢«åŠ è½½ã€‚

### 2. è‡ªåŠ¨è£…é… {#2}

é€šè¿‡ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å·²ç»æ˜ç¡®äº†å®é™…éœ€è¦è‡ªåŠ¨è£…é…çš„é…ç½®ç±»åªæœ‰ä¸€ä¸ªã€‚æ¥ä¸‹æ¥è¦åšçš„ï¼Œå°±æ˜¯**è®©SpringBootèƒ½å¤Ÿå‘ç°å¹¶åŠ è½½å®ƒ** ã€‚

åœ¨ **SpringBoot3.x** ä¸­ï¼Œå®˜æ–¹å¼•å…¥äº†å…¨æ–°çš„è‡ªåŠ¨è£…é…æœºåˆ¶ï¼šéœ€è¦åœ¨ `META-INF/spring/` ç›®å½•ä¸‹ï¼ŒæŒ‰ç±»å‹ç»´æŠ¤å¯¹åº”çš„ **importsæ–‡ä»¶** ã€‚å¯¹äºè‡ªåŠ¨é…ç½®ç±»ï¼Œéœ€è¦åˆ›å»ºå¦‚ä¸‹æ–‡ä»¶ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports
    â€‹
    # ä»¥ä¸‹ä¸ºæ–‡ä»¶å…·ä½“å†…å®¹
    com.nageoffer.onethread.config.common.starter.configuration.CommonAutoConfiguration
              
è‡³æ­¤ï¼Œæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ª Spring Boot Starter ------ `common-spring-boot-starter` å·²ç»å®Œæˆã€‚

æœ‰åŒå­¦å¯èƒ½ä¼šç–‘é—®ï¼š**å®ƒæœ¬èº«è¿˜ä¸åŒ…å«åŠ¨æ€çº¿ç¨‹æ± åˆ·æ–°çš„èƒ½åŠ›ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦å•ç‹¬å®šä¹‰è¿™ä¸ªStarterå‘¢** ï¼Ÿ

åŸå› åœ¨äºï¼Œæˆ‘ä»¬åç»­å°†æ”¯æŒå¤šç§é…ç½®ä¸­å¿ƒï¼ˆå¦‚ Nacosã€Apollo ç­‰ï¼‰ï¼Œè€Œ**åŠ¨æ€é…ç½®åˆ·æ–°ã€é€šçŸ¥å‘Šè­¦ç­‰é€»è¾‘åœ¨å„é…ç½®ä¸­å¿ƒä¸­æ˜¯é«˜åº¦é€šç”¨çš„** ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸€å…¬å…±æ¨¡å—ï¼Œç›¸å…³é€»è¾‘å°±å¿…é¡»åœ¨æ¯ä¸ªé…ç½®ä¸­å¿ƒçš„å®ç°ä¸­é‡å¤ç¼–å†™ï¼Œæ—¢å¢åŠ äº†ç»´æŠ¤æˆæœ¬ï¼Œä¹Ÿç ´åäº†ä»£ç çš„å¯å¤ç”¨æ€§ã€‚

é€šè¿‡æŠ½è±¡å‡º `common-spring-boot-starter`ï¼Œæˆ‘ä»¬å°†è¿™éƒ¨åˆ†é€šç”¨èƒ½åŠ›ç»Ÿä¸€å°è£…ï¼Œæå¤§æå‡äº†æ•´ä½“çš„æ¨¡å—åŒ–ä¸æ‰©å±•æ€§ã€‚

å…³äºå¯ç”¨åŠ¨æ€çº¿ç¨‹æ± æ ‡è¯†
-----------

æœ€æ—©åœ¨ç ”ç©¶ Zuul Starter æ—¶ï¼Œæˆ‘æ¥è§¦åˆ°äº†"å¯æ’æ‹”"è¿™ä¸ªæ¦‚å¿µã€‚ç®€å•æ¥è¯´ï¼Œå¯æ’æ‹”æŒ‡çš„æ˜¯ï¼š**å³ä½¿å¼•å…¥äº†æŸä¸ªStarterJaråŒ…ï¼Œå…¶åŠŸèƒ½æ˜¯å¦ç”Ÿæ•ˆä»ç”±ç‰¹å®šæ¡ä»¶å†³å®š** ã€‚

æ¢å¥è¯è¯´ï¼Œåªæœ‰å½“æ»¡è¶³æŸäº›å‰ç½®æ¡ä»¶æ—¶ï¼Œç›¸å…³çš„è‡ªåŠ¨é…ç½®ç±»æ‰ä¼šè¢«åŠ è½½ï¼›å¦‚æœæ¡ä»¶ä¸æ»¡è¶³ï¼Œè¯¥æ¨¡å—å°±ä¼šè¢«"æ™¾åœ¨ä¸€è¾¹"ã€‚è¿™ç§æœºåˆ¶çš„æœ¬è´¨å°±æ˜¯**æ¨¡å—æ’ä»¶åŒ–** ï¼Œå¯ä»¥æœ‰æ•ˆ**é™ä½è€¦åˆã€æå‡çµæ´»æ€§** ã€‚

### 1. å®šä¹‰æ³¨è§£ {#1}

æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªå…·æœ‰"ä¸­é—´ä»¶èŒƒå¼"çš„æ³¨è§£ï¼Œé€šå¸¸ä»¥ `Enable` å¼€å¤´ï¼Œä¾‹å¦‚ `@EnableOneThread`ï¼Œä¸€çœ¼å°±èƒ½çœ‹å‡ºå®ƒæ˜¯ç”¨æ¥å¼€å¯æŸä¸ªç‰¹æ€§æˆ–æ¨¡å—çš„å¼€å…³ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * åŠ¨æ€å¯ç”¨ oneThread åŠ¨æ€çº¿ç¨‹æ± å¼€å…³æ³¨è§£
     * <p>
     * ä½œè€…ï¼šé©¬ä¸
     * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
     * å¼€å‘æ—¶é—´ï¼š2025-04-23
     */
    @Target(ElementType.TYPE)
    @Retention(RetentionPolicy.RUNTIME)
    @Documented
    @Import(MarkerConfiguration.class)
    public @interface EnableOneThread {
    }
              
å½“åœ¨é¡¹ç›®ä¸­ä½¿ç”¨è¯¥æ³¨è§£æ—¶ï¼Œå®é™…ä¸Šä¼šè§¦å‘å†…éƒ¨çš„ `@Import` æœºåˆ¶ï¼Œè¿›è€ŒåŠ è½½å¹¶æ‰§è¡Œ `MarkerConfiguration` ä¸­çš„é…ç½®é€»è¾‘ï¼Œä»è€Œå¯ç”¨åŠ¨æ€çº¿ç¨‹æ± ç›¸å…³åŠŸèƒ½ã€‚

è¿™ç±»å¯æ’æ‹”æ³¨è§£é€šå¸¸**åŠ åœ¨åº”ç”¨çš„å¯åŠ¨ç±»ä¸Š** ï¼Œç”¨æ¥æ˜¾å¼å¼€å¯æŸä¸ªæ¨¡å—åŠŸèƒ½ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    @EnableOneThread
    @SpringBootApplication
    public class NacosCloudExampleApplication {
    â€‹
        public static void main(String[] args) {
            SpringApplication.run(NacosCloudExampleApplication.class, args);
        }
    }
              
### 2. å®šä¹‰é…ç½®ç±» {#2}

å¯æ’æ‹”æœºåˆ¶çš„æ ¸å¿ƒåœ¨äº"æŒ‰éœ€åŠ è½½"ï¼Œè€Œå…¶å®ç°æ–¹å¼æ˜¯å¤šç§å¤šæ ·çš„ï¼Œæ¯”å¦‚ï¼šé€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„å¼€å…³ï¼ˆå¦‚æŒ‡å®šå‰ç¼€çš„ Keyï¼‰ã€æˆ–è‡ªå®šä¹‰æ³¨è§£æ§åˆ¶æ¨¡å—å¯ç”¨ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    @Configuration
    public class MarkerConfiguration {
    â€‹
        @Bean
        public Marker dynamicThreadPoolMarkerBean() {
            return new Marker();
        }
    â€‹
        /**
         * æ ‡è®°ç±»
         * å¯ç”¨äºæ¡ä»¶è£…é…ï¼ˆ@ConditionalOnBean ç­‰ï¼‰ä¸­ä½œä¸ºå­˜åœ¨æ€§çš„åˆ¤æ–­ä¾æ®
         * <p>
         * ä½œè€…ï¼šé©¬ä¸
         * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
         * å¼€å‘æ—¶é—´ï¼š2025-04-23
         */
        public class Marker {
    â€‹
        }
    }
              
å…·ä½“æ¥è¯´ï¼Œå½“é¡¹ç›®ä¸­ä½¿ç”¨äº† `@EnableOneThread` æ³¨è§£ï¼Œå°±ä¼šé€šè¿‡ `@Import` æ³¨å†Œä¸€ä¸ªæ ‡è®°ç±» `Marker`ã€‚ **æœ‰è¿™ä¸ªæ ‡è®°Beanï¼ŒStarterä¸­çš„åŠ¨æ€çº¿ç¨‹æ± é€»è¾‘æ‰ä¼šè¢«åŠ è½½ï¼›åä¹‹ï¼Œåˆ™ä¸ä¼šç”Ÿæ•ˆ** ï¼Œå®ç°çœŸæ­£æ„ä¹‰ä¸Šçš„"æŒ‰éœ€å¯ç”¨"ã€‚

### 3. å¯æ’æ‹”é…ç½® {#3}

åœ¨æˆ‘ä»¬çš„è®¾è®¡ä¸­ï¼Œ**è¿™ä¸¤ç§æ–¹å¼éƒ½æ”¯æŒ** ã€‚ä½†æ— è®ºæ˜¯å“ªç§æ–¹å¼ï¼Œæœ¬è´¨ä¸Šéƒ½ç¦»ä¸å¼€ Spring Boot æä¾›çš„æ¡ä»¶è£…é…æ³¨è§£ï¼ˆå¦‚ `@ConditionalOnBean`ã€`@ConditionalOnProperty` ç­‰ï¼‰ä½œä¸ºåˆ¤æ–­ä¾æ®ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    @ConditionalOnBean(MarkerConfiguration.Marker.class)
    @Import(OneThreadBaseConfiguration.class)
    @AutoConfigureAfter(OneThreadBaseConfiguration.class)
    public class CommonAutoConfiguration {
        // ......
    }
              
### 4. åŸºäº Property å®ç°å¯æ’æ‹” {#4-property}

é™¤äº†ä½¿ç”¨å¯æ’æ‹”æ³¨è§£çš„æ–¹å¼å¤–ï¼Œæˆ‘ä»¬è¿˜å®ç°äº†**åŸºäºé…ç½®æ–‡ä»¶å±æ€§çš„å¯æ’æ‹”æœºåˆ¶** ã€‚å¤§å®¶å¯ä»¥æ³¨æ„åˆ°ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ§åˆ¶å¼€å…³ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    onethread:
      enable: true  # é»˜è®¤ä¸º trueï¼Œè®¾ç½®ä¸º false åˆ™ä¸ä¼šåŠ è½½åŠ¨æ€çº¿ç¨‹æ± åŠŸèƒ½
              
ä¸ºäº†å®ç°è¿™ä¸€åŠŸèƒ½ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Spring Boot æä¾›çš„ `@ConditionalOnProperty` æ³¨è§£ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼š**æ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„æŸä¸ªå±æ€§å€¼ï¼ŒåŠ¨æ€åˆ¤æ–­æ˜¯å¦åŠ è½½æŒ‡å®šçš„Beanæˆ–é…ç½®ç±»** ã€‚

è‡ªåŠ¨è£…é…ç±»å¦‚ä¸‹æ‰€ç¤ºï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    @ConditionalOnBean(MarkerConfiguration.Marker.class)
    @Import(OneThreadBaseConfiguration.class)
    @AutoConfigureAfter(OneThreadBaseConfiguration.class)
    @ConditionalOnProperty(prefix = BootstrapConfigProperties.PREFIX, value = "enable", matchIfMissing = true, havingValue = "true")
    public class CommonAutoConfiguration {
        // ......
    }
              
è¿™ç§æ–¹å¼éå¸¸é€‚åˆç”¨äº Starter æ¨¡å—ï¼Œèƒ½å¤Ÿè®©ä½¿ç”¨è€…é€šè¿‡ç®€å•çš„é…ç½®ï¼Œ**æ˜¾å¼åœ°å¯ç”¨æˆ–å…³é—­æŸäº›åŠŸèƒ½æ¨¡å—** ï¼Œä»è€Œå¢å¼ºäº†çµæ´»æ€§å’Œå¯æ§æ€§ã€‚  

|        å‚æ•°        |            ä½œç”¨è¯´æ˜             |
|------------------|-----------------------------|
| `prefix`         | é…ç½®å‰ç¼€ï¼Œæ¯”å¦‚ `spring.datasource` |
| `name` / `value` | å±æ€§åï¼Œä¾‹å¦‚ `enabled`            |
| `havingValue`    | å±æ€§å€¼å¿…é¡»ç­‰äºè¿™ä¸ªå€¼æ—¶æ‰ç”Ÿæ•ˆ              |
| `matchIfMissing` | å½“é…ç½®é¡¹ç¼ºå¤±æ—¶æ˜¯å¦è®¤ä¸ºæ¡ä»¶æˆç«‹ï¼Œé»˜è®¤ false    |

æ–‡æœ«æ€»ç»“
----

è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæ•´äº†è§£äº† Starter çš„æ„å»ºæµç¨‹å’Œå¯æ’æ‹”æœºåˆ¶çš„å®ç°åŸç†ã€‚

åœ¨ä¸‹ä¸€ç« èŠ‚ï¼Œæˆ‘ä»¬å°†ç»§ç»­æ·±å…¥ï¼Œå¸¦å¤§å®¶å®ç°**çº¿ç¨‹æ± çš„åŠ¨æ€åˆ·æ–°èƒ½åŠ›** ï¼Œè®©çº¿ç¨‹æ± åœ¨è¿è¡Œæ—¶ä¹Ÿèƒ½çµæ´»å˜æ›´é…ç½®ã€‚

å®Œç»“ï¼Œæ’’èŠ± ğŸ‰  
è‡ªå®šä¹‰oneThread-SpringBoot-StarteråŸºç¡€ç»„ä»¶ï¼Œå…ƒæ•°æ®ä¿¡æ¯ï¼š

*  
ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± oneThreadï¼š<https://t.zsxq.com/5GfrN>  
*  
ä»£ç ä»“åº“ï¼š<https://gitcode.net/nageoffer/onethread> ------ ç”³è¯·é¡¹ç›®æƒé™å‚è€ƒä¸Šè¿°çº¿ç¨‹æ± é¡¹ç›®é“¾æ¥  
*  
ç« èŠ‚éš¾åº¦ï¼šâ˜…â˜…â˜…â˜†â˜† - è¾ƒéš¾  
*  
  è§†é¢‘åœ°å€ï¼šæ–‡æ¡£å…ˆè¡Œè§†é¢‘æ¬¡ä¹‹



***å†…å®¹æ‘˜è¦ï¼šæœ¬ç« èŠ‚æ·±å…¥æ¢è®¨äº†å¦‚ä½•é€šè¿‡SpringBootStarterç»Ÿä¸€ç®¡ç†åŠ¨æ€çº¿ç¨‹æ± ï¼ŒåŒ…æ‹¬** åŠ¨æ€çº¿ç¨‹æ± æ ‡è®°* \*ã€\*\* è¿œç¨‹é…ç½®è¦†ç›–\*\*ã€\*\* Starter å¼€å‘**ä»¥åŠ** å¯æ’æ‹”è®¾è®¡\*\*ç­‰åŠŸèƒ½ã€‚

è¯¾ç¨‹ç›®å½•å¦‚ä¸‹æ‰€ç¤ºï¼š

*  
å¦‚ä½•å‘ç°åŠ¨æ€çº¿ç¨‹æ± ï¼Ÿ  
*  
Spring åç½®å¤„ç†å™¨  
*  
å¼€å‘ SpringBoot Starter  
*  
å…³äºå¯ç”¨åŠ¨æ€çº¿ç¨‹æ± æ ‡è¯†  
*  
  æ–‡æœ«æ€»ç»“

æœ¬ç« èŠ‚å°†æ¶‰åŠåˆ° `core`ã€`spring-base`ã€`starter/common-spring-boot-starter`ã€`nacos-cloud-example` å››ä¸ªæ¨¡å—ã€‚

![iShot_2025-06-26_20.53.59.png](https://article-images.zsxq.com/FnGsvdmA6cTDjXJhsUxryzhs5XPB "iShot_2025-06-26_20.53.59.png")

> è¿™ç¯‡æ–‡ç« æ¶‰åŠå¤šä¸ªæ¨¡å—ä¹‹é—´çš„åä½œï¼Œ**ä¸åƒå•ç‚¹åŠŸèƒ½é‚£æ ·èšç„¦æ˜ç¡®**ï¼Œå¯¹äºæ²¡æ¥è§¦è¿‡å¤æ‚å¤šæ¨¡å—ç³»ç»Ÿçš„åŒå­¦ï¼Œå¯èƒ½é˜…è¯»èµ·æ¥ä¼šæœ‰ä¸€ç‚¹"æ™•"ã€‚
>
> ä¸è¿‡æ²¡å…³ç³»ï¼Œæ–‡ä¸­æˆ‘å·²ç»å°½å¯èƒ½**æ¢³ç†äº†å…³é”®æµç¨‹å’Œç»†èŠ‚** ï¼Œå¸®åŠ©å¤§å®¶ç†è§£æ¨¡å—ä¹‹é—´çš„å…³ç³»ã€‚å¦‚æœåœ¨é˜…è¯»æˆ–å®è·µè¿‡ç¨‹ä¸­è¿˜æœ‰ä¸æ¸…æ¥šçš„åœ°æ–¹ï¼Œ**ä¹Ÿæ¬¢è¿éšæ—¶ç•™è¨€æé—®ï¼Œæˆ‘ä»¬ä¸€èµ·è®¨è®ºï½**

å¦‚ä½•å‘ç°åŠ¨æ€çº¿ç¨‹æ± ï¼Ÿ
----------

ä¸Šä¸€ç« èŠ‚æˆ‘ä»¬å·²ç»äº†è§£äº† SpringBoot Starter çš„åŸºæœ¬æ¦‚å¿µï¼Œæœ¬ç« èŠ‚å°†å…·ä½“ä»‹ç»å¦‚ä½•å€ŸåŠ© SpringBoot Starter å°†çº¿ç¨‹æ± æ³¨å†Œåˆ°ç»Ÿä¸€çš„çº¿ç¨‹æ± å®¹å™¨ `OneThreadRegistry` ä¸­ã€‚

åœ¨å¼€å§‹ä¹‹å‰ï¼Œå…ˆæå‡ºä¸€ä¸ªé—®é¢˜ï¼šå¦‚ä½•ç»Ÿä¸€ç®¡ç†åŠ¨æ€çº¿ç¨‹æ± ï¼Ÿæˆ‘æƒ³åˆ°çš„ä¸€ä¸ªç®€å•æ˜“è¡Œçš„æ–¹æ³•æ˜¯ï¼Œå°†æ¯ä¸ªçº¿ç¨‹æ± å®šä¹‰ä¸ºä¸€ä¸ª Spring çš„ Beanï¼Œå¹¶é€šè¿‡è‡ªå®šä¹‰çš„æ³¨è§£æ ‡è®°ä¸ºåŠ¨æ€çº¿ç¨‹æ± ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * åŠ¨æ€çº¿ç¨‹æ± æ³¨è§£
     * <p>
     * ä½œè€…ï¼šé©¬ä¸
     * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
     * å¼€å‘æ—¶é—´ï¼š2025-04-23
     */
    @Target({ElementType.METHOD, ElementType.TYPE})
    @Retention(RetentionPolicy.RUNTIME)
    @Documented
    public @interface DynamicThreadPool {
    }
              
å‚è€ƒåŠ¨æ€çº¿ç¨‹æ± åˆ›å»ºçš„ç¤ºä¾‹ä»£ç ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    @Bean
    @DynamicThreadPool
    public ThreadPoolExecutor onethreadProducer() {
        return ThreadPoolExecutorBuilder.builder()
                .threadPoolId("onethread-producer")
                .corePoolSize(2)
                .maximumPoolSize(4)
                .keepAliveTime(9999L)
                .awaitTerminationMillis(5000L)
                .workQueueType(BlockingQueueTypeEnum.SYNCHRONOUS_QUEUE)
                .threadFactory("onethread-producer_")
                .rejectedHandler(new ThreadPoolExecutor.CallerRunsPolicy())
                .dynamicPool()
                .build();
    }
              
åˆ°è¿™é‡Œï¼Œå¯èƒ½æœ‰åŒå­¦ä¼šç–‘æƒ‘ï¼Œä»…ä»…æ ‡è®° `@Bean` å’Œ `@DynamicThreadPool` å°±å¯ä»¥æŠŠåŠ¨æ€çº¿ç¨‹æ± æ³¨å†Œåˆ°ç»Ÿä¸€çš„å®¹å™¨é‡Œå—ï¼Ÿç­”æ¡ˆæ˜¾ç„¶æ˜¯å¦å®šçš„ã€‚

ä¸Šè¿°ä»£ç åªæ˜¯å¯¹åŠ¨æ€çº¿ç¨‹æ± çš„æ ‡è®°ï¼Œè¦æƒ³çœŸæ­£å°†å®ƒä»¬åŠ å…¥ç»Ÿä¸€ç®¡ç†çš„å®¹å™¨ï¼Œè¿˜éœ€è¦å€ŸåŠ© Spring æä¾›çš„åç½®å¤„ç†å™¨ `BeanPostProcessor`ã€‚

Spring åç½®å¤„ç†å™¨ {#spring}
----------------------

### 1. é€»è¾‘æ¦‚è¿° {#1}

åç½®å¤„ç†å™¨é™¤äº†å°†åŠ¨æ€çº¿ç¨‹æ± æ³¨å†Œåˆ°ç»Ÿä¸€å®¹å™¨ `OneThreadRegistry` å¤–ï¼Œè¿˜æ‰¿æ‹…å¦ä¸€ä¸ªé‡è¦åŠŸèƒ½ï¼šä»é…ç½®ä¸­å¿ƒè¯»å–è¿œç¨‹çº¿ç¨‹æ± é…ç½®å¹¶è¦†ç›–æœ¬åœ°é…ç½®ã€‚

é€šä¿—åœ°è®²ï¼Œå°±æ˜¯å°½ç®¡ä½ æœ¬åœ°å®šä¹‰äº†çº¿ç¨‹æ± çš„é…ç½®å‚æ•°ï¼Œä½†è¿™äº›å‚æ•°å¯èƒ½å¹¶ä¸ä¼šè¢«ä½¿ç”¨ï¼Œè€Œæ˜¯åœ¨é¡¹ç›®å¯åŠ¨æ—¶ï¼Œè‡ªåŠ¨ä»è¿œç¨‹é…ç½®ä¸­å¿ƒï¼ˆå¦‚ Nacosï¼‰æ‹‰å–æœ€æ–°çš„çº¿ç¨‹æ± å‚æ•°å¹¶ç”Ÿæ•ˆã€‚

é…ç½®ç¤ºä¾‹å¦‚ä¸‹ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    onethread:
      nacos:
        data-id: onethread-nacos-cloud-example-ding-ma.yaml
        group: DEFAULT_GROUP
      config-file-type: YAML
      web:
        core-pool-size: 17
        maximum-pool-size: 26
        keep-alive-time: 60
        notify:
          receives: xxx
      notify-platforms:
        platform: DING
        url: https://oapi.dingtalk.com/robot/send?access_token=xxx
      executors:
      - thread-pool-id: onethread-producer
        core-pool-size: 14
        maximum-pool-size: 22
        queue-capacity: 1999
        work-queue: ResizableCapacityLinkedBlockingQueue
        rejected-handler: DiscardOldestPolicy
        keep-alive-time: 160
        allow-core-thread-time-out: false
        notify:
          receives: xxx
          interval: 10
        alarm:
          enable: false
          queue-threshold: 90
          active-threshold: 90
      - thread-pool-id: onethread-consumer
        core-pool-size: 10
        maximum-pool-size: 20
        queue-capacity: 1024
        work-queue: LinkedBlockingQueue
        rejected-handler: AbortPolicy
        keep-alive-time: 9999
        allow-core-thread-time-out: true
        notify:
          receives: xxx
          interval: 5
        alarm:
          enable: false
          queue-threshold: 80
          active-threshold: 80
              
è¿œç«¯é…ç½®åªè¦†ç›–é…ç½®ä¸­å¿ƒä¸­å®šä¹‰çš„å‚æ•°ï¼Œå…¶ä»–å¦‚çº¿ç¨‹å·¥å‚çš„å®šä¹‰åˆ™ä¸ä¼šè¢«è¦†ç›–ã€‚

### 2. è¿œç«¯é…ç½®è¯»å– {#2}

è¿œç¨‹é…ç½®è¯»å–é€»è¾‘å¦‚ä¸‹ï¼Œä»¥ Nacos ç¤ºä¾‹ç¨‹åºä¸ºä¾‹ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    server:
      port: 18080  # åº”ç”¨æœåŠ¡ç«¯å£ï¼Œå¯åŠ¨åè®¿é—®åœ°å€ä¸º http://localhost:18080
    â€‹
    spring:
      application:
        name: nacos-cloud-example${unique-name:}  # Spring åº”ç”¨åç§°ï¼Œæ”¯æŒé€šè¿‡ unique-name å‚æ•°è‡ªå®šä¹‰æœåŠ¡åï¼Œæ–¹ä¾¿å¤šå®ä¾‹åŒºåˆ†
      config:
        import: nacos:onethread-nacos-cloud-example${unique-name:}.yaml  # ä» Nacos å¯¼å…¥æŒ‡å®šé…ç½®æ–‡ä»¶
      profiles:
        active: dev  # æ¿€æ´»çš„é…ç½®ç¯å¢ƒï¼ˆå¼€å‘ç¯å¢ƒï¼‰
    â€‹
      cloud:
        nacos:
          config:
            username: nacos  # è¿æ¥ Nacos çš„ç”¨æˆ·å
            password: nacos  # è¿æ¥ Nacos çš„å¯†ç 
            file-extension: yaml  # æŒ‡å®šé…ç½®æ–‡ä»¶çš„åç¼€ç±»å‹ä¸º YAML
            extension-configs:
              - data-id: onethread-nacos-cloud-example${unique-name:}.yaml  # æŒ‡å®šæ‰©å±•é…ç½®æ–‡ä»¶çš„ dataId
                group: DEFAULT_GROUP  # é…ç½®æ–‡ä»¶æ‰€åœ¨çš„ Nacos åˆ†ç»„
                refresh: true  # æ˜¯å¦å¼€å¯è‡ªåŠ¨åˆ·æ–°ï¼Œå½“ Nacos é…ç½®å˜æ›´æ—¶è‡ªåŠ¨æ›´æ–°æœ¬åœ°é…ç½®
          server-addr: 127.0.0.1:8848  # Nacos æœåŠ¡å™¨åœ°å€ï¼Œé»˜è®¤ç«¯å£ä¸º 8848
    â€‹
              
åœ¨è¿™æ®µé…ç½®ä¸­ï¼Œæœ‰ä¸¤ä¸ªå…³é”®ç‚¹éœ€è¦ç‰¹åˆ«å…³æ³¨ï¼š

*  
**`-data-id`** ï¼šè¿™æ˜¯æˆ‘ä»¬åœ¨ Nacos ä¸­åˆ›å»ºçš„é…ç½®æ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†ï¼Œåº”ç”¨ä¼šæ ¹æ®å®ƒæ¥è¯»å–å¯¹åº”çš„è¿œç¨‹é…ç½®å†…å®¹ã€‚ä¸€ä¸ªé¡¹ç›®å¯ä»¥é…ç½®å¤šä¸ª `data-id`ï¼Œå®ç°çµæ´»çš„æ¨¡å—åŒ–é…ç½®ã€‚  
*  
  **`spring.config.import`** ï¼šè¿™é‡Œå°¤å…¶å€¼å¾—æ³¨æ„ã€‚åœ¨ SpringBoot2 ä¸­ï¼Œè¿œç¨‹é…ç½®é»˜è®¤ä¼šè‡ªåŠ¨åˆå¹¶åˆ°æœ¬åœ°é…ç½®ä¸­ï¼›ä½†ä» Spring Boot 3 å¼€å§‹ï¼Œ**å¦‚æœä¸é€šè¿‡`spring.config.import`æ˜ç¡®æŒ‡å®šè¿œç¨‹é…ç½®æ–‡ä»¶çš„æ¥æºï¼ŒSpringBootå°†ä¸ä¼šåŠ è½½è¿™äº›é…ç½®** ã€‚å› æ­¤ï¼Œå¦‚æœçœç•¥äº†è¯¥é¡¹ï¼Œä¸‹é¢æåˆ°çš„"è¿œç¨‹é…ç½®è¦†ç›–æœ¬åœ°é…ç½®"çš„åŠŸèƒ½å°†æ— æ³•ç”Ÿæ•ˆã€‚

æ­¤å¤–ï¼Œé…ç½®ä¸­å¿ƒä¸­å­˜å‚¨çš„å‚æ•°æœ¬è´¨ä¸Šæ˜¯**å­—ç¬¦ä¸²å½¢å¼** çš„é”®å€¼å¯¹ï¼Œç›´æ¥ä½¿ç”¨æ—¶ä¸å¤Ÿç›´è§‚ä¹Ÿä¸ä¾¿äºç®¡ç†ã€‚åœ¨ Java åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå°†å…¶**ç»‘å®šä¸ºé…ç½®ç±»çš„å±æ€§å¯¹è±¡** ï¼Œè¿™æ ·æ›´ä¾¿äºç±»å‹è½¬æ¢ã€ä»£ç æç¤ºå’Œåç»­ç»´æŠ¤ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * oneThread é…ç½®ä¸­å¿ƒå‚æ•°
     * <p>
     * ä½œè€…ï¼šé©¬ä¸
     * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
     * å¼€å‘æ—¶é—´ï¼š2025-04-23
     */
    @Data
    public class BootstrapConfigProperties {
    â€‹
        public static final String PREFIX = "onethread";
    â€‹
        /**
         * æ˜¯å¦å¼€å¯åŠ¨æ€çº¿ç¨‹æ± å¼€å…³
         */
        private Boolean enable = Boolean.TRUE;
    â€‹
        /**
         * Nacos é…ç½®æ–‡ä»¶
         */
        private NacosConfig nacos;
    â€‹
        /**
         * Apollo é…ç½®æ–‡ä»¶
         */
        private ApolloConfig apollo;
    â€‹
        /**
         * Web çº¿ç¨‹æ± é…ç½®
         */
        private WebThreadPoolExecutorConfig web;
    â€‹
        /**
         * Nacos è¿œç¨‹é…ç½®æ–‡ä»¶æ ¼å¼ç±»å‹
         */
        private ConfigFileTypeEnum configFileType;
    â€‹
        /**
         * é€šçŸ¥é…ç½®
         */
        private NotifyPlatformsConfig notifyPlatforms;
    â€‹
        /**
         * ç›‘æ§é…ç½®
         */
        private MonitorConfig monitorConfig = new MonitorConfig();
    â€‹
        /**
         * çº¿ç¨‹æ± é…ç½®é›†åˆ
         */
        private List<ThreadPoolExecutorProperties> executors;
    â€‹
        @Data
        public static class NotifyPlatformsConfig {
    â€‹
            /**
             * é€šçŸ¥ç±»å‹ï¼Œæ¯”å¦‚ï¼šDING
             */
            private String platform;
    â€‹
            /**
             * å®Œæ•´ WebHook åœ°å€
             */
            private String url;
        }
    â€‹
        @Data
        public static class MonitorConfig {
    â€‹
            /**
             * é»˜è®¤å¼€å¯ç›‘æ§é…ç½®
             */
            private Boolean enable = Boolean.TRUE;
    â€‹
            /**
             * ç›‘æ§ç±»å‹
             */
            private String collectType = "micrometer";
    â€‹
            /**
             * é‡‡é›†é—´éš”ï¼Œé»˜è®¤ 10 ç§’
             */
            private Long collectInterval = 10L;
        }
    â€‹
        @Data
        public static class NacosConfig {
    â€‹
            private String dataId;
    â€‹
            private String group;
        }
    â€‹
        @Data
        public static class ApolloConfig {
    â€‹
            private String namespace;
        }
    â€‹
        @Data
        public static class WebThreadPoolExecutorConfig {
    â€‹
            /**
             * æ ¸å¿ƒçº¿ç¨‹æ•°
             */
            private Integer corePoolSize;
    â€‹
            /**
             * æœ€å¤§çº¿ç¨‹æ•°
             */
            private Integer maximumPoolSize;
    â€‹
            /**
             * çº¿ç¨‹ç©ºé—²å­˜æ´»æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰
             */
            private Long keepAliveTime;
    â€‹
            /**
             * é€šçŸ¥é…ç½®
             */
            private NotifyConfig notify;
        }
    â€‹
        @Data
        @NoArgsConstructor
        @AllArgsConstructor
        public static class NotifyConfig {
    â€‹
            /**
             * æ¥æ”¶äººé›†åˆ
             */
            private String receives;
        }
    â€‹
        private static BootstrapConfigProperties INSTANCE = new BootstrapConfigProperties();
    â€‹
        public static BootstrapConfigProperties getInstance() {
            return INSTANCE;
        }
    â€‹
        public static void setInstance(BootstrapConfigProperties properties) {
            INSTANCE = properties;
        }
    }
              
è¿™é‡Œè¿˜æ¶‰åŠä¸€å±‚è®¾è®¡ä¸Šçš„é€»è¾‘ï¼š**`core`åŒ…æœ¬èº«æ— æ³•ç›´æ¥è·å–Springå®¹å™¨ä¸­çš„Bean** ï¼Œä½†æˆ‘ä»¬åˆå¸Œæœ›åœ¨ `core` åŒ…ä¸­çš„ç»„ä»¶ï¼ˆå¦‚çº¿ç¨‹æ± ç›‘æ§ã€å‘Šè­¦æ¨¡å—ï¼‰èƒ½å¤Ÿä½¿ç”¨è¿œç¨‹é…ç½®ä¸­å¿ƒä¸‹å‘çš„çº¿ç¨‹æ± å‚æ•°ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªçŸ›ç›¾ï¼Œåœ¨è£…é… `BootstrapConfigProperties` Bean æ—¶ï¼Œæˆ‘ä»¬åšäº†ä¸€äº›å¤„ç†ï¼Œä½¿ç”¨äº†ä¸€ä¸ª **"å°æŠ€å·§"** ï¼šåœ¨ Bean åˆ›å»ºå®Œæˆåï¼Œ**å°†å…¶å®ä¾‹æ‰‹åŠ¨èµ‹å€¼ç»™ç±»ä¸­çš„é™æ€å•ä¾‹å˜é‡** ï¼Œä»è€Œå®ç°å…¨å±€å…±äº«ã€‚

è¿™æ ·ï¼Œå³ä½¿åœ¨é Spring ç¯å¢ƒä¸‹çš„æ¨¡å—ä¸­ï¼ˆæ¯”å¦‚ `core` åŒ…ï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ `BootstrapConfigProperties.getInstance()` çš„æ–¹å¼è·å–åˆ°çº¿ç¨‹æ± çš„é…ç½®å‚æ•°ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    public class CommonAutoConfiguration {
    â€‹
        @Bean
        public BootstrapConfigProperties bootstrapConfigProperties(Environment environment) {
            BootstrapConfigProperties bootstrapConfigProperties = Binder.get(environment)
                    .bind(BootstrapConfigProperties.PREFIX, Bindable.of(BootstrapConfigProperties.class))
                    .get();
            BootstrapConfigProperties.setInstance(bootstrapConfigProperties);
            return bootstrapConfigProperties;
        }
    }
              
é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€åœ¨ `BootstrapConfigProperties` ç±»ä¸Šæ·»åŠ  `@ConfigurationProperties(prefix = "onethread")` æ³¨è§£ï¼ŒSpring Boot å°±ä¼šè‡ªåŠ¨å®Œæˆå±æ€§çš„ç»‘å®šï¼Œæ— éœ€å¦‚æ­¤å¤æ‚çš„å¤„ç†é€»è¾‘ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    @ConfigurationProperties(prefix = "onethread")
    public class BootstrapConfigProperties {
      
        // ......
    }
    â€‹
    public class CommonAutoConfiguration {
    â€‹
        @Bean
        public BootstrapConfigProperties bootstrapConfigProperties() {
            return new BootstrapConfigProperties();
        }
    }
              
å¦‚æœæ˜¯ä¸€ä¸ª**å¸¸è§„çš„SpringBootStarteré¡¹ç›®** ï¼Œä¸”ä¸è€ƒè™‘å…¼å®¹é Spring æˆ–æ—©æœŸ Spring é¡¹ç›®ï¼Œä½¿ç”¨ Spring Boot æä¾›çš„è‡ªåŠ¨å±æ€§ç»‘å®šæœºåˆ¶ï¼ˆå¦‚ `@ConfigurationProperties`ï¼‰å°±è¶³å¤Ÿäº†ï¼Œæ— éœ€é¢å¤–å¤„ç†ã€‚

ä½†è€ƒè™‘åˆ°æˆ‘ä»¬å¸Œæœ›æ¡†æ¶å…·æœ‰æ›´å¼ºçš„é€šç”¨æ€§å’Œæ‰©å±•æ€§ï¼Œå› æ­¤é‡‡ç”¨äº†ä¸¤ä¸ª"å°æŠ€å·§"ï¼š

* 1.  
**æ‰‹åŠ¨ç»‘å®šé…ç½®å±æ€§** ï¼šä¸ä½¿ç”¨ SpringBoot é»˜è®¤çš„è‡ªåŠ¨ç»‘å®šæ–¹å¼ï¼Œè€Œæ˜¯é€šè¿‡ `Binder.bind(...)` æ‰‹åŠ¨åŠ è½½é…ç½®ï¼Œæ˜¾å¼æ§åˆ¶ç»‘å®šè¿‡ç¨‹ï¼Œå¹¶ç¡®ä¿ `BootstrapConfigProperties` å®ä¾‹åœ¨ç»‘å®šå®Œæˆåå³ä¸ºå®Œæ•´å¯¹è±¡ï¼›  
* 2.  
  **ç»´æŠ¤å†…éƒ¨å•ä¾‹** ï¼šåœ¨ `BootstrapConfigProperties` å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªé™æ€å•ä¾‹å¼•ç”¨ï¼ŒBean åˆ›å»ºå¹¶èµ‹å€¼åï¼Œå³å¯é€šè¿‡é™æ€æ–¹æ³•å…¨å±€è®¿é—®è¯¥é…ç½®ã€‚

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå³ä½¿åœ¨ä¸ä¾èµ– Spring å®¹å™¨çš„ `core` åŒ…ä¸­ï¼Œä¹Ÿèƒ½è¯»å–è¿œç¨‹é…ç½®ä¸­å¿ƒï¼ˆå¦‚ Nacosï¼‰ä¸‹å‘çš„çº¿ç¨‹æ± å‚æ•°ï¼Œå®ç°é…ç½®çš„å…¨å±€å¯ç”¨æ€§ä¸æ¨¡å—è§£è€¦ã€‚
> è¿™é‡Œéœ€è¦è¡¥å……ä¸€ç‚¹è¯´æ˜ï¼šä»æ¶æ„è®¾è®¡è§’åº¦æ¥çœ‹ï¼Œè¿™ç§åšæ³•å…¶å®å­˜åœ¨ä¸€å®šçš„**èŒè´£ä¸æ¸…æ™°** é—®é¢˜ã€‚æŒ‰ç…§ç†æƒ³çš„æ¨¡å—è¾¹ç•Œåˆ’åˆ†ï¼Œ`core` åŒ…åº”å½“ä¿æŒçº¯å‡€ï¼Œä¸“æ³¨äºé Spring ä¾èµ–çš„é€šç”¨é€»è¾‘ï¼Œä¸åº”è¯¥ç›´æ¥æ„ŸçŸ¥æˆ–ä¾èµ– Spring ç¯å¢ƒã€‚ä¸è¿‡ï¼Œä¸ºäº†é™ä½ç†è§£æˆæœ¬ã€æå‡ä½¿ç”¨ä¾¿åˆ©æ€§ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œåšäº†ä¸€å®šç¨‹åº¦çš„**è€¦åˆå¤„ç†** ï¼Œé€šè¿‡å†…éƒ¨å•ä¾‹è®© `core` ä¹Ÿèƒ½è®¿é—®åˆ°é…ç½®ä¸­å¿ƒä¸‹å‘çš„å‚æ•°ã€‚
>
> å½“ç„¶ï¼Œè¿™ç§è€¦åˆæ˜¯å¯ä»¥é¿å…çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæŸäº›æ ¸å¿ƒæ¨¡å—ï¼ˆå¦‚çº¿ç¨‹æ± å‘Šè­¦ï¼‰éœ€è¦ä¾èµ–é…ç½®é¡¹ï¼ˆå¦‚é€šçŸ¥æ¥æ”¶äººã€WebHook åœ°å€ï¼‰ï¼Œå®Œå…¨å¯ä»¥é€šè¿‡ **å‚æ•°ä¼ é€’** çš„æ–¹å¼å°†å…¶æ³¨å…¥è¿›æ¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”± Starter ä½œä¸ºå…¥å£ï¼Œå°†ç›¸å…³é…ç½®ä½œä¸ºæ–¹æ³•å‚æ•°ä¼ é€’ç»™ `core` å±‚ï¼Œæ—¢å®ç°äº†åŠŸèƒ½ï¼Œåˆä¿æŒäº†æ¨¡å—çš„ç‹¬ç«‹æ€§ä¸è§£è€¦ã€‚

### 3. è¿œç¨‹å‚æ•°æ›¿æ¢ {#3}

è¿™é‡Œæˆ‘ä»¬å…ˆé€šè¿‡ä¸€å¼ æ—¶åºå›¾ï¼Œå¸®åŠ©å¤§å®¶å¿«é€Ÿå»ºç«‹æ•´ä½“æµç¨‹çš„è®¤çŸ¥ã€‚æœ‰äº†å…¨å±€è§†è§’ä¹‹åï¼Œå†å»è°ƒè¯•å…·ä½“çš„ä»£ç é€»è¾‘ï¼Œä¼šæ›´åŠ æ¸…æ™°ã€äº‹åŠåŠŸå€ã€‚

![iShot_2025-06-26_20.53.58.png](https://article-images.zsxq.com/FqPkMHh5S7O2G5wHepimLRHX0h2C "iShot_2025-06-26_20.53.58.png")

ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * åŠ¨æ€çº¿ç¨‹æ± åç½®å¤„ç†å™¨ï¼Œæ‰«æ Bean æ˜¯å¦ä¸ºåŠ¨æ€çº¿ç¨‹æ± ï¼Œå¦‚æœæ˜¯çš„è¯è¿›è¡Œå±æ€§å¡«å……å’Œæ³¨å†Œ
     * <p>
     * ä½œè€…ï¼šé©¬ä¸
     * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
     * å¼€å‘æ—¶é—´ï¼š2025-04-23
     */
    @Slf4j
    @RequiredArgsConstructor
    public class OneThreadBeanPostProcessor implements BeanPostProcessor {
    â€‹
        private final BootstrapConfigProperties properties;
    â€‹
        @Override
        public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
            if (bean instanceof OneThreadExecutor) {
                DynamicThreadPool dynamicThreadPool;
                try {
                    // é€šè¿‡ IOC å®¹å™¨æ‰«æ Bean æ˜¯å¦å­˜åœ¨åŠ¨æ€çº¿ç¨‹æ± æ³¨è§£
                    dynamicThreadPool = ApplicationContextHolder.findAnnotationOnBean(beanName, DynamicThreadPool.class);
                    if (Objects.isNull(dynamicThreadPool)) {
                        return bean;
                    }
                } catch (Exception ex) {
                    log.error("Failed to create dynamic thread pool in annotation mode.", ex);
                    return bean;
                }
    â€‹
                OneThreadExecutor oneThreadExecutor = (OneThreadExecutor) bean;
                // ä»é…ç½®ä¸­å¿ƒè¯»å–åŠ¨æ€çº¿ç¨‹æ± é…ç½®å¹¶å¯¹çº¿ç¨‹æ± è¿›è¡Œèµ‹å€¼
                ThreadPoolExecutorProperties executorProperties = properties.getExecutors()
                        .stream()
                        .filter(each -> Objects.equals(oneThreadExecutor.getThreadPoolId(), each.getThreadPoolId()))
                        .findFirst()
                        .orElseThrow(() -> new RuntimeException("The thread pool id does not exist in the configuration."));
    â€‹
                overrideLocalThreadPoolConfig(executorProperties, oneThreadExecutor);
    â€‹
                // æ³¨å†Œåˆ°åŠ¨æ€çº¿ç¨‹æ± æ³¨å†Œå™¨ï¼Œåç»­ç›‘æ§å’ŒæŠ¥è­¦ä»æ³¨å†Œå™¨è·å–çº¿ç¨‹æ± å®ä¾‹ã€‚åŒæ—¶ï¼Œå‚æ•°åŠ¨æ€å˜æ›´éœ€è¦ä¾èµ– ThreadPoolExecutorProperties æ¯”å¯¹æ˜¯å¦æœ‰è¾¹è·Ÿ
                OneThreadRegistry.putHolder(oneThreadExecutor.getThreadPoolId(), oneThreadExecutor, executorProperties);
            }
    â€‹
            return bean;
        }
    â€‹
        private void overrideLocalThreadPoolConfig(ThreadPoolExecutorProperties executorProperties, OneThreadExecutor oneThreadExecutor) {
            Integer remoteCorePoolSize = executorProperties.getCorePoolSize();
            Integer remoteMaximumPoolSize = executorProperties.getMaximumPoolSize();
            Assert.isTrue(remoteCorePoolSize <= remoteMaximumPoolSize, "remoteCorePoolSize must be smaller than remoteMaximumPoolSize.");
    â€‹
            // å¦‚æœä¸æ¸…æ¥šä¸ºä»€ä¹ˆæœ‰è¿™æ®µé€»è¾‘ï¼Œå¯ä»¥å‚è€ƒ Hippo4j Issue https://github.com/opengoofy/hippo4j/issues/1063
            int originalMaximumPoolSize = oneThreadExecutor.getMaximumPoolSize();
            if (remoteCorePoolSize > originalMaximumPoolSize) {
                oneThreadExecutor.setMaximumPoolSize(remoteMaximumPoolSize);
                oneThreadExecutor.setCorePoolSize(remoteCorePoolSize);
            } else {
                oneThreadExecutor.setCorePoolSize(remoteCorePoolSize);
                oneThreadExecutor.setMaximumPoolSize(remoteMaximumPoolSize);
            }
    â€‹
            // é˜»å¡é˜Ÿåˆ—æ²¡æœ‰å¸¸è§„ set æ–¹æ³•ï¼Œæ‰€ä»¥ä½¿ç”¨åå°„èµ‹å€¼
            BlockingQueue workQueue = BlockingQueueTypeEnum.createBlockingQueue(executorProperties.getWorkQueue(), executorProperties.getQueueCapacity());
            // Java 9+ çš„æ¨¡å—ç³»ç»Ÿï¼ˆJPMSï¼‰é»˜è®¤ç¦æ­¢é€šè¿‡åå°„è®¿é—® JDK å†…éƒ¨ API çš„ç§æœ‰å­—æ®µï¼Œæ‰€ä»¥éœ€è¦é…ç½®å¼€æ”¾åå°„æƒé™
            // åœ¨å¯åŠ¨å‘½ä»¤ä¸­å¢åŠ ä»¥ä¸‹å‚æ•°ï¼Œæ˜¾å¼å¼€æ”¾ java.util.concurrent åŒ…
            // IDE ä¸­é€šè¿‡åœ¨ VM options ä¸­æ·»åŠ å‚æ•°ï¼š--add-opens=java.base/java.util.concurrent=ALL-UNNAMED
            // éƒ¨ç½²çš„æ—¶å€™ï¼Œåœ¨å¯åŠ¨è„šæœ¬ï¼ˆå¦‚ java -jar å‘½ä»¤ï¼‰ä¸­åŠ å…¥è¯¥å‚æ•°ï¼šjava -jar --add-opens=java.base/java.util.concurrent=ALL-UNNAMED your-app.jar
            ReflectUtil.setFieldValue(oneThreadExecutor, "workQueue", workQueue);
    â€‹
            // èµ‹å€¼åŠ¨æ€çº¿ç¨‹æ± å…¶ä»–æ ¸å¿ƒå‚æ•°
            oneThreadExecutor.setKeepAliveTime(executorProperties.getKeepAliveTime(), TimeUnit.SECONDS);
            oneThreadExecutor.allowCoreThreadTimeOut(executorProperties.getAllowCoreThreadTimeOut());
            oneThreadExecutor.setRejectedExecutionHandler(RejectedPolicyTypeEnum.createPolicy(executorProperties.getRejectedHandler()));
        }
    }
              
è¿™é‡Œå¯èƒ½æœ‰åŒå­¦ä¼šæ‹…å¿ƒï¼š**é€šè¿‡åå°„æ›¿æ¢`workQueue`æ˜¯å¦å­˜åœ¨é£é™©ï¼Ÿæ¯”å¦‚é˜Ÿåˆ—ä¸­æ˜¯å¦å¯èƒ½å·²ç»æœ‰æœªå®Œæˆçš„ä»»åŠ¡ï¼Ÿ**

å®é™…ä¸Šè¿™ç§æƒ…å†µæ˜¯ä¸å­˜åœ¨çš„ã€‚å› ä¸ºæ­¤æ—¶çº¿ç¨‹æ± ä»å¤„äº **Beanåˆ›å»ºé˜¶æ®µ** ï¼Œå°šæœªå¯¹å¤–æä¾›æœåŠ¡ï¼Œä¹Ÿå°±ä¸ä¼šæœ‰ä»»ä½•ä»»åŠ¡æäº¤è¿›æ¥ã€‚å› æ­¤ï¼Œæ›¿æ¢ `workQueue` æ˜¯å®‰å…¨ä¸”å¯æ§çš„ã€‚

å¼€å‘ SpringBoot Starter {#spring-boot-starter}
--------------------------------------------

å‰é¢æˆ‘ä»¬å·²ç»è®²è§£äº†åŠ¨æ€çº¿ç¨‹æ± çš„**æ ‡è¯†æ–¹å¼** ã€**è¿œç¨‹é…ç½®çš„è¯»å–é€»è¾‘** ä»¥åŠ**æ ¸å¿ƒå‚æ•°çš„è¦†ç›–æœºåˆ¶** ï¼Œä¹Ÿå°±æ˜¯è¯´å®ç°å±‚çš„ä»£ç åŸºæœ¬å·²ç»å®Œæˆã€‚

ä½†æœ‰ä¸€ä¸ªå…³é”®é—®é¢˜å¤§å®¶éœ€è¦æ€è€ƒï¼š**ä»£ç å†™å¥½äº†ï¼Œå¦‚ä½•æ‰èƒ½è®©å®ƒåœ¨é¡¹ç›®å¯åŠ¨æ—¶è‡ªåŠ¨ç”Ÿæ•ˆï¼Ÿ**

è¿™å°±è¦å›åˆ°æˆ‘ä»¬åœ¨ä¸Šä¸€ç« èŠ‚æåˆ°çš„ **SpringBootStarter** æœºåˆ¶ï¼Œé€šè¿‡è‡ªåŠ¨è£…é…çš„æ–¹å¼ï¼Œè®©ç›¸å…³é€»è¾‘åœ¨å¯åŠ¨æ—¶è¢«æ­£ç¡®åŠ è½½å’Œæ‰§è¡Œã€‚

æˆ‘ä»¬å¯ä»¥æŠŠå¼€å‘ Starter æ¯”ä½œ"æŠŠå¤§è±¡è£…è¿›å†°ç®±"ï¼Œåªéœ€è¦ä¸‰æ­¥ï¼š

* 1.  
ç¼–å†™æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä»£ç ï¼ˆæ¯”å¦‚è¿œç¨‹é…ç½®è¯»å–ã€åç½®å¤„ç†å™¨ç­‰ï¼‰ï¼›  
* 2.  
ç¼–å†™é…ç½®ç±»ï¼Œå°†è¿™äº›é€»è¾‘æ³¨å†Œä¸º Spring Beanï¼›  
* 3.  
  é€šè¿‡è‡ªåŠ¨è£…é…æœºåˆ¶ï¼Œå°†é…ç½®ç±»é›†æˆè¿›åº”ç”¨å¯åŠ¨æµç¨‹ä¸­ã€‚

å‰ä¸¤æ­¥æˆ‘ä»¬å·²ç»ä»‹ç»å¾—å·®ä¸å¤šäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é‡ç‚¹æ¼”ç¤º**åä¸¤æ­¥** ï¼šå¦‚ä½•è¿›è¡Œé…ç½®ç±»æ³¨å†Œä¸è‡ªåŠ¨è£…é…ã€‚

### 1. Spring è£…é…ç±» {#1-spring}

ä¹‹æ‰€ä»¥å°† `OneThreadBaseConfiguration` æ”¾åœ¨ `spring-base` æ¨¡å—ï¼Œè€Œå°† `CommonAutoConfiguration` æ”¾åœ¨ `common-spring-boot-starter` æ¨¡å—ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬åœ¨æœ€åˆè®¾è®¡æ—¶å°±è€ƒè™‘åˆ°äº†è¦å…¼å®¹ **æ™®é€šSpringé¡¹ç›®** ï¼ˆé Spring Bootï¼‰ã€‚å› æ­¤ï¼ŒåŸºç¡€é…ç½®ç±»ä¸è‡ªåŠ¨è£…é…ç±»è¿›è¡Œäº†åˆç†æ‹†åˆ†ï¼Œåˆ†åˆ«æ”¾ç½®äºä¸åŒæ¨¡å—ä¸­ï¼Œä¾¿äºæŒ‰éœ€å¼•å…¥ä¸å¤ç”¨ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * åŠ¨æ€çº¿ç¨‹æ± åŸºç¡€ Spring é…ç½®ç±»
     * <p>
     * ä½œè€…ï¼šé©¬ä¸
     * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
     * å¼€å‘æ—¶é—´ï¼š2025-04-23
     */
    @Configuration
    public class OneThreadBaseConfiguration {
    â€‹
        @Bean
        public ApplicationContextHolder applicationContextHolder() {
            return new ApplicationContextHolder();
        }
    â€‹
        @Bean
        @DependsOn("applicationContextHolder")
        public OneThreadBeanPostProcessor oneThreadBeanPostProcessor(BootstrapConfigProperties properties) {
            return new OneThreadBeanPostProcessor(properties);
        }
      
        // ......
    }
    â€‹
    /**
     * åŸºäºé…ç½®ä¸­å¿ƒçš„å…¬å…±è‡ªåŠ¨è£…é…é…ç½®
     * <p>
     * ä½œè€…ï¼šé©¬ä¸
     * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
     * å¼€å‘æ—¶é—´ï¼š2025-04-28
     */
    @Import(OneThreadBaseConfiguration.class)
    @AutoConfigureAfter(OneThreadBaseConfiguration.class)
    public class CommonAutoConfiguration {
    â€‹
        @Bean
        public BootstrapConfigProperties bootstrapConfigProperties(Environment environment) {
            BootstrapConfigProperties bootstrapConfigProperties = Binder.get(environment)
                    .bind(BootstrapConfigProperties.PREFIX, Bindable.of(BootstrapConfigProperties.class))
                    .get();
            BootstrapConfigProperties.setInstance(bootstrapConfigProperties);
            return bootstrapConfigProperties;
        }
        // ......
    }
              
ä¸Šè¿°ä»£ç ä¸­åŒ…å«ä¸‰ä¸ªå…³é”®ç»†èŠ‚ï¼Œå€¼å¾—ç‰¹åˆ«å…³æ³¨ï¼š

*  
**`@DependsOn`** ï¼šç”±äº `OneThreadBeanPostProcessor` ä¾èµ–å…¶ä»– Beanï¼ˆå¦‚ `ApplicationContextHolder`ï¼‰ï¼Œè€Œ Spring åœ¨åˆå§‹åŒ– Bean æ—¶é»˜è®¤ä¸ä¿è¯é¡ºåºï¼Œå› æ­¤é€šè¿‡ `@DependsOn` æ˜¾å¼å£°æ˜ä¾èµ–å…³ç³»ï¼Œä»¥ç¡®ä¿æ‰€éœ€ Bean å·²å°±ç»ªï¼Œé¿å…åˆå§‹åŒ–å¼‚å¸¸ã€‚  
*  
**`@Import`** ï¼šç”¨äºåœ¨ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»ä¸­å¼•å…¥å¦ä¸€ä¸ªé…ç½®ç±»ï¼Œä»è€Œè®©å…¶ä¸€å¹¶ç”Ÿæ•ˆã€‚è¿™æ˜¯æ¨¡å—åŒ– Starter ä¸­å¸¸ç”¨çš„è£…é…æ‰‹æ®µã€‚  
*  
  **`@AutoConfigureAfter`** ï¼šæŒ‡å®šå½“å‰è‡ªåŠ¨é…ç½®ç±»åº”åœ¨æŸä¸ªé…ç½®ç±»ä¹‹ååŠ è½½ã€‚ç”±äº `OneThreadBaseConfiguration` å±äºåŸºç¡€é…ç½®ï¼Œå› æ­¤éœ€è¦ç¡®ä¿å®ƒä¼˜å…ˆäºå…¶ä»–è‡ªåŠ¨é…ç½®ç±»è¢«åŠ è½½ã€‚

### 2. è‡ªåŠ¨è£…é… {#2}

é€šè¿‡ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å·²ç»æ˜ç¡®äº†å®é™…éœ€è¦è‡ªåŠ¨è£…é…çš„é…ç½®ç±»åªæœ‰ä¸€ä¸ªã€‚æ¥ä¸‹æ¥è¦åšçš„ï¼Œå°±æ˜¯**è®©SpringBootèƒ½å¤Ÿå‘ç°å¹¶åŠ è½½å®ƒ** ã€‚

åœ¨ **SpringBoot3.x** ä¸­ï¼Œå®˜æ–¹å¼•å…¥äº†å…¨æ–°çš„è‡ªåŠ¨è£…é…æœºåˆ¶ï¼šéœ€è¦åœ¨ `META-INF/spring/` ç›®å½•ä¸‹ï¼ŒæŒ‰ç±»å‹ç»´æŠ¤å¯¹åº”çš„ **importsæ–‡ä»¶** ã€‚å¯¹äºè‡ªåŠ¨é…ç½®ç±»ï¼Œéœ€è¦åˆ›å»ºå¦‚ä¸‹æ–‡ä»¶ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports
    â€‹
    # ä»¥ä¸‹ä¸ºæ–‡ä»¶å…·ä½“å†…å®¹
    com.nageoffer.onethread.config.common.starter.configuration.CommonAutoConfiguration
              
è‡³æ­¤ï¼Œæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ª Spring Boot Starter ------ `common-spring-boot-starter` å·²ç»å®Œæˆã€‚

æœ‰åŒå­¦å¯èƒ½ä¼šç–‘é—®ï¼š**å®ƒæœ¬èº«è¿˜ä¸åŒ…å«åŠ¨æ€çº¿ç¨‹æ± åˆ·æ–°çš„èƒ½åŠ›ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦å•ç‹¬å®šä¹‰è¿™ä¸ªStarterå‘¢** ï¼Ÿ

åŸå› åœ¨äºï¼Œæˆ‘ä»¬åç»­å°†æ”¯æŒå¤šç§é…ç½®ä¸­å¿ƒï¼ˆå¦‚ Nacosã€Apollo ç­‰ï¼‰ï¼Œè€Œ**åŠ¨æ€é…ç½®åˆ·æ–°ã€é€šçŸ¥å‘Šè­¦ç­‰é€»è¾‘åœ¨å„é…ç½®ä¸­å¿ƒä¸­æ˜¯é«˜åº¦é€šç”¨çš„** ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸€å…¬å…±æ¨¡å—ï¼Œç›¸å…³é€»è¾‘å°±å¿…é¡»åœ¨æ¯ä¸ªé…ç½®ä¸­å¿ƒçš„å®ç°ä¸­é‡å¤ç¼–å†™ï¼Œæ—¢å¢åŠ äº†ç»´æŠ¤æˆæœ¬ï¼Œä¹Ÿç ´åäº†ä»£ç çš„å¯å¤ç”¨æ€§ã€‚

é€šè¿‡æŠ½è±¡å‡º `common-spring-boot-starter`ï¼Œæˆ‘ä»¬å°†è¿™éƒ¨åˆ†é€šç”¨èƒ½åŠ›ç»Ÿä¸€å°è£…ï¼Œæå¤§æå‡äº†æ•´ä½“çš„æ¨¡å—åŒ–ä¸æ‰©å±•æ€§ã€‚

å…³äºå¯ç”¨åŠ¨æ€çº¿ç¨‹æ± æ ‡è¯†
-----------

æœ€æ—©åœ¨ç ”ç©¶ Zuul Starter æ—¶ï¼Œæˆ‘æ¥è§¦åˆ°äº†"å¯æ’æ‹”"è¿™ä¸ªæ¦‚å¿µã€‚ç®€å•æ¥è¯´ï¼Œå¯æ’æ‹”æŒ‡çš„æ˜¯ï¼š**å³ä½¿å¼•å…¥äº†æŸä¸ªStarterJaråŒ…ï¼Œå…¶åŠŸèƒ½æ˜¯å¦ç”Ÿæ•ˆä»ç”±ç‰¹å®šæ¡ä»¶å†³å®š** ã€‚

æ¢å¥è¯è¯´ï¼Œåªæœ‰å½“æ»¡è¶³æŸäº›å‰ç½®æ¡ä»¶æ—¶ï¼Œç›¸å…³çš„è‡ªåŠ¨é…ç½®ç±»æ‰ä¼šè¢«åŠ è½½ï¼›å¦‚æœæ¡ä»¶ä¸æ»¡è¶³ï¼Œè¯¥æ¨¡å—å°±ä¼šè¢«"æ™¾åœ¨ä¸€è¾¹"ã€‚è¿™ç§æœºåˆ¶çš„æœ¬è´¨å°±æ˜¯**æ¨¡å—æ’ä»¶åŒ–** ï¼Œå¯ä»¥æœ‰æ•ˆ**é™ä½è€¦åˆã€æå‡çµæ´»æ€§** ã€‚

### 1. å®šä¹‰æ³¨è§£ {#1}

æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªå…·æœ‰"ä¸­é—´ä»¶èŒƒå¼"çš„æ³¨è§£ï¼Œé€šå¸¸ä»¥ `Enable` å¼€å¤´ï¼Œä¾‹å¦‚ `@EnableOneThread`ï¼Œä¸€çœ¼å°±èƒ½çœ‹å‡ºå®ƒæ˜¯ç”¨æ¥å¼€å¯æŸä¸ªç‰¹æ€§æˆ–æ¨¡å—çš„å¼€å…³ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * åŠ¨æ€å¯ç”¨ oneThread åŠ¨æ€çº¿ç¨‹æ± å¼€å…³æ³¨è§£
     * <p>
     * ä½œè€…ï¼šé©¬ä¸
     * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
     * å¼€å‘æ—¶é—´ï¼š2025-04-23
     */
    @Target(ElementType.TYPE)
    @Retention(RetentionPolicy.RUNTIME)
    @Documented
    @Import(MarkerConfiguration.class)
    public @interface EnableOneThread {
    }
              
å½“åœ¨é¡¹ç›®ä¸­ä½¿ç”¨è¯¥æ³¨è§£æ—¶ï¼Œå®é™…ä¸Šä¼šè§¦å‘å†…éƒ¨çš„ `@Import` æœºåˆ¶ï¼Œè¿›è€ŒåŠ è½½å¹¶æ‰§è¡Œ `MarkerConfiguration` ä¸­çš„é…ç½®é€»è¾‘ï¼Œä»è€Œå¯ç”¨åŠ¨æ€çº¿ç¨‹æ± ç›¸å…³åŠŸèƒ½ã€‚

è¿™ç±»å¯æ’æ‹”æ³¨è§£é€šå¸¸**åŠ åœ¨åº”ç”¨çš„å¯åŠ¨ç±»ä¸Š** ï¼Œç”¨æ¥æ˜¾å¼å¼€å¯æŸä¸ªæ¨¡å—åŠŸèƒ½ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    @EnableOneThread
    @SpringBootApplication
    public class NacosCloudExampleApplication {
    â€‹
        public static void main(String[] args) {
            SpringApplication.run(NacosCloudExampleApplication.class, args);
        }
    }
              
### 2. å®šä¹‰é…ç½®ç±» {#2}

å¯æ’æ‹”æœºåˆ¶çš„æ ¸å¿ƒåœ¨äº"æŒ‰éœ€åŠ è½½"ï¼Œè€Œå…¶å®ç°æ–¹å¼æ˜¯å¤šç§å¤šæ ·çš„ï¼Œæ¯”å¦‚ï¼šé€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„å¼€å…³ï¼ˆå¦‚æŒ‡å®šå‰ç¼€çš„ Keyï¼‰ã€æˆ–è‡ªå®šä¹‰æ³¨è§£æ§åˆ¶æ¨¡å—å¯ç”¨ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    @Configuration
    public class MarkerConfiguration {
    â€‹
        @Bean
        public Marker dynamicThreadPoolMarkerBean() {
            return new Marker();
        }
    â€‹
        /**
         * æ ‡è®°ç±»
         * å¯ç”¨äºæ¡ä»¶è£…é…ï¼ˆ@ConditionalOnBean ç­‰ï¼‰ä¸­ä½œä¸ºå­˜åœ¨æ€§çš„åˆ¤æ–­ä¾æ®
         * <p>
         * ä½œè€…ï¼šé©¬ä¸
         * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
         * å¼€å‘æ—¶é—´ï¼š2025-04-23
         */
        public class Marker {
    â€‹
        }
    }
              
å…·ä½“æ¥è¯´ï¼Œå½“é¡¹ç›®ä¸­ä½¿ç”¨äº† `@EnableOneThread` æ³¨è§£ï¼Œå°±ä¼šé€šè¿‡ `@Import` æ³¨å†Œä¸€ä¸ªæ ‡è®°ç±» `Marker`ã€‚ **æœ‰è¿™ä¸ªæ ‡è®°Beanï¼ŒStarterä¸­çš„åŠ¨æ€çº¿ç¨‹æ± é€»è¾‘æ‰ä¼šè¢«åŠ è½½ï¼›åä¹‹ï¼Œåˆ™ä¸ä¼šç”Ÿæ•ˆ** ï¼Œå®ç°çœŸæ­£æ„ä¹‰ä¸Šçš„"æŒ‰éœ€å¯ç”¨"ã€‚

### 3. å¯æ’æ‹”é…ç½® {#3}

åœ¨æˆ‘ä»¬çš„è®¾è®¡ä¸­ï¼Œ**è¿™ä¸¤ç§æ–¹å¼éƒ½æ”¯æŒ** ã€‚ä½†æ— è®ºæ˜¯å“ªç§æ–¹å¼ï¼Œæœ¬è´¨ä¸Šéƒ½ç¦»ä¸å¼€ Spring Boot æä¾›çš„æ¡ä»¶è£…é…æ³¨è§£ï¼ˆå¦‚ `@ConditionalOnBean`ã€`@ConditionalOnProperty` ç­‰ï¼‰ä½œä¸ºåˆ¤æ–­ä¾æ®ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    @ConditionalOnBean(MarkerConfiguration.Marker.class)
    @Import(OneThreadBaseConfiguration.class)
    @AutoConfigureAfter(OneThreadBaseConfiguration.class)
    public class CommonAutoConfiguration {
        // ......
    }
              
### 4. åŸºäº Property å®ç°å¯æ’æ‹” {#4-property}

é™¤äº†ä½¿ç”¨å¯æ’æ‹”æ³¨è§£çš„æ–¹å¼å¤–ï¼Œæˆ‘ä»¬è¿˜å®ç°äº†**åŸºäºé…ç½®æ–‡ä»¶å±æ€§çš„å¯æ’æ‹”æœºåˆ¶** ã€‚å¤§å®¶å¯ä»¥æ³¨æ„åˆ°ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ§åˆ¶å¼€å…³ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    onethread:
      enable: true  # é»˜è®¤ä¸º trueï¼Œè®¾ç½®ä¸º false åˆ™ä¸ä¼šåŠ è½½åŠ¨æ€çº¿ç¨‹æ± åŠŸèƒ½
              
ä¸ºäº†å®ç°è¿™ä¸€åŠŸèƒ½ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Spring Boot æä¾›çš„ `@ConditionalOnProperty` æ³¨è§£ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼š**æ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„æŸä¸ªå±æ€§å€¼ï¼ŒåŠ¨æ€åˆ¤æ–­æ˜¯å¦åŠ è½½æŒ‡å®šçš„Beanæˆ–é…ç½®ç±»** ã€‚

è‡ªåŠ¨è£…é…ç±»å¦‚ä¸‹æ‰€ç¤ºï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    @ConditionalOnBean(MarkerConfiguration.Marker.class)
    @Import(OneThreadBaseConfiguration.class)
    @AutoConfigureAfter(OneThreadBaseConfiguration.class)
    @ConditionalOnProperty(prefix = BootstrapConfigProperties.PREFIX, value = "enable", matchIfMissing = true, havingValue = "true")
    public class CommonAutoConfiguration {
        // ......
    }
              
è¿™ç§æ–¹å¼éå¸¸é€‚åˆç”¨äº Starter æ¨¡å—ï¼Œèƒ½å¤Ÿè®©ä½¿ç”¨è€…é€šè¿‡ç®€å•çš„é…ç½®ï¼Œ**æ˜¾å¼åœ°å¯ç”¨æˆ–å…³é—­æŸäº›åŠŸèƒ½æ¨¡å—** ï¼Œä»è€Œå¢å¼ºäº†çµæ´»æ€§å’Œå¯æ§æ€§ã€‚  

|        å‚æ•°        |            ä½œç”¨è¯´æ˜             |
|------------------|-----------------------------|
| `prefix`         | é…ç½®å‰ç¼€ï¼Œæ¯”å¦‚ `spring.datasource` |
| `name` / `value` | å±æ€§åï¼Œä¾‹å¦‚ `enabled`            |
| `havingValue`    | å±æ€§å€¼å¿…é¡»ç­‰äºè¿™ä¸ªå€¼æ—¶æ‰ç”Ÿæ•ˆ              |
| `matchIfMissing` | å½“é…ç½®é¡¹ç¼ºå¤±æ—¶æ˜¯å¦è®¤ä¸ºæ¡ä»¶æˆç«‹ï¼Œé»˜è®¤ false    |

æ–‡æœ«æ€»ç»“
----

è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæ•´äº†è§£äº† Starter çš„æ„å»ºæµç¨‹å’Œå¯æ’æ‹”æœºåˆ¶çš„å®ç°åŸç†ã€‚

åœ¨ä¸‹ä¸€ç« èŠ‚ï¼Œæˆ‘ä»¬å°†ç»§ç»­æ·±å…¥ï¼Œå¸¦å¤§å®¶å®ç°**çº¿ç¨‹æ± çš„åŠ¨æ€åˆ·æ–°èƒ½åŠ›** ï¼Œè®©çº¿ç¨‹æ± åœ¨è¿è¡Œæ—¶ä¹Ÿèƒ½çµæ´»å˜æ›´é…ç½®ã€‚

å®Œç»“ï¼Œæ’’èŠ± ğŸ‰

