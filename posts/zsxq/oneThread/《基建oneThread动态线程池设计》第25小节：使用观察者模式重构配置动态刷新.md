2025å¹´08æœˆ07æ—¥ 22:45  
ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼é‡æ„é…ç½®åŠ¨æ€åˆ·æ–°ï¼Œå…ƒæ•°æ®ä¿¡æ¯ï¼š

*  
ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± oneThreadï¼š<https://t.zsxq.com/5GfrN>  
*  
ä»£ç ä»“åº“ï¼š<https://gitcode.net/nageoffer/onethread> ------ ç”³è¯·é¡¹ç›®æƒé™å‚è€ƒä¸Šè¿°çº¿ç¨‹æ± é¡¹ç›®é“¾æ¥  
*  
ç« èŠ‚éš¾åº¦ï¼šâ˜…â˜…â˜…â˜†â˜† - è¾ƒéš¾  
*  
  è§†é¢‘åœ°å€ï¼šæ–‡æ¡£å…ˆè¡Œè§†é¢‘æ¬¡ä¹‹



*** ** * ** ***

å†…å®¹æ‘˜è¦ï¼šæœ¬æ–‡æ·±å…¥å‰–æäº† oneThread åŠ¨æ€çº¿ç¨‹æ± æ¡†æ¶ä¸­è·¨æ¨¡å—é€šä¿¡çš„è®¾è®¡æŒ‘æˆ˜ï¼Œé€šè¿‡å¯¹é…ç½®ä¸­å¿ƒ Starter ä¸ Web Starter è§£è€¦éœ€æ±‚çš„åˆ†æï¼Œå¼•å‡ºè§‚å¯Ÿè€…æ¨¡å¼åœ¨æ¡†æ¶æ¶æ„ä¸­çš„æ ¸å¿ƒä»·å€¼ã€‚æ–‡ç« ä»å®é™…ä¸šåŠ¡åœºæ™¯å‡ºå‘ï¼Œè¯¦ç»†è§£æäº†è§‚å¯Ÿè€…æ¨¡å¼çš„è®¾è®¡ç†å¿µã€å®ç°æœºåˆ¶ä»¥åŠåœ¨åŠ¨æ€çº¿ç¨‹æ± é…ç½®åˆ·æ–°ä¸­çš„å…·ä½“åº”ç”¨ã€‚

è¯¾ç¨‹ç›®å½•å¦‚ä¸‹æ‰€ç¤ºï¼š

*  
å‰è¨€  
*  
è·¨æ¨¡å—é€šä¿¡çš„è®¾è®¡æŒ‘æˆ˜  
*  
ä¸ºä»€ä¹ˆé€‰æ‹©è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ  
*  
ä»€ä¹ˆæ˜¯è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ  
*  
oneThread ä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼å®ç°  
*  
æ‰©å±•æ€§åˆ†æ  
*  
Guava vs Spring è§‚å¯Ÿè€…æ¨¡å¼  
*  
  æ–‡æœ«æ€»ç»“

å‰è¨€
---

åœ¨æ„å»º oneThread åŠ¨æ€çº¿ç¨‹æ± æ¡†æ¶çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é¢ä¸´ç€ä¸€ä¸ªç»å…¸çš„æ¶æ„è®¾è®¡é—®é¢˜ï¼šå¦‚ä½•åœ¨ä¿æŒæ¨¡å—ç‹¬ç«‹æ€§çš„å‰æä¸‹ï¼Œå®ç°è·¨æ¨¡å—çš„é«˜æ•ˆé€šä¿¡ï¼Ÿ

ç‰¹åˆ«æ˜¯åœ¨é…ç½®ä¸­å¿ƒ Starter éœ€è¦é€šçŸ¥ Web Starter è¿›è¡Œçº¿ç¨‹æ± å‚æ•°æ›´æ–°æ—¶ï¼Œä¼ ç»Ÿçš„ç›´æ¥ä¾èµ–æ–¹å¼ä¼šå¸¦æ¥æ¨¡å—è€¦åˆã€åŒ…ä½“ç§¯è†¨èƒ€ç­‰é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸€æŒ‘æˆ˜ï¼Œæˆ‘ä»¬å¼•å…¥äº†**è§‚å¯Ÿè€…æ¨¡å¼**ï¼Œæ„å»ºäº†ä¸€å¥—æ¾è€¦åˆã€é«˜æ‰©å±•çš„äº‹ä»¶é©±åŠ¨æ¶æ„ã€‚

æœ¬æ–‡å°†å¸¦ä½ æ·±å…¥äº†è§£è¿™ä¸€è®¾è®¡å†³ç­–çš„æ¥é¾™å»è„‰ï¼Œä»¥åŠè§‚å¯Ÿè€…æ¨¡å¼åœ¨ oneThread æ¡†æ¶ä¸­çš„ç²¾å¦™åº”ç”¨ã€‚

è·¨æ¨¡å—é€šä¿¡çš„è®¾è®¡æŒ‘æˆ˜
----------

### 1. æ¨¡å—æ¶æ„æ¦‚è§ˆ {#1}

oneThread æ¡†æ¶é‡‡ç”¨åˆ†å±‚æ¨¡å—åŒ–è®¾è®¡ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹æ ¸å¿ƒæ¨¡å—ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    .
    â””â”€â”€ starter # åŠ¨æ€çº¿ç¨‹æ± é…ç½®ä¸­å¿ƒç»„ä»¶åŒ…ï¼Œå®ç°çº¿ç¨‹æ± ç»“åˆSpringæ¡†æ¶å’Œé…ç½®ä¸­å¿ƒåŠ¨æ€åˆ·æ–°
        â”œâ”€â”€ adapter # åŠ¨æ€çº¿ç¨‹æ± é€‚é…å±‚ï¼Œæ¯”å¦‚å¯¹æ¥ Web å®¹å™¨ Tomcat çº¿ç¨‹æ± ç­‰
        â”‚   â””â”€â”€ web-spring-boot-starter # Web å®¹å™¨çº¿ç¨‹æ± ç»„ä»¶åº“
        â”œâ”€â”€ apollo-spring-boot-starter # Apollo é…ç½®ä¸­å¿ƒåŠ¨æ€ç›‘æ§çº¿ç¨‹æ± ç»„ä»¶åº“
        â”œâ”€â”€ common-spring-boot-starter # é…ç½®ä¸­å¿ƒå…¬å…±ç›‘å¬ç­‰é€»è¾‘æŠ½è±¡ç»„ä»¶åº“
        â”œâ”€â”€ dashboard-dev-spring-boot-starter # æ§åˆ¶å° API ç»„ä»¶åº“
        â””â”€â”€ nacos-cloud-spring-boot-starter # Nacos é…ç½®ä¸­å¿ƒåŠ¨æ€ç›‘æ§çº¿ç¨‹æ± ç»„ä»¶åº“
              
å’Œæœ¬æ–‡ç« ç›¸å…³çš„åœ¨ starter æ¨¡å—ä¸‹ï¼Œå­æ¨¡å—èŒè´£å¦‚ä¸‹ï¼š

*  
**common-spring-boot-starter**ï¼šæä¾›é…ç½®è§£æã€äº‹ä»¶å®šä¹‰ç­‰å…¬å…±èƒ½åŠ›ã€‚  
*  
**nacos/apollo-spring-boot-starter**ï¼šç›‘å¬é…ç½®ä¸­å¿ƒå˜æ›´ï¼Œè§¦å‘åˆ·æ–°é€»è¾‘ã€‚  
*  
  **web-spring-boot-starter**ï¼šç®¡ç† Web å®¹å™¨çº¿ç¨‹æ± ï¼Œå“åº”é…ç½®å˜æ›´ã€‚

å¦‚æœé‡‡ç”¨ç›´æ¥ä¾èµ–çš„æ–¹å¼è§£å†³è·¨æ¨¡å—é€šä¿¡ï¼Œä¼šé¢ä¸´ä»¥ä¸‹é—®é¢˜ï¼š

*  
é…ç½®ä¸­å¿ƒç›¸å…³çš„ Starter ä¾èµ– web-starterï¼Œå¦‚æœç”¨æˆ·ä»…éœ€è¦åŠ¨æ€çº¿ç¨‹æ± ä¾èµ–ï¼Œæ— æ³•æŒ‰éœ€ä¾èµ–ã€‚  
*  
  æ‰©å±•æ€§å·®ï¼Œæ¯å¢åŠ ä¸€ç§çº¿ç¨‹æ± é€‚é…å™¨ï¼ˆå¦‚ Dubboã€Hystrix ç­‰ï¼‰ï¼Œéƒ½éœ€è¦ä¿®æ”¹é…ç½®ä¸­å¿ƒ Starter ä»£ç ï¼Œå¢åŠ æ–°çš„ä¾èµ–å…³ç³»ç­‰ã€‚

ä»£ç è€¦åˆå¦‚ä¸‹æ‰€ç¤ºï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    // é…ç½®ä¸­å¿ƒ Starter éœ€è¦äº†è§£æ‰€æœ‰å¯èƒ½çš„çº¿ç¨‹æ± ç±»å‹
    public class AbstractDynamicThreadPoolRefresher {
        
        @Autowired(required = false)
        private WebThreadPoolService webService;
        
        @Autowired(required = false) 
        private RocketMQThreadPoolService rocketMQService;
        
        @Autowired(required = false)
        private RabbitMQThreadPoolService rabbitMQService;
        
        public void refreshConfig(String config) {
            if (webService != null) {
                webService.update(config);
            }
            if (rocketMQService != null) {
                rocketMQService.update(config);
            }
            // ... æ›´å¤šifåˆ¤æ–­
        }
    }
              
### 2. ç†æƒ³çš„è§£å†³æ–¹æ¡ˆ {#2}

æˆ‘ä»¬éœ€è¦ä¸€ç§æœºåˆ¶ï¼Œèƒ½å¤Ÿå®Œæˆä»¥ä¸‹éœ€æ±‚ï¼š

*  
**è§£è€¦æ¨¡å—ä¾èµ–**ï¼šé…ç½®ä¸­å¿ƒ Starter æ— éœ€ç›´æ¥ä¾èµ–å…·ä½“çš„çº¿ç¨‹æ± ç®¡ç†æ¨¡å—ã€‚  
*  
**æ”¯æŒåŠ¨æ€æ‰©å±•**ï¼šæ–°å¢çº¿ç¨‹æ± é€‚é…å™¨æ—¶ï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç ã€‚  
*  
**ä¿æŒé«˜å†…èš**ï¼šæ¯ä¸ªæ¨¡å—ä¸“æ³¨è‡ªå·±çš„æ ¸å¿ƒèŒè´£ã€‚  
*  
  **ç®€åŒ–æµ‹è¯•**ï¼šæ¨¡å—é—´æ¾è€¦åˆï¼Œä¾¿äºå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ã€‚

ä¸ºä»€ä¹ˆé€‰æ‹©è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ
-----------

### 1. ä¸šåŠ¡åœºæ™¯åˆ†æ {#1}

åœ¨ oneThread æ¡†æ¶ä¸­ï¼Œé…ç½®å˜æ›´çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    é…ç½®ä¸­å¿ƒå˜æ›´ â†’ é…ç½®è§£æ â†’ å‚æ•°å¯¹æ¯” â†’ çº¿ç¨‹æ± æ›´æ–° â†’ å˜æ›´é€šçŸ¥
              
è¿™ä¸ªæµç¨‹ä¸­å­˜åœ¨å…¸å‹çš„"ä¸€å¯¹å¤š"é€šçŸ¥åœºæ™¯ï¼š

*  
**ä¸€ä¸ªäº‹ä»¶æº**ï¼šé…ç½®ä¸­å¿ƒçš„é…ç½®å˜æ›´ã€‚  
*  
  **å¤šä¸ªè§‚å¯Ÿè€…**ï¼šåŠ¨æ€çº¿ç¨‹æ± ç®¡ç†å™¨ã€Web çº¿ç¨‹æ± ç®¡ç†å™¨ã€RocketMQ çº¿ç¨‹æ± ç®¡ç†å™¨ã€è‡ªå®šä¹‰çº¿ç¨‹æ± ç®¡ç†å™¨ç­‰ã€‚ç”šè‡³åŠ ç‚¹æƒ³è±¡åŠ›ï¼Œæ˜¯ä¸æ˜¯è¿æ¥æ± åŠ¨æ€å˜æ›´ä¹Ÿèƒ½åšã€‚

### 2. è§‚å¯Ÿè€…æ¨¡å¼çš„ä¼˜åŠ¿ {#2}

#### 2.1 æ¾è€¦åˆè®¾è®¡ {#2-1}

![iShot_2025-08-01_11.34.12.png](https://article-images.zsxq.com/FmoI2Ryd_GA2O_ltrZiR2MrBTkYE)

#### 2.2 åŠ¨æ€æ‰©å±•èƒ½åŠ› {#2-2}

æ–°å¢çº¿ç¨‹æ± é€‚é…å™¨æ—¶ï¼Œåªéœ€ï¼š

* 1.  
å¼€å‘ç›‘å¬è€…ï¼Œå®ç° `ApplicationListener<ThreadPoolConfigUpdateEvent>` æ¥å£ã€‚  
* 2.  
  å°†ç›‘å¬è€…æ³¨å†Œä¸º Spring Beanï¼Œæ— éœ€ä¿®æ”¹ä»»ä½•ç°æœ‰ä»£ç ã€‚

è¿™ç§æ–¹æ¡ˆè®¾è®¡ä¸‹ï¼ŒèŒè´£åˆ†ç¦»è¶³å¤Ÿæ¸…æ™°ï¼š

*  
**é…ç½®ä¸­å¿ƒæ¨¡å—**ï¼šä¸“æ³¨é…ç½®ç›‘å¬å’Œè§£æã€‚  
*  
**çº¿ç¨‹æ± ç®¡ç†æ¨¡å—**ï¼šä¸åŒç»„ä»¶ä¸“æ³¨è‡ªå·±èŒè´£å†…çš„çº¿ç¨‹æ± å‚æ•°æ›´æ–°ã€‚  
*  
  **äº‹ä»¶æœºåˆ¶**ï¼šè´Ÿè´£æ¶ˆæ¯ä¼ é€’å’Œè·¯ç”±ã€‚

ä»€ä¹ˆæ˜¯è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ
---------

### 1. è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰ {#1}

**è§‚å¯Ÿè€…æ¨¡å¼**ï¼ˆObserver Patternï¼‰æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œå®ƒå®šä¹‰äº†å¯¹è±¡é—´çš„ä¸€å¯¹å¤šä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½ä¼šå¾—åˆ°é€šçŸ¥å¹¶è‡ªåŠ¨æ›´æ–°ã€‚

### 2. æ ¸å¿ƒè§’è‰² {#2}

*  
**Subjectï¼ˆä¸»é¢˜/è¢«è§‚å¯Ÿè€…ï¼‰**ï¼šç»´æŠ¤è§‚å¯Ÿè€…åˆ—è¡¨ï¼Œæä¾›æ³¨å†Œã€ç§»é™¤è§‚å¯Ÿè€…çš„æ–¹æ³•ã€‚  
*  
**Observerï¼ˆè§‚å¯Ÿè€…ï¼‰**ï¼šå®šä¹‰æ›´æ–°æ¥å£ï¼Œå½“æ”¶åˆ°ä¸»é¢˜é€šçŸ¥æ—¶æ‰§è¡Œç›¸åº”æ“ä½œã€‚  
*  
**ConcreteSubjectï¼ˆå…·ä½“ä¸»é¢˜ï¼‰**ï¼šå®ç°ä¸»é¢˜æ¥å£ï¼ŒçŠ¶æ€æ”¹å˜æ—¶é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…ã€‚  
*  
  **ConcreteObserverï¼ˆå…·ä½“è§‚å¯Ÿè€…ï¼‰**ï¼šå®ç°è§‚å¯Ÿè€…æ¥å£ï¼Œå®šä¹‰å…·ä½“çš„æ›´æ–°é€»è¾‘ã€‚

### 3. ç»å…¸å®ç°ç¤ºä¾‹ {#3}

ä»¥æ–°é—»è®¢é˜…ä¸ºä¾‹ï¼Œå±•ç¤ºè§‚å¯Ÿè€…æ¨¡å¼çš„åŸºæœ¬å®ç°ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    // è§‚å¯Ÿè€…æ¥å£
    public interface NewsObserver {
        void update(String news);
    }
    â€‹
    // ä¸»é¢˜æ¥å£  
    public interface NewsSubject {
        void addObserver(NewsObserver observer);
        void removeObserver(NewsObserver observer);
        void notifyObservers(String news);
    }
    â€‹
    // å…·ä½“ä¸»é¢˜ï¼šæ–°é—»å‘å¸ƒè€…
    public class NewsPublisher implements NewsSubject {
        private List<NewsObserver> observers = new ArrayList<>();
        
        @Override
        public void addObserver(NewsObserver observer) {
            observers.add(observer);
        }
        
        @Override
        public void removeObserver(NewsObserver observer) {
            observers.remove(observer);
        }
        
        @Override
        public void notifyObservers(String news) {
            for (NewsObserver observer : observers) {
                observer.update(news);
            }
        }
        
        public void publishNews(String news) {
            System.out.println("å‘å¸ƒæ–°é—»: " + news);
            notifyObservers(news);
        }
    }
    â€‹
    // å…·ä½“è§‚å¯Ÿè€…ï¼šé‚®ä»¶è®¢é˜…è€…
    public class EmailSubscriber implements NewsObserver {
        private String email;
        
        public EmailSubscriber(String email) {
            this.email = email;
        }
        
        @Override
        public void update(String news) {
            System.out.println("é‚®ä»¶é€šçŸ¥ " + email + ": " + news);
        }
    }
    â€‹
    // å…·ä½“è§‚å¯Ÿè€…ï¼šçŸ­ä¿¡è®¢é˜…è€…
    public class SMSSubscriber implements NewsObserver {
        private String phone;
        
        public SMSSubscriber(String phone) {
            this.phone = phone;
        }
        
        @Override
        public void update(String news) {
            System.out.println("çŸ­ä¿¡é€šçŸ¥ " + phone + ": " + news);
        }
    }
              
è§‚å¯Ÿè€…æ¨¡å¼æ—¶åºå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š

![image-20250807144451601.png](https://article-images.zsxq.com/Frgyaj-mQ-dr7XiYJPFPp8yoHYCh)

oneThread ä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼å®ç° {#one-thread}
---------------------------------

### 1. Spring äº‹ä»¶æœºåˆ¶ {#1-spring}

oneThread æ¡†æ¶åŸºäº Spring çš„äº‹ä»¶å‘å¸ƒæœºåˆ¶å®ç°è§‚å¯Ÿè€…æ¨¡å¼ï¼Œè¿™ç§æ–¹å¼å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

*  
**æ¡†æ¶é›†æˆ**ï¼šä¸ Spring å®¹å™¨æ·±åº¦é›†æˆï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†è§‚å¯Ÿè€…åˆ—è¡¨ã€‚  
*  
**å¼‚æ­¥æ”¯æŒ**ï¼šæ”¯æŒåŒæ­¥å’Œå¼‚æ­¥äº‹ä»¶å¤„ç†ã€‚  
*  
  **ç±»å‹å®‰å…¨**ï¼šåŸºäºæ³›å‹çš„å¼ºç±»å‹äº‹ä»¶å®šä¹‰ã€‚

![image-20250807140723647.png](https://article-images.zsxq.com/FpCwABaNwasah2CRBNqeKxm_yb1N)

### 2. äº‹ä»¶å®šä¹‰ {#2}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * çº¿ç¨‹æ± é…ç½®æ›´æ–°äº‹ä»¶
     * å½“é…ç½®ä¸­å¿ƒæ£€æµ‹åˆ°çº¿ç¨‹æ± å‚æ•°å˜æ›´æ—¶ï¼Œå‘å¸ƒæ­¤äº‹ä»¶é€šçŸ¥æ‰€æœ‰ç›¸å…³ç»„ä»¶
     */
    public class ThreadPoolConfigUpdateEvent extends ApplicationEvent {
    â€‹
        @Getter
        @Setter
        private BootstrapConfigProperties bootstrapConfigProperties;
    â€‹
        public ThreadPoolConfigUpdateEvent(Object source, BootstrapConfigProperties bootstrapConfigProperties) {
            super(source);
            this.bootstrapConfigProperties = bootstrapConfigProperties;
        }
    }
              
äº‹ä»¶ç±»è®¾è®¡è¦ç‚¹ï¼š

*  
ç»§æ‰¿ `ApplicationEvent`ï¼Œç¬¦åˆ Spring äº‹ä»¶è§„èŒƒã€‚  
*  
  æºå¸¦é…ç½®ä¿¡æ¯ `BootstrapConfigProperties`ï¼Œä¸ºè§‚å¯Ÿè€…æä¾›å¿…è¦æ•°æ®ã€‚

### 3. äº‹ä»¶å‘å¸ƒè€…ï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰ {#3}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    @Slf4j
    @RequiredArgsConstructor
    public abstract class AbstractDynamicThreadPoolRefresher implements ApplicationRunner {
    â€‹
        protected final BootstrapConfigProperties properties;
    â€‹
        /**
         * é…ç½®åˆ·æ–°çš„æ ¸å¿ƒæ–¹æ³•
         * è§£æé…ç½®ä¿¡æ¯å¹¶å‘å¸ƒæ›´æ–°äº‹ä»¶
         */
        @SneakyThrows
        public void refreshThreadPoolProperties(String configInfo) {
            // 1. è§£æé…ç½®ä¿¡æ¯
            Map<Object, Object> configInfoMap = ConfigParserHandler.getInstance()
                .parseConfig(configInfo, properties.getConfigFileType());
            
            // 2. ç»‘å®šåˆ°é…ç½®å¯¹è±¡
            ConfigurationPropertySource sources = new MapConfigurationPropertySource(configInfoMap);
            Binder binder = new Binder(sources);
            BootstrapConfigProperties refresherProperties = binder
                .bind(BootstrapConfigProperties.PREFIX, Bindable.ofInstance(properties))
                .get();
    â€‹
            // 3. å‘å¸ƒçº¿ç¨‹æ± é…ç½®å˜æ›´äº‹ä»¶ï¼ˆè§‚å¯Ÿè€…æ¨¡å¼çš„æ ¸å¿ƒï¼‰
            ApplicationContextHolder.publishEvent(
                new ThreadPoolConfigUpdateEvent(this, refresherProperties)
            );
        }
    }
              
### 4. äº‹ä»¶è§‚å¯Ÿè€…å®ç° {#4}

#### 4.1 é€šç”¨çº¿ç¨‹æ± é…ç½®ç›‘å¬å™¨ {#4-1}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * åŠ¨æ€çº¿ç¨‹æ± åˆ·æ–°ç›‘å¬å™¨
     * å¤„ç†é€šç”¨çº¿ç¨‹æ± ï¼ˆéWebå®¹å™¨ï¼‰çš„é…ç½®æ›´æ–°
     */
    @Slf4j
    @RequiredArgsConstructor
    public class DynamicThreadPoolRefreshListener implements ApplicationListener<ThreadPoolConfigUpdateEvent> {
    â€‹
        private final NotifierDispatcher notifierDispatcher;
    â€‹
        @Override
        public void onApplicationEvent(ThreadPoolConfigUpdateEvent event) {
            BootstrapConfigProperties refresherProperties = event.getBootstrapConfigProperties();
    â€‹
            // æ£€æŸ¥è¿œç¨‹é…ç½®æ–‡ä»¶æ˜¯å¦åŒ…å«çº¿ç¨‹æ± é…ç½®
            if (CollUtil.isEmpty(refresherProperties.getExecutors())) {
                return;
            }
    â€‹
            // åˆ·æ–°åŠ¨æ€çº¿ç¨‹æ± å¯¹è±¡æ ¸å¿ƒå‚æ•°
            for (ThreadPoolExecutorProperties remoteProperties : refresherProperties.getExecutors()) {
                // .....
            });
        }
    }
              
#### 4.2 Webå®¹å™¨çº¿ç¨‹æ± ç›‘å¬å™¨ {#4-2-web}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * Webå®¹å™¨çº¿ç¨‹æ± åˆ·æ–°ç›‘å¬å™¨
     * ä¸“é—¨å¤„ç†Webå®¹å™¨ï¼ˆTomcat/Jetty/Undertowï¼‰çº¿ç¨‹æ± çš„é…ç½®æ›´æ–°
     */
    @RequiredArgsConstructor
    public class WebThreadPoolRefreshListener implements ApplicationListener<ThreadPoolConfigUpdateEvent> {
    â€‹
        private final WebThreadPoolService webThreadPoolService;
        private final NotifierDispatcher notifierDispatcher;
    â€‹
        @Override
        public void onApplicationEvent(ThreadPoolConfigUpdateEvent event) {
            BootstrapConfigProperties.WebThreadPoolExecutorConfig webExecutorConfig = event.getBootstrapConfigProperties().getWeb();
            if (Objects.isNull(webExecutorConfig)) {
                return;
            }
    â€‹
            WebThreadPoolBaseMetrics basicMetrics = webThreadPoolService.getBasicMetrics();
            if (!Objects.equals(basicMetrics.getCorePoolSize(), webExecutorConfig.getCorePoolSize())
                    || !Objects.equals(basicMetrics.getMaximumPoolSize(), webExecutorConfig.getMaximumPoolSize())
                    || !Objects.equals(basicMetrics.getKeepAliveTime(), webExecutorConfig.getKeepAliveTime())) {
                // å˜æ›´ Web çº¿ç¨‹æ± é…ç½®
                webThreadPoolService.updateThreadPool(BeanUtil.toBean(webExecutorConfig, WebThreadPoolConfig.class));
    â€‹
                // å‘é€ Web çº¿ç¨‹æ± é…ç½®å˜æ›´é€šçŸ¥
                sendWebThreadPoolConfigChangeMessage(basicMetrics, webExecutorConfig);
            }
        }
    â€‹
        // ......
    }
              
æ‰©å±•æ€§åˆ†æ
-----

### 1. æ–°å¢çº¿ç¨‹æ± é€‚é…å™¨ {#1}

å‡è®¾æˆ‘ä»¬éœ€è¦æ”¯æŒ RocketMQ çš„çº¿ç¨‹æ± åŠ¨æ€è°ƒæ•´ï¼Œåªéœ€è¦ä»¥ä¸‹æ­¥éª¤ï¼š

#### 1.1 åˆ›å»ºç›‘å¬å™¨ {#1-1}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * RocketMQçº¿ç¨‹æ± åˆ·æ–°ç›‘å¬å™¨
     */
    @Component
    @RequiredArgsConstructor
    public class RocketMQThreadPoolRefreshListener implements ApplicationListener<ThreadPoolConfigUpdateEvent> {
    â€‹
        private final RocketMQThreadPoolService rocketMQService;
    â€‹
        @Override
        public void onApplicationEvent(ThreadPoolConfigUpdateEvent event) {
            BootstrapConfigProperties.RocketMQConfig rocketMQConfig = 
                event.getBootstrapConfigProperties().getRocketMQ();
    â€‹
            if (Objects.isNull(rocketMQConfig)) {
                return;
            }
    â€‹
            // æ›´æ–°RocketMQçº¿ç¨‹æ± é…ç½®
            rocketMQService.updateThreadPool(rocketMQConfig);
        }
    }
              
#### 1.2 é…ç½®ç±»æ‰©å±• {#1-2}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    // åœ¨BootstrapConfigPropertiesä¸­æ·»åŠ RocketMQé…ç½®
    @Data
    @ConfigurationProperties(prefix = BootstrapConfigProperties.PREFIX)
    public class BootstrapConfigProperties {
    â€‹
        // ç°æœ‰é…ç½®...
    â€‹
        /**
         * RocketMQçº¿ç¨‹æ± é…ç½®
         */
        private RocketMQConfig rocketMQ;
    â€‹
        @Data
        public static class RocketMQConfig {
            private Integer consumerCorePoolSize = 20;
            private Integer consumerMaximumPoolSize = 200;
            private Integer producerCorePoolSize = 4;
            private Integer producerMaximumPoolSize = 8;
        }
    }
              
### 2. è‡ªå®šä¹‰äº‹ä»¶å¤„ç† {#2}

å¼€å‘è€…è¿˜å¯ä»¥ç›‘å¬é…ç½®æ›´æ–°äº‹ä»¶ï¼Œå®ç°è‡ªå®šä¹‰é€»è¾‘ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * è‡ªå®šä¹‰é…ç½®å˜æ›´ç›‘å¬å™¨
     * å¯ä»¥å®ç°é…ç½®å˜æ›´æ—¥å¿—è®°å½•ã€æŒ‡æ ‡ä¸ŠæŠ¥ç­‰åŠŸèƒ½
     */
    @Component
    @Slf4j
    public class CustomConfigChangeListener implements ApplicationListener<ThreadPoolConfigUpdateEvent> {
    â€‹
        @Override
        public void onApplicationEvent(ThreadPoolConfigUpdateEvent event) {
            // è®°å½•é…ç½®å˜æ›´æ—¥å¿—
            logConfigChange(event);
    â€‹
            // ä¸ŠæŠ¥ç›‘æ§æŒ‡æ ‡
            reportMetrics(event);
    â€‹
            // å‘é€å‘Šè­¦é€šçŸ¥
            sendAlert(event);
        }
    â€‹
        private void logConfigChange(ThreadPoolConfigUpdateEvent event) {
            log.info("çº¿ç¨‹æ± é…ç½®å‘ç”Ÿå˜æ›´: {}", 
                JSON.toJSONString(event.getBootstrapConfigProperties()));
        }
    }
              
Guava vs Spring è§‚å¯Ÿè€…æ¨¡å¼ {#guava-vs-spring}
----------------------------------------

Guava çš„è§‚å¯Ÿè€…æ¨¡å¼ç½‘ä¸Šèµ„æ–™å¾ˆå¤šäº†ï¼Œè€Œä¸”å’±ä»¬ä¹Ÿæ²¡æœ‰ç”¨åˆ°ï¼Œè¿™é‡Œæˆ‘å°±ä¸èµ˜è¿°äº†ã€‚è¿™é‡Œé‡ç‚¹è¯´æ˜ä¸‹ä¸¤è€…çš„åŒºåˆ«ï¼š  

|   ç»´åº¦    |           **Spring ApplicationEvent**            |     **Guava EventBus**      |
|---------|--------------------------------------------------|-----------------------------|
| æ‰€å±æ¡†æ¶    | Spring æ¡†æ¶                                        | Guava å·¥å…·åº“                   |
| äº‹ä»¶è®¢é˜…æ–¹å¼  | å®ç° `ApplicationListener` æˆ– `@EventListener` æ³¨è§£ç›‘å¬ | ä½¿ç”¨ `@Subscribe` æ³¨è§£çš„æ–¹æ³•ç›‘å¬     |
| æ³¨å†Œç›‘å¬å™¨   | è‡ªåŠ¨æ³¨å†Œï¼ˆé€šè¿‡ Spring å®¹å™¨æ‰«æ Beanï¼‰                        | éœ€æ‰‹åŠ¨æ³¨å†Œåˆ° EventBus             |
| åŒæ­¥/å¼‚æ­¥æ”¯æŒ | é»˜è®¤åŒæ­¥ï¼Œæ”¯æŒ `@Async` å¼‚æ­¥                              | é»˜è®¤åŒæ­¥ï¼Œä¹Ÿæ”¯æŒ `AsyncEventBus` å¼‚æ­¥ |
| è§£è€¦ç¨‹åº¦    | é«˜ï¼ŒåŸºäºäº‹ä»¶åç§°å’Œç±»å‹ï¼Œå¤©ç„¶è§£è€¦                                 | ä¸­ï¼Œéœ€æ˜¾å¼æ³¨å†Œå¯¹è±¡                   |

æ•´ä½“æ¥çœ‹ï¼ŒSpring äº‹ä»¶æœºåˆ¶ä¸ Guava EventBus åœ¨å®ç°è§‚å¯Ÿè€…æ¨¡å¼ä¸Šå¹¶æ— æœ¬è´¨å·®å¼‚ï¼Œéƒ½é€‚ç”¨äºå¸¸è§„çš„ä¸šåŠ¡è§£è€¦åœºæ™¯ã€‚ä¸è¿‡ï¼Œè€ƒè™‘åˆ° Spring æä¾›äº†åŸç”Ÿæ”¯æŒï¼Œä¸”ç”Ÿæ€å®Œå–„ã€é›†æˆä¾¿æ·ï¼Œ**æ›´æ¨èä¼˜å…ˆä½¿ç”¨ Spring çš„äº‹ä»¶ç›‘å¬æœºåˆ¶ï¼Œæ— éœ€é¢å¤–å¼•å…¥ Guava ä¾èµ–**ã€‚

åŒæ—¶ï¼Œå¦‚æœåœ¨ä»£ç ä¸­ç›´æ¥ `ApplicationContext` å‘å¸ƒäº‹ä»¶ç›‘å¬ï¼Œè¿˜èƒ½é€šè¿‡ IDEA è‡ªå¸¦å›¾æ ‡çœ‹åˆ°å¯¹åº”çš„è§‚å¯Ÿè€…é›†åˆï¼ŒGuava EventBus æ˜¯æ²¡æœ‰è¿™ä¸ªå±•ç¤ºçš„ã€‚

![image-20250807165443521.png](https://article-images.zsxq.com/Fu23vEYZ1jiUQkCEt5YNTSNfxWwG)

æ–‡æœ«æ€»ç»“
----

é€šè¿‡å¼•å…¥è§‚å¯Ÿè€…æ¨¡å¼ï¼ŒoneThread åŠ¨æ€çº¿ç¨‹æ± æ¡†æ¶æˆåŠŸè§£å†³äº†è·¨æ¨¡å—é€šä¿¡çš„è®¾è®¡æŒ‘æˆ˜ï¼Œå®ç°äº†é…ç½®ä¸­å¿ƒ Starter ä¸å„ç§çº¿ç¨‹æ± ç®¡ç†æ¨¡å—ä¹‹é—´çš„æ¾è€¦åˆé€šä¿¡ã€‚

é€šè¿‡è§‚å¯Ÿè€…æ¨¡å¼å’Œ Spring äº‹ä»¶ç»“åˆï¼Œæœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

* 1.  
**æ¨¡å—è§£è€¦**ï¼šé…ç½®ä¸­å¿ƒæ¨¡å—æ— éœ€ç›´æ¥ä¾èµ–å…·ä½“çš„çº¿ç¨‹æ± ç®¡ç†æ¨¡å—ï¼Œé¿å…äº†å¾ªç¯ä¾èµ–å’Œæ¨¡å—è€¦åˆé—®é¢˜ã€‚  
* 2.  
**æ‰©å±•æ€§å¼º**ï¼šæ–°å¢çº¿ç¨‹æ± é€‚é…å™¨æ—¶ï¼Œåªéœ€å®ç°ç›‘å¬å™¨æ¥å£å¹¶æ³¨å†Œä¸ºSpring Beanï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç ã€‚  
* 3.  
**èŒè´£æ¸…æ™°**ï¼šæ¯ä¸ªæ¨¡å—ä¸“æ³¨è‡ªå·±çš„æ ¸å¿ƒèŒè´£ï¼Œé…ç½®ç›‘å¬ã€äº‹ä»¶è·¯ç”±ã€å‚æ•°æ›´æ–°å„å¸å…¶èŒã€‚  
* 4.  
  **æ˜“äºæµ‹è¯•**ï¼šæ¾è€¦åˆçš„è®¾è®¡ä½¿å¾—å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•æ›´åŠ ç®€å•ã€‚

å®Œç»“ï¼Œæ’’èŠ± ğŸ‰  
ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼é‡æ„é…ç½®åŠ¨æ€åˆ·æ–°ï¼Œå…ƒæ•°æ®ä¿¡æ¯ï¼š

*  
ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± oneThreadï¼š<https://t.zsxq.com/5GfrN>  
*  
ä»£ç ä»“åº“ï¼š<https://gitcode.net/nageoffer/onethread> ------ ç”³è¯·é¡¹ç›®æƒé™å‚è€ƒä¸Šè¿°çº¿ç¨‹æ± é¡¹ç›®é“¾æ¥  
*  
ç« èŠ‚éš¾åº¦ï¼šâ˜…â˜…â˜…â˜†â˜† - è¾ƒéš¾  
*  
  è§†é¢‘åœ°å€ï¼šæ–‡æ¡£å…ˆè¡Œè§†é¢‘æ¬¡ä¹‹



*** ** * ** ***

å†…å®¹æ‘˜è¦ï¼šæœ¬æ–‡æ·±å…¥å‰–æäº† oneThread åŠ¨æ€çº¿ç¨‹æ± æ¡†æ¶ä¸­è·¨æ¨¡å—é€šä¿¡çš„è®¾è®¡æŒ‘æˆ˜ï¼Œé€šè¿‡å¯¹é…ç½®ä¸­å¿ƒ Starter ä¸ Web Starter è§£è€¦éœ€æ±‚çš„åˆ†æï¼Œå¼•å‡ºè§‚å¯Ÿè€…æ¨¡å¼åœ¨æ¡†æ¶æ¶æ„ä¸­çš„æ ¸å¿ƒä»·å€¼ã€‚æ–‡ç« ä»å®é™…ä¸šåŠ¡åœºæ™¯å‡ºå‘ï¼Œè¯¦ç»†è§£æäº†è§‚å¯Ÿè€…æ¨¡å¼çš„è®¾è®¡ç†å¿µã€å®ç°æœºåˆ¶ä»¥åŠåœ¨åŠ¨æ€çº¿ç¨‹æ± é…ç½®åˆ·æ–°ä¸­çš„å…·ä½“åº”ç”¨ã€‚

è¯¾ç¨‹ç›®å½•å¦‚ä¸‹æ‰€ç¤ºï¼š

*  
å‰è¨€  
*  
è·¨æ¨¡å—é€šä¿¡çš„è®¾è®¡æŒ‘æˆ˜  
*  
ä¸ºä»€ä¹ˆé€‰æ‹©è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ  
*  
ä»€ä¹ˆæ˜¯è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ  
*  
oneThread ä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼å®ç°  
*  
æ‰©å±•æ€§åˆ†æ  
*  
Guava vs Spring è§‚å¯Ÿè€…æ¨¡å¼  
*  
  æ–‡æœ«æ€»ç»“

å‰è¨€
---

åœ¨æ„å»º oneThread åŠ¨æ€çº¿ç¨‹æ± æ¡†æ¶çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é¢ä¸´ç€ä¸€ä¸ªç»å…¸çš„æ¶æ„è®¾è®¡é—®é¢˜ï¼šå¦‚ä½•åœ¨ä¿æŒæ¨¡å—ç‹¬ç«‹æ€§çš„å‰æä¸‹ï¼Œå®ç°è·¨æ¨¡å—çš„é«˜æ•ˆé€šä¿¡ï¼Ÿ

ç‰¹åˆ«æ˜¯åœ¨é…ç½®ä¸­å¿ƒ Starter éœ€è¦é€šçŸ¥ Web Starter è¿›è¡Œçº¿ç¨‹æ± å‚æ•°æ›´æ–°æ—¶ï¼Œä¼ ç»Ÿçš„ç›´æ¥ä¾èµ–æ–¹å¼ä¼šå¸¦æ¥æ¨¡å—è€¦åˆã€åŒ…ä½“ç§¯è†¨èƒ€ç­‰é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸€æŒ‘æˆ˜ï¼Œæˆ‘ä»¬å¼•å…¥äº†**è§‚å¯Ÿè€…æ¨¡å¼**ï¼Œæ„å»ºäº†ä¸€å¥—æ¾è€¦åˆã€é«˜æ‰©å±•çš„äº‹ä»¶é©±åŠ¨æ¶æ„ã€‚

æœ¬æ–‡å°†å¸¦ä½ æ·±å…¥äº†è§£è¿™ä¸€è®¾è®¡å†³ç­–çš„æ¥é¾™å»è„‰ï¼Œä»¥åŠè§‚å¯Ÿè€…æ¨¡å¼åœ¨ oneThread æ¡†æ¶ä¸­çš„ç²¾å¦™åº”ç”¨ã€‚

è·¨æ¨¡å—é€šä¿¡çš„è®¾è®¡æŒ‘æˆ˜
----------

### 1. æ¨¡å—æ¶æ„æ¦‚è§ˆ {#1}

oneThread æ¡†æ¶é‡‡ç”¨åˆ†å±‚æ¨¡å—åŒ–è®¾è®¡ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹æ ¸å¿ƒæ¨¡å—ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    .
    â””â”€â”€ starter # åŠ¨æ€çº¿ç¨‹æ± é…ç½®ä¸­å¿ƒç»„ä»¶åŒ…ï¼Œå®ç°çº¿ç¨‹æ± ç»“åˆSpringæ¡†æ¶å’Œé…ç½®ä¸­å¿ƒåŠ¨æ€åˆ·æ–°
        â”œâ”€â”€ adapter # åŠ¨æ€çº¿ç¨‹æ± é€‚é…å±‚ï¼Œæ¯”å¦‚å¯¹æ¥ Web å®¹å™¨ Tomcat çº¿ç¨‹æ± ç­‰
        â”‚   â””â”€â”€ web-spring-boot-starter # Web å®¹å™¨çº¿ç¨‹æ± ç»„ä»¶åº“
        â”œâ”€â”€ apollo-spring-boot-starter # Apollo é…ç½®ä¸­å¿ƒåŠ¨æ€ç›‘æ§çº¿ç¨‹æ± ç»„ä»¶åº“
        â”œâ”€â”€ common-spring-boot-starter # é…ç½®ä¸­å¿ƒå…¬å…±ç›‘å¬ç­‰é€»è¾‘æŠ½è±¡ç»„ä»¶åº“
        â”œâ”€â”€ dashboard-dev-spring-boot-starter # æ§åˆ¶å° API ç»„ä»¶åº“
        â””â”€â”€ nacos-cloud-spring-boot-starter # Nacos é…ç½®ä¸­å¿ƒåŠ¨æ€ç›‘æ§çº¿ç¨‹æ± ç»„ä»¶åº“
              
å’Œæœ¬æ–‡ç« ç›¸å…³çš„åœ¨ starter æ¨¡å—ä¸‹ï¼Œå­æ¨¡å—èŒè´£å¦‚ä¸‹ï¼š

*  
**common-spring-boot-starter**ï¼šæä¾›é…ç½®è§£æã€äº‹ä»¶å®šä¹‰ç­‰å…¬å…±èƒ½åŠ›ã€‚  
*  
**nacos/apollo-spring-boot-starter**ï¼šç›‘å¬é…ç½®ä¸­å¿ƒå˜æ›´ï¼Œè§¦å‘åˆ·æ–°é€»è¾‘ã€‚  
*  
  **web-spring-boot-starter**ï¼šç®¡ç† Web å®¹å™¨çº¿ç¨‹æ± ï¼Œå“åº”é…ç½®å˜æ›´ã€‚

å¦‚æœé‡‡ç”¨ç›´æ¥ä¾èµ–çš„æ–¹å¼è§£å†³è·¨æ¨¡å—é€šä¿¡ï¼Œä¼šé¢ä¸´ä»¥ä¸‹é—®é¢˜ï¼š

*  
é…ç½®ä¸­å¿ƒç›¸å…³çš„ Starter ä¾èµ– web-starterï¼Œå¦‚æœç”¨æˆ·ä»…éœ€è¦åŠ¨æ€çº¿ç¨‹æ± ä¾èµ–ï¼Œæ— æ³•æŒ‰éœ€ä¾èµ–ã€‚  
*  
  æ‰©å±•æ€§å·®ï¼Œæ¯å¢åŠ ä¸€ç§çº¿ç¨‹æ± é€‚é…å™¨ï¼ˆå¦‚ Dubboã€Hystrix ç­‰ï¼‰ï¼Œéƒ½éœ€è¦ä¿®æ”¹é…ç½®ä¸­å¿ƒ Starter ä»£ç ï¼Œå¢åŠ æ–°çš„ä¾èµ–å…³ç³»ç­‰ã€‚

ä»£ç è€¦åˆå¦‚ä¸‹æ‰€ç¤ºï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    // é…ç½®ä¸­å¿ƒ Starter éœ€è¦äº†è§£æ‰€æœ‰å¯èƒ½çš„çº¿ç¨‹æ± ç±»å‹
    public class AbstractDynamicThreadPoolRefresher {
        
        @Autowired(required = false)
        private WebThreadPoolService webService;
        
        @Autowired(required = false) 
        private RocketMQThreadPoolService rocketMQService;
        
        @Autowired(required = false)
        private RabbitMQThreadPoolService rabbitMQService;
        
        public void refreshConfig(String config) {
            if (webService != null) {
                webService.update(config);
            }
            if (rocketMQService != null) {
                rocketMQService.update(config);
            }
            // ... æ›´å¤šifåˆ¤æ–­
        }
    }
              
### 2. ç†æƒ³çš„è§£å†³æ–¹æ¡ˆ {#2}

æˆ‘ä»¬éœ€è¦ä¸€ç§æœºåˆ¶ï¼Œèƒ½å¤Ÿå®Œæˆä»¥ä¸‹éœ€æ±‚ï¼š

*  
**è§£è€¦æ¨¡å—ä¾èµ–**ï¼šé…ç½®ä¸­å¿ƒ Starter æ— éœ€ç›´æ¥ä¾èµ–å…·ä½“çš„çº¿ç¨‹æ± ç®¡ç†æ¨¡å—ã€‚  
*  
**æ”¯æŒåŠ¨æ€æ‰©å±•**ï¼šæ–°å¢çº¿ç¨‹æ± é€‚é…å™¨æ—¶ï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç ã€‚  
*  
**ä¿æŒé«˜å†…èš**ï¼šæ¯ä¸ªæ¨¡å—ä¸“æ³¨è‡ªå·±çš„æ ¸å¿ƒèŒè´£ã€‚  
*  
  **ç®€åŒ–æµ‹è¯•**ï¼šæ¨¡å—é—´æ¾è€¦åˆï¼Œä¾¿äºå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ã€‚

ä¸ºä»€ä¹ˆé€‰æ‹©è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ
-----------

### 1. ä¸šåŠ¡åœºæ™¯åˆ†æ {#1}

åœ¨ oneThread æ¡†æ¶ä¸­ï¼Œé…ç½®å˜æ›´çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    é…ç½®ä¸­å¿ƒå˜æ›´ â†’ é…ç½®è§£æ â†’ å‚æ•°å¯¹æ¯” â†’ çº¿ç¨‹æ± æ›´æ–° â†’ å˜æ›´é€šçŸ¥
              
è¿™ä¸ªæµç¨‹ä¸­å­˜åœ¨å…¸å‹çš„"ä¸€å¯¹å¤š"é€šçŸ¥åœºæ™¯ï¼š

*  
**ä¸€ä¸ªäº‹ä»¶æº**ï¼šé…ç½®ä¸­å¿ƒçš„é…ç½®å˜æ›´ã€‚  
*  
  **å¤šä¸ªè§‚å¯Ÿè€…**ï¼šåŠ¨æ€çº¿ç¨‹æ± ç®¡ç†å™¨ã€Web çº¿ç¨‹æ± ç®¡ç†å™¨ã€RocketMQ çº¿ç¨‹æ± ç®¡ç†å™¨ã€è‡ªå®šä¹‰çº¿ç¨‹æ± ç®¡ç†å™¨ç­‰ã€‚ç”šè‡³åŠ ç‚¹æƒ³è±¡åŠ›ï¼Œæ˜¯ä¸æ˜¯è¿æ¥æ± åŠ¨æ€å˜æ›´ä¹Ÿèƒ½åšã€‚

### 2. è§‚å¯Ÿè€…æ¨¡å¼çš„ä¼˜åŠ¿ {#2}

#### 2.1 æ¾è€¦åˆè®¾è®¡ {#2-1}

![iShot_2025-08-01_11.34.12.png](https://article-images.zsxq.com/FmoI2Ryd_GA2O_ltrZiR2MrBTkYE)

#### 2.2 åŠ¨æ€æ‰©å±•èƒ½åŠ› {#2-2}

æ–°å¢çº¿ç¨‹æ± é€‚é…å™¨æ—¶ï¼Œåªéœ€ï¼š

* 1.  
å¼€å‘ç›‘å¬è€…ï¼Œå®ç° `ApplicationListener<ThreadPoolConfigUpdateEvent>` æ¥å£ã€‚  
* 2.  
  å°†ç›‘å¬è€…æ³¨å†Œä¸º Spring Beanï¼Œæ— éœ€ä¿®æ”¹ä»»ä½•ç°æœ‰ä»£ç ã€‚

è¿™ç§æ–¹æ¡ˆè®¾è®¡ä¸‹ï¼ŒèŒè´£åˆ†ç¦»è¶³å¤Ÿæ¸…æ™°ï¼š

*  
**é…ç½®ä¸­å¿ƒæ¨¡å—**ï¼šä¸“æ³¨é…ç½®ç›‘å¬å’Œè§£æã€‚  
*  
**çº¿ç¨‹æ± ç®¡ç†æ¨¡å—**ï¼šä¸åŒç»„ä»¶ä¸“æ³¨è‡ªå·±èŒè´£å†…çš„çº¿ç¨‹æ± å‚æ•°æ›´æ–°ã€‚  
*  
  **äº‹ä»¶æœºåˆ¶**ï¼šè´Ÿè´£æ¶ˆæ¯ä¼ é€’å’Œè·¯ç”±ã€‚

ä»€ä¹ˆæ˜¯è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ
---------

### 1. è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰ {#1}

**è§‚å¯Ÿè€…æ¨¡å¼**ï¼ˆObserver Patternï¼‰æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œå®ƒå®šä¹‰äº†å¯¹è±¡é—´çš„ä¸€å¯¹å¤šä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½ä¼šå¾—åˆ°é€šçŸ¥å¹¶è‡ªåŠ¨æ›´æ–°ã€‚

### 2. æ ¸å¿ƒè§’è‰² {#2}

*  
**Subjectï¼ˆä¸»é¢˜/è¢«è§‚å¯Ÿè€…ï¼‰**ï¼šç»´æŠ¤è§‚å¯Ÿè€…åˆ—è¡¨ï¼Œæä¾›æ³¨å†Œã€ç§»é™¤è§‚å¯Ÿè€…çš„æ–¹æ³•ã€‚  
*  
**Observerï¼ˆè§‚å¯Ÿè€…ï¼‰**ï¼šå®šä¹‰æ›´æ–°æ¥å£ï¼Œå½“æ”¶åˆ°ä¸»é¢˜é€šçŸ¥æ—¶æ‰§è¡Œç›¸åº”æ“ä½œã€‚  
*  
**ConcreteSubjectï¼ˆå…·ä½“ä¸»é¢˜ï¼‰**ï¼šå®ç°ä¸»é¢˜æ¥å£ï¼ŒçŠ¶æ€æ”¹å˜æ—¶é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…ã€‚  
*  
  **ConcreteObserverï¼ˆå…·ä½“è§‚å¯Ÿè€…ï¼‰**ï¼šå®ç°è§‚å¯Ÿè€…æ¥å£ï¼Œå®šä¹‰å…·ä½“çš„æ›´æ–°é€»è¾‘ã€‚

### 3. ç»å…¸å®ç°ç¤ºä¾‹ {#3}

ä»¥æ–°é—»è®¢é˜…ä¸ºä¾‹ï¼Œå±•ç¤ºè§‚å¯Ÿè€…æ¨¡å¼çš„åŸºæœ¬å®ç°ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    // è§‚å¯Ÿè€…æ¥å£
    public interface NewsObserver {
        void update(String news);
    }
    â€‹
    // ä¸»é¢˜æ¥å£  
    public interface NewsSubject {
        void addObserver(NewsObserver observer);
        void removeObserver(NewsObserver observer);
        void notifyObservers(String news);
    }
    â€‹
    // å…·ä½“ä¸»é¢˜ï¼šæ–°é—»å‘å¸ƒè€…
    public class NewsPublisher implements NewsSubject {
        private List<NewsObserver> observers = new ArrayList<>();
        
        @Override
        public void addObserver(NewsObserver observer) {
            observers.add(observer);
        }
        
        @Override
        public void removeObserver(NewsObserver observer) {
            observers.remove(observer);
        }
        
        @Override
        public void notifyObservers(String news) {
            for (NewsObserver observer : observers) {
                observer.update(news);
            }
        }
        
        public void publishNews(String news) {
            System.out.println("å‘å¸ƒæ–°é—»: " + news);
            notifyObservers(news);
        }
    }
    â€‹
    // å…·ä½“è§‚å¯Ÿè€…ï¼šé‚®ä»¶è®¢é˜…è€…
    public class EmailSubscriber implements NewsObserver {
        private String email;
        
        public EmailSubscriber(String email) {
            this.email = email;
        }
        
        @Override
        public void update(String news) {
            System.out.println("é‚®ä»¶é€šçŸ¥ " + email + ": " + news);
        }
    }
    â€‹
    // å…·ä½“è§‚å¯Ÿè€…ï¼šçŸ­ä¿¡è®¢é˜…è€…
    public class SMSSubscriber implements NewsObserver {
        private String phone;
        
        public SMSSubscriber(String phone) {
            this.phone = phone;
        }
        
        @Override
        public void update(String news) {
            System.out.println("çŸ­ä¿¡é€šçŸ¥ " + phone + ": " + news);
        }
    }
              
è§‚å¯Ÿè€…æ¨¡å¼æ—¶åºå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š

![image-20250807144451601.png](https://article-images.zsxq.com/Frgyaj-mQ-dr7XiYJPFPp8yoHYCh)

oneThread ä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼å®ç° {#one-thread}
---------------------------------

### 1. Spring äº‹ä»¶æœºåˆ¶ {#1-spring}

oneThread æ¡†æ¶åŸºäº Spring çš„äº‹ä»¶å‘å¸ƒæœºåˆ¶å®ç°è§‚å¯Ÿè€…æ¨¡å¼ï¼Œè¿™ç§æ–¹å¼å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

*  
**æ¡†æ¶é›†æˆ**ï¼šä¸ Spring å®¹å™¨æ·±åº¦é›†æˆï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†è§‚å¯Ÿè€…åˆ—è¡¨ã€‚  
*  
**å¼‚æ­¥æ”¯æŒ**ï¼šæ”¯æŒåŒæ­¥å’Œå¼‚æ­¥äº‹ä»¶å¤„ç†ã€‚  
*  
  **ç±»å‹å®‰å…¨**ï¼šåŸºäºæ³›å‹çš„å¼ºç±»å‹äº‹ä»¶å®šä¹‰ã€‚

![image-20250807140723647.png](https://article-images.zsxq.com/FpCwABaNwasah2CRBNqeKxm_yb1N)

### 2. äº‹ä»¶å®šä¹‰ {#2}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * çº¿ç¨‹æ± é…ç½®æ›´æ–°äº‹ä»¶
     * å½“é…ç½®ä¸­å¿ƒæ£€æµ‹åˆ°çº¿ç¨‹æ± å‚æ•°å˜æ›´æ—¶ï¼Œå‘å¸ƒæ­¤äº‹ä»¶é€šçŸ¥æ‰€æœ‰ç›¸å…³ç»„ä»¶
     */
    public class ThreadPoolConfigUpdateEvent extends ApplicationEvent {
    â€‹
        @Getter
        @Setter
        private BootstrapConfigProperties bootstrapConfigProperties;
    â€‹
        public ThreadPoolConfigUpdateEvent(Object source, BootstrapConfigProperties bootstrapConfigProperties) {
            super(source);
            this.bootstrapConfigProperties = bootstrapConfigProperties;
        }
    }
              
äº‹ä»¶ç±»è®¾è®¡è¦ç‚¹ï¼š

*  
ç»§æ‰¿ `ApplicationEvent`ï¼Œç¬¦åˆ Spring äº‹ä»¶è§„èŒƒã€‚  
*  
  æºå¸¦é…ç½®ä¿¡æ¯ `BootstrapConfigProperties`ï¼Œä¸ºè§‚å¯Ÿè€…æä¾›å¿…è¦æ•°æ®ã€‚

### 3. äº‹ä»¶å‘å¸ƒè€…ï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰ {#3}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    @Slf4j
    @RequiredArgsConstructor
    public abstract class AbstractDynamicThreadPoolRefresher implements ApplicationRunner {
    â€‹
        protected final BootstrapConfigProperties properties;
    â€‹
        /**
         * é…ç½®åˆ·æ–°çš„æ ¸å¿ƒæ–¹æ³•
         * è§£æé…ç½®ä¿¡æ¯å¹¶å‘å¸ƒæ›´æ–°äº‹ä»¶
         */
        @SneakyThrows
        public void refreshThreadPoolProperties(String configInfo) {
            // 1. è§£æé…ç½®ä¿¡æ¯
            Map<Object, Object> configInfoMap = ConfigParserHandler.getInstance()
                .parseConfig(configInfo, properties.getConfigFileType());
            
            // 2. ç»‘å®šåˆ°é…ç½®å¯¹è±¡
            ConfigurationPropertySource sources = new MapConfigurationPropertySource(configInfoMap);
            Binder binder = new Binder(sources);
            BootstrapConfigProperties refresherProperties = binder
                .bind(BootstrapConfigProperties.PREFIX, Bindable.ofInstance(properties))
                .get();
    â€‹
            // 3. å‘å¸ƒçº¿ç¨‹æ± é…ç½®å˜æ›´äº‹ä»¶ï¼ˆè§‚å¯Ÿè€…æ¨¡å¼çš„æ ¸å¿ƒï¼‰
            ApplicationContextHolder.publishEvent(
                new ThreadPoolConfigUpdateEvent(this, refresherProperties)
            );
        }
    }
              
### 4. äº‹ä»¶è§‚å¯Ÿè€…å®ç° {#4}

#### 4.1 é€šç”¨çº¿ç¨‹æ± é…ç½®ç›‘å¬å™¨ {#4-1}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * åŠ¨æ€çº¿ç¨‹æ± åˆ·æ–°ç›‘å¬å™¨
     * å¤„ç†é€šç”¨çº¿ç¨‹æ± ï¼ˆéWebå®¹å™¨ï¼‰çš„é…ç½®æ›´æ–°
     */
    @Slf4j
    @RequiredArgsConstructor
    public class DynamicThreadPoolRefreshListener implements ApplicationListener<ThreadPoolConfigUpdateEvent> {
    â€‹
        private final NotifierDispatcher notifierDispatcher;
    â€‹
        @Override
        public void onApplicationEvent(ThreadPoolConfigUpdateEvent event) {
            BootstrapConfigProperties refresherProperties = event.getBootstrapConfigProperties();
    â€‹
            // æ£€æŸ¥è¿œç¨‹é…ç½®æ–‡ä»¶æ˜¯å¦åŒ…å«çº¿ç¨‹æ± é…ç½®
            if (CollUtil.isEmpty(refresherProperties.getExecutors())) {
                return;
            }
    â€‹
            // åˆ·æ–°åŠ¨æ€çº¿ç¨‹æ± å¯¹è±¡æ ¸å¿ƒå‚æ•°
            for (ThreadPoolExecutorProperties remoteProperties : refresherProperties.getExecutors()) {
                // .....
            });
        }
    }
              
#### 4.2 Webå®¹å™¨çº¿ç¨‹æ± ç›‘å¬å™¨ {#4-2-web}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * Webå®¹å™¨çº¿ç¨‹æ± åˆ·æ–°ç›‘å¬å™¨
     * ä¸“é—¨å¤„ç†Webå®¹å™¨ï¼ˆTomcat/Jetty/Undertowï¼‰çº¿ç¨‹æ± çš„é…ç½®æ›´æ–°
     */
    @RequiredArgsConstructor
    public class WebThreadPoolRefreshListener implements ApplicationListener<ThreadPoolConfigUpdateEvent> {
    â€‹
        private final WebThreadPoolService webThreadPoolService;
        private final NotifierDispatcher notifierDispatcher;
    â€‹
        @Override
        public void onApplicationEvent(ThreadPoolConfigUpdateEvent event) {
            BootstrapConfigProperties.WebThreadPoolExecutorConfig webExecutorConfig = event.getBootstrapConfigProperties().getWeb();
            if (Objects.isNull(webExecutorConfig)) {
                return;
            }
    â€‹
            WebThreadPoolBaseMetrics basicMetrics = webThreadPoolService.getBasicMetrics();
            if (!Objects.equals(basicMetrics.getCorePoolSize(), webExecutorConfig.getCorePoolSize())
                    || !Objects.equals(basicMetrics.getMaximumPoolSize(), webExecutorConfig.getMaximumPoolSize())
                    || !Objects.equals(basicMetrics.getKeepAliveTime(), webExecutorConfig.getKeepAliveTime())) {
                // å˜æ›´ Web çº¿ç¨‹æ± é…ç½®
                webThreadPoolService.updateThreadPool(BeanUtil.toBean(webExecutorConfig, WebThreadPoolConfig.class));
    â€‹
                // å‘é€ Web çº¿ç¨‹æ± é…ç½®å˜æ›´é€šçŸ¥
                sendWebThreadPoolConfigChangeMessage(basicMetrics, webExecutorConfig);
            }
        }
    â€‹
        // ......
    }
              
æ‰©å±•æ€§åˆ†æ
-----

### 1. æ–°å¢çº¿ç¨‹æ± é€‚é…å™¨ {#1}

å‡è®¾æˆ‘ä»¬éœ€è¦æ”¯æŒ RocketMQ çš„çº¿ç¨‹æ± åŠ¨æ€è°ƒæ•´ï¼Œåªéœ€è¦ä»¥ä¸‹æ­¥éª¤ï¼š

#### 1.1 åˆ›å»ºç›‘å¬å™¨ {#1-1}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * RocketMQçº¿ç¨‹æ± åˆ·æ–°ç›‘å¬å™¨
     */
    @Component
    @RequiredArgsConstructor
    public class RocketMQThreadPoolRefreshListener implements ApplicationListener<ThreadPoolConfigUpdateEvent> {
    â€‹
        private final RocketMQThreadPoolService rocketMQService;
    â€‹
        @Override
        public void onApplicationEvent(ThreadPoolConfigUpdateEvent event) {
            BootstrapConfigProperties.RocketMQConfig rocketMQConfig = 
                event.getBootstrapConfigProperties().getRocketMQ();
    â€‹
            if (Objects.isNull(rocketMQConfig)) {
                return;
            }
    â€‹
            // æ›´æ–°RocketMQçº¿ç¨‹æ± é…ç½®
            rocketMQService.updateThreadPool(rocketMQConfig);
        }
    }
              
#### 1.2 é…ç½®ç±»æ‰©å±• {#1-2}

textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    // åœ¨BootstrapConfigPropertiesä¸­æ·»åŠ RocketMQé…ç½®
    @Data
    @ConfigurationProperties(prefix = BootstrapConfigProperties.PREFIX)
    public class BootstrapConfigProperties {
    â€‹
        // ç°æœ‰é…ç½®...
    â€‹
        /**
         * RocketMQçº¿ç¨‹æ± é…ç½®
         */
        private RocketMQConfig rocketMQ;
    â€‹
        @Data
        public static class RocketMQConfig {
            private Integer consumerCorePoolSize = 20;
            private Integer consumerMaximumPoolSize = 200;
            private Integer producerCorePoolSize = 4;
            private Integer producerMaximumPoolSize = 8;
        }
    }
              
### 2. è‡ªå®šä¹‰äº‹ä»¶å¤„ç† {#2}

å¼€å‘è€…è¿˜å¯ä»¥ç›‘å¬é…ç½®æ›´æ–°äº‹ä»¶ï¼Œå®ç°è‡ªå®šä¹‰é€»è¾‘ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * è‡ªå®šä¹‰é…ç½®å˜æ›´ç›‘å¬å™¨
     * å¯ä»¥å®ç°é…ç½®å˜æ›´æ—¥å¿—è®°å½•ã€æŒ‡æ ‡ä¸ŠæŠ¥ç­‰åŠŸèƒ½
     */
    @Component
    @Slf4j
    public class CustomConfigChangeListener implements ApplicationListener<ThreadPoolConfigUpdateEvent> {
    â€‹
        @Override
        public void onApplicationEvent(ThreadPoolConfigUpdateEvent event) {
            // è®°å½•é…ç½®å˜æ›´æ—¥å¿—
            logConfigChange(event);
    â€‹
            // ä¸ŠæŠ¥ç›‘æ§æŒ‡æ ‡
            reportMetrics(event);
    â€‹
            // å‘é€å‘Šè­¦é€šçŸ¥
            sendAlert(event);
        }
    â€‹
        private void logConfigChange(ThreadPoolConfigUpdateEvent event) {
            log.info("çº¿ç¨‹æ± é…ç½®å‘ç”Ÿå˜æ›´: {}", 
                JSON.toJSONString(event.getBootstrapConfigProperties()));
        }
    }
              
Guava vs Spring è§‚å¯Ÿè€…æ¨¡å¼ {#guava-vs-spring}
----------------------------------------

Guava çš„è§‚å¯Ÿè€…æ¨¡å¼ç½‘ä¸Šèµ„æ–™å¾ˆå¤šäº†ï¼Œè€Œä¸”å’±ä»¬ä¹Ÿæ²¡æœ‰ç”¨åˆ°ï¼Œè¿™é‡Œæˆ‘å°±ä¸èµ˜è¿°äº†ã€‚è¿™é‡Œé‡ç‚¹è¯´æ˜ä¸‹ä¸¤è€…çš„åŒºåˆ«ï¼š  

|   ç»´åº¦    |           **Spring ApplicationEvent**            |     **Guava EventBus**      |
|---------|--------------------------------------------------|-----------------------------|
| æ‰€å±æ¡†æ¶    | Spring æ¡†æ¶                                        | Guava å·¥å…·åº“                   |
| äº‹ä»¶è®¢é˜…æ–¹å¼  | å®ç° `ApplicationListener` æˆ– `@EventListener` æ³¨è§£ç›‘å¬ | ä½¿ç”¨ `@Subscribe` æ³¨è§£çš„æ–¹æ³•ç›‘å¬     |
| æ³¨å†Œç›‘å¬å™¨   | è‡ªåŠ¨æ³¨å†Œï¼ˆé€šè¿‡ Spring å®¹å™¨æ‰«æ Beanï¼‰                        | éœ€æ‰‹åŠ¨æ³¨å†Œåˆ° EventBus             |
| åŒæ­¥/å¼‚æ­¥æ”¯æŒ | é»˜è®¤åŒæ­¥ï¼Œæ”¯æŒ `@Async` å¼‚æ­¥                              | é»˜è®¤åŒæ­¥ï¼Œä¹Ÿæ”¯æŒ `AsyncEventBus` å¼‚æ­¥ |
| è§£è€¦ç¨‹åº¦    | é«˜ï¼ŒåŸºäºäº‹ä»¶åç§°å’Œç±»å‹ï¼Œå¤©ç„¶è§£è€¦                                 | ä¸­ï¼Œéœ€æ˜¾å¼æ³¨å†Œå¯¹è±¡                   |

æ•´ä½“æ¥çœ‹ï¼ŒSpring äº‹ä»¶æœºåˆ¶ä¸ Guava EventBus åœ¨å®ç°è§‚å¯Ÿè€…æ¨¡å¼ä¸Šå¹¶æ— æœ¬è´¨å·®å¼‚ï¼Œéƒ½é€‚ç”¨äºå¸¸è§„çš„ä¸šåŠ¡è§£è€¦åœºæ™¯ã€‚ä¸è¿‡ï¼Œè€ƒè™‘åˆ° Spring æä¾›äº†åŸç”Ÿæ”¯æŒï¼Œä¸”ç”Ÿæ€å®Œå–„ã€é›†æˆä¾¿æ·ï¼Œ**æ›´æ¨èä¼˜å…ˆä½¿ç”¨ Spring çš„äº‹ä»¶ç›‘å¬æœºåˆ¶ï¼Œæ— éœ€é¢å¤–å¼•å…¥ Guava ä¾èµ–**ã€‚

åŒæ—¶ï¼Œå¦‚æœåœ¨ä»£ç ä¸­ç›´æ¥ `ApplicationContext` å‘å¸ƒäº‹ä»¶ç›‘å¬ï¼Œè¿˜èƒ½é€šè¿‡ IDEA è‡ªå¸¦å›¾æ ‡çœ‹åˆ°å¯¹åº”çš„è§‚å¯Ÿè€…é›†åˆï¼ŒGuava EventBus æ˜¯æ²¡æœ‰è¿™ä¸ªå±•ç¤ºçš„ã€‚

![image-20250807165443521.png](https://article-images.zsxq.com/Fu23vEYZ1jiUQkCEt5YNTSNfxWwG)

æ–‡æœ«æ€»ç»“
----

é€šè¿‡å¼•å…¥è§‚å¯Ÿè€…æ¨¡å¼ï¼ŒoneThread åŠ¨æ€çº¿ç¨‹æ± æ¡†æ¶æˆåŠŸè§£å†³äº†è·¨æ¨¡å—é€šä¿¡çš„è®¾è®¡æŒ‘æˆ˜ï¼Œå®ç°äº†é…ç½®ä¸­å¿ƒ Starter ä¸å„ç§çº¿ç¨‹æ± ç®¡ç†æ¨¡å—ä¹‹é—´çš„æ¾è€¦åˆé€šä¿¡ã€‚

é€šè¿‡è§‚å¯Ÿè€…æ¨¡å¼å’Œ Spring äº‹ä»¶ç»“åˆï¼Œæœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

* 1.  
**æ¨¡å—è§£è€¦**ï¼šé…ç½®ä¸­å¿ƒæ¨¡å—æ— éœ€ç›´æ¥ä¾èµ–å…·ä½“çš„çº¿ç¨‹æ± ç®¡ç†æ¨¡å—ï¼Œé¿å…äº†å¾ªç¯ä¾èµ–å’Œæ¨¡å—è€¦åˆé—®é¢˜ã€‚  
* 2.  
**æ‰©å±•æ€§å¼º**ï¼šæ–°å¢çº¿ç¨‹æ± é€‚é…å™¨æ—¶ï¼Œåªéœ€å®ç°ç›‘å¬å™¨æ¥å£å¹¶æ³¨å†Œä¸ºSpring Beanï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç ã€‚  
* 3.  
**èŒè´£æ¸…æ™°**ï¼šæ¯ä¸ªæ¨¡å—ä¸“æ³¨è‡ªå·±çš„æ ¸å¿ƒèŒè´£ï¼Œé…ç½®ç›‘å¬ã€äº‹ä»¶è·¯ç”±ã€å‚æ•°æ›´æ–°å„å¸å…¶èŒã€‚  
* 4.  
  **æ˜“äºæµ‹è¯•**ï¼šæ¾è€¦åˆçš„è®¾è®¡ä½¿å¾—å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•æ›´åŠ ç®€å•ã€‚

å®Œç»“ï¼Œæ’’èŠ± ğŸ‰

