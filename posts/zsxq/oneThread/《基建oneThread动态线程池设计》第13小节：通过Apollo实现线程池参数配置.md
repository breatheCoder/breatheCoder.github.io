2025å¹´07æœˆ21æ—¥ 20:00  
é€šè¿‡ Apollo å®ç°çº¿ç¨‹æ± å‚æ•°é…ç½®ï¼Œå…ƒæ•°æ®ä¿¡æ¯ï¼š

*  
ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± oneThreadï¼š<https://t.zsxq.com/5GfrN>  
*  
ä»£ç ä»“åº“ï¼š<https://gitcode.net/nageoffer/onethread> ------ ç”³è¯·é¡¹ç›®æƒé™å‚è€ƒä¸Šè¿°çº¿ç¨‹æ± é¡¹ç›®é“¾æ¥  
*  
ç« èŠ‚éš¾åº¦ï¼šâ˜…â˜…â˜†â˜†â˜† - ä¸­ç­‰  
*  
  è§†é¢‘åœ°å€ï¼šæœ¬ç« èŠ‚å†…å®¹ç®€å•ï¼Œæ— 



*** ** * ** ***

å†…å®¹æ‘˜è¦ï¼šæœ¬ç« èŠ‚è®²è§£äº† Apollo é…ç½®ä¸­å¿ƒçš„åŸºæœ¬åŸç†ã€æ ¸å¿ƒç‰¹æ€§ã€é€‚ç”¨åœºæ™¯ï¼Œå¹¶ç»“åˆå®é™…é¡¹ç›®åˆ†æäº† Apollo ä¸ Nacos åœ¨é…ç½®ç®¡ç†ä¸­çš„ä¼˜åŠ£å¯¹æ¯”ã€‚æœ€åï¼Œé€šè¿‡ä¸€ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åŸºäº `apollo-spring-boot-starter` å¿«é€Ÿå®ç°é…ç½®å˜æ›´ç›‘å¬ä¸åŠ¨æ€åˆ·æ–°çº¿ç¨‹æ± é…ç½®çš„è½åœ°å®ç°ã€‚

è¯¾ç¨‹ç›®å½•å¦‚ä¸‹æ‰€ç¤ºï¼š

*  
å‰è¨€  
*  
ä»€ä¹ˆæ˜¯ Apolloï¼Ÿ  
*  
Apollo vs Nacos  
*  
Apollo å¦‚ä½•å®Œæˆé…ç½®ç›‘å¬ï¼Ÿ  
*  
  æ–‡æœ«æ€»ç»“

å‰è¨€
---

å¦‚æœå¤§å®¶åªå…³æ³¨ `oneThread` åŠ¨æ€çº¿ç¨‹æ± çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œè€Œä½¿ç”¨çš„æ˜¯ **Nacosé…ç½®ä¸­å¿ƒ** ï¼Œåˆ™æœ¬ç« èŠ‚å†…å®¹å¯ä½œä¸ºå‚è€ƒé˜…è¯»ï¼Œä¸å¼ºä¾èµ–ã€‚ä¸¤è€…ä½¿ç”¨æ–¹å¼è™½ç„¶ä¸åŒï¼Œä½†ç›‘å¬é…ç½®å˜æ›´çš„æ ¸å¿ƒæ€æƒ³å®Œå…¨ä¸€è‡´ã€‚
> Breatheï¼Œä½ åœ¨å‰é¢ç« èŠ‚å·²ç»ç”¨ Nacos å®ç°äº†åŠ¨æ€çº¿ç¨‹æ± é…ç½®åˆ·æ–°ï¼Œä¸ºä»€ä¹ˆè¿˜è¦è®² Apolloï¼Ÿ

è¿™æ˜¯ä¸ªå¾ˆå¥½çš„é—®é¢˜ã€‚ç­”æ¡ˆå¾ˆç®€å•ï¼š**æˆ‘ä»¬åšçš„æ˜¯åŸºç¡€ç»„ä»¶å¼€å‘ï¼Œä¸æ˜¯ä»…åº”ç”¨å•ä¸ªé¡¹ç›®çš„** ã€‚

åœ¨çœŸå®çš„ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·çš„åŸºç¡€è®¾æ–½ç¯å¢ƒå¾€å¾€æ˜¯å¤šæ ·åŒ–çš„ ------ æœ‰çš„å…¬å¸ç”¨ Nacosï¼Œæœ‰çš„ç”¨ Apolloï¼Œè¿˜æœ‰çš„å¯èƒ½ä½¿ç”¨ Consulã€Zookeeperã€Etcd ç”šè‡³è‡ªç ”é…ç½®ä¸­å¿ƒã€‚è¿™å°±è¦æ±‚æˆ‘ä»¬æ„å»ºçš„ç»„ä»¶å…·å¤‡**è‰¯å¥½çš„å¯æ’æ‹”èƒ½åŠ›** ï¼Œå¯ä»¥é€‚é…ä¸åŒçš„é…ç½®ä¸­å¿ƒï¼ŒæŒ‰éœ€é€‰æ‹©ã€çµæ´»é›†æˆã€‚

å› æ­¤ï¼ŒApollo çš„æ”¯æŒå¹¶ä¸æ˜¯"é‡å¤é€ è½®å­"ï¼Œè€Œæ˜¯å¯¹åŠ¨æ€çº¿ç¨‹æ± ç»„ä»¶èƒ½åŠ›è¾¹ç•Œçš„å»¶ä¼¸ï¼Œ**è®©ç”¨æˆ·å¯ä»¥æ— æ„Ÿé›†æˆåˆ°ä»»æ„é…ç½®ä½“ç³»ä¸‹çš„é¡¹ç›®ä¸­** ã€‚

ä»€ä¹ˆæ˜¯ Apolloï¼Ÿ {#apollo}
---------------------

### 1. åŸºç¡€ä»‹ç» {#1}

Apolloï¼ˆé˜¿æ³¢ç½—ï¼‰æ˜¯ä¸€æ¬¾å¯é çš„åˆ†å¸ƒå¼é…ç½®ç®¡ç†ä¸­å¿ƒï¼Œè¯ç”Ÿäºæºç¨‹æ¡†æ¶ç ”å‘éƒ¨ï¼Œèƒ½å¤Ÿé›†ä¸­åŒ–ç®¡ç†åº”ç”¨ä¸åŒç¯å¢ƒã€ä¸åŒé›†ç¾¤çš„é…ç½®ï¼Œé…ç½®ä¿®æ”¹åèƒ½å¤Ÿå®æ—¶æ¨é€åˆ°åº”ç”¨ç«¯ï¼Œå¹¶ä¸”å…·å¤‡è§„èŒƒçš„æƒé™ã€æµç¨‹æ²»ç†ç­‰ç‰¹æ€§ï¼Œé€‚ç”¨äºå¾®æœåŠ¡é…ç½®ç®¡ç†åœºæ™¯ã€‚

æœåŠ¡ç«¯åŸºäº SpringBoot å’Œ SpringCloud å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–å®‰è£… Tomcat ç­‰åº”ç”¨å®¹å™¨ã€‚

Javaå®¢æˆ·ç«¯ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Spring/SpringBoot ç¯å¢ƒä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒã€‚

æ­£æ˜¯åŸºäºé…ç½®çš„ç‰¹æ®Šæ€§ï¼Œæ‰€ä»¥ Apollo ä»è®¾è®¡ä¹‹åˆå°±ç«‹å¿—äºæˆä¸ºä¸€ä¸ªæœ‰æ²»ç†èƒ½åŠ›çš„é…ç½®å‘å¸ƒå¹³å°ï¼Œç›®å‰æä¾›äº†ä»¥ä¸‹çš„ç‰¹æ€§ï¼š

*  
  **ç»Ÿä¸€ç®¡ç†ä¸åŒç¯å¢ƒã€ä¸åŒé›†ç¾¤çš„é…ç½®** ï¼š
  *  
  Apollo æä¾›äº†ä¸€ä¸ªç»Ÿä¸€ç•Œé¢é›†ä¸­å¼ç®¡ç†ä¸åŒç¯å¢ƒï¼ˆenvironmentï¼‰ã€ä¸åŒé›†ç¾¤ï¼ˆclusterï¼‰ã€ä¸åŒå‘½åç©ºé—´ï¼ˆnamespaceï¼‰çš„é…ç½®ã€‚  
  *  
  åŒä¸€ä»½ä»£ç éƒ¨ç½²åœ¨ä¸åŒçš„é›†ç¾¤ï¼Œå¯ä»¥æœ‰ä¸åŒçš„é…ç½®ï¼Œæ¯”å¦‚ zookeeper çš„åœ°å€ç­‰ã€‚  
  *  
é€šè¿‡å‘½åç©ºé—´ï¼ˆnamespaceï¼‰å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ”¯æŒå¤šä¸ªä¸åŒåº”ç”¨å…±äº«åŒä¸€ä»½é…ç½®ï¼ŒåŒæ—¶è¿˜å…è®¸åº”ç”¨å¯¹å…±äº«çš„é…ç½®è¿›è¡Œè¦†ç›–ã€‚  
*  
**é…ç½®ä¿®æ”¹å®æ—¶ç”Ÿæ•ˆï¼ˆçƒ­å‘å¸ƒï¼‰** ï¼šç”¨æˆ·åœ¨ Apollo ä¿®æ”¹å®Œé…ç½®å¹¶å‘å¸ƒåï¼Œå®¢æˆ·ç«¯èƒ½å®æ—¶ï¼ˆ1ç§’ï¼‰æ¥æ”¶åˆ°æœ€æ–°çš„é…ç½®ï¼Œå¹¶é€šçŸ¥åˆ°åº”ç”¨ç¨‹åºã€‚  
*  
**ç‰ˆæœ¬å‘å¸ƒç®¡ç†** ï¼šæ‰€æœ‰çš„é…ç½®å‘å¸ƒéƒ½æœ‰ç‰ˆæœ¬æ¦‚å¿µï¼Œä»è€Œå¯ä»¥æ–¹ä¾¿åœ°æ”¯æŒé…ç½®çš„å›æ»šã€‚  
*  
**ç°åº¦å‘å¸ƒ** ï¼šæ”¯æŒé…ç½®çš„ç°åº¦å‘å¸ƒï¼Œæ¯”å¦‚ç‚¹äº†å‘å¸ƒåï¼Œåªå¯¹éƒ¨åˆ†åº”ç”¨å®ä¾‹ç”Ÿæ•ˆï¼Œç­‰è§‚å¯Ÿä¸€æ®µæ—¶é—´æ²¡é—®é¢˜åå†æ¨ç»™æ‰€æœ‰åº”ç”¨å®ä¾‹ã€‚  
*  
  **é…ç½®é¡¹çš„å…¨å±€è§†è§’æœç´¢** ï¼š
  *  
  é€šè¿‡å¯¹é…ç½®é¡¹çš„ key ä¸ value è¿›è¡Œçš„æ¨¡ç³Šæ£€ç´¢ï¼Œæ‰¾åˆ°æ‹¥æœ‰å¯¹åº”å€¼çš„é…ç½®é¡¹åœ¨å“ªä¸ªåº”ç”¨ã€ç¯å¢ƒã€é›†ç¾¤ã€å‘½åç©ºé—´ä¸­è¢«ä½¿ç”¨ã€‚  
  *  
é€šè¿‡é«˜äº®æ˜¾ç¤ºã€åˆ†é¡µä¸è·³è½¬é…ç½®ç­‰æ“ä½œï¼Œä¾¿äºè®©ç®¡ç†å‘˜ä»¥åŠ SRE è§’è‰²å¿«é€Ÿã€ä¾¿æ·åœ°æ‰¾åˆ°ä¸æ›´æ”¹èµ„æºçš„é…ç½®å€¼ã€‚  
*  
  **æƒé™ç®¡ç†ã€å‘å¸ƒå®¡æ ¸ã€æ“ä½œå®¡è®¡**
  *  
  åº”ç”¨å’Œé…ç½®çš„ç®¡ç†éƒ½æœ‰å®Œå–„çš„æƒé™ç®¡ç†æœºåˆ¶ï¼Œå¯¹é…ç½®çš„ç®¡ç†è¿˜åˆ†ä¸ºäº†ç¼–è¾‘å’Œå‘å¸ƒä¸¤ä¸ªç¯èŠ‚ï¼Œä»è€Œå‡å°‘äººä¸ºçš„é”™è¯¯ã€‚  
  *  
æ‰€æœ‰çš„æ“ä½œéƒ½æœ‰å®¡è®¡æ—¥å¿—ï¼Œå¯ä»¥æ–¹ä¾¿åœ°è¿½è¸ªé—®é¢˜ã€‚  
*  
**å®¢æˆ·ç«¯é…ç½®ä¿¡æ¯ç›‘æ§** ï¼šå¯ä»¥åœ¨ç•Œé¢ä¸Šæ–¹ä¾¿åœ°çœ‹åˆ°é…ç½®åœ¨è¢«å“ªäº›å®ä¾‹ä½¿ç”¨ã€‚  
*  
  **æä¾›Javaå’Œ.NetåŸç”Ÿå®¢æˆ·ç«¯** ï¼š
  *  
  æä¾›äº† Java å’Œ .Net çš„åŸç”Ÿå®¢æˆ·ç«¯ï¼Œæ–¹ä¾¿åº”ç”¨é›†æˆã€‚  
  *  
  æ”¯æŒ Spring Placeholder, Annotation å’Œ Spring Boot çš„ ConfigurationPropertiesï¼Œæ–¹ä¾¿åº”ç”¨ä½¿ç”¨ï¼ˆéœ€è¦Spring 3.1.1+ï¼‰ã€‚  
  *  
åŒæ—¶æä¾›äº† Http æ¥å£ï¼Œé Java å’Œ .Net åº”ç”¨ä¹Ÿå¯ä»¥æ–¹ä¾¿åœ°ä½¿ç”¨ã€‚  
*  
  **æä¾›å¼€æ”¾å¹³å°API** ï¼š
  *  
  Apollo è‡ªèº«æä¾›äº†æ¯”è¾ƒå®Œå–„çš„ç»Ÿä¸€é…ç½®ç®¡ç†ç•Œé¢ï¼Œæ”¯æŒå¤šç¯å¢ƒã€å¤šæ•°æ®ä¸­å¿ƒé…ç½®ç®¡ç†ã€æƒé™ã€æµç¨‹æ²»ç†ç­‰ç‰¹æ€§ã€‚ä¸è¿‡ Apollo å‡ºäºé€šç”¨æ€§è€ƒè™‘ï¼Œä¸ä¼šå¯¹é…ç½®çš„ä¿®æ”¹åšè¿‡å¤šé™åˆ¶ï¼Œåªè¦ç¬¦åˆåŸºæœ¬çš„æ ¼å¼å°±èƒ½ä¿å­˜ï¼Œä¸ä¼šé’ˆå¯¹ä¸åŒçš„é…ç½®å€¼è¿›è¡Œé’ˆå¯¹æ€§çš„æ ¡éªŒï¼Œå¦‚æ•°æ®åº“ç”¨æˆ·åã€å¯†ç ï¼ŒRedis æœåŠ¡åœ°å€ç­‰ã€‚  
  *  
å¯¹äºè¿™ç±»åº”ç”¨é…ç½®ï¼ŒApollo æ”¯æŒåº”ç”¨æ–¹é€šè¿‡å¼€æ”¾å¹³å° API åœ¨ Apollo è¿›è¡Œé…ç½®çš„ä¿®æ”¹å’Œå‘å¸ƒï¼Œå¹¶ä¸”å…·å¤‡å®Œå–„çš„æˆæƒå’Œæƒé™æ§åˆ¶ã€‚  
*  
  **éƒ¨ç½²ç®€å•** ï¼š
  *  
  é…ç½®ä¸­å¿ƒä½œä¸ºåŸºç¡€æœåŠ¡ï¼Œå¯ç”¨æ€§è¦æ±‚éå¸¸é«˜ï¼Œè¿™å°±è¦æ±‚ Apollo å¯¹å¤–éƒ¨ä¾èµ–å°½å¯èƒ½åœ°å°‘ã€‚  
  *  
  ç›®å‰å”¯ä¸€çš„å¤–éƒ¨ä¾èµ–æ˜¯ MySQLï¼Œæ‰€ä»¥éƒ¨ç½²éå¸¸ç®€å•ï¼Œåªè¦å®‰è£…å¥½ Java å’Œ MySQL å°±å¯ä»¥è®© Apollo è·‘èµ·æ¥ã€‚  
  *  
    Apollo è¿˜æä¾›äº†æ‰“åŒ…è„šæœ¬ï¼Œä¸€é”®å°±å¯ä»¥ç”Ÿæˆæ‰€æœ‰éœ€è¦çš„å®‰è£…åŒ…ï¼Œå¹¶ä¸”æ”¯æŒè‡ªå®šä¹‰è¿è¡Œæ—¶å‚æ•°ã€‚

### 2. Apollo at a glance {#2-apollo-at-a-glance}

#### 2.1 åŸºç¡€æ¨¡å‹ {#2-1}

å¦‚ä¸‹å³æ˜¯ Apollo çš„åŸºç¡€æ¨¡å‹ï¼š

* 1.  
ç”¨æˆ·åœ¨é…ç½®ä¸­å¿ƒå¯¹é…ç½®è¿›è¡Œä¿®æ”¹å¹¶å‘å¸ƒï¼›  
* 2.  
é…ç½®ä¸­å¿ƒé€šçŸ¥ Apollo å®¢æˆ·ç«¯æœ‰é…ç½®æ›´æ–°ï¼›  
* 3.  
  Apollo å®¢æˆ·ç«¯ä»é…ç½®ä¸­å¿ƒæ‹‰å–æœ€æ–°çš„é…ç½®ã€æ›´æ–°æœ¬åœ°é…ç½®å¹¶é€šçŸ¥åˆ°åº”ç”¨ã€‚

![basic-architecture.png](https://article-images.zsxq.com/FrS7SKti6CZHPzZZlOvMNSaiic9q "basic-architecture.png")

#### 2.2 ç•Œé¢æ¦‚è§ˆ {#2-2}

ä¸‹å›¾æ˜¯ Apollo é…ç½®ä¸­å¿ƒä¸­ä¸€ä¸ªé¡¹ç›®çš„é…ç½®é¦–é¡µï¼š

*  
åœ¨é¡µé¢å·¦ä¸Šæ–¹çš„ç¯å¢ƒåˆ—è¡¨æ¨¡å—å±•ç¤ºäº†æ‰€æœ‰çš„ç¯å¢ƒå’Œé›†ç¾¤ï¼Œç”¨æˆ·å¯ä»¥éšæ—¶åˆ‡æ¢ã€‚  
*  
é¡µé¢ä¸­å¤®å±•ç¤ºäº†ä¸¤ä¸ª namespaceï¼ˆapplication å’Œ FX.apolloï¼‰çš„é…ç½®ä¿¡æ¯ï¼Œé»˜è®¤æŒ‰ç…§è¡¨æ ¼æ¨¡å¼å±•ç¤ºã€ç¼–è¾‘ã€‚ç”¨æˆ·ä¹Ÿå¯ä»¥åˆ‡æ¢åˆ°æ–‡æœ¬æ¨¡å¼ï¼Œä»¥æ–‡ä»¶å½¢å¼æŸ¥çœ‹ã€ç¼–è¾‘ã€‚  
*  
  é¡µé¢ä¸Šå¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œå‘å¸ƒã€å›æ»šã€ç°åº¦ã€æˆæƒã€æŸ¥çœ‹æ›´æ”¹å†å²å’Œå‘å¸ƒå†å²ç­‰æ“ä½œã€‚

![apollo-home-screenshot.jpg](https://article-images.zsxq.com/FqzqAfUb1bp6UYmaZhz7S4Bd58zv "apollo-home-screenshot.jpg")

### 3. æ¶æ„è®¾è®¡ {#3}

#### 3.1 æ€»ä½“è®¾è®¡ {#3-1}

![overall-architecture.png](https://article-images.zsxq.com/FnkSs9Sy6brFvCyqFIJKtK9uVsxJ "overall-architecture.png")

ä¸Šå›¾ç®€è¦æè¿°äº† Apollo çš„æ€»ä½“è®¾è®¡ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸‹å¾€ä¸Šçœ‹ï¼š

*  
Config Service æä¾›é…ç½®çš„è¯»å–ã€æ¨é€ç­‰åŠŸèƒ½ï¼ŒæœåŠ¡å¯¹è±¡æ˜¯ Apollo å®¢æˆ·ç«¯ã€‚  
*  
Admin Service æä¾›é…ç½®çš„ä¿®æ”¹ã€å‘å¸ƒç­‰åŠŸèƒ½ï¼ŒæœåŠ¡å¯¹è±¡æ˜¯ Apollo Portalï¼ˆç®¡ç†ç•Œé¢ï¼‰ã€‚  
*  
Config Service å’Œ Admin Service éƒ½æ˜¯å¤šå®ä¾‹ã€æ— çŠ¶æ€éƒ¨ç½²ï¼Œæ‰€ä»¥éœ€è¦å°†è‡ªå·±æ³¨å†Œåˆ° Eureka ä¸­å¹¶ä¿æŒå¿ƒè·³ã€‚  
*  
åœ¨ Eureka ä¹‹ä¸Šæˆ‘ä»¬æ¶äº†ä¸€å±‚ Meta Server ç”¨äºå°è£… Eureka çš„æœåŠ¡å‘ç°æ¥å£ã€‚  
*  
Client é€šè¿‡åŸŸåè®¿é—® Meta Server è·å– Config Service æœåŠ¡åˆ—è¡¨ï¼ˆIP+Portï¼‰ï¼Œè€Œåç›´æ¥é€šè¿‡ IP+Port è®¿é—®æœåŠ¡ï¼ŒåŒæ—¶åœ¨ Client ä¾§ä¼šåš load balanceã€é”™è¯¯é‡è¯•ã€‚  
*  
Portal é€šè¿‡åŸŸåè®¿é—® Meta Server è·å– Admin Service æœåŠ¡åˆ—è¡¨ï¼ˆIP+Portï¼‰ï¼Œè€Œåç›´æ¥é€šè¿‡ IP+Port è®¿é—®æœåŠ¡ï¼ŒåŒæ—¶åœ¨ Portal ä¾§ä¼šåš load balanceã€é”™è¯¯é‡è¯•ã€‚  
*  
  ä¸ºäº†ç®€åŒ–éƒ¨ç½²ï¼Œæˆ‘ä»¬å®é™…ä¸Šä¼šæŠŠ Config Serviceã€Eureka å’Œ Meta Server ä¸‰ä¸ªé€»è¾‘è§’è‰²éƒ¨ç½²åœ¨åŒä¸€ä¸ª JVM è¿›ç¨‹ä¸­ã€‚

#### 3.2 å®¢æˆ·ç«¯è®¾è®¡ {#3-2}

![client-architecture.png](https://article-images.zsxq.com/FnG-jOncdDf9GAZT2Y38gWC6u41k "client-architecture.png")

ä¸Šå›¾ç®€è¦æè¿°äº† Apollo å®¢æˆ·ç«¯çš„å®ç°åŸç†ï¼š

* 1.  
å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¿æŒäº†ä¸€ä¸ªé•¿è¿æ¥ï¼Œä»è€Œèƒ½ç¬¬ä¸€æ—¶é—´è·å¾—é…ç½®æ›´æ–°çš„æ¨é€ã€‚  
* 2.  
  å®¢æˆ·ç«¯è¿˜ä¼šå®šæ—¶ä» Apollo é…ç½®ä¸­å¿ƒæœåŠ¡ç«¯æ‹‰å–åº”ç”¨çš„æœ€æ–°é…ç½®ã€‚
  *  
  è¿™æ˜¯ä¸€ä¸ª fallback æœºåˆ¶ï¼Œä¸ºäº†é˜²æ­¢æ¨é€æœºåˆ¶å¤±æ•ˆå¯¼è‡´é…ç½®ä¸æ›´æ–°ï¼›  
  *  
  å®¢æˆ·ç«¯å®šæ—¶æ‹‰å–ä¼šä¸ŠæŠ¥æœ¬åœ°ç‰ˆæœ¬ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯¹äºå®šæ—¶æ‹‰å–çš„æ“ä½œï¼ŒæœåŠ¡ç«¯éƒ½ä¼šè¿”å› 304 - Not Modifiedï¼›  
  *  
å®šæ—¶é¢‘ç‡é»˜è®¤ä¸ºæ¯ 5 åˆ†é’Ÿæ‹‰å–ä¸€æ¬¡ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥é€šè¿‡åœ¨è¿è¡Œæ—¶æŒ‡å®š System Property: `apollo.refreshInterval` æ¥è¦†ç›–ï¼Œå•ä½ä¸ºåˆ†é’Ÿã€‚  
* 3.  
å®¢æˆ·ç«¯ä» Apollo é…ç½®ä¸­å¿ƒæœåŠ¡ç«¯è·å–åˆ°åº”ç”¨çš„æœ€æ–°é…ç½®åï¼Œä¼šä¿å­˜åœ¨å†…å­˜ä¸­ã€‚  
* 4.  
å®¢æˆ·ç«¯ä¼šæŠŠä»æœåŠ¡ç«¯è·å–åˆ°çš„é…ç½®åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ä¸€ä»½ã€‚åœ¨é‡åˆ°æœåŠ¡ä¸å¯ç”¨ï¼Œæˆ–ç½‘ç»œä¸é€šçš„æ—¶å€™ï¼Œä¾ç„¶èƒ½ä»æœ¬åœ°æ¢å¤é…ç½®ã€‚  
* 5.  
  åº”ç”¨ç¨‹åºä» Apollo å®¢æˆ·ç«¯è·å–æœ€æ–°çš„é…ç½®ã€è®¢é˜…é…ç½®æ›´æ–°é€šçŸ¥ã€‚

çœ‹äº†ä¸Šé¢çš„æè¿°ï¼Œç›¸ä¿¡å¤§å®¶å¯¹ Apollo æœ‰äº†ç®€å•è®¤è¯†ï¼Œå¦‚æœæƒ³å­¦ä¹ æ›´å¤šçŸ¥è¯†ï¼Œå‚è€ƒ [Apollo å®˜æ–¹æ–‡æ¡£](https://www.apolloconfig.com/#/zh/README)ã€‚

Apollo vs Nacos {#apollo-vs-nacos}
----------------------------------

### 1. åŸºç¡€å®šä½ {#1}

|  ç‰¹æ€§  |             Apollo             |        Nacos        |
|------|--------------------------------|---------------------|
| æ ¸å¿ƒå®šä½ | é…ç½®ä¸­å¿ƒï¼ˆConfiguration Managementï¼‰ | é…ç½®ä¸­å¿ƒ + æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼ˆåŒæ ¸å¿ƒï¼‰ |
| ä¸»å¯¼æ–¹  | æºç¨‹                             | é˜¿é‡Œå·´å·´                |
| å¼€æºæ—¶é—´ | 2017                           | 2018                |

### 2. åŠŸèƒ½å¯¹æ¯” {#2}

|     åŠŸèƒ½ç‰¹æ€§      |        Apollo         |        Nacos        |
|---------------|-----------------------|---------------------|
| é…ç½®ç®¡ç†          | âœ… æ”¯æŒå¤šç¯å¢ƒã€å¤šé›†ç¾¤ã€ç°åº¦ã€æ³¨é‡Šç­‰åŠŸèƒ½  | âœ… æ”¯æŒï¼Œé…ç½®è½»é‡ï¼Œæ”¯æŒåŠ¨æ€åˆ·æ–°    |
| æœåŠ¡æ³¨å†Œä¸å‘ç°       | âŒ ä¸æ”¯æŒ                 | âœ… æ”¯æŒ DNS+RPC æ³¨å†Œå‘ç°   |
| æƒé™ä¸å®¡è®¡         | âœ… æ”¯æŒç»†ç²’åº¦æƒé™æ§åˆ¶ã€æ“ä½œæ—¥å¿—      | âš ï¸ æ”¯æŒè¾ƒå¼±ï¼Œç¤¾åŒºç‰ˆæƒé™è¾ƒç®€å•    |
| å¤šç§Ÿæˆ·/Namespace | âœ… æ”¯æŒï¼Œè¾ƒä¸ºå®Œå–„             | âœ… æ”¯æŒï¼Œä½†éš”ç¦»ç²’åº¦å’Œéš”ç¦»æœºåˆ¶ç•¥å¼±   |
| ç°åº¦å‘å¸ƒ          | âœ… æ”¯æŒç°åº¦é…ç½®ã€ç°åº¦è§„åˆ™ç­‰        | âŒ é»˜è®¤ä¸æ”¯æŒï¼Œéœ€è¦é¢å¤–æ¥å…¥      |
| æ§åˆ¶å°ä½“éªŒ         | âœ… å®Œå–„ï¼ŒåŠŸèƒ½ç»†åŒ–ã€å¯ç¼–è¾‘å†å²é…ç½®ã€æƒé™ç­‰ | âš ï¸ ç®€æ´ä½†åè½»é‡ï¼Œé€‚åˆåŸºç¡€ä½¿ç”¨    |
| å†å²ç‰ˆæœ¬ \& å›æ»š    | âœ… æ”¯æŒæŸ¥çœ‹ã€å›æ»šå†å²ç‰ˆæœ¬         | âœ… æ”¯æŒï¼Œä½†åŠŸèƒ½è¾ƒç®€å•         |
| æŒä¹…åŒ–å­˜å‚¨         | âœ… é»˜è®¤åŸºäº MySQL          | âœ… é»˜è®¤åŸºäº MySQLï¼Œä¹Ÿæ”¯æŒåµŒå…¥å¼ |

### 3. ä½¿ç”¨åœºæ™¯ {#3}

Apollo é€‚åˆçš„åœºæ™¯ï¼š

*  
ä¼ä¸šçº§é…ç½®ä¸­å¿ƒéœ€æ±‚ï¼Œè¦æ±‚æƒé™ã€å®¡è®¡ã€ç‰ˆæœ¬å›æ»šå®Œå–„ã€‚  
*  
é…ç½®ç»´åº¦å¤šã€ä¸šåŠ¡çº¿å¤šã€ç¯å¢ƒåˆ’åˆ†å¤æ‚ã€‚  
*  
  å¯¹ç°åº¦å‘å¸ƒã€é…ç½®å®¡è®¡ç­‰æœ‰å¼ºéœ€æ±‚ã€‚

Nacos é€‚åˆçš„åœºæ™¯ï¼š

*  
éœ€è¦é…ç½®ç®¡ç† + æœåŠ¡æ³¨å†Œä¸€ä½“åŒ–è§£å†³æ–¹æ¡ˆã€‚  
*  
å¾®æœåŠ¡æ²»ç†åœºæ™¯ä¸­ï¼Œå¸Œæœ›è½»é‡ã€å¿«é€Ÿæ¥å…¥ï¼ˆå¦‚ Dubbo/Spring Cloudï¼‰ã€‚  
*  
  æ³¨å†Œä¸­å¿ƒä¸é…ç½®ä¸­å¿ƒç»Ÿä¸€éƒ¨ç½²åœºæ™¯ã€‚

æ€»ç»“å¯¹æ¯”ï¼š  

|  å¯¹æ¯”ç»´åº¦  |    Apollo    |          Nacos          |
|--------|--------------|-------------------------|
| é…ç½®ç®¡ç†èƒ½åŠ› | â­â­â­â­â­ï¼ˆåŠŸèƒ½ä¸°å¯Œï¼‰  | â­â­â­ï¼ˆè½»é‡å®ç”¨ï¼‰               |
| æœåŠ¡æ³¨å†Œå‘ç° | âŒ            | â­â­â­â­ï¼ˆåŠŸèƒ½é½å…¨ï¼‰              |
| æ§åˆ¶å°ä½“éªŒ  | â­â­â­â­ï¼ˆä¼ä¸šçº§ UIï¼‰ | â­â­ï¼ˆåŸºç¡€å¯ç”¨ï¼‰                |
| è¿ç»´å¤æ‚åº¦  | â­â­ï¼ˆéœ€éƒ¨ç½²å¤šä¸ªç»„ä»¶ï¼‰  | â­â­â­â­ï¼ˆè½»é‡çº§éƒ¨ç½²ï¼‰             |
| ç°åº¦ä¸æƒé™  | â­â­â­â­ï¼ˆæ”¯æŒç»†ç²’åº¦ï¼‰  | â­â­ï¼ˆç®€å•æ”¯æŒï¼‰                |
| ä½¿ç”¨é—¨æ§›   | â­â­ï¼ˆéœ€é…å¥— SDKï¼‰  | â­â­â­â­ï¼ˆSpring Cloud å¿«é€Ÿæ•´åˆï¼‰ |
| ç¤¾åŒºä¸ç”Ÿæ€  | â­â­â­â­         | â­â­â­â­                    |

### 4. Breatheä¸»è§‚æ¯”è¾ƒ {#4}

è¿™ä¸€ç« èŠ‚ï¼ŒBreatheä¸æ‰“ç®—ä»å®˜æ–¹æ–‡æ¡£æˆ–åŠŸèƒ½æ¸…å•å»è¯„æ¯” Apollo å’Œ Nacosï¼Œè€Œæ˜¯ç»“åˆè‡ªå·±åœ¨é¡¹ç›®ä¸­æ¥è§¦å’Œè½åœ°çš„å®é™…ä½“éªŒï¼Œåšä¸€æ³¢**çº¯ä¸»è§‚ã€åå®æˆ˜çš„æ¨ªå‘å¯¹æ¯”** ã€‚å¦‚æœä½ æœ‰ä¸åŒè§‚ç‚¹ï¼Œæ¬¢è¿è¯„è®ºåŒºä¸€èµ·äº¤æµã€‚

æˆ‘ä¸»è¦ä»ä»¥ä¸‹å‡ ä¸ªç»´åº¦åšä¸ªç®€è¦åˆ†æï¼š

*  
**æ¶æ„å±‚é¢** ï¼šä¸¤è€…çš„åº•å±‚æ¶æ„å…¶å®éƒ½å·²ç»éå¸¸æˆç†Ÿï¼Œç»å†äº†å¤§è§„æ¨¡ç”Ÿäº§éªŒè¯ã€‚æ— è®ºé€‰å“ªä¸€ä¸ªï¼Œç¨³å®šæ€§å’Œå¯ç”¨æ€§éƒ½æ— éœ€æ‹…å¿ƒï¼Œå› æ­¤æ¶æ„æœ¬èº«ä¸æ„æˆé€‰å‹é—¨æ§›ã€‚  
*  
**åŠŸèƒ½å®Œå¤‡æ€§** ï¼šå°±"é…ç½®ä¸­å¿ƒ"æœ¬èº«è€Œè¨€ï¼ŒApollo çš„åŠŸèƒ½æ›´åä¼ä¸šçº§ï¼Œ**åœ¨ç°åº¦å‘å¸ƒã€æƒé™æ§åˆ¶ã€ç‰ˆæœ¬å›æ»šç­‰æ–¹é¢ä¼˜åŠ¿æ˜æ˜¾** ï¼Œè¿™æ–¹é¢ Nacos æ˜¯æ— æ³•æ¯”çš„ï¼Œå±äºè¢« Apollo ç¢¾å‹çš„å­˜åœ¨ã€‚  
*  
**é›†æˆä¾¿åˆ©æ€§** ï¼šä½† Nacos èƒœåœ¨"å…¨èƒ½å‹é€‰æ‰‹"------**æœåŠ¡æ³¨å†Œ+é…ç½®ä¸­å¿ƒä¸€ä½“åŒ–** ï¼Œå¯¹ä¸­å°é¡¹ç›®å°¤å…¶å‹å¥½ï¼Œå‡å°‘äº†ä¸­é—´ä»¶éƒ¨ç½²ã€ç»´æŠ¤å’Œå­¦ä¹ æˆæœ¬ï¼Œæˆ‘ä¸ªäººåœ¨ä¸šåŠ¡åœºæ™¯ä¸­æ›´åå¥½ Nacosã€‚  
*  
**ä»£ç è§‚æ„Ÿ** ï¼šApollo çš„æ—©æœŸæºç é£æ ¼æœ‰è¾ƒæ˜æ˜¾çš„ `.NET` å½±å­ï¼Œæ¯”å¦‚ `m_` å‘½åå‰ç¼€ç­‰ï¼Œå¯¹äº Java å¼€å‘è€…ä¸å¤ªå‹å¥½ï¼›ç›¸æ¯”ä¹‹ä¸‹ï¼ŒNacos çš„ä»£ç ç»“æ„æ›´è´´åˆç°ä»£ Java å¼€å‘ä¹ æƒ¯ï¼Œä¸Šæ‰‹æ›´è‡ªç„¶ã€‚  
*  
  **ç¤¾åŒºæ´»è·ƒåº¦** ï¼šç›®å‰æ¥çœ‹ï¼ŒApollo çš„å‘å¸ƒé¢‘ç‡æœ‰æ‰€ä¸‹é™ï¼ˆ23å¹´ä¸¤ä¸ªç‰ˆæœ¬ï¼Œ24å¹´ä¸€ä¸ªï¼Œ25å¹´ä¸ŠåŠå¹´ä¸€ä¸ªï¼‰ï¼Œä½†æˆ‘æ›´å€¾å‘äºç†è§£ä¸º"åŠŸèƒ½è¶‹äºç¨³å®š"ï¼›è€Œ Nacos å› å…¼å…·æ³¨å†Œä¸­å¿ƒèŒèƒ½ï¼Œç¤¾åŒºä»è¾ƒæ´»è·ƒï¼ŒPMC ä¸»å¯¼ä¸‹ Bug ä¿®å¤å’Œå‘ç‰ˆä¹Ÿæ›´æŒç»­ã€‚

å¯¹å¤§å¤šæ•°å›¢é˜Ÿè€Œè¨€ï¼Œ**Nacoså·²è¶³å¤Ÿæ»¡è¶³æ—¥å¸¸é…ç½®éœ€æ±‚** ï¼›ä½†å¦‚æœä½ å¯¹æƒé™ã€å®¡è®¡ã€ç°åº¦å‘å¸ƒç­‰æœ‰æ›´é«˜è¦æ±‚ï¼Œ**Apolloæ˜¯æ›´åˆé€‚çš„é€‰æ‹©** ã€‚ä¸¤è€…å¹¶éæ›¿ä»£å…³ç³»ï¼Œè€Œæ˜¯å¯æŒ‰éœ€é€‰å‹çš„ä¸åŒä¾§é‡ã€‚

Apollo å¦‚ä½•å®Œæˆé…ç½®ç›‘å¬ï¼Ÿ {#apollo}
--------------------------

å¦‚æœå¤§å®¶çœ‹è¿‡ Nacos çš„é…ç½®ç›‘å¬å’Œå‚æ•°å˜æ›´ï¼Œå…¶å® Apollo æµç¨‹æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯ç›‘å¬é€»è¾‘æ˜¯ä¸åŒçš„ã€‚
> æœ¬ç« èŠ‚çš„é‡ç‚¹å†…å®¹é›†ä¸­åœ¨æ¨¡å—ï¼š `apollo-spring-boot-starter`ã€‚

å¦‚æœå¤§å®¶æƒ³è¦åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ Apollo é…ç½®ç®¡ç†ï¼Œéœ€è¦åœ¨ pom.xml æ–‡ä»¶ä¸­æ·»åŠ å¯¹åº”çš„ä¾èµ–ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    <dependency>
        <groupId>com.ctrip.framework.apollo</groupId>
        <artifactId>apollo-client-config-data</artifactId>
    </dependency>
              
ä» Apollo æä¾›çš„é…ç½®ä¸­å¿ƒæŠ½è±¡æ¥å£ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶æ ¸å¿ƒæ–¹æ³•ä¹‹ä¸€æ˜¯ `addChangeListener`ï¼Œç”¨äºæ³¨å†Œé…ç½®å˜æ›´ç›‘å¬å™¨ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    public interface Config {
        // ......
        /**
         * Add change listener to this config instance, will be notified when any key is changed in this namespace.
         *
         * @param listener the config change listener
         */
        void addChangeListener(ConfigChangeListener listener);
        // ......
    }
              
ä¸‹æ–¹ Yaml é…ç½®ä¸º Apollo éœ€è¦è®¾ç½®å‚æ•°å†…å®¹ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    app:
      id: onethread-apollo-example${unique-name:} # Apollo é…ç½®ä¸­å¿ƒçš„ åº”ç”¨å”¯ä¸€æ ‡è¯†ï¼ˆAppIdï¼‰
    env: dev # æŒ‡å®š Apollo çš„ç¯å¢ƒï¼ˆEnvironmentï¼‰ï¼Œå¦‚ devã€fatã€uatã€pro ç­‰
    â€‹
    apollo:
      meta: http://127.0.0.1:8080 # æŒ‡å®š Apollo çš„ Meta Server åœ°å€ã€‚å®¢æˆ·ç«¯é€šè¿‡ Meta Server è·å–å¯¹åº”çš„é…ç½®æœåŠ¡ï¼ˆConfig Serviceï¼‰åœ°å€
      autoUpdateInjectedSpringProperties: true # æ˜¯å¦æ”¯æŒ Spring æ³¨å…¥å±æ€§çš„è‡ªåŠ¨åˆ·æ–°
      bootstrap:
        enabled: true # å¯ç”¨ Apollo çš„ Bootstrap åŠ è½½æœºåˆ¶ï¼Œé»˜è®¤ SpringBoot çš„é…ç½®åŠ è½½æ—¶æœºæ™šäº Apollo
        namespaces: application # æŒ‡å®šä»å“ªäº› Namespace åŠ è½½é…ç½®ï¼ˆå¤šä¸ªä»¥é€—å·åˆ†éš”ï¼‰
        eagerLoad:
          enabled: true # å¼ºåˆ¶åœ¨ Spring å®¹å™¨åŠ è½½å‰ï¼Œç«‹å³åŠ è½½ Apollo é…ç½®
      configService: http://127.0.0.1:8080 # æ‰‹åŠ¨æŒ‡å®š Config Service åœ°å€ï¼ˆå¯é€‰ï¼‰
              
ä¸‹é¢æˆ‘ä»¬å…ˆé€šè¿‡ä¸€å¼ æ—¶åºå›¾ï¼Œä»å®è§‚è§’åº¦å¿«é€Ÿäº†è§£ Apollo é…ç½®ç›‘å¬æ³¨å†Œçš„å¤§è‡´æµç¨‹ï¼Œå¸®åŠ©å¤§å®¶å»ºç«‹æ•´ä½“è®¤çŸ¥ï¼š

![image-20250721110846775.png](https://article-images.zsxq.com/FlVvfusM1n8nNUAMeL9oqNFh2PwC "image-20250721110846775.png")

å¥½ï¼Œå’±ä»¬ç»§ç»­å¾€ä¸‹çœ‹ ------ **æ¥çœ‹ä¸‹æ³¨å†Œé…ç½®ç›‘å¬çš„æ–¹æ³•æ˜¯æ€ä¹ˆå®ç°çš„ï¼š**  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    @Slf4j
    @RequiredArgsConstructor
    public class ApolloRefresherHandlerV1 implements ApplicationRunner {
    â€‹
        private final BootstrapConfigProperties properties;
    â€‹
        @Override
        public void run(ApplicationArguments args) throws Exception {
            BootstrapConfigProperties.ApolloConfig apolloConfig = properties.getApollo();
            String[] apolloNamespaces = apolloConfig.getNamespace().split(",");
    â€‹
            String namespace = apolloNamespaces[0];
            String configFileType = properties.getConfigFileType().getValue();
            Config config = ConfigService.getConfig(String.format("%s.%s", namespace, properties.getConfigFileType().getValue()));
    â€‹
            ConfigChangeListener configChangeListener = createConfigChangeListener(namespace, configFileType);
            config.addChangeListener(configChangeListener);
    â€‹
            log.info("Dynamic thread pool refresher, add apollo listener success. namespace: {}", namespace);
        }
    â€‹
        private ConfigChangeListener createConfigChangeListener(String namespace, String configFileType) {
            return configChangeEvent -> {
                // å¦‚æœ Apollo é…ç½®æ–‡ä»¶å˜æ›´ï¼Œä¼šè§¦å‘è¯¥æ–¹æ³•è¿›è¡Œå›è°ƒ
                String namespaceItem = namespace.replace("." + configFileType, "");
                ConfigFileFormat configFileFormat = ConfigFileFormat.fromString(configFileType);
                ConfigFile configFile = ConfigService.getConfigFile(namespaceItem, configFileFormat);
                String content = configFile.getContent(); // å˜æ›´åçš„æœ€æ–°å†…å®¹
                refreshThreadPoolProperties(content); // åˆ·æ–°åŠ¨æ€çº¿ç¨‹æ± é…ç½®
            };
        }
    }
              
æ–¹æ³•çš„å…·ä½“é€»è¾‘å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š

* 1.  
**è·å–Apolloé…ç½®** ï¼šé¦–å…ˆï¼Œé€šè¿‡ `properties.getApollo()` è·å–é…ç½®ä¸­å¿ƒçš„å…³é”®å‚æ•°ï¼Œè¯»å–é¡¹ç›®ä¸­çš„ Apollo å‘½åç©ºé—´é…ç½®ï¼Œæ”¯æŒå¤šä¸ªï¼Œä»¥é€—å·åˆ†éš”ã€‚  
* 2.  
**æ³¨å†Œé…ç½®å˜æ›´ç›‘å¬å™¨** ï¼šæ¥ç€è°ƒç”¨ `config.addChangeListener(...)` æ–¹æ³•ï¼Œå‘æŒ‡å®šçš„ `nameserver` æ³¨å†Œç›‘å¬å™¨ã€‚ä¸€æ—¦ Apollo ç«¯å¯¹åº”çš„é…ç½®å‘ç”Ÿå˜æ›´ï¼Œç›‘å¬å™¨å°±ä¼šè¢«è‡ªåŠ¨è§¦å‘ã€‚  
* 3.  
**é…ç½®å˜æ›´å›è°ƒ** ï¼šå½“é…ç½®å‘ç”Ÿå˜æ›´æ—¶ï¼Œ`configChangeListener` æ–¹æ³•ä¼šè¢«å›è°ƒã€‚æˆ‘ä»¬é€šå¸¸ä¼šåœ¨è¿™é‡Œè°ƒç”¨ `refreshThreadPoolProperties(...)`ï¼Œå°†æœ€æ–°çš„é…ç½®ä¿¡æ¯è§£æå‡ºæ¥å¹¶åŠ¨æ€åˆ·æ–°çº¿ç¨‹æ± å‚æ•°ã€‚  
* 4.  
  **æ—¥å¿—è¾“å‡º** ï¼šä¸ºäº†æ–¹ä¾¿åç»­è¿ç»´æ’æŸ¥ï¼Œæ³¨å†ŒæˆåŠŸåä¼šæ‰“å°ä¸€æ¡ `info` çº§åˆ«çš„æ—¥å¿—ï¼Œæ˜ç¡®è¡¨ç¤ºç›‘å¬å™¨å·²ç»ç”Ÿæ•ˆã€‚

Apollo é»˜è®¤ä½¿ç”¨ `properties` æ ¼å¼ä½œä¸ºé…ç½®è½½ä½“ï¼Œä»è¿”å›ç»“æœä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥æ¸…æ™°çœ‹å‡ºã€‚

![image-20250721105752254.png](https://article-images.zsxq.com/Fsv06HfBpYsD2e-BlDf_U5b8gSux "image-20250721105752254.png")

æ•´ä½“ç›‘å¬æœºåˆ¶çš„å®ç°é€»è¾‘ä¸ Nacos ååˆ†ç›¸ä¼¼ï¼Œå› æ­¤æœ¬ç« èŠ‚ä¸å†èµ˜è¿°é‡å¤å†…å®¹ï¼Œé‡ç‚¹èšç„¦ Apollo çš„å·®å¼‚åŒ–å®ç°ã€‚
> éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒApollo çš„å¯åŠ¨æµç¨‹ç›¸å¯¹å¤æ‚ï¼Œæˆ‘å½“æ—¶ä¹Ÿå°è¯•äº†å¤šç§æ–¹å¼æ‰æœ€ç»ˆé€šè¿‡å®˜ç½‘æä¾›çš„ `docker-compose` æˆåŠŸå¯åŠ¨ã€‚å¦‚æœä½ åªæ˜¯æƒ³èšç„¦ `oneThread` çš„æ ¸å¿ƒèƒ½åŠ›ï¼Œå¯¹ Apollo æœ¬èº«å¹¶ä¸æ„Ÿå…´è¶£ï¼Œå¯ä»¥è·³è¿‡éƒ¨ç½²éƒ¨åˆ†ï¼Œç›´æ¥è¿›å…¥åç»­å†…å®¹ã€‚

æ–‡æœ«æ€»ç»“
----

Apollo å¹¶é oneThread çš„å¼ºä¾èµ–ï¼Œä½†æ”¯æŒå®ƒï¼Œæ˜¯ä¸ºäº†è®©ç»„ä»¶å…·å¤‡æ›´å¼ºçš„**é€šç”¨æ€§ä¸é€‚é…æ€§** ï¼ŒçœŸæ­£åšåˆ°åœ¨ä¸åŒé…ç½®ä¸­å¿ƒä¹‹é—´**æ— ç¼æ¥å…¥ã€æŒ‰éœ€é›†æˆ** ã€‚

æ­¤å¤–ï¼ŒBreatheä¹Ÿç‰¹æ„è€ƒå¤äº†ä¸€ä¸‹ Apollo ä½œè€…å®‹é¡ºï¼ˆèŠ±åï¼šé½å¤©ï¼‰çš„æ—©æœŸåšå®¢ï¼Œå†…å®¹è´¨é‡å¾ˆé«˜ï¼Œå¯¹äºç†è§£ Apollo çš„è®¾è®¡åˆè¡·å’Œè½åœ°æ€è·¯éå¸¸æœ‰å¸®åŠ©ï¼Œæ¨èå¤§å®¶ä½œä¸ºå»¶ä¼¸é˜…è¯»æ·±å…¥æ€è€ƒã€‚
> å®‹é¡ºï¼ˆèŠ±åï¼šé½å¤©ï¼‰ï¼Œèš‚èšé›†å›¢èµ„æ·±æŠ€æœ¯ä¸“å®¶ï¼ŒApollo Config PMCã€‚
>
> åœ¨å¾®æœåŠ¡æ¶æ„ã€åˆ†å¸ƒå¼è®¡ç®—ç­‰é¢†åŸŸæœ‰ç€ä¸°å¯Œçš„ç»éªŒï¼Œ2019 å¹´åŠ å…¥èš‚èšé›†å›¢ï¼Œç›®å‰ä¸“æ³¨äºäº‘åŸç”Ÿå’Œå¾®æœåŠ¡æ–¹å‘ï¼Œå¦‚ Service Meshã€Serverlessã€Application Runtime ç­‰ã€‚
>
> æ¯•ä¸šäºå¤æ—¦å¤§å­¦è½¯ä»¶å·¥ç¨‹ç³»ï¼Œæ›¾å°±èŒäºå¤§ä¼—ç‚¹è¯„ã€æºç¨‹ï¼Œè´Ÿè´£åå°ç³»ç»Ÿã€ä¸­é—´ä»¶ç­‰ç ”å‘å·¥ä½œã€‚
>
> *  
> [Apolloé…ç½®ä¸­å¿ƒä»‹ç»](https://nobodyiam.com/2016/07/09/introduction-to-apollo/)  
> *  
>   [é…ç½®ä¸­å¿ƒï¼Œè®©å¾®æœåŠ¡æ›´ã€æ™ºèƒ½ã€](https://nobodyiam.com/2018/07/29/configuration-center-makes-microservices-smart/)

å®Œç»“ï¼Œæ’’èŠ± ğŸ‰  
é€šè¿‡ Apollo å®ç°çº¿ç¨‹æ± å‚æ•°é…ç½®ï¼Œå…ƒæ•°æ®ä¿¡æ¯ï¼š

*  
ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± oneThreadï¼š<https://t.zsxq.com/5GfrN>  
*  
ä»£ç ä»“åº“ï¼š<https://gitcode.net/nageoffer/onethread> ------ ç”³è¯·é¡¹ç›®æƒé™å‚è€ƒä¸Šè¿°çº¿ç¨‹æ± é¡¹ç›®é“¾æ¥  
*  
ç« èŠ‚éš¾åº¦ï¼šâ˜…â˜…â˜†â˜†â˜† - ä¸­ç­‰  
*  
  è§†é¢‘åœ°å€ï¼šæœ¬ç« èŠ‚å†…å®¹ç®€å•ï¼Œæ— 



*** ** * ** ***

å†…å®¹æ‘˜è¦ï¼šæœ¬ç« èŠ‚è®²è§£äº† Apollo é…ç½®ä¸­å¿ƒçš„åŸºæœ¬åŸç†ã€æ ¸å¿ƒç‰¹æ€§ã€é€‚ç”¨åœºæ™¯ï¼Œå¹¶ç»“åˆå®é™…é¡¹ç›®åˆ†æäº† Apollo ä¸ Nacos åœ¨é…ç½®ç®¡ç†ä¸­çš„ä¼˜åŠ£å¯¹æ¯”ã€‚æœ€åï¼Œé€šè¿‡ä¸€ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åŸºäº `apollo-spring-boot-starter` å¿«é€Ÿå®ç°é…ç½®å˜æ›´ç›‘å¬ä¸åŠ¨æ€åˆ·æ–°çº¿ç¨‹æ± é…ç½®çš„è½åœ°å®ç°ã€‚

è¯¾ç¨‹ç›®å½•å¦‚ä¸‹æ‰€ç¤ºï¼š

*  
å‰è¨€  
*  
ä»€ä¹ˆæ˜¯ Apolloï¼Ÿ  
*  
Apollo vs Nacos  
*  
Apollo å¦‚ä½•å®Œæˆé…ç½®ç›‘å¬ï¼Ÿ  
*  
  æ–‡æœ«æ€»ç»“

å‰è¨€
---

å¦‚æœå¤§å®¶åªå…³æ³¨ `oneThread` åŠ¨æ€çº¿ç¨‹æ± çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œè€Œä½¿ç”¨çš„æ˜¯ **Nacosé…ç½®ä¸­å¿ƒ** ï¼Œåˆ™æœ¬ç« èŠ‚å†…å®¹å¯ä½œä¸ºå‚è€ƒé˜…è¯»ï¼Œä¸å¼ºä¾èµ–ã€‚ä¸¤è€…ä½¿ç”¨æ–¹å¼è™½ç„¶ä¸åŒï¼Œä½†ç›‘å¬é…ç½®å˜æ›´çš„æ ¸å¿ƒæ€æƒ³å®Œå…¨ä¸€è‡´ã€‚
> Breatheï¼Œä½ åœ¨å‰é¢ç« èŠ‚å·²ç»ç”¨ Nacos å®ç°äº†åŠ¨æ€çº¿ç¨‹æ± é…ç½®åˆ·æ–°ï¼Œä¸ºä»€ä¹ˆè¿˜è¦è®² Apolloï¼Ÿ

è¿™æ˜¯ä¸ªå¾ˆå¥½çš„é—®é¢˜ã€‚ç­”æ¡ˆå¾ˆç®€å•ï¼š**æˆ‘ä»¬åšçš„æ˜¯åŸºç¡€ç»„ä»¶å¼€å‘ï¼Œä¸æ˜¯ä»…åº”ç”¨å•ä¸ªé¡¹ç›®çš„** ã€‚

åœ¨çœŸå®çš„ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·çš„åŸºç¡€è®¾æ–½ç¯å¢ƒå¾€å¾€æ˜¯å¤šæ ·åŒ–çš„ ------ æœ‰çš„å…¬å¸ç”¨ Nacosï¼Œæœ‰çš„ç”¨ Apolloï¼Œè¿˜æœ‰çš„å¯èƒ½ä½¿ç”¨ Consulã€Zookeeperã€Etcd ç”šè‡³è‡ªç ”é…ç½®ä¸­å¿ƒã€‚è¿™å°±è¦æ±‚æˆ‘ä»¬æ„å»ºçš„ç»„ä»¶å…·å¤‡**è‰¯å¥½çš„å¯æ’æ‹”èƒ½åŠ›** ï¼Œå¯ä»¥é€‚é…ä¸åŒçš„é…ç½®ä¸­å¿ƒï¼ŒæŒ‰éœ€é€‰æ‹©ã€çµæ´»é›†æˆã€‚

å› æ­¤ï¼ŒApollo çš„æ”¯æŒå¹¶ä¸æ˜¯"é‡å¤é€ è½®å­"ï¼Œè€Œæ˜¯å¯¹åŠ¨æ€çº¿ç¨‹æ± ç»„ä»¶èƒ½åŠ›è¾¹ç•Œçš„å»¶ä¼¸ï¼Œ**è®©ç”¨æˆ·å¯ä»¥æ— æ„Ÿé›†æˆåˆ°ä»»æ„é…ç½®ä½“ç³»ä¸‹çš„é¡¹ç›®ä¸­** ã€‚

ä»€ä¹ˆæ˜¯ Apolloï¼Ÿ {#apollo}
---------------------

### 1. åŸºç¡€ä»‹ç» {#1}

Apolloï¼ˆé˜¿æ³¢ç½—ï¼‰æ˜¯ä¸€æ¬¾å¯é çš„åˆ†å¸ƒå¼é…ç½®ç®¡ç†ä¸­å¿ƒï¼Œè¯ç”Ÿäºæºç¨‹æ¡†æ¶ç ”å‘éƒ¨ï¼Œèƒ½å¤Ÿé›†ä¸­åŒ–ç®¡ç†åº”ç”¨ä¸åŒç¯å¢ƒã€ä¸åŒé›†ç¾¤çš„é…ç½®ï¼Œé…ç½®ä¿®æ”¹åèƒ½å¤Ÿå®æ—¶æ¨é€åˆ°åº”ç”¨ç«¯ï¼Œå¹¶ä¸”å…·å¤‡è§„èŒƒçš„æƒé™ã€æµç¨‹æ²»ç†ç­‰ç‰¹æ€§ï¼Œé€‚ç”¨äºå¾®æœåŠ¡é…ç½®ç®¡ç†åœºæ™¯ã€‚

æœåŠ¡ç«¯åŸºäº SpringBoot å’Œ SpringCloud å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–å®‰è£… Tomcat ç­‰åº”ç”¨å®¹å™¨ã€‚

Javaå®¢æˆ·ç«¯ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Spring/SpringBoot ç¯å¢ƒä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒã€‚

æ­£æ˜¯åŸºäºé…ç½®çš„ç‰¹æ®Šæ€§ï¼Œæ‰€ä»¥ Apollo ä»è®¾è®¡ä¹‹åˆå°±ç«‹å¿—äºæˆä¸ºä¸€ä¸ªæœ‰æ²»ç†èƒ½åŠ›çš„é…ç½®å‘å¸ƒå¹³å°ï¼Œç›®å‰æä¾›äº†ä»¥ä¸‹çš„ç‰¹æ€§ï¼š

*  
  **ç»Ÿä¸€ç®¡ç†ä¸åŒç¯å¢ƒã€ä¸åŒé›†ç¾¤çš„é…ç½®** ï¼š
  *  
  Apollo æä¾›äº†ä¸€ä¸ªç»Ÿä¸€ç•Œé¢é›†ä¸­å¼ç®¡ç†ä¸åŒç¯å¢ƒï¼ˆenvironmentï¼‰ã€ä¸åŒé›†ç¾¤ï¼ˆclusterï¼‰ã€ä¸åŒå‘½åç©ºé—´ï¼ˆnamespaceï¼‰çš„é…ç½®ã€‚  
  *  
  åŒä¸€ä»½ä»£ç éƒ¨ç½²åœ¨ä¸åŒçš„é›†ç¾¤ï¼Œå¯ä»¥æœ‰ä¸åŒçš„é…ç½®ï¼Œæ¯”å¦‚ zookeeper çš„åœ°å€ç­‰ã€‚  
  *  
é€šè¿‡å‘½åç©ºé—´ï¼ˆnamespaceï¼‰å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ”¯æŒå¤šä¸ªä¸åŒåº”ç”¨å…±äº«åŒä¸€ä»½é…ç½®ï¼ŒåŒæ—¶è¿˜å…è®¸åº”ç”¨å¯¹å…±äº«çš„é…ç½®è¿›è¡Œè¦†ç›–ã€‚  
*  
**é…ç½®ä¿®æ”¹å®æ—¶ç”Ÿæ•ˆï¼ˆçƒ­å‘å¸ƒï¼‰** ï¼šç”¨æˆ·åœ¨ Apollo ä¿®æ”¹å®Œé…ç½®å¹¶å‘å¸ƒåï¼Œå®¢æˆ·ç«¯èƒ½å®æ—¶ï¼ˆ1ç§’ï¼‰æ¥æ”¶åˆ°æœ€æ–°çš„é…ç½®ï¼Œå¹¶é€šçŸ¥åˆ°åº”ç”¨ç¨‹åºã€‚  
*  
**ç‰ˆæœ¬å‘å¸ƒç®¡ç†** ï¼šæ‰€æœ‰çš„é…ç½®å‘å¸ƒéƒ½æœ‰ç‰ˆæœ¬æ¦‚å¿µï¼Œä»è€Œå¯ä»¥æ–¹ä¾¿åœ°æ”¯æŒé…ç½®çš„å›æ»šã€‚  
*  
**ç°åº¦å‘å¸ƒ** ï¼šæ”¯æŒé…ç½®çš„ç°åº¦å‘å¸ƒï¼Œæ¯”å¦‚ç‚¹äº†å‘å¸ƒåï¼Œåªå¯¹éƒ¨åˆ†åº”ç”¨å®ä¾‹ç”Ÿæ•ˆï¼Œç­‰è§‚å¯Ÿä¸€æ®µæ—¶é—´æ²¡é—®é¢˜åå†æ¨ç»™æ‰€æœ‰åº”ç”¨å®ä¾‹ã€‚  
*  
  **é…ç½®é¡¹çš„å…¨å±€è§†è§’æœç´¢** ï¼š
  *  
  é€šè¿‡å¯¹é…ç½®é¡¹çš„ key ä¸ value è¿›è¡Œçš„æ¨¡ç³Šæ£€ç´¢ï¼Œæ‰¾åˆ°æ‹¥æœ‰å¯¹åº”å€¼çš„é…ç½®é¡¹åœ¨å“ªä¸ªåº”ç”¨ã€ç¯å¢ƒã€é›†ç¾¤ã€å‘½åç©ºé—´ä¸­è¢«ä½¿ç”¨ã€‚  
  *  
é€šè¿‡é«˜äº®æ˜¾ç¤ºã€åˆ†é¡µä¸è·³è½¬é…ç½®ç­‰æ“ä½œï¼Œä¾¿äºè®©ç®¡ç†å‘˜ä»¥åŠ SRE è§’è‰²å¿«é€Ÿã€ä¾¿æ·åœ°æ‰¾åˆ°ä¸æ›´æ”¹èµ„æºçš„é…ç½®å€¼ã€‚  
*  
  **æƒé™ç®¡ç†ã€å‘å¸ƒå®¡æ ¸ã€æ“ä½œå®¡è®¡**
  *  
  åº”ç”¨å’Œé…ç½®çš„ç®¡ç†éƒ½æœ‰å®Œå–„çš„æƒé™ç®¡ç†æœºåˆ¶ï¼Œå¯¹é…ç½®çš„ç®¡ç†è¿˜åˆ†ä¸ºäº†ç¼–è¾‘å’Œå‘å¸ƒä¸¤ä¸ªç¯èŠ‚ï¼Œä»è€Œå‡å°‘äººä¸ºçš„é”™è¯¯ã€‚  
  *  
æ‰€æœ‰çš„æ“ä½œéƒ½æœ‰å®¡è®¡æ—¥å¿—ï¼Œå¯ä»¥æ–¹ä¾¿åœ°è¿½è¸ªé—®é¢˜ã€‚  
*  
**å®¢æˆ·ç«¯é…ç½®ä¿¡æ¯ç›‘æ§** ï¼šå¯ä»¥åœ¨ç•Œé¢ä¸Šæ–¹ä¾¿åœ°çœ‹åˆ°é…ç½®åœ¨è¢«å“ªäº›å®ä¾‹ä½¿ç”¨ã€‚  
*  
  **æä¾›Javaå’Œ.NetåŸç”Ÿå®¢æˆ·ç«¯** ï¼š
  *  
  æä¾›äº† Java å’Œ .Net çš„åŸç”Ÿå®¢æˆ·ç«¯ï¼Œæ–¹ä¾¿åº”ç”¨é›†æˆã€‚  
  *  
  æ”¯æŒ Spring Placeholder, Annotation å’Œ Spring Boot çš„ ConfigurationPropertiesï¼Œæ–¹ä¾¿åº”ç”¨ä½¿ç”¨ï¼ˆéœ€è¦Spring 3.1.1+ï¼‰ã€‚  
  *  
åŒæ—¶æä¾›äº† Http æ¥å£ï¼Œé Java å’Œ .Net åº”ç”¨ä¹Ÿå¯ä»¥æ–¹ä¾¿åœ°ä½¿ç”¨ã€‚  
*  
  **æä¾›å¼€æ”¾å¹³å°API** ï¼š
  *  
  Apollo è‡ªèº«æä¾›äº†æ¯”è¾ƒå®Œå–„çš„ç»Ÿä¸€é…ç½®ç®¡ç†ç•Œé¢ï¼Œæ”¯æŒå¤šç¯å¢ƒã€å¤šæ•°æ®ä¸­å¿ƒé…ç½®ç®¡ç†ã€æƒé™ã€æµç¨‹æ²»ç†ç­‰ç‰¹æ€§ã€‚ä¸è¿‡ Apollo å‡ºäºé€šç”¨æ€§è€ƒè™‘ï¼Œä¸ä¼šå¯¹é…ç½®çš„ä¿®æ”¹åšè¿‡å¤šé™åˆ¶ï¼Œåªè¦ç¬¦åˆåŸºæœ¬çš„æ ¼å¼å°±èƒ½ä¿å­˜ï¼Œä¸ä¼šé’ˆå¯¹ä¸åŒçš„é…ç½®å€¼è¿›è¡Œé’ˆå¯¹æ€§çš„æ ¡éªŒï¼Œå¦‚æ•°æ®åº“ç”¨æˆ·åã€å¯†ç ï¼ŒRedis æœåŠ¡åœ°å€ç­‰ã€‚  
  *  
å¯¹äºè¿™ç±»åº”ç”¨é…ç½®ï¼ŒApollo æ”¯æŒåº”ç”¨æ–¹é€šè¿‡å¼€æ”¾å¹³å° API åœ¨ Apollo è¿›è¡Œé…ç½®çš„ä¿®æ”¹å’Œå‘å¸ƒï¼Œå¹¶ä¸”å…·å¤‡å®Œå–„çš„æˆæƒå’Œæƒé™æ§åˆ¶ã€‚  
*  
  **éƒ¨ç½²ç®€å•** ï¼š
  *  
  é…ç½®ä¸­å¿ƒä½œä¸ºåŸºç¡€æœåŠ¡ï¼Œå¯ç”¨æ€§è¦æ±‚éå¸¸é«˜ï¼Œè¿™å°±è¦æ±‚ Apollo å¯¹å¤–éƒ¨ä¾èµ–å°½å¯èƒ½åœ°å°‘ã€‚  
  *  
  ç›®å‰å”¯ä¸€çš„å¤–éƒ¨ä¾èµ–æ˜¯ MySQLï¼Œæ‰€ä»¥éƒ¨ç½²éå¸¸ç®€å•ï¼Œåªè¦å®‰è£…å¥½ Java å’Œ MySQL å°±å¯ä»¥è®© Apollo è·‘èµ·æ¥ã€‚  
  *  
    Apollo è¿˜æä¾›äº†æ‰“åŒ…è„šæœ¬ï¼Œä¸€é”®å°±å¯ä»¥ç”Ÿæˆæ‰€æœ‰éœ€è¦çš„å®‰è£…åŒ…ï¼Œå¹¶ä¸”æ”¯æŒè‡ªå®šä¹‰è¿è¡Œæ—¶å‚æ•°ã€‚

### 2. Apollo at a glance {#2-apollo-at-a-glance}

#### 2.1 åŸºç¡€æ¨¡å‹ {#2-1}

å¦‚ä¸‹å³æ˜¯ Apollo çš„åŸºç¡€æ¨¡å‹ï¼š

* 1.  
ç”¨æˆ·åœ¨é…ç½®ä¸­å¿ƒå¯¹é…ç½®è¿›è¡Œä¿®æ”¹å¹¶å‘å¸ƒï¼›  
* 2.  
é…ç½®ä¸­å¿ƒé€šçŸ¥ Apollo å®¢æˆ·ç«¯æœ‰é…ç½®æ›´æ–°ï¼›  
* 3.  
  Apollo å®¢æˆ·ç«¯ä»é…ç½®ä¸­å¿ƒæ‹‰å–æœ€æ–°çš„é…ç½®ã€æ›´æ–°æœ¬åœ°é…ç½®å¹¶é€šçŸ¥åˆ°åº”ç”¨ã€‚

![basic-architecture.png](https://article-images.zsxq.com/FrS7SKti6CZHPzZZlOvMNSaiic9q "basic-architecture.png")

#### 2.2 ç•Œé¢æ¦‚è§ˆ {#2-2}

ä¸‹å›¾æ˜¯ Apollo é…ç½®ä¸­å¿ƒä¸­ä¸€ä¸ªé¡¹ç›®çš„é…ç½®é¦–é¡µï¼š

*  
åœ¨é¡µé¢å·¦ä¸Šæ–¹çš„ç¯å¢ƒåˆ—è¡¨æ¨¡å—å±•ç¤ºäº†æ‰€æœ‰çš„ç¯å¢ƒå’Œé›†ç¾¤ï¼Œç”¨æˆ·å¯ä»¥éšæ—¶åˆ‡æ¢ã€‚  
*  
é¡µé¢ä¸­å¤®å±•ç¤ºäº†ä¸¤ä¸ª namespaceï¼ˆapplication å’Œ FX.apolloï¼‰çš„é…ç½®ä¿¡æ¯ï¼Œé»˜è®¤æŒ‰ç…§è¡¨æ ¼æ¨¡å¼å±•ç¤ºã€ç¼–è¾‘ã€‚ç”¨æˆ·ä¹Ÿå¯ä»¥åˆ‡æ¢åˆ°æ–‡æœ¬æ¨¡å¼ï¼Œä»¥æ–‡ä»¶å½¢å¼æŸ¥çœ‹ã€ç¼–è¾‘ã€‚  
*  
  é¡µé¢ä¸Šå¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œå‘å¸ƒã€å›æ»šã€ç°åº¦ã€æˆæƒã€æŸ¥çœ‹æ›´æ”¹å†å²å’Œå‘å¸ƒå†å²ç­‰æ“ä½œã€‚

![apollo-home-screenshot.jpg](https://article-images.zsxq.com/FqzqAfUb1bp6UYmaZhz7S4Bd58zv "apollo-home-screenshot.jpg")

### 3. æ¶æ„è®¾è®¡ {#3}

#### 3.1 æ€»ä½“è®¾è®¡ {#3-1}

![overall-architecture.png](https://article-images.zsxq.com/FnkSs9Sy6brFvCyqFIJKtK9uVsxJ "overall-architecture.png")

ä¸Šå›¾ç®€è¦æè¿°äº† Apollo çš„æ€»ä½“è®¾è®¡ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸‹å¾€ä¸Šçœ‹ï¼š

*  
Config Service æä¾›é…ç½®çš„è¯»å–ã€æ¨é€ç­‰åŠŸèƒ½ï¼ŒæœåŠ¡å¯¹è±¡æ˜¯ Apollo å®¢æˆ·ç«¯ã€‚  
*  
Admin Service æä¾›é…ç½®çš„ä¿®æ”¹ã€å‘å¸ƒç­‰åŠŸèƒ½ï¼ŒæœåŠ¡å¯¹è±¡æ˜¯ Apollo Portalï¼ˆç®¡ç†ç•Œé¢ï¼‰ã€‚  
*  
Config Service å’Œ Admin Service éƒ½æ˜¯å¤šå®ä¾‹ã€æ— çŠ¶æ€éƒ¨ç½²ï¼Œæ‰€ä»¥éœ€è¦å°†è‡ªå·±æ³¨å†Œåˆ° Eureka ä¸­å¹¶ä¿æŒå¿ƒè·³ã€‚  
*  
åœ¨ Eureka ä¹‹ä¸Šæˆ‘ä»¬æ¶äº†ä¸€å±‚ Meta Server ç”¨äºå°è£… Eureka çš„æœåŠ¡å‘ç°æ¥å£ã€‚  
*  
Client é€šè¿‡åŸŸåè®¿é—® Meta Server è·å– Config Service æœåŠ¡åˆ—è¡¨ï¼ˆIP+Portï¼‰ï¼Œè€Œåç›´æ¥é€šè¿‡ IP+Port è®¿é—®æœåŠ¡ï¼ŒåŒæ—¶åœ¨ Client ä¾§ä¼šåš load balanceã€é”™è¯¯é‡è¯•ã€‚  
*  
Portal é€šè¿‡åŸŸåè®¿é—® Meta Server è·å– Admin Service æœåŠ¡åˆ—è¡¨ï¼ˆIP+Portï¼‰ï¼Œè€Œåç›´æ¥é€šè¿‡ IP+Port è®¿é—®æœåŠ¡ï¼ŒåŒæ—¶åœ¨ Portal ä¾§ä¼šåš load balanceã€é”™è¯¯é‡è¯•ã€‚  
*  
  ä¸ºäº†ç®€åŒ–éƒ¨ç½²ï¼Œæˆ‘ä»¬å®é™…ä¸Šä¼šæŠŠ Config Serviceã€Eureka å’Œ Meta Server ä¸‰ä¸ªé€»è¾‘è§’è‰²éƒ¨ç½²åœ¨åŒä¸€ä¸ª JVM è¿›ç¨‹ä¸­ã€‚

#### 3.2 å®¢æˆ·ç«¯è®¾è®¡ {#3-2}

![client-architecture.png](https://article-images.zsxq.com/FnG-jOncdDf9GAZT2Y38gWC6u41k "client-architecture.png")

ä¸Šå›¾ç®€è¦æè¿°äº† Apollo å®¢æˆ·ç«¯çš„å®ç°åŸç†ï¼š

* 1.  
å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¿æŒäº†ä¸€ä¸ªé•¿è¿æ¥ï¼Œä»è€Œèƒ½ç¬¬ä¸€æ—¶é—´è·å¾—é…ç½®æ›´æ–°çš„æ¨é€ã€‚  
* 2.  
  å®¢æˆ·ç«¯è¿˜ä¼šå®šæ—¶ä» Apollo é…ç½®ä¸­å¿ƒæœåŠ¡ç«¯æ‹‰å–åº”ç”¨çš„æœ€æ–°é…ç½®ã€‚
  *  
  è¿™æ˜¯ä¸€ä¸ª fallback æœºåˆ¶ï¼Œä¸ºäº†é˜²æ­¢æ¨é€æœºåˆ¶å¤±æ•ˆå¯¼è‡´é…ç½®ä¸æ›´æ–°ï¼›  
  *  
  å®¢æˆ·ç«¯å®šæ—¶æ‹‰å–ä¼šä¸ŠæŠ¥æœ¬åœ°ç‰ˆæœ¬ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯¹äºå®šæ—¶æ‹‰å–çš„æ“ä½œï¼ŒæœåŠ¡ç«¯éƒ½ä¼šè¿”å› 304 - Not Modifiedï¼›  
  *  
å®šæ—¶é¢‘ç‡é»˜è®¤ä¸ºæ¯ 5 åˆ†é’Ÿæ‹‰å–ä¸€æ¬¡ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥é€šè¿‡åœ¨è¿è¡Œæ—¶æŒ‡å®š System Property: `apollo.refreshInterval` æ¥è¦†ç›–ï¼Œå•ä½ä¸ºåˆ†é’Ÿã€‚  
* 3.  
å®¢æˆ·ç«¯ä» Apollo é…ç½®ä¸­å¿ƒæœåŠ¡ç«¯è·å–åˆ°åº”ç”¨çš„æœ€æ–°é…ç½®åï¼Œä¼šä¿å­˜åœ¨å†…å­˜ä¸­ã€‚  
* 4.  
å®¢æˆ·ç«¯ä¼šæŠŠä»æœåŠ¡ç«¯è·å–åˆ°çš„é…ç½®åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ä¸€ä»½ã€‚åœ¨é‡åˆ°æœåŠ¡ä¸å¯ç”¨ï¼Œæˆ–ç½‘ç»œä¸é€šçš„æ—¶å€™ï¼Œä¾ç„¶èƒ½ä»æœ¬åœ°æ¢å¤é…ç½®ã€‚  
* 5.  
  åº”ç”¨ç¨‹åºä» Apollo å®¢æˆ·ç«¯è·å–æœ€æ–°çš„é…ç½®ã€è®¢é˜…é…ç½®æ›´æ–°é€šçŸ¥ã€‚

çœ‹äº†ä¸Šé¢çš„æè¿°ï¼Œç›¸ä¿¡å¤§å®¶å¯¹ Apollo æœ‰äº†ç®€å•è®¤è¯†ï¼Œå¦‚æœæƒ³å­¦ä¹ æ›´å¤šçŸ¥è¯†ï¼Œå‚è€ƒ [Apollo å®˜æ–¹æ–‡æ¡£](https://www.apolloconfig.com/#/zh/README)ã€‚

Apollo vs Nacos {#apollo-vs-nacos}
----------------------------------

### 1. åŸºç¡€å®šä½ {#1}

|  ç‰¹æ€§  |             Apollo             |        Nacos        |
|------|--------------------------------|---------------------|
| æ ¸å¿ƒå®šä½ | é…ç½®ä¸­å¿ƒï¼ˆConfiguration Managementï¼‰ | é…ç½®ä¸­å¿ƒ + æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼ˆåŒæ ¸å¿ƒï¼‰ |
| ä¸»å¯¼æ–¹  | æºç¨‹                             | é˜¿é‡Œå·´å·´                |
| å¼€æºæ—¶é—´ | 2017                           | 2018                |

### 2. åŠŸèƒ½å¯¹æ¯” {#2}

|     åŠŸèƒ½ç‰¹æ€§      |        Apollo         |        Nacos        |
|---------------|-----------------------|---------------------|
| é…ç½®ç®¡ç†          | âœ… æ”¯æŒå¤šç¯å¢ƒã€å¤šé›†ç¾¤ã€ç°åº¦ã€æ³¨é‡Šç­‰åŠŸèƒ½  | âœ… æ”¯æŒï¼Œé…ç½®è½»é‡ï¼Œæ”¯æŒåŠ¨æ€åˆ·æ–°    |
| æœåŠ¡æ³¨å†Œä¸å‘ç°       | âŒ ä¸æ”¯æŒ                 | âœ… æ”¯æŒ DNS+RPC æ³¨å†Œå‘ç°   |
| æƒé™ä¸å®¡è®¡         | âœ… æ”¯æŒç»†ç²’åº¦æƒé™æ§åˆ¶ã€æ“ä½œæ—¥å¿—      | âš ï¸ æ”¯æŒè¾ƒå¼±ï¼Œç¤¾åŒºç‰ˆæƒé™è¾ƒç®€å•    |
| å¤šç§Ÿæˆ·/Namespace | âœ… æ”¯æŒï¼Œè¾ƒä¸ºå®Œå–„             | âœ… æ”¯æŒï¼Œä½†éš”ç¦»ç²’åº¦å’Œéš”ç¦»æœºåˆ¶ç•¥å¼±   |
| ç°åº¦å‘å¸ƒ          | âœ… æ”¯æŒç°åº¦é…ç½®ã€ç°åº¦è§„åˆ™ç­‰        | âŒ é»˜è®¤ä¸æ”¯æŒï¼Œéœ€è¦é¢å¤–æ¥å…¥      |
| æ§åˆ¶å°ä½“éªŒ         | âœ… å®Œå–„ï¼ŒåŠŸèƒ½ç»†åŒ–ã€å¯ç¼–è¾‘å†å²é…ç½®ã€æƒé™ç­‰ | âš ï¸ ç®€æ´ä½†åè½»é‡ï¼Œé€‚åˆåŸºç¡€ä½¿ç”¨    |
| å†å²ç‰ˆæœ¬ \& å›æ»š    | âœ… æ”¯æŒæŸ¥çœ‹ã€å›æ»šå†å²ç‰ˆæœ¬         | âœ… æ”¯æŒï¼Œä½†åŠŸèƒ½è¾ƒç®€å•         |
| æŒä¹…åŒ–å­˜å‚¨         | âœ… é»˜è®¤åŸºäº MySQL          | âœ… é»˜è®¤åŸºäº MySQLï¼Œä¹Ÿæ”¯æŒåµŒå…¥å¼ |

### 3. ä½¿ç”¨åœºæ™¯ {#3}

Apollo é€‚åˆçš„åœºæ™¯ï¼š

*  
ä¼ä¸šçº§é…ç½®ä¸­å¿ƒéœ€æ±‚ï¼Œè¦æ±‚æƒé™ã€å®¡è®¡ã€ç‰ˆæœ¬å›æ»šå®Œå–„ã€‚  
*  
é…ç½®ç»´åº¦å¤šã€ä¸šåŠ¡çº¿å¤šã€ç¯å¢ƒåˆ’åˆ†å¤æ‚ã€‚  
*  
  å¯¹ç°åº¦å‘å¸ƒã€é…ç½®å®¡è®¡ç­‰æœ‰å¼ºéœ€æ±‚ã€‚

Nacos é€‚åˆçš„åœºæ™¯ï¼š

*  
éœ€è¦é…ç½®ç®¡ç† + æœåŠ¡æ³¨å†Œä¸€ä½“åŒ–è§£å†³æ–¹æ¡ˆã€‚  
*  
å¾®æœåŠ¡æ²»ç†åœºæ™¯ä¸­ï¼Œå¸Œæœ›è½»é‡ã€å¿«é€Ÿæ¥å…¥ï¼ˆå¦‚ Dubbo/Spring Cloudï¼‰ã€‚  
*  
  æ³¨å†Œä¸­å¿ƒä¸é…ç½®ä¸­å¿ƒç»Ÿä¸€éƒ¨ç½²åœºæ™¯ã€‚

æ€»ç»“å¯¹æ¯”ï¼š  

|  å¯¹æ¯”ç»´åº¦  |    Apollo    |          Nacos          |
|--------|--------------|-------------------------|
| é…ç½®ç®¡ç†èƒ½åŠ› | â­â­â­â­â­ï¼ˆåŠŸèƒ½ä¸°å¯Œï¼‰  | â­â­â­ï¼ˆè½»é‡å®ç”¨ï¼‰               |
| æœåŠ¡æ³¨å†Œå‘ç° | âŒ            | â­â­â­â­ï¼ˆåŠŸèƒ½é½å…¨ï¼‰              |
| æ§åˆ¶å°ä½“éªŒ  | â­â­â­â­ï¼ˆä¼ä¸šçº§ UIï¼‰ | â­â­ï¼ˆåŸºç¡€å¯ç”¨ï¼‰                |
| è¿ç»´å¤æ‚åº¦  | â­â­ï¼ˆéœ€éƒ¨ç½²å¤šä¸ªç»„ä»¶ï¼‰  | â­â­â­â­ï¼ˆè½»é‡çº§éƒ¨ç½²ï¼‰             |
| ç°åº¦ä¸æƒé™  | â­â­â­â­ï¼ˆæ”¯æŒç»†ç²’åº¦ï¼‰  | â­â­ï¼ˆç®€å•æ”¯æŒï¼‰                |
| ä½¿ç”¨é—¨æ§›   | â­â­ï¼ˆéœ€é…å¥— SDKï¼‰  | â­â­â­â­ï¼ˆSpring Cloud å¿«é€Ÿæ•´åˆï¼‰ |
| ç¤¾åŒºä¸ç”Ÿæ€  | â­â­â­â­         | â­â­â­â­                    |

### 4. Breatheä¸»è§‚æ¯”è¾ƒ {#4}

è¿™ä¸€ç« èŠ‚ï¼ŒBreatheä¸æ‰“ç®—ä»å®˜æ–¹æ–‡æ¡£æˆ–åŠŸèƒ½æ¸…å•å»è¯„æ¯” Apollo å’Œ Nacosï¼Œè€Œæ˜¯ç»“åˆè‡ªå·±åœ¨é¡¹ç›®ä¸­æ¥è§¦å’Œè½åœ°çš„å®é™…ä½“éªŒï¼Œåšä¸€æ³¢**çº¯ä¸»è§‚ã€åå®æˆ˜çš„æ¨ªå‘å¯¹æ¯”** ã€‚å¦‚æœä½ æœ‰ä¸åŒè§‚ç‚¹ï¼Œæ¬¢è¿è¯„è®ºåŒºä¸€èµ·äº¤æµã€‚

æˆ‘ä¸»è¦ä»ä»¥ä¸‹å‡ ä¸ªç»´åº¦åšä¸ªç®€è¦åˆ†æï¼š

*  
**æ¶æ„å±‚é¢** ï¼šä¸¤è€…çš„åº•å±‚æ¶æ„å…¶å®éƒ½å·²ç»éå¸¸æˆç†Ÿï¼Œç»å†äº†å¤§è§„æ¨¡ç”Ÿäº§éªŒè¯ã€‚æ— è®ºé€‰å“ªä¸€ä¸ªï¼Œç¨³å®šæ€§å’Œå¯ç”¨æ€§éƒ½æ— éœ€æ‹…å¿ƒï¼Œå› æ­¤æ¶æ„æœ¬èº«ä¸æ„æˆé€‰å‹é—¨æ§›ã€‚  
*  
**åŠŸèƒ½å®Œå¤‡æ€§** ï¼šå°±"é…ç½®ä¸­å¿ƒ"æœ¬èº«è€Œè¨€ï¼ŒApollo çš„åŠŸèƒ½æ›´åä¼ä¸šçº§ï¼Œ**åœ¨ç°åº¦å‘å¸ƒã€æƒé™æ§åˆ¶ã€ç‰ˆæœ¬å›æ»šç­‰æ–¹é¢ä¼˜åŠ¿æ˜æ˜¾** ï¼Œè¿™æ–¹é¢ Nacos æ˜¯æ— æ³•æ¯”çš„ï¼Œå±äºè¢« Apollo ç¢¾å‹çš„å­˜åœ¨ã€‚  
*  
**é›†æˆä¾¿åˆ©æ€§** ï¼šä½† Nacos èƒœåœ¨"å…¨èƒ½å‹é€‰æ‰‹"------**æœåŠ¡æ³¨å†Œ+é…ç½®ä¸­å¿ƒä¸€ä½“åŒ–** ï¼Œå¯¹ä¸­å°é¡¹ç›®å°¤å…¶å‹å¥½ï¼Œå‡å°‘äº†ä¸­é—´ä»¶éƒ¨ç½²ã€ç»´æŠ¤å’Œå­¦ä¹ æˆæœ¬ï¼Œæˆ‘ä¸ªäººåœ¨ä¸šåŠ¡åœºæ™¯ä¸­æ›´åå¥½ Nacosã€‚  
*  
**ä»£ç è§‚æ„Ÿ** ï¼šApollo çš„æ—©æœŸæºç é£æ ¼æœ‰è¾ƒæ˜æ˜¾çš„ `.NET` å½±å­ï¼Œæ¯”å¦‚ `m_` å‘½åå‰ç¼€ç­‰ï¼Œå¯¹äº Java å¼€å‘è€…ä¸å¤ªå‹å¥½ï¼›ç›¸æ¯”ä¹‹ä¸‹ï¼ŒNacos çš„ä»£ç ç»“æ„æ›´è´´åˆç°ä»£ Java å¼€å‘ä¹ æƒ¯ï¼Œä¸Šæ‰‹æ›´è‡ªç„¶ã€‚  
*  
  **ç¤¾åŒºæ´»è·ƒåº¦** ï¼šç›®å‰æ¥çœ‹ï¼ŒApollo çš„å‘å¸ƒé¢‘ç‡æœ‰æ‰€ä¸‹é™ï¼ˆ23å¹´ä¸¤ä¸ªç‰ˆæœ¬ï¼Œ24å¹´ä¸€ä¸ªï¼Œ25å¹´ä¸ŠåŠå¹´ä¸€ä¸ªï¼‰ï¼Œä½†æˆ‘æ›´å€¾å‘äºç†è§£ä¸º"åŠŸèƒ½è¶‹äºç¨³å®š"ï¼›è€Œ Nacos å› å…¼å…·æ³¨å†Œä¸­å¿ƒèŒèƒ½ï¼Œç¤¾åŒºä»è¾ƒæ´»è·ƒï¼ŒPMC ä¸»å¯¼ä¸‹ Bug ä¿®å¤å’Œå‘ç‰ˆä¹Ÿæ›´æŒç»­ã€‚

å¯¹å¤§å¤šæ•°å›¢é˜Ÿè€Œè¨€ï¼Œ**Nacoså·²è¶³å¤Ÿæ»¡è¶³æ—¥å¸¸é…ç½®éœ€æ±‚** ï¼›ä½†å¦‚æœä½ å¯¹æƒé™ã€å®¡è®¡ã€ç°åº¦å‘å¸ƒç­‰æœ‰æ›´é«˜è¦æ±‚ï¼Œ**Apolloæ˜¯æ›´åˆé€‚çš„é€‰æ‹©** ã€‚ä¸¤è€…å¹¶éæ›¿ä»£å…³ç³»ï¼Œè€Œæ˜¯å¯æŒ‰éœ€é€‰å‹çš„ä¸åŒä¾§é‡ã€‚

Apollo å¦‚ä½•å®Œæˆé…ç½®ç›‘å¬ï¼Ÿ {#apollo}
--------------------------

å¦‚æœå¤§å®¶çœ‹è¿‡ Nacos çš„é…ç½®ç›‘å¬å’Œå‚æ•°å˜æ›´ï¼Œå…¶å® Apollo æµç¨‹æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯ç›‘å¬é€»è¾‘æ˜¯ä¸åŒçš„ã€‚
> æœ¬ç« èŠ‚çš„é‡ç‚¹å†…å®¹é›†ä¸­åœ¨æ¨¡å—ï¼š `apollo-spring-boot-starter`ã€‚

å¦‚æœå¤§å®¶æƒ³è¦åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ Apollo é…ç½®ç®¡ç†ï¼Œéœ€è¦åœ¨ pom.xml æ–‡ä»¶ä¸­æ·»åŠ å¯¹åº”çš„ä¾èµ–ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    <dependency>
        <groupId>com.ctrip.framework.apollo</groupId>
        <artifactId>apollo-client-config-data</artifactId>
    </dependency>
              
ä» Apollo æä¾›çš„é…ç½®ä¸­å¿ƒæŠ½è±¡æ¥å£ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶æ ¸å¿ƒæ–¹æ³•ä¹‹ä¸€æ˜¯ `addChangeListener`ï¼Œç”¨äºæ³¨å†Œé…ç½®å˜æ›´ç›‘å¬å™¨ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    public interface Config {
        // ......
        /**
         * Add change listener to this config instance, will be notified when any key is changed in this namespace.
         *
         * @param listener the config change listener
         */
        void addChangeListener(ConfigChangeListener listener);
        // ......
    }
              
ä¸‹æ–¹ Yaml é…ç½®ä¸º Apollo éœ€è¦è®¾ç½®å‚æ•°å†…å®¹ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    app:
      id: onethread-apollo-example${unique-name:} # Apollo é…ç½®ä¸­å¿ƒçš„ åº”ç”¨å”¯ä¸€æ ‡è¯†ï¼ˆAppIdï¼‰
    env: dev # æŒ‡å®š Apollo çš„ç¯å¢ƒï¼ˆEnvironmentï¼‰ï¼Œå¦‚ devã€fatã€uatã€pro ç­‰
    â€‹
    apollo:
      meta: http://127.0.0.1:8080 # æŒ‡å®š Apollo çš„ Meta Server åœ°å€ã€‚å®¢æˆ·ç«¯é€šè¿‡ Meta Server è·å–å¯¹åº”çš„é…ç½®æœåŠ¡ï¼ˆConfig Serviceï¼‰åœ°å€
      autoUpdateInjectedSpringProperties: true # æ˜¯å¦æ”¯æŒ Spring æ³¨å…¥å±æ€§çš„è‡ªåŠ¨åˆ·æ–°
      bootstrap:
        enabled: true # å¯ç”¨ Apollo çš„ Bootstrap åŠ è½½æœºåˆ¶ï¼Œé»˜è®¤ SpringBoot çš„é…ç½®åŠ è½½æ—¶æœºæ™šäº Apollo
        namespaces: application # æŒ‡å®šä»å“ªäº› Namespace åŠ è½½é…ç½®ï¼ˆå¤šä¸ªä»¥é€—å·åˆ†éš”ï¼‰
        eagerLoad:
          enabled: true # å¼ºåˆ¶åœ¨ Spring å®¹å™¨åŠ è½½å‰ï¼Œç«‹å³åŠ è½½ Apollo é…ç½®
      configService: http://127.0.0.1:8080 # æ‰‹åŠ¨æŒ‡å®š Config Service åœ°å€ï¼ˆå¯é€‰ï¼‰
              
ä¸‹é¢æˆ‘ä»¬å…ˆé€šè¿‡ä¸€å¼ æ—¶åºå›¾ï¼Œä»å®è§‚è§’åº¦å¿«é€Ÿäº†è§£ Apollo é…ç½®ç›‘å¬æ³¨å†Œçš„å¤§è‡´æµç¨‹ï¼Œå¸®åŠ©å¤§å®¶å»ºç«‹æ•´ä½“è®¤çŸ¥ï¼š

![image-20250721110846775.png](https://article-images.zsxq.com/FlVvfusM1n8nNUAMeL9oqNFh2PwC "image-20250721110846775.png")

å¥½ï¼Œå’±ä»¬ç»§ç»­å¾€ä¸‹çœ‹ ------ **æ¥çœ‹ä¸‹æ³¨å†Œé…ç½®ç›‘å¬çš„æ–¹æ³•æ˜¯æ€ä¹ˆå®ç°çš„ï¼š**  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    @Slf4j
    @RequiredArgsConstructor
    public class ApolloRefresherHandlerV1 implements ApplicationRunner {
    â€‹
        private final BootstrapConfigProperties properties;
    â€‹
        @Override
        public void run(ApplicationArguments args) throws Exception {
            BootstrapConfigProperties.ApolloConfig apolloConfig = properties.getApollo();
            String[] apolloNamespaces = apolloConfig.getNamespace().split(",");
    â€‹
            String namespace = apolloNamespaces[0];
            String configFileType = properties.getConfigFileType().getValue();
            Config config = ConfigService.getConfig(String.format("%s.%s", namespace, properties.getConfigFileType().getValue()));
    â€‹
            ConfigChangeListener configChangeListener = createConfigChangeListener(namespace, configFileType);
            config.addChangeListener(configChangeListener);
    â€‹
            log.info("Dynamic thread pool refresher, add apollo listener success. namespace: {}", namespace);
        }
    â€‹
        private ConfigChangeListener createConfigChangeListener(String namespace, String configFileType) {
            return configChangeEvent -> {
                // å¦‚æœ Apollo é…ç½®æ–‡ä»¶å˜æ›´ï¼Œä¼šè§¦å‘è¯¥æ–¹æ³•è¿›è¡Œå›è°ƒ
                String namespaceItem = namespace.replace("." + configFileType, "");
                ConfigFileFormat configFileFormat = ConfigFileFormat.fromString(configFileType);
                ConfigFile configFile = ConfigService.getConfigFile(namespaceItem, configFileFormat);
                String content = configFile.getContent(); // å˜æ›´åçš„æœ€æ–°å†…å®¹
                refreshThreadPoolProperties(content); // åˆ·æ–°åŠ¨æ€çº¿ç¨‹æ± é…ç½®
            };
        }
    }
              
æ–¹æ³•çš„å…·ä½“é€»è¾‘å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š

* 1.  
**è·å–Apolloé…ç½®** ï¼šé¦–å…ˆï¼Œé€šè¿‡ `properties.getApollo()` è·å–é…ç½®ä¸­å¿ƒçš„å…³é”®å‚æ•°ï¼Œè¯»å–é¡¹ç›®ä¸­çš„ Apollo å‘½åç©ºé—´é…ç½®ï¼Œæ”¯æŒå¤šä¸ªï¼Œä»¥é€—å·åˆ†éš”ã€‚  
* 2.  
**æ³¨å†Œé…ç½®å˜æ›´ç›‘å¬å™¨** ï¼šæ¥ç€è°ƒç”¨ `config.addChangeListener(...)` æ–¹æ³•ï¼Œå‘æŒ‡å®šçš„ `nameserver` æ³¨å†Œç›‘å¬å™¨ã€‚ä¸€æ—¦ Apollo ç«¯å¯¹åº”çš„é…ç½®å‘ç”Ÿå˜æ›´ï¼Œç›‘å¬å™¨å°±ä¼šè¢«è‡ªåŠ¨è§¦å‘ã€‚  
* 3.  
**é…ç½®å˜æ›´å›è°ƒ** ï¼šå½“é…ç½®å‘ç”Ÿå˜æ›´æ—¶ï¼Œ`configChangeListener` æ–¹æ³•ä¼šè¢«å›è°ƒã€‚æˆ‘ä»¬é€šå¸¸ä¼šåœ¨è¿™é‡Œè°ƒç”¨ `refreshThreadPoolProperties(...)`ï¼Œå°†æœ€æ–°çš„é…ç½®ä¿¡æ¯è§£æå‡ºæ¥å¹¶åŠ¨æ€åˆ·æ–°çº¿ç¨‹æ± å‚æ•°ã€‚  
* 4.  
  **æ—¥å¿—è¾“å‡º** ï¼šä¸ºäº†æ–¹ä¾¿åç»­è¿ç»´æ’æŸ¥ï¼Œæ³¨å†ŒæˆåŠŸåä¼šæ‰“å°ä¸€æ¡ `info` çº§åˆ«çš„æ—¥å¿—ï¼Œæ˜ç¡®è¡¨ç¤ºç›‘å¬å™¨å·²ç»ç”Ÿæ•ˆã€‚

Apollo é»˜è®¤ä½¿ç”¨ `properties` æ ¼å¼ä½œä¸ºé…ç½®è½½ä½“ï¼Œä»è¿”å›ç»“æœä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥æ¸…æ™°çœ‹å‡ºã€‚

![image-20250721105752254.png](https://article-images.zsxq.com/Fsv06HfBpYsD2e-BlDf_U5b8gSux "image-20250721105752254.png")

æ•´ä½“ç›‘å¬æœºåˆ¶çš„å®ç°é€»è¾‘ä¸ Nacos ååˆ†ç›¸ä¼¼ï¼Œå› æ­¤æœ¬ç« èŠ‚ä¸å†èµ˜è¿°é‡å¤å†…å®¹ï¼Œé‡ç‚¹èšç„¦ Apollo çš„å·®å¼‚åŒ–å®ç°ã€‚
> éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒApollo çš„å¯åŠ¨æµç¨‹ç›¸å¯¹å¤æ‚ï¼Œæˆ‘å½“æ—¶ä¹Ÿå°è¯•äº†å¤šç§æ–¹å¼æ‰æœ€ç»ˆé€šè¿‡å®˜ç½‘æä¾›çš„ `docker-compose` æˆåŠŸå¯åŠ¨ã€‚å¦‚æœä½ åªæ˜¯æƒ³èšç„¦ `oneThread` çš„æ ¸å¿ƒèƒ½åŠ›ï¼Œå¯¹ Apollo æœ¬èº«å¹¶ä¸æ„Ÿå…´è¶£ï¼Œå¯ä»¥è·³è¿‡éƒ¨ç½²éƒ¨åˆ†ï¼Œç›´æ¥è¿›å…¥åç»­å†…å®¹ã€‚

æ–‡æœ«æ€»ç»“
----

Apollo å¹¶é oneThread çš„å¼ºä¾èµ–ï¼Œä½†æ”¯æŒå®ƒï¼Œæ˜¯ä¸ºäº†è®©ç»„ä»¶å…·å¤‡æ›´å¼ºçš„**é€šç”¨æ€§ä¸é€‚é…æ€§** ï¼ŒçœŸæ­£åšåˆ°åœ¨ä¸åŒé…ç½®ä¸­å¿ƒä¹‹é—´**æ— ç¼æ¥å…¥ã€æŒ‰éœ€é›†æˆ** ã€‚

æ­¤å¤–ï¼ŒBreatheä¹Ÿç‰¹æ„è€ƒå¤äº†ä¸€ä¸‹ Apollo ä½œè€…å®‹é¡ºï¼ˆèŠ±åï¼šé½å¤©ï¼‰çš„æ—©æœŸåšå®¢ï¼Œå†…å®¹è´¨é‡å¾ˆé«˜ï¼Œå¯¹äºç†è§£ Apollo çš„è®¾è®¡åˆè¡·å’Œè½åœ°æ€è·¯éå¸¸æœ‰å¸®åŠ©ï¼Œæ¨èå¤§å®¶ä½œä¸ºå»¶ä¼¸é˜…è¯»æ·±å…¥æ€è€ƒã€‚
> å®‹é¡ºï¼ˆèŠ±åï¼šé½å¤©ï¼‰ï¼Œèš‚èšé›†å›¢èµ„æ·±æŠ€æœ¯ä¸“å®¶ï¼ŒApollo Config PMCã€‚
>
> åœ¨å¾®æœåŠ¡æ¶æ„ã€åˆ†å¸ƒå¼è®¡ç®—ç­‰é¢†åŸŸæœ‰ç€ä¸°å¯Œçš„ç»éªŒï¼Œ2019 å¹´åŠ å…¥èš‚èšé›†å›¢ï¼Œç›®å‰ä¸“æ³¨äºäº‘åŸç”Ÿå’Œå¾®æœåŠ¡æ–¹å‘ï¼Œå¦‚ Service Meshã€Serverlessã€Application Runtime ç­‰ã€‚
>
> æ¯•ä¸šäºå¤æ—¦å¤§å­¦è½¯ä»¶å·¥ç¨‹ç³»ï¼Œæ›¾å°±èŒäºå¤§ä¼—ç‚¹è¯„ã€æºç¨‹ï¼Œè´Ÿè´£åå°ç³»ç»Ÿã€ä¸­é—´ä»¶ç­‰ç ”å‘å·¥ä½œã€‚
>
> *  
> [Apolloé…ç½®ä¸­å¿ƒä»‹ç»](https://nobodyiam.com/2016/07/09/introduction-to-apollo/)  
> *  
>   [é…ç½®ä¸­å¿ƒï¼Œè®©å¾®æœåŠ¡æ›´ã€æ™ºèƒ½ã€](https://nobodyiam.com/2018/07/29/configuration-center-makes-microservices-smart/)

å®Œç»“ï¼Œæ’’èŠ± ğŸ‰

