2025å¹´07æœˆ12æ—¥ 22:46  
è‡ªå®šä¹‰åŠ¨æ€çº¿ç¨‹æ± åŸºç¡€ç±»ï¼Œå…ƒæ•°æ®ä¿¡æ¯ï¼š

*  
ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± oneThreadï¼š<https://t.zsxq.com/5GfrN>  
*  
ä»£ç ä»“åº“ï¼š<https://gitcode.net/nageoffer/onethread> ------ ç”³è¯·é¡¹ç›®æƒé™å‚è€ƒä¸Šè¿°çº¿ç¨‹æ± é¡¹ç›®é“¾æ¥  
*  
ç« èŠ‚éš¾åº¦ï¼šâ˜…â˜…â˜†â˜†â˜† - ä¸­ç­‰  
*  
  è§†é¢‘åœ°å€ï¼šæœ¬ç« èŠ‚å†…å®¹ç®€å•ï¼Œæ— 



*** ** * ** ***

å†…å®¹æ‘˜è¦ï¼šæ ¸å¿ƒè®¾è®¡çš„æå‰è§„åˆ’ä¸æ•´ä½“æ„æ€ï¼Œæ˜¯æ„å»ºé«˜è´¨é‡åŠ¨æ€çº¿ç¨‹æ± æ¡†æ¶çš„åŸºçŸ³ï¼Œèƒ½å¤Ÿæœ‰æ•ˆé¿å…åæœŸå¤§å¹…è¿”å·¥ï¼ŒåŒæ—¶ä¸ºç³»ç»Ÿçš„çµæ´»æ‰©å±•å’Œç»´æŠ¤å¥ å®šåšå®åŸºç¡€ã€‚

è¯¾ç¨‹ç›®å½•å¦‚ä¸‹æ‰€ç¤ºï¼š

*  
æ ¸å¿ƒè®¾è®¡æ¦‚è¿°  
*  
å…³é”®ç±»è¯¦è§£  
*  
Builder è®¾è®¡æ¨¡å¼  
*  
  æ–‡æœ«æ€»ç»“

æ ¸å¿ƒè®¾è®¡æ¦‚è§ˆ
------

### 1. è®¾è®¡æ€æƒ³ {#1}

åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»åˆæ­¥äº†è§£äº†æˆ‘åœ¨è®¾è®¡åŸºç¡€ç»„ä»¶åº“æ—¶ç§‰æŒçš„æ ¸å¿ƒç†å¿µï¼š**å°½å¯èƒ½å‡å°‘å¯¹ä¸‰æ–¹æ¡†æ¶çš„ä¾èµ–** ã€‚

ç§‰æŒè¿™ä¸€è®¾è®¡æ€è·¯ï¼Œåœ¨æœ€åˆå¼€å‘ `oneThread` æ¡†æ¶æ—¶ï¼Œæˆ‘å°†å¤§éƒ¨åˆ†ä¸ç¬¬ä¸‰æ–¹æ¡†æ¶æ— å…³çš„é€šç”¨é€»è¾‘ï¼Œç»Ÿä¸€æŠ½è±¡å°è£…åœ¨äº† `onethread-core` æ¨¡å—ä¸­ã€‚

è¯¥æ¨¡å—ä¸»è¦æ‰¿æ‹…ä»¥ä¸‹æ ¸å¿ƒèŒè´£ï¼š

*  
å®šä¹‰åŠ¨æ€çº¿ç¨‹æ± çš„åŸºç¡€æŠ½è±¡ç±»ï¼›  
*  
æ‰§è¡Œçº¿ç¨‹æ± è¿è¡Œæ—¶çš„å‘Šè­¦æ‰«æé€»è¾‘ï¼›  
*  
æä¾›çº¿ç¨‹æ± è¿è¡ŒçŠ¶æ€çš„æŒ‡æ ‡é‡‡é›†èƒ½åŠ›ï¼›  
*  
  æ”¯æŒç›‘å¬é…ç½®ä¸­å¿ƒå˜æ›´ï¼Œå¹¶åŠ¨æ€è°ƒæ•´çº¿ç¨‹æ± å‚æ•°åŠè§¦å‘å‘Šè­¦é€šçŸ¥ã€‚

ä¸‹é¢æ˜¯ `onethread-core` æ¨¡å—çš„ `pom.xml` ä¾èµ–ï¼Œå¯ä»¥çœ‹åˆ°å®ƒ**å¹¶æœªå¼ºåˆ¶ä¾èµ–ä»»ä½•Springç›¸å…³çš„åŒ…** ï¼Œä¿æŒäº†è‰¯å¥½çš„ç‹¬ç«‹æ€§å’Œå¯ç§»æ¤æ€§ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    <?xml version="1.0" encoding="UTF-8"?>
    <project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
        <modelVersion>4.0.0</modelVersion>
        <parent>
            <groupId>com.nageoffer.onethread</groupId>
            <artifactId>onethread-all</artifactId>
            <version>0.0.1-SNAPSHOT</version>
        </parent>
        <artifactId>onethread-core</artifactId>
    â€‹
        <dependencies>
            <dependency>
                <groupId>cn.hutool</groupId>
                <artifactId>hutool-all</artifactId>
            </dependency>
    â€‹
            <dependency>
                <groupId>com.alibaba.fastjson2</groupId>
                <artifactId>fastjson2</artifactId>
            </dependency>
    â€‹
            <dependency>
                <groupId>org.yaml</groupId>
                <artifactId>snakeyaml</artifactId>
            </dependency>
    â€‹
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-test</artifactId>
                <scope>test</scope>
            </dependency>
    â€‹
            <dependency>
                <groupId>ch.qos.logback</groupId>
                <artifactId>logback-classic</artifactId>
            </dependency>
    â€‹
            <dependency>
                <groupId>io.micrometer</groupId>
                <artifactId>micrometer-core</artifactId>
            </dependency>
        </dependencies>
    </project>
              
æœ‰åŒå­¦å¯èƒ½ä¼šç–‘æƒ‘ï¼š**ä¸ºä»€ä¹ˆä¸Šè¿°ä¾èµ–ä¸­æ²¡æœ‰æ˜¾å¼æŒ‡å®šç‰ˆæœ¬å·ï¼Ÿ**

è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ï¼ˆé€šå¸¸æ˜¯ `parent` é¡¹ç›®çš„ `pom.xml`ï¼‰ä¸­ï¼Œå·²ç»é€šè¿‡ `<dependencyManagement>` ç»Ÿä¸€å®šä¹‰äº†å„ä¾èµ–çš„ç‰ˆæœ¬å·ã€‚å› æ­¤ï¼Œåœ¨ `onethread-core` æ¨¡å—ä¸­åªéœ€å£°æ˜ä¾èµ–çš„åæ ‡ï¼Œæ— éœ€é‡å¤æŒ‡å®šç‰ˆæœ¬ï¼ŒMaven ä¼šè‡ªåŠ¨ä»çˆ¶æ¨¡å—ç»§æ‰¿å¯¹åº”çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚è¿™æ ·ä¸ä»…æé«˜äº†ä¾èµ–ç®¡ç†çš„ç»Ÿä¸€æ€§ï¼Œä¹Ÿæœ‰åŠ©äºå‡å°‘ç‰ˆæœ¬å†²çªé£é™©ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    <properties>
        <java.version>17</java.version>
        <spring-boot.version>3.0.7</spring-boot.version>
        <spring-cloud.version>2022.0.3</spring-cloud.version>
        <spring-cloud-alibaba.version>2022.0.0.0-RC2</spring-cloud-alibaba.version>
        <hutool-all.version>5.8.37</hutool-all.version>
        <apollo-client-config-data.version>2.4.0</apollo-client-config-data.version>
        <fastjson2.version>2.0.57</fastjson2.version>
        <spotless-maven-plugin.version>2.22.1</spotless-maven-plugin.version>
        <maven-compiler-plugin.version>3.6.1</maven-compiler-plugin.version>
    </properties>
    â€‹
    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-dependencies</artifactId>
                <version>${spring-boot.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
    â€‹
            <dependency>
                <groupId>org.springframework.cloud</groupId>
                <artifactId>spring-cloud-dependencies</artifactId>
                <version>${spring-cloud.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
    â€‹
            <dependency>
                <groupId>com.alibaba.cloud</groupId>
                <artifactId>spring-cloud-alibaba-dependencies</artifactId>
                <version>${spring-cloud-alibaba.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
    â€‹
            <dependency>
                <groupId>cn.hutool</groupId>
                <artifactId>hutool-all</artifactId>
                <version>${hutool-all.version}</version>
            </dependency>
    â€‹
            <dependency>
                <groupId>com.ctrip.framework.apollo</groupId>
                <artifactId>apollo-client-config-data</artifactId>
                <version>${apollo-client-config-data.version}</version>
            </dependency>
    â€‹
            <dependency>
                <groupId>com.alibaba.fastjson2</groupId>
                <artifactId>fastjson2</artifactId>
                <version>${fastjson2.version}</version>
            </dependency>
        </dependencies>
    </dependencyManagement>
              
### 2. package è¯´æ˜ {#2-package}

åœ¨å‰é¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä»‹ç»è¿‡ `oneThread` æ¡†æ¶ä¸­å„ä¸ªæ¨¡å—ï¼ˆModuleï¼‰æ‰€æ‰¿æ‹…çš„èŒè´£ã€‚ä½†å½“æ—¶å¹¶æœªå±•å¼€åˆ°æ›´ç»†ç²’åº¦çš„ **packageå±‚çº§ç»“æ„** ã€‚

æœ¬æ–‡å°†è¿›ä¸€æ­¥è¯´æ˜ `onethread-core` æ¨¡å—ä¸­å„ä¸ªåŒ…çš„å…·ä½“ä½œç”¨ï¼Œå¸®åŠ©å¤§å®¶æ›´æ¸…æ™°åœ°ç†è§£å…¶å†…éƒ¨ç»“æ„ä¸è®¾è®¡æ„å›¾ã€‚

å…·ä½“åŒ…åˆ’åˆ†ä¸åŠŸèƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    .
    â”œâ”€â”€ src
    â”‚   â”œâ”€â”€ main
    â”‚   â”‚   â””â”€â”€ java
    â”‚   â”‚       â””â”€â”€ com
    â”‚   â”‚           â””â”€â”€ nageoffer
    â”‚   â”‚               â””â”€â”€ onethread
    â”‚   â”‚                   â””â”€â”€ core
    â”‚   â”‚                       â”œâ”€â”€ alarm # å‘Šè­¦æ‰«æ
    â”‚   â”‚                       â”œâ”€â”€ config # ç»„ä»¶åº“åŸºç¡€é…ç½®
    â”‚   â”‚                       â”œâ”€â”€ constant # å¸¸é‡ç±»
    â”‚   â”‚                       â”œâ”€â”€ executor # æœ€æœ€æ ¸å¿ƒçš„çº¿ç¨‹æ± åŸºç¡€åŒ…
    â”‚   â”‚                       â”‚   â””â”€â”€ support # æ ¸å¿ƒåŸºç¡€åŒ…è‡³ä¸Šå¢å¼ºçš„åŠŸèƒ½ï¼Œå¦‚æœä¸æ‹†åˆ†è¿™ä¸ªä¹Ÿè¡Œï¼Œä½†æ˜¯ç±»ä¼šæ¯”è¾ƒå¤š
    â”‚   â”‚                       â”œâ”€â”€ monitor # è¿è¡Œæ—¶æŒ‡æ ‡ç›‘æ§
    â”‚   â”‚                       â”œâ”€â”€ notification # çº¿ç¨‹æ± é…ç½®å˜æ›´å’Œå‘Šè­¦é€šçŸ¥
    â”‚   â”‚                       â”‚   â”œâ”€â”€ dto
    â”‚   â”‚                       â”‚   â””â”€â”€ service
    â”‚   â”‚                       â”œâ”€â”€ parser # è§£æé…ç½®å†…å®¹å­—ç¬¦ä¸²ä¸ºé”®å€¼å¯¹ Map
    â”‚   â”‚                       â””â”€â”€ toolkit # å·¥å…·åŒ…ï¼Œæ¯”å¦‚ï¼šçº¿ç¨‹æ± å’Œçº¿ç¨‹å·¥å‚æ„å»ºè€…
              
å¤§å®¶æœ€éœ€è¦å…³æ³¨çš„æ˜¯ alarmã€executorã€monitorã€notification å››ä¸ªåŒ…ã€‚

### 3. ç±»å›¾è®¾è®¡ {#3}

åœ¨ `core` åŒ…ä¸­ï¼Œæœ‰å››ä¸ªæœ€æ ¸å¿ƒçš„ç±»ï¼Œå®ƒä»¬æ„æˆäº†æ•´ä¸ªåŠ¨æ€çº¿ç¨‹æ± åŠŸèƒ½çš„åŸºç¡€ã€‚å…¶å…³ç³»å¦‚ä¸‹æ‰€ç¤ºï¼š

![iShot_2025-06-26_20.53.54.png](https://article-images.zsxq.com/FkqM-rk3f8UxBzTRHg1YzyUgfMrb "iShot_2025-06-26_20.53.54.png")

å…³é”®ç±»è¯¦è§£
-----

### 1. OneThreadExecutor {#1-one-thread-executor}

æœ‰åŒå­¦å¯èƒ½ä¼šé—®ï¼š**ä¸ºä»€ä¹ˆè¦å•ç‹¬å®šä¹‰ä¸€ä¸ªçº¿ç¨‹æ± åŸºç±»ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨åŸç”Ÿçš„`ThreadPoolExecutor`å‘¢ï¼Ÿ**

åŸå› æœ‰å¾ˆå¤šï¼Œä½†ä¸ºäº†å¾ªåºæ¸è¿›åœ°å±•å¼€è¯´æ˜ï¼Œè¿™é‡Œå…ˆè®²å…¶ä¸­ä¸€ä¸ªæœ€å…³é”®çš„ç‚¹ï¼š
> åŸç”Ÿçº¿ç¨‹æ± å¹¶æ²¡æœ‰çº¿ç¨‹æ±  ID æˆ–åç§°çš„æ¦‚å¿µã€‚

åœ¨å®é™…ä¸šåŠ¡ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦å¯¹çº¿ç¨‹æ± è¿›è¡Œè¿è¡Œæ—¶å˜æ›´ã€æŒ‡æ ‡ç›‘æ§ã€å‘Šè­¦é€šçŸ¥ç­‰æ“ä½œã€‚è€Œç¼ºä¹å”¯ä¸€æ ‡è¯†ï¼Œä¼šè®©æˆ‘ä»¬åœ¨é¢å¯¹å¤šä¸ªçº¿ç¨‹æ± æ—¶éš¾ä»¥å‡†ç¡®å®šä½ã€è¯†åˆ«å’Œç®¡ç†ã€‚

å› æ­¤ï¼Œä¸ºäº†æ”¯æŒæ›´å¼ºçš„å¯è§‚æµ‹æ€§ä¸å¯è¿ç»´æ€§ï¼Œæˆ‘ä»¬æŠ½è±¡å‡ºäº†å…·å¤‡çº¿ç¨‹æ± æ ‡è¯†èƒ½åŠ›çš„åŸºç±»ï¼Œä½œä¸ºåç»­æ‰©å±•çš„ç»Ÿä¸€å…¥å£ã€‚

å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ`ThreadPoolExecutor` æœ¬èº«å¹¶ä¸æ’æ–¥ç»§æ‰¿ï¼Œåè€Œåœ¨è®¾è®¡ä¸Šä¸ºç»§æ‰¿æ‰©å±•é¢„ç•™äº†å‡ ä¸ªå…³é”®çš„æ‰©å±•ç‚¹æ–¹æ³•ã€‚é€šè¿‡ç»§æ‰¿å¹¶é‡å†™è¿™äº›æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾æ³¨å…¥è‡ªå®šä¹‰è¡Œä¸ºï¼Œæ„å»ºæ›´æ™ºèƒ½çš„çº¿ç¨‹æ± ä½“ç³»ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * ä»»åŠ¡æ‰§è¡Œå‰é’©å­ï¼ˆå¯ç”¨äºè®°å½•å¼€å§‹æ—¶é—´ã€è®¾ç½®çº¿ç¨‹ä¸Šä¸‹æ–‡ç­‰ï¼‰
     */
    @Override
    protected void beforeExecute(Thread t, Runnable r) {
        super.beforeExecute(t, r);
        // è‡ªå®šä¹‰é€»è¾‘
    }
    â€‹
    /**
     * ä»»åŠ¡æ‰§è¡Œåé’©å­ï¼ˆå¯ç”¨äºç»Ÿè®¡æ‰§è¡Œè€—æ—¶ã€æ¸…ç†èµ„æºã€æ—¥å¿—è®°å½•ç­‰ï¼‰
     */
    @Override
    protected void afterExecute(Runnable r, Throwable t) {
        super.afterExecute(r, t);
        // è‡ªå®šä¹‰é€»è¾‘
    }
    â€‹
    /**
     * çº¿ç¨‹æ± ç»ˆæ­¢é’©å­ï¼ˆå¯ç”¨äºæ¸…ç†èµ„æºã€å‘é€é€šçŸ¥ç­‰ï¼‰
     */
    @Override
    protected void terminated() {
        super.terminated();
        // è‡ªå®šä¹‰é€»è¾‘
    }
    â€‹
              
ä¸‹é¢æ˜¯ `oneThread` çš„çº¿ç¨‹æ± åŸºç±»ï¼Œç›®å‰æˆ‘ä»¬åªåœ¨å…¶ä¸­**é›†æˆäº†çº¿ç¨‹æ± å”¯ä¸€æ ‡è¯†** è¿™ä¸€æ ¸å¿ƒèƒ½åŠ›ã€‚

åœ¨é˜…è¯»æºç æ—¶ï¼Œå»ºè®®å¤§å®¶æš‚æ—¶èšç„¦è¿™ä¸€åŠŸèƒ½ç‚¹ã€‚è‡³äºç±»ä¸­å…¶ä»–ç›¸å¯¹å¤æ‚çš„é€»è¾‘ï¼Œå¦‚æœä¸€æ—¶çœ‹ä¸å¤ªæ‡‚ä¹Ÿæ²¡å…³ç³»ï¼Œ**ä¸å…¶é™·å…¥ç»†èŠ‚ï¼Œä¸å¦‚å…ˆè·Ÿç€Breatheä¸€èµ·æŒ‰"ä¸»çº¿æ€è·¯"ä¸€æ­¥æ­¥æ·±å…¥ç†è§£ã€‚**  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * å¢å¼ºçš„åŠ¨æ€ã€æŠ¥è­¦å’Œå—ç›‘æ§çš„çº¿ç¨‹æ±  oneThread
     * <p>
     * ä½œè€…ï¼šé©¬ä¸
     * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
     * å¼€å‘æ—¶é—´ï¼š2025-04-20
     */
    @Slf4j
    public class OneThreadExecutor extends ThreadPoolExecutor {
    â€‹
        /**
         * çº¿ç¨‹æ± å”¯ä¸€æ ‡è¯†ï¼Œç”¨æ¥åŠ¨æ€å˜æ›´å‚æ•°ç­‰
         */
        @Getter
        private final String threadPoolId;
        // ......
    â€‹
        /**
         * Creates a new {@code ExtensibleThreadPoolExecutor} with the given initial parameters.
         *
         * @param threadPoolId           thread-pool id
         * @param corePoolSize           the number of threads to keep in the pool, even
         *                               if they are idle, unless {@code allowCoreThreadTimeOut} is set
         * @param maximumPoolSize        the maximum number of threads to allow in the
         *                               pool
         * @param keepAliveTime          when the number of threads is greater than
         *                               the core, this is the maximum time that excess idle threads
         *                               will wait for new tasks before terminating.
         * @param unit                   the time unit for the {@code keepAliveTime} argument
         * @param workQueue              the queue to use for holding tasks before they are
         *                               executed.  This queue will hold only the {@code Runnable}
         *                               tasks submitted by the {@code execute} method.
         * @param threadFactory          the factory to use when the executor
         *                               creates a new thread
         * @param handler                the handler to use when execution is blocked
         *                               because the thread bounds and queue capacities are reached
         * @param awaitTerminationMillis the maximum time to wait
         * @throws IllegalArgumentException if one of the following holds:<br>
         *                                  {@code corePoolSize < 0}<br>
         *                                  {@code keepAliveTime < 0}<br>
         *                                  {@code maximumPoolSize <= 0}<br>
         *                                  {@code maximumPoolSize < corePoolSize}
         * @throws NullPointerException     if {@code workQueue} or {@code unit}
         *                                  or {@code threadFactory} or {@code handler} is null
         */
        public OneThreadExecutor(
                @NonNull String threadPoolId,
                int corePoolSize,
                int maximumPoolSize,
                long keepAliveTime,
                @NonNull TimeUnit unit,
                @NonNull BlockingQueue<Runnable> workQueue,
                @NonNull ThreadFactory threadFactory,
                @NonNull RejectedExecutionHandler handler,
                long awaitTerminationMillis) {
            super(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue, threadFactory, handler);
            // ......
            // è®¾ç½®åŠ¨æ€çº¿ç¨‹æ± æ‰©å±•å±æ€§ï¼šçº¿ç¨‹æ±  ID æ ‡è¯†
            this.threadPoolId = threadPoolId;
            // ......
        }
    â€‹
        // ......
    }
              
### 2. ThreadPoolExecutorProperties {#2-thread-pool-executor-properties}

æœ‰åŒå­¦å¯èƒ½ä¼šé—®ï¼š**çº¿ç¨‹æ± çš„å‚æ•°æ˜æ˜å·²ç»åœ¨`OneThreadExecutor`ä¸­å®šä¹‰äº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å•ç‹¬æ‹†åˆ†å‡ºä¸€ä¸ªå±æ€§å®ä½“ç±»ï¼Ÿ**

è¿™æ˜¯å› ä¸ºçº¿ç¨‹æ± ä¸­çš„å‚æ•°é€šå¸¸**åˆ†æ•£åœ¨å¤šä¸ªå­—æ®µä¸­** ï¼Œå¹¶ä¸”åƒ**å‘Šè­¦é˜ˆå€¼ã€é€šçŸ¥è§„åˆ™ç­‰é…ç½®** åœ¨åŸç”Ÿçº¿ç¨‹æ± ä¸­æ˜¯æ ¹æœ¬ä¸å­˜åœ¨çš„ã€‚ä¸ºäº†æ›´å¥½åœ°æ”¯æŒåŠ¨æ€é…ç½®å’Œç»Ÿä¸€ç®¡ç†ï¼Œæˆ‘ä»¬é€šè¿‡ `threadPoolId` å°†è¿™äº›"å¤–å›´å‚æ•°"ä¸çº¿ç¨‹æ± è¿›è¡Œå…³è”ï¼Œå½¢æˆä¸€å¥—å®Œæ•´çš„é…ç½®ä½“ç³»ï¼Œä¾¿äºåœ¨è¿è¡Œæ—¶æŸ¥çœ‹ã€å­˜å‚¨ã€å˜æ›´å’Œè¿½è¸ªã€‚

å¦å¤–ï¼Œä¸ºäº†Breatheå†™ä»£ç æ–¹ä¾¿ï¼Œå‘Šè­¦å’Œé€šçŸ¥ç›¸å…³çš„å‚æ•°ç±»ç›®å‰æ˜¯ä»¥**é™æ€å†…éƒ¨ç±»** çš„å½¢å¼å­˜åœ¨ã€‚å¤§å®¶åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦å°†å…¶**æ‹†åˆ†ä¸ºç‹¬ç«‹çš„å¤–éƒ¨ç±»** ï¼Œä»¥æå‡å¯å¤ç”¨æ€§ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * çº¿ç¨‹æ± å±æ€§å‚æ•°
     * <p>
     * ä½œè€…ï¼šé©¬ä¸
     * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
     * å¼€å‘æ—¶é—´ï¼š2025-04-20
     */
    @Data
    @Builder
    @NoArgsConstructor
    @AllArgsConstructor
    @Accessors(chain = true)
    public class ThreadPoolExecutorProperties {
    â€‹
        /**
         * çº¿ç¨‹æ± å”¯ä¸€æ ‡è¯†
         */
        private String threadPoolId;
    â€‹
        /**
         * æ ¸å¿ƒçº¿ç¨‹æ•°
         */
        private Integer corePoolSize;
    â€‹
        /**
         * æœ€å¤§çº¿ç¨‹æ•°
         */
        private Integer maximumPoolSize;
    â€‹
        /**
         * é˜Ÿåˆ—å®¹é‡
         */
        private Integer queueCapacity;
    â€‹
        /**
         * é˜»å¡é˜Ÿåˆ—ç±»å‹
         */
        private String workQueue;
    â€‹
        /**
         * æ‹’ç»ç­–ç•¥ç±»å‹
         */
        private String rejectedHandler;
    â€‹
        /**
         * çº¿ç¨‹ç©ºé—²å­˜æ´»æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰
         */
        private Long keepAliveTime;
    â€‹
        /**
         * æ˜¯å¦å…è®¸æ ¸å¿ƒçº¿ç¨‹è¶…æ—¶
         */
        private Boolean allowCoreThreadTimeOut;
    â€‹
        /**
         * é€šçŸ¥é…ç½®
         */
        private NotifyConfig notify;
    â€‹
        /**
         * æŠ¥è­¦é…ç½®ï¼Œé»˜è®¤è®¾ç½®
         */
        private AlarmConfig alarm = new AlarmConfig();
    â€‹
        @Data
        @NoArgsConstructor
        @AllArgsConstructor
        public static class NotifyConfig {
    â€‹
            /**
             * æ¥æ”¶äººé›†åˆ
             */
            private String receives;
    â€‹
            /**
             * å‘Šè­¦é—´éš”ï¼Œå•ä½åˆ†é’Ÿ
             */
            private Integer interval = 5;
        }
    â€‹
        @Data
        @NoArgsConstructor
        @AllArgsConstructor
        public static class AlarmConfig {
    â€‹
            /**
             * é»˜è®¤å¼€å¯æŠ¥è­¦é…é…ç½®
             */
            private Boolean enable = Boolean.TRUE;
    â€‹
            /**
             * é˜Ÿåˆ—é˜ˆå€¼
             */
            private Integer queueThreshold = 80;
    â€‹
            /**
             * æ´»è·ƒçº¿ç¨‹é˜ˆå€¼
             */
            private Integer activeThreshold = 80;
        }
    }
              
### 3. ThreadPoolExecutorHolder {#3-thread-pool-executor-holder}

çº¿ç¨‹æ± å®ä¾‹å¯¹è±¡å’Œçº¿ç¨‹æ± å‚æ•°é…ç½®å¯¹è±¡æœ¬è´¨ä¸Šæ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„å®ä½“ã€‚ä½†åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦**åŒæ—¶æ“ä½œè¿™ä¸¤éƒ¨åˆ†ä¿¡æ¯** ï¼Œä¾‹å¦‚åœ¨æ‰§è¡ŒåŠ¨æ€å˜æ›´ã€çŠ¶æ€ç›‘æ§æˆ–å‘Šè­¦å¤„ç†æ—¶ã€‚

ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¼•å…¥äº† `Holder` çš„è®¾è®¡æ€è·¯ï¼Œå°†çº¿ç¨‹æ± å®ä¾‹ä¸å…¶å¯¹åº”çš„å±æ€§é…ç½®ï¼Œé€šè¿‡ `threadPoolId` è¿›è¡Œç»‘å®šå’Œèšåˆï¼Œå°è£…æˆä¸€ä¸ªç»Ÿä¸€çš„ç»“æ„ï¼Œä¾¿äºåç»­ç»Ÿä¸€ç®¡ç†ä¸è®¿é—®ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * çº¿ç¨‹æ± æ‰§è¡Œå™¨æŒæœ‰è€…å¯¹è±¡
     * <p>
     * ä½œè€…ï¼šé©¬ä¸
     * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
     * å¼€å‘æ—¶é—´ï¼š2025-04-20
     */
    @Data
    @AllArgsConstructor
    public class ThreadPoolExecutorHolder {
    â€‹
        /**
         * çº¿ç¨‹æ± å”¯ä¸€æ ‡è¯†
         */
        private String threadPoolId;
    â€‹
        /**
         * çº¿ç¨‹æ± 
         */
        private ThreadPoolExecutor executor;
    â€‹
        /**
         * çº¿ç¨‹æ± å±æ€§å‚æ•°
         */
        private ThreadPoolExecutorProperties executorProperties;
    }
              
### 4. OneThreadRegistry {#4-one-thread-registry}

çº¿ç¨‹æ± å®ä¾‹ä¸å…¶å‚æ•°é…ç½®çš„èšåˆé—®é¢˜è§£å†³åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘ä¸€ä¸ªç°å®é—®é¢˜ï¼š**å•ä¸ªé¡¹ç›®ä¸­å¾€å¾€ä¸æ­¢ä¸€ä¸ªåŠ¨æ€çº¿ç¨‹æ± å®ä¾‹** ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç»Ÿä¸€çš„**çº¿ç¨‹æ± ç®¡ç†å®¹å™¨** æ¥è¿›è¡Œé›†ä¸­å­˜å‚¨å’Œç®¡ç†ï¼Œè¿™å°±æ˜¯ `OneThreadRegistry` çš„ç”±æ¥ã€‚

è¿™ä¸ªæ³¨å†Œä¸­å¿ƒçš„è®¾è®¡éå¸¸ç®€æ´ï¼Œä¸»è¦æä¾›äº†ä»¥ä¸‹ä¸‰ç±»æ ¸å¿ƒèƒ½åŠ›ï¼š

*  
**æ–°å¢çº¿ç¨‹æ± å®ä¾‹** ï¼›  
*  
**æ ¹æ®çº¿ç¨‹æ± IDè·å–æŒ‡å®šå®ä¾‹** ï¼›  
*  
  **è·å–å½“å‰æ‰€æœ‰çº¿ç¨‹æ± å®ä¾‹** ã€‚

é€šè¿‡è¿™ä¸€ç®¡ç†å™¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»¥ç»Ÿä¸€çš„æ–¹å¼å¯¹æ‰€æœ‰çº¿ç¨‹æ± è¿›è¡Œæ³¨å†Œã€æŸ¥è¯¢å’Œç»´æŠ¤ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * åŠ¨æ€çº¿ç¨‹æ± ç®¡ç†å™¨ï¼Œç”¨äºç»Ÿä¸€ç®¡ç†çº¿ç¨‹æ± å®ä¾‹
     * <p>
     * ä½œè€…ï¼šé©¬ä¸
     * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
     * å¼€å‘æ—¶é—´ï¼š2025-04-20
     */
    public class OneThreadRegistry {
    â€‹
        /**
         * çº¿ç¨‹æ± æŒæœ‰è€…ç¼“å­˜ï¼Œkey ä¸ºçº¿ç¨‹æ± å”¯ä¸€æ ‡è¯†ï¼Œvalue ä¸ºçº¿ç¨‹æ± åŒ…è£…ç±»
         */
        private static final Map<String, ThreadPoolExecutorHolder> HOLDER_MAP = new ConcurrentHashMap<>();
    â€‹
        /**
         * æ³¨å†Œçº¿ç¨‹æ± åˆ°ç®¡ç†å™¨
         *
         * @param threadPoolId çº¿ç¨‹æ± å”¯ä¸€æ ‡è¯†
         * @param executor     çº¿ç¨‹æ± æ‰§è¡Œå™¨å®ä¾‹
         * @param properties   çº¿ç¨‹æ± å‚æ•°é…ç½®
         */
        public static void putHolder(String threadPoolId, ThreadPoolExecutor executor, ThreadPoolExecutorProperties properties) {
            ThreadPoolExecutorHolder executorHolder = new ThreadPoolExecutorHolder(threadPoolId, executor, properties);
            HOLDER_MAP.put(threadPoolId, executorHolder);
        }
    â€‹
        /**
         * æ ¹æ®çº¿ç¨‹æ±  ID è·å–å¯¹åº”çš„çº¿ç¨‹æ± åŒ…è£…å¯¹è±¡
         *
         * @param threadPoolId çº¿ç¨‹æ± å”¯ä¸€æ ‡è¯†
         * @return çº¿ç¨‹æ± æŒæœ‰è€…å¯¹è±¡
         */
        public static ThreadPoolExecutorHolder getHolder(String threadPoolId) {
            return HOLDER_MAP.get(threadPoolId);
        }
    â€‹
        /**
         * è·å–æ‰€æœ‰çº¿ç¨‹æ± é›†åˆ
         *
         * @return çº¿ç¨‹æ± é›†åˆ
         */
        public static Collection<ThreadPoolExecutorHolder> getAllHolders() {
            return HOLDER_MAP.values();
        }
    }
              
ä»¥ä¸Šè¿™å››ä¸ªç±»æ„æˆäº†åŠ¨æ€çº¿ç¨‹æ± ä½“ç³»ä¸­æœ€æ ¸å¿ƒçš„åŸºç¡€ä»£ç ï¼Œåç»­çš„æ‰€æœ‰åŠŸèƒ½è®¾è®¡å‡ ä¹éƒ½æ˜¯å›´ç»•å®ƒä»¬å±•å¼€çš„ã€‚

å½“å¤§å®¶å¯¹è¿™äº›åŸºç¡€è®¾æ–½æœ‰äº†æ¸…æ™°çš„ç†è§£ä¹‹åï¼Œå†å»é˜…è¯»å…¶ä»–åŸºäºè¿™äº›å¯¹è±¡æ„å»ºçš„ APIï¼Œå°±èƒ½æ›´å®¹æ˜“æŠŠæ¡å…¶èƒŒåçš„ä¸Šä¸‹æ–‡è¯­ä¹‰ä¸è®¾è®¡åŠ¨æœºï¼Œä»è€ŒçœŸæ­£åšåˆ°"çŸ¥å…¶ç„¶ï¼Œä¹ŸçŸ¥å…¶æ‰€ä»¥ç„¶"ã€‚

Builder è®¾è®¡æ¨¡å¼ {#builder}
-----------------------

### 1. ä»€ä¹ˆæ˜¯ Builder è®¾è®¡æ¨¡å¼ï¼Ÿ {#1-builder}

åœ¨ `core` åŒ…ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¼•å…¥äº†ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ ------ **Builderæ¨¡å¼** ã€‚

éšç€çº¿ç¨‹æ± åŠŸèƒ½é€æ­¥å¢å¼ºï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥æ›´å¤šè‡ªå®šä¹‰å‚æ•°ï¼Œä¾‹å¦‚ï¼šåŠ¨æ€çº¿ç¨‹æ± æ ‡è¯†ã€é¡¹ç›®å…³é—­æ—¶ç­‰å¾…ä»»åŠ¡å®Œæˆçš„æœ€å¤§æ—¶é•¿ç­‰ã€‚è¿™äº›å‚æ•°åœ¨æ„å»ºè¿‡ç¨‹ä¸­ä¸ä»…éœ€è¦è¿›è¡Œåˆç†æ€§æ ¡éªŒï¼Œè¿˜å¯èƒ½å½±å“æœ€ç»ˆæ„é€ å‡ºçš„çº¿ç¨‹æ± ç±»å‹ï¼ˆæ™®é€šæˆ–åŠ¨æ€çº¿ç¨‹æ± ï¼‰ã€‚

ä¸ºäº†è§£å†³ä¸Šè¿°æ„å»ºçµæ´»æ€§ä¸å¯ç»´æŠ¤æ€§çš„é—®é¢˜ï¼Œæˆ‘ä»¬è®¾è®¡äº† `ThreadPoolExecutorBuilder`ï¼Œå®ƒé‡‡ç”¨äº†ç»å…¸çš„ **Builderæ¨¡å¼** ï¼Œå°†çº¿ç¨‹æ± çš„å„é¡¹é…ç½®å‚æ•°å°è£…ä¸ºé“¾å¼è°ƒç”¨å½¢å¼ã€‚
> Builder æ¨¡å¼ä½œç”¨åŸŸï¼š**å¦‚æœç±»çš„å±æ€§ä¹‹é—´æœ‰ä¸€å®šçš„ä¾èµ–å…³ç³»æˆ–è€…çº¦æŸæ¡ä»¶ï¼ˆæºè‡ªè®¾è®¡æ¨¡å¼ä¹‹ç¾ï¼‰** ã€‚

![iShot_2025-06-26_20.53.55.png](https://article-images.zsxq.com/FqPzWrqg4pFJajwZ0RxNziYVAziT "iShot_2025-06-26_20.53.55.png")


<br />


å…³äº Builder æ¨¡å¼åœ¨çº¿ç¨‹æ± ä¸­çš„åº”ç”¨ï¼Œå…¶å®åœ¨ 12306 é¡¹ç›®ä¸­å·²æœ‰ä¸€ç¯‡æ–‡ç« ä¸“é—¨è®²è§£äº†ï¼šã€ŠHutool å¦‚ä½•ä½¿ç”¨ Builder æ¨¡å¼åˆ›å»ºçº¿ç¨‹æ± ã€‹ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å‰å¾€é˜…è¯»ã€‚
> ğŸ”— è®¿é—®æ–¹å¼ï¼šè¿›å…¥æ˜Ÿçƒä¸“æ ï¼ŒæŸ¥çœ‹ **12306ä¸“é¢˜** ï¼Œæ–‡ç« é“¾æ¥æ”¶å½•åœ¨å¯¹åº”çš„è¯­é›€æ–‡æ¡£ä¸­ã€‚
>
> æ­¤å¤–ï¼Œåç»­æˆ‘ä¹Ÿè®¡åˆ’å¯¹æ˜Ÿçƒå†…å®¹è¿›è¡Œæ•´ä½“é‡æ„ï¼Œå°†æ‰€æœ‰æ–‡ç« ç»Ÿä¸€è¿ç§»åˆ° [nageoffer.com](https://nageoffer.com)ï¼Œå¹¶å°†ä¸€äº›é€šç”¨çš„è®¾è®¡æ¨¡å¼ä¸å·¥ç¨‹è®¾è®¡äº®ç‚¹æŠ½è±¡æ•´ç†æˆç‹¬ç«‹ä¸“æ ï¼Œæ–¹ä¾¿å¤§å®¶ç³»ç»Ÿæ€§å­¦ä¹ ä¸æŸ¥é˜…ã€‚

### 2. å¸¸è§é—®é¢˜ç­”ç–‘ {#2}

å¯èƒ½æœ‰åŒå­¦ä¼šç–‘æƒ‘ï¼š**Lombokä¸æ˜¯ä¹Ÿæä¾›äº†`@Builder`æ³¨è§£å—ï¼Ÿé‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜è¦æ‰‹åŠ¨å®ç°Builderæ¨¡å¼å‘¢ï¼Ÿ**

ä¸ºäº†å¸®åŠ©å¤§å®¶æ›´ç›´è§‚åœ°ç†è§£ä¸¤è€…çš„å·®å¼‚ï¼Œæˆ‘æ•´ç†äº†ä¸€å¼ å¯¹æ¯”è¡¨æ ¼ï¼Œåˆ—å‡ºäº†æ‰‹åŠ¨å®ç° Builder ä¸ Lombok `@Builder` æ³¨è§£åœ¨ä½¿ç”¨ä¸Šçš„ä¸»è¦åŒºåˆ«å’Œå„è‡ªçš„é€‚ç”¨åœºæ™¯ï¼š  

|      å¯¹æ¯”é¡¹      |     å¸¸è§„ Builder æ¨¡å¼     |   Lombok `@Builder` æ³¨è§£    |
|---------------|-----------------------|---------------------------|
| **å®ç°æ–¹å¼**      | æ‰‹åŠ¨ç¼–å†™ `Builder` ç±»å’Œé“¾å¼æ–¹æ³• | è‡ªåŠ¨ç”Ÿæˆ `Builder` ç±»ã€æ„é€ å™¨å’Œé“¾å¼æ–¹æ³• |
| **ä»£ç æ§åˆ¶åŠ›**     | é«˜ï¼šå¯ä»¥è‡ªç”±æ§åˆ¶æ„é€ é€»è¾‘ã€å‚æ•°æ ¡éªŒã€é»˜è®¤å€¼ | ä½ï¼šé€»è¾‘å¤æ‚æ—¶ä¸æ˜“æ’å…¥ä¸­é—´å¤„ç†           |
| **å¯è¯»æ€§/IDEä½“éªŒ** | æ˜ç¡®ç»“æ„æ¸…æ™°ï¼Œå®¹æ˜“è°ƒè¯•å’Œå¯¼èˆª        | å¿«é€Ÿç”Ÿæˆï¼Œçœä»£ç ï¼Œä½†ä¸æ˜“é˜…è¯»ã€è°ƒè¯•         |
| **é»˜è®¤å€¼æ”¯æŒ**     | æ˜“äºé€šè¿‡æ„é€ å™¨é€»è¾‘æ³¨å…¥é»˜è®¤å€¼        | åªèƒ½ä¾èµ–å­—æ®µå®šä¹‰å¤„çš„åˆå§‹åŒ–ï¼ˆæˆ–åå¤„ç†ï¼‰       |
| **ç»§æ‰¿æ”¯æŒ**      | æ”¯æŒæ›´çµæ´»çš„ç»§æ‰¿å’Œæ‰©å±•           | ä¸æ”¯æŒç»§æ‰¿ Builderï¼Œå¤æ‚åœºæ™¯é™åˆ¶è¾ƒå¤š    |
| **æ–¹æ³•é‡è½½æ§åˆ¶**    | å¯ç²¾ç»†è®¾è®¡å¤šä¸ªæ„é€ è·¯å¾„           | ä¸æ”¯æŒå¤šç§æ„é€ æ–¹å¼ï¼Œå®¹æ˜“å—é™            |
| **ç”Ÿæˆé¢å¤–æ„é€ å™¨**   | è‡ªå·±æ§åˆ¶                  | ä¼šè‡ªåŠ¨ç”Ÿæˆ `builder()` æ–¹æ³•      |
| **å­¦ä¹ /ä½¿ç”¨æˆæœ¬**   | é«˜ä¸€äº›ï¼Œä½†é€»è¾‘æ¸…æ™°ï¼Œä¾¿äºç»´æŠ¤        | éå¸¸ä½ï¼Œä¸Šæ‰‹å¿«ï¼Œé€‚åˆç®€å•åœºæ™¯            |

Lombok æä¾›çš„ `@Builder` æ³¨è§£ç¡®å®å¾ˆæ–¹ä¾¿ï¼Œå®ƒçš„æœ€å¤§ä¼˜åŠ¿åœ¨äº**çœä»£ç ã€ä¸Šæ‰‹å¿«** ï¼Œéå¸¸é€‚åˆç”¨äºæ„å»ºç®€å•çš„ Java å¯¹è±¡ã€‚ä½†ç›¸æ¯”ä¹‹ä¸‹ï¼Œæ‰‹å†™çš„ Builder æ¨¡å¼åˆ™å…·æœ‰æ›´å¼ºçš„**çµæ´»æ€§å’Œå¯æ§æ€§** ï¼Œèƒ½å¤Ÿ**æ”¯æŒå¤æ‚æ„å»ºé€»è¾‘ã€å‚æ•°æ ¡éªŒã€é»˜è®¤å€¼æ³¨å…¥ç­‰æ‰©å±•åœºæ™¯** ã€‚

ä»¥æˆ‘ä»¬å½“å‰çš„çº¿ç¨‹æ± æ„å»ºå™¨ä¸ºä¾‹ï¼Œå¦‚æœå•çº¯ä½¿ç”¨ Lombok çš„ `@Builder`ï¼Œåªèƒ½æ„é€ å‡ºä¸€ä¸ªé™æ€å¯¹è±¡ï¼Œ**æ— æ³•æ ¹æ®æ„å»ºè¿‡ç¨‹ä¸­çš„å‚æ•°åŠ¨æ€å†³å®šæ˜¯åˆ›å»ºæ™®é€šçº¿ç¨‹æ± è¿˜æ˜¯åŠ¨æ€çº¿ç¨‹æ± ** ï¼Œä¹Ÿ**æ— æ³•åœ¨æ„å»ºè¿‡ç¨‹ä¸­æ’å…¥å®šåˆ¶åŒ–æ ¡éªŒæˆ–åˆå§‹åŒ–é€»è¾‘** ã€‚

è€Œåœ¨æˆ‘ä»¬æ‰‹å†™çš„æ„å»ºå™¨ä¸­ï¼Œæœ€ç»ˆ `build()` æ–¹æ³•å°±æ˜¯æ‰©å±•èƒ½åŠ›çš„æ ¸å¿ƒä½“ç°ã€‚ç›®å‰æˆ‘ä»¬åªéªŒè¯äº†éƒ¨åˆ†æ ¸å¿ƒå‚æ•°ï¼Œå®é™…ä¸Šè¿˜å¯ä»¥åœ¨è¿™é‡ŒåŠ å…¥æ›´å¤šæ ¡éªŒé€»è¾‘ï¼Œä¾‹å¦‚çº¿ç¨‹æ± å®¹é‡æ˜¯å¦åŒ¹é…ã€æ‹’ç»ç­–ç•¥æ˜¯å¦åˆæ³•ã€ç­‰å¾…æ—¶é•¿æ˜¯å¦è¶…é•¿ç­‰ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * æ„å»ºçº¿ç¨‹æ± å®ä¾‹
     */
    public ThreadPoolExecutor build() {
        BlockingQueue<Runnable> blockingQueue = BlockingQueueTypeEnum.createBlockingQueue(workQueueType.getName(), workQueueCapacity);
        RejectedExecutionHandler rejectedHandler = Optional.ofNullable(this.rejectedHandler)
                .orElseGet(() -> new ThreadPoolExecutor.AbortPolicy());
    â€‹
        Assert.notNull(threadFactory, "The thread factory cannot be null.");
    â€‹
        ThreadPoolExecutor threadPoolExecutor;
        if (dynamicPool) {
            threadPoolExecutor = new OneThreadExecutor(
                    threadPoolId,
                    corePoolSize,
                    maximumPoolSize,
                    keepAliveTime,
                    TimeUnit.SECONDS,
                    blockingQueue,
                    threadFactory,
                    rejectedHandler,
                    awaitTerminationMillis
            );
        } else {
            threadPoolExecutor = new ThreadPoolExecutor(
                    corePoolSize,
                    maximumPoolSize,
                    keepAliveTime,
                    TimeUnit.SECONDS,
                    blockingQueue,
                    threadFactory,
                    rejectedHandler
            );
        }
    â€‹
        threadPoolExecutor.allowCoreThreadTimeOut(allowCoreThreadTimeOut);
        return threadPoolExecutor;
    }
              
å¯èƒ½æœ‰åŒå­¦ä¼šé—®ï¼š**åƒ"ç­‰å¾…æ—¶é•¿æ˜¯å¦è¶…å‡ºé™åˆ¶"è¿™æ ·çš„å‚æ•°æ ¡éªŒï¼Œæˆ‘åœ¨è®¾ç½®å‚æ•°çš„æ—¶å€™ç›´æ¥æ ¡éªŒä¸å°±è¡Œäº†å—ï¼Ÿ**

ä»æŸäº›ç®€å•åœºæ™¯æ¥çœ‹ï¼Œè¿™ç¡®å®æ˜¯å¯è¡Œçš„ã€‚ä½†ä¸€æ—¦å‡ºç°**å‚æ•°ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»** ï¼Œå°±ä¸é€‚åˆåœ¨æ¯ä¸ª Setter æ–¹æ³•ä¸­é€ä¸€æ ¡éªŒäº†ã€‚
> è¿˜æœ‰ä¸€ç‚¹ï¼Œæœ‰å¯èƒ½ç”¨æˆ·æ²¡æœ‰è°ƒç”¨è¿™ä¸ªå‚æ•°æ–¹æ³•ï¼Œä½†æ˜¯æœ€ç»ˆæ˜¯éœ€è¦å¿…å¡«çš„ã€‚

ä¸¾ä¸ªå…¸å‹ä¾‹å­ï¼š**æ ¸å¿ƒçº¿ç¨‹æ•°ä¸èƒ½å¤§äºæœ€å¤§çº¿ç¨‹æ•°** ã€‚å¦‚æœä½ åœ¨è®¾ç½® `corePoolSize` æ—¶å°±è¿›è¡Œæ ¡éªŒï¼Œè€Œè¿™æ—¶ `maximumPoolSize` è¿˜æœªè®¾ç½®ï¼Œæ˜¾ç„¶æ ¡éªŒæ˜¯æ— æ•ˆæˆ–é”™è¯¯çš„ã€‚è¿™ç§è·¨å­—æ®µçš„é€»è¾‘ä¾èµ–ï¼Œåªæœ‰åœ¨ **æ‰€æœ‰å‚æ•°éƒ½é…ç½®å®Œæ¯•ã€å‡†å¤‡æ„å»ºå®ä¾‹çš„æœ€åä¸€æ­¥ï¼ˆå³`build()`æ–¹æ³•ï¼‰** æ—¶æ‰èƒ½ç»Ÿä¸€åˆ¤æ–­ã€‚

è¿˜æœ‰ä¸€ç‚¹ä¹Ÿå€¼å¾—æ³¨æ„ï¼š**æœ‰äº›å‚æ•°æ˜¯å¿…å¡«çš„ï¼Œä½†ç”¨æˆ·å¯èƒ½æ ¹æœ¬æ²¡æœ‰è°ƒç”¨å¯¹åº”çš„Setteræ–¹æ³•è¿›è¡Œè®¾ç½®** ã€‚

æ¯”å¦‚çº¿ç¨‹æ± çš„ `threadFactory` æˆ– `threadPoolId`ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹æ˜¯æ„é€ çº¿ç¨‹æ± æ‰€å¿…éœ€çš„æ ¸å¿ƒå‚æ•°ã€‚å¦‚æœä¸åœ¨æœ€ç»ˆçš„ `build()` æ–¹æ³•ä¸­ç»Ÿä¸€æ ¡éªŒè¿™äº›"å¿…å¡«ä½†å¯èƒ½è¢«é—æ¼"çš„å­—æ®µï¼Œå°±å¯èƒ½å¯¼è‡´çº¿ç¨‹æ± åœ¨è¿è¡Œæ—¶æŠ›å‡ºå¼‚å¸¸æˆ–å‡ºç°ä¸å¯é¢„æœŸçš„è¡Œä¸ºã€‚

å› æ­¤ï¼Œ**`build()`æ–¹æ³•ä¸ä»…æ˜¯æ„å»ºå®ä¾‹çš„å…¥å£ï¼Œä¹Ÿæ˜¯åš"æœ€ç»ˆå…œåº•æ ¡éªŒ"çš„æœ€ä½³ä½ç½®** ï¼Œå¯ä»¥æœ€å¤§ç¨‹åº¦åœ°ç¡®ä¿æ„é€ å‡ºæ¥çš„å¯¹è±¡æ˜¯å®Œæ•´ã€åˆæ³•ã€å¯ç”¨çš„ã€‚

æ–‡æœ«æ€»ç»“
----

é€šè¿‡æœ¬ç« çš„å­¦ä¹ ï¼Œæˆ‘ä»¬æ·±å…¥å‰–æäº† `oneThread` åŠ¨æ€çº¿ç¨‹æ± æ¡†æ¶ä¸­æ ¸å¿ƒåŸºç¡€ç±»çš„è®¾è®¡ç†å¿µä¸å®ç°æ–¹å¼ï¼Œæ¶µç›–çº¿ç¨‹æ± åŸºç±»ã€å‚æ•°å°è£…ã€æ³¨å†Œä¸­å¿ƒã€æ„å»ºå™¨ç­‰å…³é”®æ¨¡å—ã€‚è¿™äº›è®¾è®¡ä¸ä»…æå‡äº†çº¿ç¨‹æ± çš„å¯è§‚æµ‹æ€§å’Œå¯è¿ç»´æ€§ï¼Œä¹Ÿä¸ºåç»­åŠŸèƒ½æ‰©å±•ï¼ˆå¦‚è¿è¡Œæ—¶è°ƒå‚ã€å‘Šè­¦é€šçŸ¥ï¼‰æ‰“ä¸‹åšå®åŸºç¡€ã€‚

å»ºè®®å¤§å®¶åœ¨ç†è§£è¿™äº›åŸºç¡€ç»“æ„åï¼Œå†å»é˜…è¯»ä¸Šå±‚ç»„ä»¶ä»£ç ï¼Œèƒ½æ›´å¥½æŠŠæ¡æ•´ä½“æ¶æ„è„‰ç»œï¼Œå®ç°ä»"çŸ¥å…¶ç„¶"åˆ°"çŸ¥å…¶æ‰€ä»¥ç„¶"çš„è½¬å˜ã€‚

å®Œç»“ï¼Œæ’’èŠ± ğŸ‰  
è‡ªå®šä¹‰åŠ¨æ€çº¿ç¨‹æ± åŸºç¡€ç±»ï¼Œå…ƒæ•°æ®ä¿¡æ¯ï¼š

*  
ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± oneThreadï¼š<https://t.zsxq.com/5GfrN>  
*  
ä»£ç ä»“åº“ï¼š<https://gitcode.net/nageoffer/onethread> ------ ç”³è¯·é¡¹ç›®æƒé™å‚è€ƒä¸Šè¿°çº¿ç¨‹æ± é¡¹ç›®é“¾æ¥  
*  
ç« èŠ‚éš¾åº¦ï¼šâ˜…â˜…â˜†â˜†â˜† - ä¸­ç­‰  
*  
  è§†é¢‘åœ°å€ï¼šæœ¬ç« èŠ‚å†…å®¹ç®€å•ï¼Œæ— 



*** ** * ** ***

å†…å®¹æ‘˜è¦ï¼šæ ¸å¿ƒè®¾è®¡çš„æå‰è§„åˆ’ä¸æ•´ä½“æ„æ€ï¼Œæ˜¯æ„å»ºé«˜è´¨é‡åŠ¨æ€çº¿ç¨‹æ± æ¡†æ¶çš„åŸºçŸ³ï¼Œèƒ½å¤Ÿæœ‰æ•ˆé¿å…åæœŸå¤§å¹…è¿”å·¥ï¼ŒåŒæ—¶ä¸ºç³»ç»Ÿçš„çµæ´»æ‰©å±•å’Œç»´æŠ¤å¥ å®šåšå®åŸºç¡€ã€‚

è¯¾ç¨‹ç›®å½•å¦‚ä¸‹æ‰€ç¤ºï¼š

*  
æ ¸å¿ƒè®¾è®¡æ¦‚è¿°  
*  
å…³é”®ç±»è¯¦è§£  
*  
Builder è®¾è®¡æ¨¡å¼  
*  
  æ–‡æœ«æ€»ç»“

æ ¸å¿ƒè®¾è®¡æ¦‚è§ˆ
------

### 1. è®¾è®¡æ€æƒ³ {#1}

åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»åˆæ­¥äº†è§£äº†æˆ‘åœ¨è®¾è®¡åŸºç¡€ç»„ä»¶åº“æ—¶ç§‰æŒçš„æ ¸å¿ƒç†å¿µï¼š**å°½å¯èƒ½å‡å°‘å¯¹ä¸‰æ–¹æ¡†æ¶çš„ä¾èµ–** ã€‚

ç§‰æŒè¿™ä¸€è®¾è®¡æ€è·¯ï¼Œåœ¨æœ€åˆå¼€å‘ `oneThread` æ¡†æ¶æ—¶ï¼Œæˆ‘å°†å¤§éƒ¨åˆ†ä¸ç¬¬ä¸‰æ–¹æ¡†æ¶æ— å…³çš„é€šç”¨é€»è¾‘ï¼Œç»Ÿä¸€æŠ½è±¡å°è£…åœ¨äº† `onethread-core` æ¨¡å—ä¸­ã€‚

è¯¥æ¨¡å—ä¸»è¦æ‰¿æ‹…ä»¥ä¸‹æ ¸å¿ƒèŒè´£ï¼š

*  
å®šä¹‰åŠ¨æ€çº¿ç¨‹æ± çš„åŸºç¡€æŠ½è±¡ç±»ï¼›  
*  
æ‰§è¡Œçº¿ç¨‹æ± è¿è¡Œæ—¶çš„å‘Šè­¦æ‰«æé€»è¾‘ï¼›  
*  
æä¾›çº¿ç¨‹æ± è¿è¡ŒçŠ¶æ€çš„æŒ‡æ ‡é‡‡é›†èƒ½åŠ›ï¼›  
*  
  æ”¯æŒç›‘å¬é…ç½®ä¸­å¿ƒå˜æ›´ï¼Œå¹¶åŠ¨æ€è°ƒæ•´çº¿ç¨‹æ± å‚æ•°åŠè§¦å‘å‘Šè­¦é€šçŸ¥ã€‚

ä¸‹é¢æ˜¯ `onethread-core` æ¨¡å—çš„ `pom.xml` ä¾èµ–ï¼Œå¯ä»¥çœ‹åˆ°å®ƒ**å¹¶æœªå¼ºåˆ¶ä¾èµ–ä»»ä½•Springç›¸å…³çš„åŒ…** ï¼Œä¿æŒäº†è‰¯å¥½çš„ç‹¬ç«‹æ€§å’Œå¯ç§»æ¤æ€§ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    <?xml version="1.0" encoding="UTF-8"?>
    <project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
        <modelVersion>4.0.0</modelVersion>
        <parent>
            <groupId>com.nageoffer.onethread</groupId>
            <artifactId>onethread-all</artifactId>
            <version>0.0.1-SNAPSHOT</version>
        </parent>
        <artifactId>onethread-core</artifactId>
    â€‹
        <dependencies>
            <dependency>
                <groupId>cn.hutool</groupId>
                <artifactId>hutool-all</artifactId>
            </dependency>
    â€‹
            <dependency>
                <groupId>com.alibaba.fastjson2</groupId>
                <artifactId>fastjson2</artifactId>
            </dependency>
    â€‹
            <dependency>
                <groupId>org.yaml</groupId>
                <artifactId>snakeyaml</artifactId>
            </dependency>
    â€‹
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-test</artifactId>
                <scope>test</scope>
            </dependency>
    â€‹
            <dependency>
                <groupId>ch.qos.logback</groupId>
                <artifactId>logback-classic</artifactId>
            </dependency>
    â€‹
            <dependency>
                <groupId>io.micrometer</groupId>
                <artifactId>micrometer-core</artifactId>
            </dependency>
        </dependencies>
    </project>
              
æœ‰åŒå­¦å¯èƒ½ä¼šç–‘æƒ‘ï¼š**ä¸ºä»€ä¹ˆä¸Šè¿°ä¾èµ–ä¸­æ²¡æœ‰æ˜¾å¼æŒ‡å®šç‰ˆæœ¬å·ï¼Ÿ**

è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ï¼ˆé€šå¸¸æ˜¯ `parent` é¡¹ç›®çš„ `pom.xml`ï¼‰ä¸­ï¼Œå·²ç»é€šè¿‡ `<dependencyManagement>` ç»Ÿä¸€å®šä¹‰äº†å„ä¾èµ–çš„ç‰ˆæœ¬å·ã€‚å› æ­¤ï¼Œåœ¨ `onethread-core` æ¨¡å—ä¸­åªéœ€å£°æ˜ä¾èµ–çš„åæ ‡ï¼Œæ— éœ€é‡å¤æŒ‡å®šç‰ˆæœ¬ï¼ŒMaven ä¼šè‡ªåŠ¨ä»çˆ¶æ¨¡å—ç»§æ‰¿å¯¹åº”çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚è¿™æ ·ä¸ä»…æé«˜äº†ä¾èµ–ç®¡ç†çš„ç»Ÿä¸€æ€§ï¼Œä¹Ÿæœ‰åŠ©äºå‡å°‘ç‰ˆæœ¬å†²çªé£é™©ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    <properties>
        <java.version>17</java.version>
        <spring-boot.version>3.0.7</spring-boot.version>
        <spring-cloud.version>2022.0.3</spring-cloud.version>
        <spring-cloud-alibaba.version>2022.0.0.0-RC2</spring-cloud-alibaba.version>
        <hutool-all.version>5.8.37</hutool-all.version>
        <apollo-client-config-data.version>2.4.0</apollo-client-config-data.version>
        <fastjson2.version>2.0.57</fastjson2.version>
        <spotless-maven-plugin.version>2.22.1</spotless-maven-plugin.version>
        <maven-compiler-plugin.version>3.6.1</maven-compiler-plugin.version>
    </properties>
    â€‹
    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-dependencies</artifactId>
                <version>${spring-boot.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
    â€‹
            <dependency>
                <groupId>org.springframework.cloud</groupId>
                <artifactId>spring-cloud-dependencies</artifactId>
                <version>${spring-cloud.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
    â€‹
            <dependency>
                <groupId>com.alibaba.cloud</groupId>
                <artifactId>spring-cloud-alibaba-dependencies</artifactId>
                <version>${spring-cloud-alibaba.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
    â€‹
            <dependency>
                <groupId>cn.hutool</groupId>
                <artifactId>hutool-all</artifactId>
                <version>${hutool-all.version}</version>
            </dependency>
    â€‹
            <dependency>
                <groupId>com.ctrip.framework.apollo</groupId>
                <artifactId>apollo-client-config-data</artifactId>
                <version>${apollo-client-config-data.version}</version>
            </dependency>
    â€‹
            <dependency>
                <groupId>com.alibaba.fastjson2</groupId>
                <artifactId>fastjson2</artifactId>
                <version>${fastjson2.version}</version>
            </dependency>
        </dependencies>
    </dependencyManagement>
              
### 2. package è¯´æ˜ {#2-package}

åœ¨å‰é¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä»‹ç»è¿‡ `oneThread` æ¡†æ¶ä¸­å„ä¸ªæ¨¡å—ï¼ˆModuleï¼‰æ‰€æ‰¿æ‹…çš„èŒè´£ã€‚ä½†å½“æ—¶å¹¶æœªå±•å¼€åˆ°æ›´ç»†ç²’åº¦çš„ **packageå±‚çº§ç»“æ„** ã€‚

æœ¬æ–‡å°†è¿›ä¸€æ­¥è¯´æ˜ `onethread-core` æ¨¡å—ä¸­å„ä¸ªåŒ…çš„å…·ä½“ä½œç”¨ï¼Œå¸®åŠ©å¤§å®¶æ›´æ¸…æ™°åœ°ç†è§£å…¶å†…éƒ¨ç»“æ„ä¸è®¾è®¡æ„å›¾ã€‚

å…·ä½“åŒ…åˆ’åˆ†ä¸åŠŸèƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    .
    â”œâ”€â”€ src
    â”‚   â”œâ”€â”€ main
    â”‚   â”‚   â””â”€â”€ java
    â”‚   â”‚       â””â”€â”€ com
    â”‚   â”‚           â””â”€â”€ nageoffer
    â”‚   â”‚               â””â”€â”€ onethread
    â”‚   â”‚                   â””â”€â”€ core
    â”‚   â”‚                       â”œâ”€â”€ alarm # å‘Šè­¦æ‰«æ
    â”‚   â”‚                       â”œâ”€â”€ config # ç»„ä»¶åº“åŸºç¡€é…ç½®
    â”‚   â”‚                       â”œâ”€â”€ constant # å¸¸é‡ç±»
    â”‚   â”‚                       â”œâ”€â”€ executor # æœ€æœ€æ ¸å¿ƒçš„çº¿ç¨‹æ± åŸºç¡€åŒ…
    â”‚   â”‚                       â”‚   â””â”€â”€ support # æ ¸å¿ƒåŸºç¡€åŒ…è‡³ä¸Šå¢å¼ºçš„åŠŸèƒ½ï¼Œå¦‚æœä¸æ‹†åˆ†è¿™ä¸ªä¹Ÿè¡Œï¼Œä½†æ˜¯ç±»ä¼šæ¯”è¾ƒå¤š
    â”‚   â”‚                       â”œâ”€â”€ monitor # è¿è¡Œæ—¶æŒ‡æ ‡ç›‘æ§
    â”‚   â”‚                       â”œâ”€â”€ notification # çº¿ç¨‹æ± é…ç½®å˜æ›´å’Œå‘Šè­¦é€šçŸ¥
    â”‚   â”‚                       â”‚   â”œâ”€â”€ dto
    â”‚   â”‚                       â”‚   â””â”€â”€ service
    â”‚   â”‚                       â”œâ”€â”€ parser # è§£æé…ç½®å†…å®¹å­—ç¬¦ä¸²ä¸ºé”®å€¼å¯¹ Map
    â”‚   â”‚                       â””â”€â”€ toolkit # å·¥å…·åŒ…ï¼Œæ¯”å¦‚ï¼šçº¿ç¨‹æ± å’Œçº¿ç¨‹å·¥å‚æ„å»ºè€…
              
å¤§å®¶æœ€éœ€è¦å…³æ³¨çš„æ˜¯ alarmã€executorã€monitorã€notification å››ä¸ªåŒ…ã€‚

### 3. ç±»å›¾è®¾è®¡ {#3}

åœ¨ `core` åŒ…ä¸­ï¼Œæœ‰å››ä¸ªæœ€æ ¸å¿ƒçš„ç±»ï¼Œå®ƒä»¬æ„æˆäº†æ•´ä¸ªåŠ¨æ€çº¿ç¨‹æ± åŠŸèƒ½çš„åŸºç¡€ã€‚å…¶å…³ç³»å¦‚ä¸‹æ‰€ç¤ºï¼š

![iShot_2025-06-26_20.53.54.png](https://article-images.zsxq.com/FkqM-rk3f8UxBzTRHg1YzyUgfMrb "iShot_2025-06-26_20.53.54.png")

å…³é”®ç±»è¯¦è§£
-----

### 1. OneThreadExecutor {#1-one-thread-executor}

æœ‰åŒå­¦å¯èƒ½ä¼šé—®ï¼š**ä¸ºä»€ä¹ˆè¦å•ç‹¬å®šä¹‰ä¸€ä¸ªçº¿ç¨‹æ± åŸºç±»ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨åŸç”Ÿçš„`ThreadPoolExecutor`å‘¢ï¼Ÿ**

åŸå› æœ‰å¾ˆå¤šï¼Œä½†ä¸ºäº†å¾ªåºæ¸è¿›åœ°å±•å¼€è¯´æ˜ï¼Œè¿™é‡Œå…ˆè®²å…¶ä¸­ä¸€ä¸ªæœ€å…³é”®çš„ç‚¹ï¼š
> åŸç”Ÿçº¿ç¨‹æ± å¹¶æ²¡æœ‰çº¿ç¨‹æ±  ID æˆ–åç§°çš„æ¦‚å¿µã€‚

åœ¨å®é™…ä¸šåŠ¡ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦å¯¹çº¿ç¨‹æ± è¿›è¡Œè¿è¡Œæ—¶å˜æ›´ã€æŒ‡æ ‡ç›‘æ§ã€å‘Šè­¦é€šçŸ¥ç­‰æ“ä½œã€‚è€Œç¼ºä¹å”¯ä¸€æ ‡è¯†ï¼Œä¼šè®©æˆ‘ä»¬åœ¨é¢å¯¹å¤šä¸ªçº¿ç¨‹æ± æ—¶éš¾ä»¥å‡†ç¡®å®šä½ã€è¯†åˆ«å’Œç®¡ç†ã€‚

å› æ­¤ï¼Œä¸ºäº†æ”¯æŒæ›´å¼ºçš„å¯è§‚æµ‹æ€§ä¸å¯è¿ç»´æ€§ï¼Œæˆ‘ä»¬æŠ½è±¡å‡ºäº†å…·å¤‡çº¿ç¨‹æ± æ ‡è¯†èƒ½åŠ›çš„åŸºç±»ï¼Œä½œä¸ºåç»­æ‰©å±•çš„ç»Ÿä¸€å…¥å£ã€‚

å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ`ThreadPoolExecutor` æœ¬èº«å¹¶ä¸æ’æ–¥ç»§æ‰¿ï¼Œåè€Œåœ¨è®¾è®¡ä¸Šä¸ºç»§æ‰¿æ‰©å±•é¢„ç•™äº†å‡ ä¸ªå…³é”®çš„æ‰©å±•ç‚¹æ–¹æ³•ã€‚é€šè¿‡ç»§æ‰¿å¹¶é‡å†™è¿™äº›æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾æ³¨å…¥è‡ªå®šä¹‰è¡Œä¸ºï¼Œæ„å»ºæ›´æ™ºèƒ½çš„çº¿ç¨‹æ± ä½“ç³»ï¼š  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * ä»»åŠ¡æ‰§è¡Œå‰é’©å­ï¼ˆå¯ç”¨äºè®°å½•å¼€å§‹æ—¶é—´ã€è®¾ç½®çº¿ç¨‹ä¸Šä¸‹æ–‡ç­‰ï¼‰
     */
    @Override
    protected void beforeExecute(Thread t, Runnable r) {
        super.beforeExecute(t, r);
        // è‡ªå®šä¹‰é€»è¾‘
    }
    â€‹
    /**
     * ä»»åŠ¡æ‰§è¡Œåé’©å­ï¼ˆå¯ç”¨äºç»Ÿè®¡æ‰§è¡Œè€—æ—¶ã€æ¸…ç†èµ„æºã€æ—¥å¿—è®°å½•ç­‰ï¼‰
     */
    @Override
    protected void afterExecute(Runnable r, Throwable t) {
        super.afterExecute(r, t);
        // è‡ªå®šä¹‰é€»è¾‘
    }
    â€‹
    /**
     * çº¿ç¨‹æ± ç»ˆæ­¢é’©å­ï¼ˆå¯ç”¨äºæ¸…ç†èµ„æºã€å‘é€é€šçŸ¥ç­‰ï¼‰
     */
    @Override
    protected void terminated() {
        super.terminated();
        // è‡ªå®šä¹‰é€»è¾‘
    }
    â€‹
              
ä¸‹é¢æ˜¯ `oneThread` çš„çº¿ç¨‹æ± åŸºç±»ï¼Œç›®å‰æˆ‘ä»¬åªåœ¨å…¶ä¸­**é›†æˆäº†çº¿ç¨‹æ± å”¯ä¸€æ ‡è¯†** è¿™ä¸€æ ¸å¿ƒèƒ½åŠ›ã€‚

åœ¨é˜…è¯»æºç æ—¶ï¼Œå»ºè®®å¤§å®¶æš‚æ—¶èšç„¦è¿™ä¸€åŠŸèƒ½ç‚¹ã€‚è‡³äºç±»ä¸­å…¶ä»–ç›¸å¯¹å¤æ‚çš„é€»è¾‘ï¼Œå¦‚æœä¸€æ—¶çœ‹ä¸å¤ªæ‡‚ä¹Ÿæ²¡å…³ç³»ï¼Œ**ä¸å…¶é™·å…¥ç»†èŠ‚ï¼Œä¸å¦‚å…ˆè·Ÿç€Breatheä¸€èµ·æŒ‰"ä¸»çº¿æ€è·¯"ä¸€æ­¥æ­¥æ·±å…¥ç†è§£ã€‚**  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * å¢å¼ºçš„åŠ¨æ€ã€æŠ¥è­¦å’Œå—ç›‘æ§çš„çº¿ç¨‹æ±  oneThread
     * <p>
     * ä½œè€…ï¼šé©¬ä¸
     * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
     * å¼€å‘æ—¶é—´ï¼š2025-04-20
     */
    @Slf4j
    public class OneThreadExecutor extends ThreadPoolExecutor {
    â€‹
        /**
         * çº¿ç¨‹æ± å”¯ä¸€æ ‡è¯†ï¼Œç”¨æ¥åŠ¨æ€å˜æ›´å‚æ•°ç­‰
         */
        @Getter
        private final String threadPoolId;
        // ......
    â€‹
        /**
         * Creates a new {@code ExtensibleThreadPoolExecutor} with the given initial parameters.
         *
         * @param threadPoolId           thread-pool id
         * @param corePoolSize           the number of threads to keep in the pool, even
         *                               if they are idle, unless {@code allowCoreThreadTimeOut} is set
         * @param maximumPoolSize        the maximum number of threads to allow in the
         *                               pool
         * @param keepAliveTime          when the number of threads is greater than
         *                               the core, this is the maximum time that excess idle threads
         *                               will wait for new tasks before terminating.
         * @param unit                   the time unit for the {@code keepAliveTime} argument
         * @param workQueue              the queue to use for holding tasks before they are
         *                               executed.  This queue will hold only the {@code Runnable}
         *                               tasks submitted by the {@code execute} method.
         * @param threadFactory          the factory to use when the executor
         *                               creates a new thread
         * @param handler                the handler to use when execution is blocked
         *                               because the thread bounds and queue capacities are reached
         * @param awaitTerminationMillis the maximum time to wait
         * @throws IllegalArgumentException if one of the following holds:<br>
         *                                  {@code corePoolSize < 0}<br>
         *                                  {@code keepAliveTime < 0}<br>
         *                                  {@code maximumPoolSize <= 0}<br>
         *                                  {@code maximumPoolSize < corePoolSize}
         * @throws NullPointerException     if {@code workQueue} or {@code unit}
         *                                  or {@code threadFactory} or {@code handler} is null
         */
        public OneThreadExecutor(
                @NonNull String threadPoolId,
                int corePoolSize,
                int maximumPoolSize,
                long keepAliveTime,
                @NonNull TimeUnit unit,
                @NonNull BlockingQueue<Runnable> workQueue,
                @NonNull ThreadFactory threadFactory,
                @NonNull RejectedExecutionHandler handler,
                long awaitTerminationMillis) {
            super(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue, threadFactory, handler);
            // ......
            // è®¾ç½®åŠ¨æ€çº¿ç¨‹æ± æ‰©å±•å±æ€§ï¼šçº¿ç¨‹æ±  ID æ ‡è¯†
            this.threadPoolId = threadPoolId;
            // ......
        }
    â€‹
        // ......
    }
              
### 2. ThreadPoolExecutorProperties {#2-thread-pool-executor-properties}

æœ‰åŒå­¦å¯èƒ½ä¼šé—®ï¼š**çº¿ç¨‹æ± çš„å‚æ•°æ˜æ˜å·²ç»åœ¨`OneThreadExecutor`ä¸­å®šä¹‰äº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å•ç‹¬æ‹†åˆ†å‡ºä¸€ä¸ªå±æ€§å®ä½“ç±»ï¼Ÿ**

è¿™æ˜¯å› ä¸ºçº¿ç¨‹æ± ä¸­çš„å‚æ•°é€šå¸¸**åˆ†æ•£åœ¨å¤šä¸ªå­—æ®µä¸­** ï¼Œå¹¶ä¸”åƒ**å‘Šè­¦é˜ˆå€¼ã€é€šçŸ¥è§„åˆ™ç­‰é…ç½®** åœ¨åŸç”Ÿçº¿ç¨‹æ± ä¸­æ˜¯æ ¹æœ¬ä¸å­˜åœ¨çš„ã€‚ä¸ºäº†æ›´å¥½åœ°æ”¯æŒåŠ¨æ€é…ç½®å’Œç»Ÿä¸€ç®¡ç†ï¼Œæˆ‘ä»¬é€šè¿‡ `threadPoolId` å°†è¿™äº›"å¤–å›´å‚æ•°"ä¸çº¿ç¨‹æ± è¿›è¡Œå…³è”ï¼Œå½¢æˆä¸€å¥—å®Œæ•´çš„é…ç½®ä½“ç³»ï¼Œä¾¿äºåœ¨è¿è¡Œæ—¶æŸ¥çœ‹ã€å­˜å‚¨ã€å˜æ›´å’Œè¿½è¸ªã€‚

å¦å¤–ï¼Œä¸ºäº†Breatheå†™ä»£ç æ–¹ä¾¿ï¼Œå‘Šè­¦å’Œé€šçŸ¥ç›¸å…³çš„å‚æ•°ç±»ç›®å‰æ˜¯ä»¥**é™æ€å†…éƒ¨ç±»** çš„å½¢å¼å­˜åœ¨ã€‚å¤§å®¶åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦å°†å…¶**æ‹†åˆ†ä¸ºç‹¬ç«‹çš„å¤–éƒ¨ç±»** ï¼Œä»¥æå‡å¯å¤ç”¨æ€§ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * çº¿ç¨‹æ± å±æ€§å‚æ•°
     * <p>
     * ä½œè€…ï¼šé©¬ä¸
     * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
     * å¼€å‘æ—¶é—´ï¼š2025-04-20
     */
    @Data
    @Builder
    @NoArgsConstructor
    @AllArgsConstructor
    @Accessors(chain = true)
    public class ThreadPoolExecutorProperties {
    â€‹
        /**
         * çº¿ç¨‹æ± å”¯ä¸€æ ‡è¯†
         */
        private String threadPoolId;
    â€‹
        /**
         * æ ¸å¿ƒçº¿ç¨‹æ•°
         */
        private Integer corePoolSize;
    â€‹
        /**
         * æœ€å¤§çº¿ç¨‹æ•°
         */
        private Integer maximumPoolSize;
    â€‹
        /**
         * é˜Ÿåˆ—å®¹é‡
         */
        private Integer queueCapacity;
    â€‹
        /**
         * é˜»å¡é˜Ÿåˆ—ç±»å‹
         */
        private String workQueue;
    â€‹
        /**
         * æ‹’ç»ç­–ç•¥ç±»å‹
         */
        private String rejectedHandler;
    â€‹
        /**
         * çº¿ç¨‹ç©ºé—²å­˜æ´»æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰
         */
        private Long keepAliveTime;
    â€‹
        /**
         * æ˜¯å¦å…è®¸æ ¸å¿ƒçº¿ç¨‹è¶…æ—¶
         */
        private Boolean allowCoreThreadTimeOut;
    â€‹
        /**
         * é€šçŸ¥é…ç½®
         */
        private NotifyConfig notify;
    â€‹
        /**
         * æŠ¥è­¦é…ç½®ï¼Œé»˜è®¤è®¾ç½®
         */
        private AlarmConfig alarm = new AlarmConfig();
    â€‹
        @Data
        @NoArgsConstructor
        @AllArgsConstructor
        public static class NotifyConfig {
    â€‹
            /**
             * æ¥æ”¶äººé›†åˆ
             */
            private String receives;
    â€‹
            /**
             * å‘Šè­¦é—´éš”ï¼Œå•ä½åˆ†é’Ÿ
             */
            private Integer interval = 5;
        }
    â€‹
        @Data
        @NoArgsConstructor
        @AllArgsConstructor
        public static class AlarmConfig {
    â€‹
            /**
             * é»˜è®¤å¼€å¯æŠ¥è­¦é…é…ç½®
             */
            private Boolean enable = Boolean.TRUE;
    â€‹
            /**
             * é˜Ÿåˆ—é˜ˆå€¼
             */
            private Integer queueThreshold = 80;
    â€‹
            /**
             * æ´»è·ƒçº¿ç¨‹é˜ˆå€¼
             */
            private Integer activeThreshold = 80;
        }
    }
              
### 3. ThreadPoolExecutorHolder {#3-thread-pool-executor-holder}

çº¿ç¨‹æ± å®ä¾‹å¯¹è±¡å’Œçº¿ç¨‹æ± å‚æ•°é…ç½®å¯¹è±¡æœ¬è´¨ä¸Šæ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„å®ä½“ã€‚ä½†åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦**åŒæ—¶æ“ä½œè¿™ä¸¤éƒ¨åˆ†ä¿¡æ¯** ï¼Œä¾‹å¦‚åœ¨æ‰§è¡ŒåŠ¨æ€å˜æ›´ã€çŠ¶æ€ç›‘æ§æˆ–å‘Šè­¦å¤„ç†æ—¶ã€‚

ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¼•å…¥äº† `Holder` çš„è®¾è®¡æ€è·¯ï¼Œå°†çº¿ç¨‹æ± å®ä¾‹ä¸å…¶å¯¹åº”çš„å±æ€§é…ç½®ï¼Œé€šè¿‡ `threadPoolId` è¿›è¡Œç»‘å®šå’Œèšåˆï¼Œå°è£…æˆä¸€ä¸ªç»Ÿä¸€çš„ç»“æ„ï¼Œä¾¿äºåç»­ç»Ÿä¸€ç®¡ç†ä¸è®¿é—®ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * çº¿ç¨‹æ± æ‰§è¡Œå™¨æŒæœ‰è€…å¯¹è±¡
     * <p>
     * ä½œè€…ï¼šé©¬ä¸
     * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
     * å¼€å‘æ—¶é—´ï¼š2025-04-20
     */
    @Data
    @AllArgsConstructor
    public class ThreadPoolExecutorHolder {
    â€‹
        /**
         * çº¿ç¨‹æ± å”¯ä¸€æ ‡è¯†
         */
        private String threadPoolId;
    â€‹
        /**
         * çº¿ç¨‹æ± 
         */
        private ThreadPoolExecutor executor;
    â€‹
        /**
         * çº¿ç¨‹æ± å±æ€§å‚æ•°
         */
        private ThreadPoolExecutorProperties executorProperties;
    }
              
### 4. OneThreadRegistry {#4-one-thread-registry}

çº¿ç¨‹æ± å®ä¾‹ä¸å…¶å‚æ•°é…ç½®çš„èšåˆé—®é¢˜è§£å†³åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘ä¸€ä¸ªç°å®é—®é¢˜ï¼š**å•ä¸ªé¡¹ç›®ä¸­å¾€å¾€ä¸æ­¢ä¸€ä¸ªåŠ¨æ€çº¿ç¨‹æ± å®ä¾‹** ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç»Ÿä¸€çš„**çº¿ç¨‹æ± ç®¡ç†å®¹å™¨** æ¥è¿›è¡Œé›†ä¸­å­˜å‚¨å’Œç®¡ç†ï¼Œè¿™å°±æ˜¯ `OneThreadRegistry` çš„ç”±æ¥ã€‚

è¿™ä¸ªæ³¨å†Œä¸­å¿ƒçš„è®¾è®¡éå¸¸ç®€æ´ï¼Œä¸»è¦æä¾›äº†ä»¥ä¸‹ä¸‰ç±»æ ¸å¿ƒèƒ½åŠ›ï¼š

*  
**æ–°å¢çº¿ç¨‹æ± å®ä¾‹** ï¼›  
*  
**æ ¹æ®çº¿ç¨‹æ± IDè·å–æŒ‡å®šå®ä¾‹** ï¼›  
*  
  **è·å–å½“å‰æ‰€æœ‰çº¿ç¨‹æ± å®ä¾‹** ã€‚

é€šè¿‡è¿™ä¸€ç®¡ç†å™¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»¥ç»Ÿä¸€çš„æ–¹å¼å¯¹æ‰€æœ‰çº¿ç¨‹æ± è¿›è¡Œæ³¨å†Œã€æŸ¥è¯¢å’Œç»´æŠ¤ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * åŠ¨æ€çº¿ç¨‹æ± ç®¡ç†å™¨ï¼Œç”¨äºç»Ÿä¸€ç®¡ç†çº¿ç¨‹æ± å®ä¾‹
     * <p>
     * ä½œè€…ï¼šé©¬ä¸
     * åŠ é¡¹ç›®ç¾¤ï¼šæ—©åŠ å…¥å°±æ˜¯ä¼˜åŠ¿ï¼500äººå†…éƒ¨é¡¹ç›®ç¾¤ï¼Œåˆ†äº«çš„çŸ¥è¯†æ€»æœ‰ä½ éœ€è¦çš„ <a href="https://t.zsxq.com/cw7b9" />
     * å¼€å‘æ—¶é—´ï¼š2025-04-20
     */
    public class OneThreadRegistry {
    â€‹
        /**
         * çº¿ç¨‹æ± æŒæœ‰è€…ç¼“å­˜ï¼Œkey ä¸ºçº¿ç¨‹æ± å”¯ä¸€æ ‡è¯†ï¼Œvalue ä¸ºçº¿ç¨‹æ± åŒ…è£…ç±»
         */
        private static final Map<String, ThreadPoolExecutorHolder> HOLDER_MAP = new ConcurrentHashMap<>();
    â€‹
        /**
         * æ³¨å†Œçº¿ç¨‹æ± åˆ°ç®¡ç†å™¨
         *
         * @param threadPoolId çº¿ç¨‹æ± å”¯ä¸€æ ‡è¯†
         * @param executor     çº¿ç¨‹æ± æ‰§è¡Œå™¨å®ä¾‹
         * @param properties   çº¿ç¨‹æ± å‚æ•°é…ç½®
         */
        public static void putHolder(String threadPoolId, ThreadPoolExecutor executor, ThreadPoolExecutorProperties properties) {
            ThreadPoolExecutorHolder executorHolder = new ThreadPoolExecutorHolder(threadPoolId, executor, properties);
            HOLDER_MAP.put(threadPoolId, executorHolder);
        }
    â€‹
        /**
         * æ ¹æ®çº¿ç¨‹æ±  ID è·å–å¯¹åº”çš„çº¿ç¨‹æ± åŒ…è£…å¯¹è±¡
         *
         * @param threadPoolId çº¿ç¨‹æ± å”¯ä¸€æ ‡è¯†
         * @return çº¿ç¨‹æ± æŒæœ‰è€…å¯¹è±¡
         */
        public static ThreadPoolExecutorHolder getHolder(String threadPoolId) {
            return HOLDER_MAP.get(threadPoolId);
        }
    â€‹
        /**
         * è·å–æ‰€æœ‰çº¿ç¨‹æ± é›†åˆ
         *
         * @return çº¿ç¨‹æ± é›†åˆ
         */
        public static Collection<ThreadPoolExecutorHolder> getAllHolders() {
            return HOLDER_MAP.values();
        }
    }
              
ä»¥ä¸Šè¿™å››ä¸ªç±»æ„æˆäº†åŠ¨æ€çº¿ç¨‹æ± ä½“ç³»ä¸­æœ€æ ¸å¿ƒçš„åŸºç¡€ä»£ç ï¼Œåç»­çš„æ‰€æœ‰åŠŸèƒ½è®¾è®¡å‡ ä¹éƒ½æ˜¯å›´ç»•å®ƒä»¬å±•å¼€çš„ã€‚

å½“å¤§å®¶å¯¹è¿™äº›åŸºç¡€è®¾æ–½æœ‰äº†æ¸…æ™°çš„ç†è§£ä¹‹åï¼Œå†å»é˜…è¯»å…¶ä»–åŸºäºè¿™äº›å¯¹è±¡æ„å»ºçš„ APIï¼Œå°±èƒ½æ›´å®¹æ˜“æŠŠæ¡å…¶èƒŒåçš„ä¸Šä¸‹æ–‡è¯­ä¹‰ä¸è®¾è®¡åŠ¨æœºï¼Œä»è€ŒçœŸæ­£åšåˆ°"çŸ¥å…¶ç„¶ï¼Œä¹ŸçŸ¥å…¶æ‰€ä»¥ç„¶"ã€‚

Builder è®¾è®¡æ¨¡å¼ {#builder}
-----------------------

### 1. ä»€ä¹ˆæ˜¯ Builder è®¾è®¡æ¨¡å¼ï¼Ÿ {#1-builder}

åœ¨ `core` åŒ…ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¼•å…¥äº†ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ ------ **Builderæ¨¡å¼** ã€‚

éšç€çº¿ç¨‹æ± åŠŸèƒ½é€æ­¥å¢å¼ºï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥æ›´å¤šè‡ªå®šä¹‰å‚æ•°ï¼Œä¾‹å¦‚ï¼šåŠ¨æ€çº¿ç¨‹æ± æ ‡è¯†ã€é¡¹ç›®å…³é—­æ—¶ç­‰å¾…ä»»åŠ¡å®Œæˆçš„æœ€å¤§æ—¶é•¿ç­‰ã€‚è¿™äº›å‚æ•°åœ¨æ„å»ºè¿‡ç¨‹ä¸­ä¸ä»…éœ€è¦è¿›è¡Œåˆç†æ€§æ ¡éªŒï¼Œè¿˜å¯èƒ½å½±å“æœ€ç»ˆæ„é€ å‡ºçš„çº¿ç¨‹æ± ç±»å‹ï¼ˆæ™®é€šæˆ–åŠ¨æ€çº¿ç¨‹æ± ï¼‰ã€‚

ä¸ºäº†è§£å†³ä¸Šè¿°æ„å»ºçµæ´»æ€§ä¸å¯ç»´æŠ¤æ€§çš„é—®é¢˜ï¼Œæˆ‘ä»¬è®¾è®¡äº† `ThreadPoolExecutorBuilder`ï¼Œå®ƒé‡‡ç”¨äº†ç»å…¸çš„ **Builderæ¨¡å¼** ï¼Œå°†çº¿ç¨‹æ± çš„å„é¡¹é…ç½®å‚æ•°å°è£…ä¸ºé“¾å¼è°ƒç”¨å½¢å¼ã€‚
> Builder æ¨¡å¼ä½œç”¨åŸŸï¼š**å¦‚æœç±»çš„å±æ€§ä¹‹é—´æœ‰ä¸€å®šçš„ä¾èµ–å…³ç³»æˆ–è€…çº¦æŸæ¡ä»¶ï¼ˆæºè‡ªè®¾è®¡æ¨¡å¼ä¹‹ç¾ï¼‰** ã€‚

![iShot_2025-06-26_20.53.55.png](https://article-images.zsxq.com/FqPzWrqg4pFJajwZ0RxNziYVAziT "iShot_2025-06-26_20.53.55.png")


<br />


å…³äº Builder æ¨¡å¼åœ¨çº¿ç¨‹æ± ä¸­çš„åº”ç”¨ï¼Œå…¶å®åœ¨ 12306 é¡¹ç›®ä¸­å·²æœ‰ä¸€ç¯‡æ–‡ç« ä¸“é—¨è®²è§£äº†ï¼šã€ŠHutool å¦‚ä½•ä½¿ç”¨ Builder æ¨¡å¼åˆ›å»ºçº¿ç¨‹æ± ã€‹ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å‰å¾€é˜…è¯»ã€‚
> ğŸ”— è®¿é—®æ–¹å¼ï¼šè¿›å…¥æ˜Ÿçƒä¸“æ ï¼ŒæŸ¥çœ‹ **12306ä¸“é¢˜** ï¼Œæ–‡ç« é“¾æ¥æ”¶å½•åœ¨å¯¹åº”çš„è¯­é›€æ–‡æ¡£ä¸­ã€‚
>
> æ­¤å¤–ï¼Œåç»­æˆ‘ä¹Ÿè®¡åˆ’å¯¹æ˜Ÿçƒå†…å®¹è¿›è¡Œæ•´ä½“é‡æ„ï¼Œå°†æ‰€æœ‰æ–‡ç« ç»Ÿä¸€è¿ç§»åˆ° [nageoffer.com](https://nageoffer.com)ï¼Œå¹¶å°†ä¸€äº›é€šç”¨çš„è®¾è®¡æ¨¡å¼ä¸å·¥ç¨‹è®¾è®¡äº®ç‚¹æŠ½è±¡æ•´ç†æˆç‹¬ç«‹ä¸“æ ï¼Œæ–¹ä¾¿å¤§å®¶ç³»ç»Ÿæ€§å­¦ä¹ ä¸æŸ¥é˜…ã€‚

### 2. å¸¸è§é—®é¢˜ç­”ç–‘ {#2}

å¯èƒ½æœ‰åŒå­¦ä¼šç–‘æƒ‘ï¼š**Lombokä¸æ˜¯ä¹Ÿæä¾›äº†`@Builder`æ³¨è§£å—ï¼Ÿé‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜è¦æ‰‹åŠ¨å®ç°Builderæ¨¡å¼å‘¢ï¼Ÿ**

ä¸ºäº†å¸®åŠ©å¤§å®¶æ›´ç›´è§‚åœ°ç†è§£ä¸¤è€…çš„å·®å¼‚ï¼Œæˆ‘æ•´ç†äº†ä¸€å¼ å¯¹æ¯”è¡¨æ ¼ï¼Œåˆ—å‡ºäº†æ‰‹åŠ¨å®ç° Builder ä¸ Lombok `@Builder` æ³¨è§£åœ¨ä½¿ç”¨ä¸Šçš„ä¸»è¦åŒºåˆ«å’Œå„è‡ªçš„é€‚ç”¨åœºæ™¯ï¼š  

|      å¯¹æ¯”é¡¹      |     å¸¸è§„ Builder æ¨¡å¼     |   Lombok `@Builder` æ³¨è§£    |
|---------------|-----------------------|---------------------------|
| **å®ç°æ–¹å¼**      | æ‰‹åŠ¨ç¼–å†™ `Builder` ç±»å’Œé“¾å¼æ–¹æ³• | è‡ªåŠ¨ç”Ÿæˆ `Builder` ç±»ã€æ„é€ å™¨å’Œé“¾å¼æ–¹æ³• |
| **ä»£ç æ§åˆ¶åŠ›**     | é«˜ï¼šå¯ä»¥è‡ªç”±æ§åˆ¶æ„é€ é€»è¾‘ã€å‚æ•°æ ¡éªŒã€é»˜è®¤å€¼ | ä½ï¼šé€»è¾‘å¤æ‚æ—¶ä¸æ˜“æ’å…¥ä¸­é—´å¤„ç†           |
| **å¯è¯»æ€§/IDEä½“éªŒ** | æ˜ç¡®ç»“æ„æ¸…æ™°ï¼Œå®¹æ˜“è°ƒè¯•å’Œå¯¼èˆª        | å¿«é€Ÿç”Ÿæˆï¼Œçœä»£ç ï¼Œä½†ä¸æ˜“é˜…è¯»ã€è°ƒè¯•         |
| **é»˜è®¤å€¼æ”¯æŒ**     | æ˜“äºé€šè¿‡æ„é€ å™¨é€»è¾‘æ³¨å…¥é»˜è®¤å€¼        | åªèƒ½ä¾èµ–å­—æ®µå®šä¹‰å¤„çš„åˆå§‹åŒ–ï¼ˆæˆ–åå¤„ç†ï¼‰       |
| **ç»§æ‰¿æ”¯æŒ**      | æ”¯æŒæ›´çµæ´»çš„ç»§æ‰¿å’Œæ‰©å±•           | ä¸æ”¯æŒç»§æ‰¿ Builderï¼Œå¤æ‚åœºæ™¯é™åˆ¶è¾ƒå¤š    |
| **æ–¹æ³•é‡è½½æ§åˆ¶**    | å¯ç²¾ç»†è®¾è®¡å¤šä¸ªæ„é€ è·¯å¾„           | ä¸æ”¯æŒå¤šç§æ„é€ æ–¹å¼ï¼Œå®¹æ˜“å—é™            |
| **ç”Ÿæˆé¢å¤–æ„é€ å™¨**   | è‡ªå·±æ§åˆ¶                  | ä¼šè‡ªåŠ¨ç”Ÿæˆ `builder()` æ–¹æ³•      |
| **å­¦ä¹ /ä½¿ç”¨æˆæœ¬**   | é«˜ä¸€äº›ï¼Œä½†é€»è¾‘æ¸…æ™°ï¼Œä¾¿äºç»´æŠ¤        | éå¸¸ä½ï¼Œä¸Šæ‰‹å¿«ï¼Œé€‚åˆç®€å•åœºæ™¯            |

Lombok æä¾›çš„ `@Builder` æ³¨è§£ç¡®å®å¾ˆæ–¹ä¾¿ï¼Œå®ƒçš„æœ€å¤§ä¼˜åŠ¿åœ¨äº**çœä»£ç ã€ä¸Šæ‰‹å¿«** ï¼Œéå¸¸é€‚åˆç”¨äºæ„å»ºç®€å•çš„ Java å¯¹è±¡ã€‚ä½†ç›¸æ¯”ä¹‹ä¸‹ï¼Œæ‰‹å†™çš„ Builder æ¨¡å¼åˆ™å…·æœ‰æ›´å¼ºçš„**çµæ´»æ€§å’Œå¯æ§æ€§** ï¼Œèƒ½å¤Ÿ**æ”¯æŒå¤æ‚æ„å»ºé€»è¾‘ã€å‚æ•°æ ¡éªŒã€é»˜è®¤å€¼æ³¨å…¥ç­‰æ‰©å±•åœºæ™¯** ã€‚

ä»¥æˆ‘ä»¬å½“å‰çš„çº¿ç¨‹æ± æ„å»ºå™¨ä¸ºä¾‹ï¼Œå¦‚æœå•çº¯ä½¿ç”¨ Lombok çš„ `@Builder`ï¼Œåªèƒ½æ„é€ å‡ºä¸€ä¸ªé™æ€å¯¹è±¡ï¼Œ**æ— æ³•æ ¹æ®æ„å»ºè¿‡ç¨‹ä¸­çš„å‚æ•°åŠ¨æ€å†³å®šæ˜¯åˆ›å»ºæ™®é€šçº¿ç¨‹æ± è¿˜æ˜¯åŠ¨æ€çº¿ç¨‹æ± ** ï¼Œä¹Ÿ**æ— æ³•åœ¨æ„å»ºè¿‡ç¨‹ä¸­æ’å…¥å®šåˆ¶åŒ–æ ¡éªŒæˆ–åˆå§‹åŒ–é€»è¾‘** ã€‚

è€Œåœ¨æˆ‘ä»¬æ‰‹å†™çš„æ„å»ºå™¨ä¸­ï¼Œæœ€ç»ˆ `build()` æ–¹æ³•å°±æ˜¯æ‰©å±•èƒ½åŠ›çš„æ ¸å¿ƒä½“ç°ã€‚ç›®å‰æˆ‘ä»¬åªéªŒè¯äº†éƒ¨åˆ†æ ¸å¿ƒå‚æ•°ï¼Œå®é™…ä¸Šè¿˜å¯ä»¥åœ¨è¿™é‡ŒåŠ å…¥æ›´å¤šæ ¡éªŒé€»è¾‘ï¼Œä¾‹å¦‚çº¿ç¨‹æ± å®¹é‡æ˜¯å¦åŒ¹é…ã€æ‹’ç»ç­–ç•¥æ˜¯å¦åˆæ³•ã€ç­‰å¾…æ—¶é•¿æ˜¯å¦è¶…é•¿ç­‰ã€‚  
textjavascripttypescriptcsshtmlbashjsonmarkdownpythonjavaccpprubygorustphpsqlyaml Copy

                    /**
     * æ„å»ºçº¿ç¨‹æ± å®ä¾‹
     */
    public ThreadPoolExecutor build() {
        BlockingQueue<Runnable> blockingQueue = BlockingQueueTypeEnum.createBlockingQueue(workQueueType.getName(), workQueueCapacity);
        RejectedExecutionHandler rejectedHandler = Optional.ofNullable(this.rejectedHandler)
                .orElseGet(() -> new ThreadPoolExecutor.AbortPolicy());
    â€‹
        Assert.notNull(threadFactory, "The thread factory cannot be null.");
    â€‹
        ThreadPoolExecutor threadPoolExecutor;
        if (dynamicPool) {
            threadPoolExecutor = new OneThreadExecutor(
                    threadPoolId,
                    corePoolSize,
                    maximumPoolSize,
                    keepAliveTime,
                    TimeUnit.SECONDS,
                    blockingQueue,
                    threadFactory,
                    rejectedHandler,
                    awaitTerminationMillis
            );
        } else {
            threadPoolExecutor = new ThreadPoolExecutor(
                    corePoolSize,
                    maximumPoolSize,
                    keepAliveTime,
                    TimeUnit.SECONDS,
                    blockingQueue,
                    threadFactory,
                    rejectedHandler
            );
        }
    â€‹
        threadPoolExecutor.allowCoreThreadTimeOut(allowCoreThreadTimeOut);
        return threadPoolExecutor;
    }
              
å¯èƒ½æœ‰åŒå­¦ä¼šé—®ï¼š**åƒ"ç­‰å¾…æ—¶é•¿æ˜¯å¦è¶…å‡ºé™åˆ¶"è¿™æ ·çš„å‚æ•°æ ¡éªŒï¼Œæˆ‘åœ¨è®¾ç½®å‚æ•°çš„æ—¶å€™ç›´æ¥æ ¡éªŒä¸å°±è¡Œäº†å—ï¼Ÿ**

ä»æŸäº›ç®€å•åœºæ™¯æ¥çœ‹ï¼Œè¿™ç¡®å®æ˜¯å¯è¡Œçš„ã€‚ä½†ä¸€æ—¦å‡ºç°**å‚æ•°ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»** ï¼Œå°±ä¸é€‚åˆåœ¨æ¯ä¸ª Setter æ–¹æ³•ä¸­é€ä¸€æ ¡éªŒäº†ã€‚
> è¿˜æœ‰ä¸€ç‚¹ï¼Œæœ‰å¯èƒ½ç”¨æˆ·æ²¡æœ‰è°ƒç”¨è¿™ä¸ªå‚æ•°æ–¹æ³•ï¼Œä½†æ˜¯æœ€ç»ˆæ˜¯éœ€è¦å¿…å¡«çš„ã€‚

ä¸¾ä¸ªå…¸å‹ä¾‹å­ï¼š**æ ¸å¿ƒçº¿ç¨‹æ•°ä¸èƒ½å¤§äºæœ€å¤§çº¿ç¨‹æ•°** ã€‚å¦‚æœä½ åœ¨è®¾ç½® `corePoolSize` æ—¶å°±è¿›è¡Œæ ¡éªŒï¼Œè€Œè¿™æ—¶ `maximumPoolSize` è¿˜æœªè®¾ç½®ï¼Œæ˜¾ç„¶æ ¡éªŒæ˜¯æ— æ•ˆæˆ–é”™è¯¯çš„ã€‚è¿™ç§è·¨å­—æ®µçš„é€»è¾‘ä¾èµ–ï¼Œåªæœ‰åœ¨ **æ‰€æœ‰å‚æ•°éƒ½é…ç½®å®Œæ¯•ã€å‡†å¤‡æ„å»ºå®ä¾‹çš„æœ€åä¸€æ­¥ï¼ˆå³`build()`æ–¹æ³•ï¼‰** æ—¶æ‰èƒ½ç»Ÿä¸€åˆ¤æ–­ã€‚

è¿˜æœ‰ä¸€ç‚¹ä¹Ÿå€¼å¾—æ³¨æ„ï¼š**æœ‰äº›å‚æ•°æ˜¯å¿…å¡«çš„ï¼Œä½†ç”¨æˆ·å¯èƒ½æ ¹æœ¬æ²¡æœ‰è°ƒç”¨å¯¹åº”çš„Setteræ–¹æ³•è¿›è¡Œè®¾ç½®** ã€‚

æ¯”å¦‚çº¿ç¨‹æ± çš„ `threadFactory` æˆ– `threadPoolId`ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹æ˜¯æ„é€ çº¿ç¨‹æ± æ‰€å¿…éœ€çš„æ ¸å¿ƒå‚æ•°ã€‚å¦‚æœä¸åœ¨æœ€ç»ˆçš„ `build()` æ–¹æ³•ä¸­ç»Ÿä¸€æ ¡éªŒè¿™äº›"å¿…å¡«ä½†å¯èƒ½è¢«é—æ¼"çš„å­—æ®µï¼Œå°±å¯èƒ½å¯¼è‡´çº¿ç¨‹æ± åœ¨è¿è¡Œæ—¶æŠ›å‡ºå¼‚å¸¸æˆ–å‡ºç°ä¸å¯é¢„æœŸçš„è¡Œä¸ºã€‚

å› æ­¤ï¼Œ**`build()`æ–¹æ³•ä¸ä»…æ˜¯æ„å»ºå®ä¾‹çš„å…¥å£ï¼Œä¹Ÿæ˜¯åš"æœ€ç»ˆå…œåº•æ ¡éªŒ"çš„æœ€ä½³ä½ç½®** ï¼Œå¯ä»¥æœ€å¤§ç¨‹åº¦åœ°ç¡®ä¿æ„é€ å‡ºæ¥çš„å¯¹è±¡æ˜¯å®Œæ•´ã€åˆæ³•ã€å¯ç”¨çš„ã€‚

æ–‡æœ«æ€»ç»“
----

é€šè¿‡æœ¬ç« çš„å­¦ä¹ ï¼Œæˆ‘ä»¬æ·±å…¥å‰–æäº† `oneThread` åŠ¨æ€çº¿ç¨‹æ± æ¡†æ¶ä¸­æ ¸å¿ƒåŸºç¡€ç±»çš„è®¾è®¡ç†å¿µä¸å®ç°æ–¹å¼ï¼Œæ¶µç›–çº¿ç¨‹æ± åŸºç±»ã€å‚æ•°å°è£…ã€æ³¨å†Œä¸­å¿ƒã€æ„å»ºå™¨ç­‰å…³é”®æ¨¡å—ã€‚è¿™äº›è®¾è®¡ä¸ä»…æå‡äº†çº¿ç¨‹æ± çš„å¯è§‚æµ‹æ€§å’Œå¯è¿ç»´æ€§ï¼Œä¹Ÿä¸ºåç»­åŠŸèƒ½æ‰©å±•ï¼ˆå¦‚è¿è¡Œæ—¶è°ƒå‚ã€å‘Šè­¦é€šçŸ¥ï¼‰æ‰“ä¸‹åšå®åŸºç¡€ã€‚

å»ºè®®å¤§å®¶åœ¨ç†è§£è¿™äº›åŸºç¡€ç»“æ„åï¼Œå†å»é˜…è¯»ä¸Šå±‚ç»„ä»¶ä»£ç ï¼Œèƒ½æ›´å¥½æŠŠæ¡æ•´ä½“æ¶æ„è„‰ç»œï¼Œå®ç°ä»"çŸ¥å…¶ç„¶"åˆ°"çŸ¥å…¶æ‰€ä»¥ç„¶"çš„è½¬å˜ã€‚

å®Œç»“ï¼Œæ’’èŠ± ğŸ‰

